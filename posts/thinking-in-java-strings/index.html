<!DOCTYPE html><html lang="zh-CN" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="《Java编程思想》第13章字符串" /><meta property="og:locale" content="zh_CN" /><meta name="description" content="第13章 字符串" /><meta property="og:description" content="第13章 字符串" /><link rel="canonical" href="https://malinkang.cn/posts/thinking-in-java-strings/" /><meta property="og:url" content="https://malinkang.cn/posts/thinking-in-java-strings/" /><meta property="og:site_name" content="malinkang" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2013-06-04T21:39:36+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="《Java编程思想》第13章字符串" /><meta name="twitter:site" content="@malinkang" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"description":"第13章 字符串","headline":"《Java编程思想》第13章字符串","dateModified":"2021-07-07T14:54:59+08:00","url":"https://malinkang.cn/posts/thinking-in-java-strings/","datePublished":"2013-06-04T21:39:36+08:00","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://malinkang.cn/posts/thinking-in-java-strings/"},"@context":"https://schema.org"}</script><title>《Java编程思想》第13章字符串 | malinkang</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="malinkang"><meta name="application-name" content="malinkang"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://malinkang-1253444926.cos.ap-beijing.myqcloud.com/images/avatar.jpeg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">malinkang</a></div><div class="site-subtitle font-italic">人生最可悲的事情，莫过于胸怀大志，却又虚度光阴。</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>分类</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>标签</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>归档</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>关于</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/malinkang" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/malinkang" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['linkang.ma','gmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>《Java编程思想》第13章字符串</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>《Java编程思想》第13章字符串</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> malinkang </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Tue, Jun 4, 2013, 9:39 PM +0800" prep="on" > Jun 4, 2013 <i class="unloaded">2013-06-04T21:39:36+08:00</i> </span></div><div> <span> <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Wed, Jul 7, 2021, 2:54 PM +0800" prefix="Updated " > Jul 7 <i class="unloaded">2021-07-07T14:54:59+08:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="7701 words">42 min</span></div></div><div class="post-content"><h1 id="第13章-字符串">第13章 字符串</h1><h2 id="131-不可变string">13.1 不可变String</h2><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Immutable</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">String</span> <span class="nf">upcase</span><span class="o">(</span><span class="nc">String</span> <span class="n">s</span><span class="o">){</span>
        <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="na">toUpperCase</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">q</span> <span class="o">=</span> <span class="s">"howdy"</span><span class="o">;</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">q</span><span class="o">);</span>
        <span class="nc">String</span> <span class="n">qq</span> <span class="o">=</span> <span class="n">upcase</span><span class="o">(</span><span class="n">q</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">qq</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">q</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>当把<code class="language-plaintext highlighter-rouge">q</code>传给<code class="language-plaintext highlighter-rouge">upcase()</code>方法时，实际传递的是引用的一份拷贝。其实，<strong>每当把</strong><code class="language-plaintext highlighter-rouge">String</code><strong>对象作为方法的参数时，都会复制一份引用</strong>，而该引用所指的对象其实一直待在单一的物理位置上，从未动过。</p><p>回到<code class="language-plaintext highlighter-rouge">upcase()</code>的定义，传入其中的引用有了名字<code class="language-plaintext highlighter-rouge">s</code>,只有<code class="language-plaintext highlighter-rouge">upcase()</code>运行的时候，局部引用<code class="language-plaintext highlighter-rouge">s</code>才存在。一旦<code class="language-plaintext highlighter-rouge">upcase()</code>运行结束，<code class="language-plaintext highlighter-rouge">s</code>就消失了。当然了，<code class="language-plaintext highlighter-rouge">upcase()</code>的返回值，其实只是最终结果的引用。这足以说明，<code class="language-plaintext highlighter-rouge">upcase()</code>返回的引用已经指向了一个新的对象，而原本的<code class="language-plaintext highlighter-rouge">q</code>则还在原地。</p><h2 id="132-重载与stringbuilder">13.2 重载“+”与StringBuilder</h2><p>操作符“+”可以用来连接<code class="language-plaintext highlighter-rouge">String</code>。</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Concatenation</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">mango</span> <span class="o">=</span>  <span class="s">"mango"</span><span class="o">;</span>
        <span class="nc">String</span> <span class="n">s</span> <span class="o">=</span> <span class="s">"abc"</span><span class="o">+</span><span class="n">mango</span><span class="o">+</span><span class="s">"def"</span><span class="o">+</span><span class="mi">47</span><span class="o">;</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">s</span><span class="o">);</span><span class="c1">//abcmangodef47</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>用<code class="language-plaintext highlighter-rouge">JDK</code>自带的工具<code class="language-plaintext highlighter-rouge">javap</code>来反编译以上代码。命令如下</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>javap -c Concatenation
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">-c</code>标志表示将生成<code class="language-plaintext highlighter-rouge">JVM</code>字节码。剔除不感兴趣的部分，有了以下的字节码。</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span><span class="o">[]);</span>
<span class="nl">Code:</span>
   <span class="mi">0</span><span class="o">:</span> <span class="n">ldc</span>           <span class="err">#</span><span class="mi">2</span>                  <span class="c1">// String mango</span>
   <span class="mi">2</span><span class="o">:</span> <span class="n">astore_1</span>
   <span class="mi">3</span><span class="o">:</span> <span class="k">new</span>           <span class="err">#</span><span class="mi">3</span>                  <span class="c1">// class java/lang/StringBuilder</span>
   <span class="mi">6</span><span class="o">:</span> <span class="n">dup</span>
   <span class="mi">7</span><span class="o">:</span> <span class="n">invokespecial</span> <span class="err">#</span><span class="mi">4</span>                  <span class="c1">// Method java/lang/StringBuilder."&lt;init&gt;":()V</span>
  <span class="mi">10</span><span class="o">:</span> <span class="n">ldc</span>           <span class="err">#</span><span class="mi">5</span>                  <span class="c1">// String abc</span>
  <span class="mi">12</span><span class="o">:</span> <span class="n">invokevirtual</span> <span class="err">#</span><span class="mi">6</span>                  <span class="c1">// Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;</span>
  <span class="mi">15</span><span class="o">:</span> <span class="n">aload_1</span>
  <span class="mi">16</span><span class="o">:</span> <span class="n">invokevirtual</span> <span class="err">#</span><span class="mi">6</span>                  <span class="c1">// Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;</span>
  <span class="mi">19</span><span class="o">:</span> <span class="n">ldc</span>           <span class="err">#</span><span class="mi">7</span>                  <span class="c1">// String def</span>
  <span class="mi">21</span><span class="o">:</span> <span class="n">invokevirtual</span> <span class="err">#</span><span class="mi">6</span>                  <span class="c1">// Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;</span>
  <span class="mi">24</span><span class="o">:</span> <span class="n">bipush</span>        <span class="mi">47</span>
  <span class="mi">26</span><span class="o">:</span> <span class="n">invokevirtual</span> <span class="err">#</span><span class="mi">8</span>                  <span class="c1">// Method java/lang/StringBuilder.append:(I)Ljava/lang/StringBuilder;</span>
  <span class="mi">29</span><span class="o">:</span> <span class="n">invokevirtual</span> <span class="err">#</span><span class="mi">9</span>                  <span class="c1">// Method java/lang/StringBuilder.toString:()Ljava/lang/String;</span>
  <span class="mi">32</span><span class="o">:</span> <span class="n">astore_2</span>
  <span class="mi">33</span><span class="o">:</span> <span class="n">getstatic</span>     <span class="err">#</span><span class="mi">10</span>                 <span class="c1">// Field java/lang/System.out:Ljava/io/PrintStream;</span>
  <span class="mi">36</span><span class="o">:</span> <span class="n">aload_2</span>
  <span class="mi">37</span><span class="o">:</span> <span class="n">invokevirtual</span> <span class="err">#</span><span class="mi">11</span>                 <span class="c1">// Method java/io/PrintStream.println:(Ljava/lang/String;)V</span>
  <span class="mi">40</span><span class="o">:</span> <span class="k">return</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">dup</code>与<code class="language-plaintext highlighter-rouge">invokevirtual</code>语句相当于<code class="language-plaintext highlighter-rouge">Java</code>虚拟机上的汇编语句。</p><p>在这个例子中，编译器创建了一个<code class="language-plaintext highlighter-rouge">StringBuilder</code>对象，用以构建最终的<code class="language-plaintext highlighter-rouge">String</code>，并为每个字符串调用一次<code class="language-plaintext highlighter-rouge">StringBuilder</code>的<code class="language-plaintext highlighter-rouge">append()</code>方法，总计四次。最后调用<code class="language-plaintext highlighter-rouge">toString()</code>生成结果，并存为<code class="language-plaintext highlighter-rouge">s</code>。</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">WhitherStringBuilder</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">implicit</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">fields</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">result</span> <span class="o">=</span> <span class="s">""</span><span class="o">;</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">fields</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">result</span> <span class="o">+=</span> <span class="n">fields</span><span class="o">[</span><span class="n">i</span><span class="o">];</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">explicit</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">fields</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">StringBuilder</span> <span class="n">result</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StringBuilder</span><span class="o">();</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">fields</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">result</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">fields</span><span class="o">[</span><span class="n">i</span><span class="o">]);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></table></code></div></div><p>运行<code class="language-plaintext highlighter-rouge">javap -c WhitherStringBuilder</code>。</p><p><code class="language-plaintext highlighter-rouge">implicit()</code>方法对应的字节码：</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="nf">implicit</span><span class="o">(</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span><span class="o">[]);</span>
<span class="nl">Code:</span>
   <span class="mi">0</span><span class="o">:</span> <span class="n">ldc</span>           <span class="err">#</span><span class="mi">2</span>                  <span class="c1">// String</span>
   <span class="mi">2</span><span class="o">:</span> <span class="n">astore_2</span>
   <span class="mi">3</span><span class="o">:</span> <span class="n">iconst_0</span>
   <span class="mi">4</span><span class="o">:</span> <span class="n">istore_3</span>
   <span class="mi">5</span><span class="o">:</span> <span class="n">iload_3</span>
   <span class="mi">6</span><span class="o">:</span> <span class="n">aload_1</span>
   <span class="mi">7</span><span class="o">:</span> <span class="n">arraylength</span>
   <span class="mi">8</span><span class="o">:</span> <span class="n">if_icmpge</span>     <span class="mi">38</span>
  <span class="mi">11</span><span class="o">:</span> <span class="k">new</span>           <span class="err">#</span><span class="mi">3</span>                  <span class="c1">// class java/lang/StringBuilder</span>
  <span class="mi">14</span><span class="o">:</span> <span class="n">dup</span>
  <span class="mi">15</span><span class="o">:</span> <span class="n">invokespecial</span> <span class="err">#</span><span class="mi">4</span>                  <span class="c1">// Method java/lang/StringBuilder."&lt;init&gt;":()V</span>
  <span class="mi">18</span><span class="o">:</span> <span class="n">aload_2</span>
  <span class="mi">19</span><span class="o">:</span> <span class="n">invokevirtual</span> <span class="err">#</span><span class="mi">5</span>                  <span class="c1">// Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;</span>
  <span class="mi">22</span><span class="o">:</span> <span class="n">aload_1</span>
  <span class="mi">23</span><span class="o">:</span> <span class="n">iload_3</span>
  <span class="mi">24</span><span class="o">:</span> <span class="n">aaload</span>
  <span class="mi">25</span><span class="o">:</span> <span class="n">invokevirtual</span> <span class="err">#</span><span class="mi">5</span>                  <span class="c1">// Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;</span>
  <span class="mi">28</span><span class="o">:</span> <span class="n">invokevirtual</span> <span class="err">#</span><span class="mi">6</span>                  <span class="c1">// Method java/lang/StringBuilder.toString:()Ljava/lang/String;</span>
  <span class="mi">31</span><span class="o">:</span> <span class="n">astore_2</span>
  <span class="mi">32</span><span class="o">:</span> <span class="n">iinc</span>          <span class="mi">3</span><span class="o">,</span> <span class="mi">1</span>
  <span class="mi">35</span><span class="o">:</span> <span class="k">goto</span>          <span class="mi">5</span>
  <span class="mi">38</span><span class="o">:</span> <span class="n">aload_2</span>
  <span class="mi">39</span><span class="o">:</span> <span class="n">areturn</span>
</pre></table></code></div></div><p>从第8行到第35行构成了一个循环体。第8行：对堆栈中的操作数进行“大于或等于的整数比较运算”，循环结束时跳到第38行。第35行：返回循环体的起始点第5行。要注意的重点是：<code class="language-plaintext highlighter-rouge">StringBuilder</code>是在循环之内构造的，这意味着每经过循环一次，就会创建一个新的<code class="language-plaintext highlighter-rouge">StringBuilder</code>对象。</p><p><code class="language-plaintext highlighter-rouge">explicit()</code>方法对应的字节码：</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="nf">explicit</span><span class="o">(</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span><span class="o">[]);</span>
<span class="nl">Code:</span>
   <span class="mi">0</span><span class="o">:</span> <span class="k">new</span>           <span class="err">#</span><span class="mi">3</span>                  <span class="c1">// class java/lang/StringBuilder</span>
   <span class="mi">3</span><span class="o">:</span> <span class="n">dup</span>
   <span class="mi">4</span><span class="o">:</span> <span class="n">invokespecial</span> <span class="err">#</span><span class="mi">4</span>                  <span class="c1">// Method java/lang/StringBuilder."&lt;init&gt;":()V</span>
   <span class="mi">7</span><span class="o">:</span> <span class="n">astore_2</span>
   <span class="mi">8</span><span class="o">:</span> <span class="n">iconst_0</span>
   <span class="mi">9</span><span class="o">:</span> <span class="n">istore_3</span>
  <span class="mi">10</span><span class="o">:</span> <span class="n">iload_3</span>
  <span class="mi">11</span><span class="o">:</span> <span class="n">aload_1</span>
  <span class="mi">12</span><span class="o">:</span> <span class="n">arraylength</span>
  <span class="mi">13</span><span class="o">:</span> <span class="n">if_icmpge</span>     <span class="mi">30</span>
  <span class="mi">16</span><span class="o">:</span> <span class="n">aload_2</span>
  <span class="mi">17</span><span class="o">:</span> <span class="n">aload_1</span>
  <span class="mi">18</span><span class="o">:</span> <span class="n">iload_3</span>
  <span class="mi">19</span><span class="o">:</span> <span class="n">aaload</span>
  <span class="mi">20</span><span class="o">:</span> <span class="n">invokevirtual</span> <span class="err">#</span><span class="mi">5</span>                  <span class="c1">// Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;</span>
  <span class="mi">23</span><span class="o">:</span> <span class="n">pop</span>
  <span class="mi">24</span><span class="o">:</span> <span class="n">iinc</span>          <span class="mi">3</span><span class="o">,</span> <span class="mi">1</span>
  <span class="mi">27</span><span class="o">:</span> <span class="k">goto</span>          <span class="mi">10</span>
  <span class="mi">30</span><span class="o">:</span> <span class="n">aload_2</span>
  <span class="mi">31</span><span class="o">:</span> <span class="n">invokevirtual</span> <span class="err">#</span><span class="mi">6</span>                  <span class="c1">// Method java/lang/StringBuilder.toString:()Ljava/lang/String;</span>
  <span class="mi">34</span><span class="o">:</span> <span class="n">areturn</span>
</pre></table></code></div></div><p>可以看到，不仅循环部分的代码更简短、更简单，并且它只生成了一个<code class="language-plaintext highlighter-rouge">StringBuilder</code>对象。显式地创建<code class="language-plaintext highlighter-rouge">StringBuilder</code>还允许你预先指定<code class="language-plaintext highlighter-rouge">StringBuilder</code>的大小，避免多次重新分配缓存。</p><p>因此，当为一个类编写<code class="language-plaintext highlighter-rouge">toString()</code>方法时，如果字符串操作比较简单，那就可以信赖编译器，他会为你合理地构造最终的字符串结果。但是，如果你要在<code class="language-plaintext highlighter-rouge">toString()</code>方法中使用循环，那么最好自己创建一个<code class="language-plaintext highlighter-rouge">StringBuilder</code>对象，用它来构造最终的结果。</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">UsingStringBuilder</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">Random</span> <span class="n">rand</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Random</span><span class="o">(</span><span class="mi">47</span><span class="o">);</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">StringBuilder</span> <span class="n">result</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StringBuilder</span><span class="o">(</span><span class="s">"["</span><span class="o">);</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">25</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">result</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">rand</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="mi">100</span><span class="o">));</span>
            <span class="n">result</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">", "</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="n">result</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="n">result</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">-</span> <span class="mi">2</span><span class="o">,</span> <span class="n">result</span><span class="o">.</span><span class="na">length</span><span class="o">());</span>
        <span class="n">result</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">"]"</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">UsingStringBuilder</span> <span class="n">usb</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">UsingStringBuilder</span><span class="o">();</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">usb</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="cm">/*
[58, 55, 93, 61, 61, 29, 68, 0, 22, 7, 88, 28, 51, 89, 
9, 78, 98, 61, 20, 58, 16, 40, 11, 22, 4]
 */</span>
</pre></table></code></div></div><h2 id="133-无意识的递归">13.3 无意识的递归</h2><p><code class="language-plaintext highlighter-rouge">Java</code>中的每个类从根本上都是继承自<code class="language-plaintext highlighter-rouge">Object</code>，标准容器类自然也不例外。因此容器类都有<code class="language-plaintext highlighter-rouge">toString()</code>方法，覆写了该方法，使得它生成的<code class="language-plaintext highlighter-rouge">String</code>结果能够表达容器自身，以及容器所包含的对象。例如<code class="language-plaintext highlighter-rouge">ArrayList.toString()</code>，它会遍历<code class="language-plaintext highlighter-rouge">ArrayList</code>中包含的所有对象，调用每个元素上的<code class="language-plaintext highlighter-rouge">toString()</code>方法：</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ArrayListDisplay</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">Coffee</span><span class="o">&gt;</span> <span class="n">coffees</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">Coffee</span><span class="o">&gt;();</span>
        <span class="k">for</span> <span class="o">(</span><span class="nc">Coffee</span> <span class="n">coffee</span> <span class="o">:</span> <span class="k">new</span> <span class="nc">CoffeeGenerator</span><span class="o">(</span><span class="mi">10</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">coffees</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">coffee</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">coffees</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="cm">/*
[Americano 0, Latte 1, Americano 2, Mocha 3, Mocha 4, Breve 5,
Americano 6, Latte 7, Cappuccino 8, Cappuccino 9]
 */</span>
</pre></table></code></div></div><p>如果希望<code class="language-plaintext highlighter-rouge">toString()</code>方法打印出对象的内存地址，也许会考虑使用<code class="language-plaintext highlighter-rouge">this</code>关键字：</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">InfiniteRecursion</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">"InfiniteRecursion address: "</span> <span class="o">+</span> <span class="k">this</span> <span class="o">+</span> <span class="s">"\n"</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">List</span><span class="o">&lt;</span><span class="nc">InfiniteRecursion</span><span class="o">&gt;</span> <span class="n">v</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">InfiniteRecursion</span><span class="o">&gt;();</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">v</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nc">InfiniteRecursion</span><span class="o">());</span>
        <span class="o">}</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">v</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>执行代码会得到一串非常长的异常。这里发生了自动类型转换，由<code class="language-plaintext highlighter-rouge">InfiniteRecursion</code>类型转换成<code class="language-plaintext highlighter-rouge">String</code>类型。因为编译器看到一个<code class="language-plaintext highlighter-rouge">String</code>对象后面跟着一个“+”，而在后面的对象不是<code class="language-plaintext highlighter-rouge">String</code>，于是编译器试着将<code class="language-plaintext highlighter-rouge">this</code>转换成一个<code class="language-plaintext highlighter-rouge">String</code>。调用<code class="language-plaintext highlighter-rouge">this</code>上的<code class="language-plaintext highlighter-rouge">toString()</code>方法进行转换，于是就发生了递归调用。所以不该使用<code class="language-plaintext highlighter-rouge">this</code>，而是应该调用<code class="language-plaintext highlighter-rouge">super.toString()</code>方法。</p><h2 id="134-string上的操作">13.4 String上的操作</h2><h2 id="135-格式化输出">13.5 格式化输出</h2><h3 id="1351-printf">13.5.1 printf()</h3><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"Row 1:[%d %f] \n"</span><span class="o">,</span><span class="mi">10</span><span class="o">,</span><span class="mf">2.5</span><span class="o">);</span><span class="c1">// Row 1:[10 2.500000]</span>
</pre></table></code></div></div><h3 id="1352-systemoutformat">13.5.2 System.out.format()</h3><p><code class="language-plaintext highlighter-rouge">Java SE5</code>引入的<code class="language-plaintext highlighter-rouge">format</code>方法可用于<code class="language-plaintext highlighter-rouge">PrintStream</code>或<code class="language-plaintext highlighter-rouge">PrintWriter</code>对象，其中也包括<code class="language-plaintext highlighter-rouge">System.out</code>对象。</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SimpleFormat</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">5</span><span class="o">;</span>
        <span class="kt">double</span> <span class="n">y</span> <span class="o">=</span> <span class="mf">5.332542</span><span class="o">;</span>
        <span class="c1">// The old way:</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Row 1: ["</span> <span class="o">+</span> <span class="n">x</span> <span class="o">+</span> <span class="s">" "</span> <span class="o">+</span> <span class="n">y</span> <span class="o">+</span> <span class="s">"]"</span><span class="o">);</span>
        <span class="c1">// The new way:</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"Row 1: [%d %f]\n"</span><span class="o">,</span> <span class="n">x</span><span class="o">,</span> <span class="n">y</span><span class="o">);</span>
        <span class="c1">// OR</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"Row 1: [%d %f]\n"</span><span class="o">,</span> <span class="n">x</span><span class="o">,</span> <span class="n">y</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="cm">/*
Row 1: [5 5.332542]
Row 1: [5 5.332542]
Row 1: [5 5.332542]
 */</span>
</pre></table></code></div></div><p>可以看到，<code class="language-plaintext highlighter-rouge">format()</code>与<code class="language-plaintext highlighter-rouge">printf()</code>是等价的。</p><h3 id="1353-formatter类">13.5.3 Formatter类</h3><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Turtle</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">Formatter</span> <span class="n">f</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">Turtle</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">,</span> <span class="nc">Formatter</span> <span class="n">f</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">f</span> <span class="o">=</span> <span class="n">f</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">move</span><span class="o">(</span><span class="kt">int</span> <span class="n">x</span><span class="o">,</span> <span class="kt">int</span> <span class="n">y</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">f</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"%s The Turtle is at (%d,%d)\n"</span><span class="o">,</span> <span class="n">name</span><span class="o">,</span> <span class="n">x</span><span class="o">,</span> <span class="n">y</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">PrintStream</span> <span class="n">outAlias</span> <span class="o">=</span><span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">;</span>
        <span class="nc">Turtle</span> <span class="n">tommy</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Turtle</span><span class="o">(</span><span class="s">"Tommy"</span><span class="o">,</span><span class="k">new</span> <span class="nc">Formatter</span><span class="o">(</span><span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">));</span>
        <span class="nc">Turtle</span> <span class="n">terry</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Turtle</span><span class="o">(</span><span class="s">"Terry"</span><span class="o">,</span><span class="k">new</span> <span class="nc">Formatter</span><span class="o">(</span><span class="n">outAlias</span><span class="o">));</span>
        <span class="n">tommy</span><span class="o">.</span><span class="na">move</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span><span class="mi">0</span><span class="o">);</span>
        <span class="n">terry</span><span class="o">.</span><span class="na">move</span><span class="o">(</span><span class="mi">4</span><span class="o">,</span><span class="mi">8</span><span class="o">);</span>
        <span class="n">tommy</span><span class="o">.</span><span class="na">move</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span><span class="mi">4</span><span class="o">);</span>
        <span class="n">terry</span><span class="o">.</span><span class="na">move</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span><span class="mi">5</span><span class="o">);</span>
        <span class="n">tommy</span><span class="o">.</span><span class="na">move</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span><span class="mi">3</span><span class="o">);</span>
        <span class="n">terry</span><span class="o">.</span><span class="na">move</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span><span class="mi">3</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span>
<span class="cm">/*
Tommy The Turtle is at (0,0)
Terry The Turtle is at (4,8)
Tommy The Turtle is at (3,4)
Terry The Turtle is at (2,5)
Tommy The Turtle is at (3,3)
Terry The Turtle is at (3,3)
 */</span>
</pre></table></code></div></div><h3 id="1354-格式化说明符">13.5.4 格式化说明符</h3><p>在插入数据时，如果想要控制空格与对齐，你需要更精细复杂的格式修饰符，一下是其抽象的语法：</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>%[argument_index$][flags][width][precision]conversion
</pre></table></code></div></div><p>通过指定<code class="language-plaintext highlighter-rouge">width</code>来实现控制一个域的最小尺寸。<code class="language-plaintext highlighter-rouge">Formatter</code>对象通过在必要时添加空格，来确保一个域至少达到某个长度。在默认情况下，数据时右对齐，不过可以通过使用“-”标志来改变对齐方向。</p><p>与<code class="language-plaintext highlighter-rouge">width</code>相对的是<code class="language-plaintext highlighter-rouge">precision</code>,它用来指明最大尺寸。<code class="language-plaintext highlighter-rouge">width</code>可以用用于各种类型的数据转换，并且其行为方式都一样。<code class="language-plaintext highlighter-rouge">precision</code>则不然，不是所有类型的数据都能使用<code class="language-plaintext highlighter-rouge">precision</code>，而且，应用于不同类型的数据转换时，<code class="language-plaintext highlighter-rouge">precision</code>的意义也不同。在将<code class="language-plaintext highlighter-rouge">precision</code>应用于<code class="language-plaintext highlighter-rouge">String</code>时，它表示打印<code class="language-plaintext highlighter-rouge">String</code>时输出字符的最大数量。而在将<code class="language-plaintext highlighter-rouge">precision</code>应用于浮点数时，它表示小数部分要显示出来的位数（默认是6位小数），如果小数位过多则舍入，太少则在尾部补零。由于整数没有小数部分，所以<code class="language-plaintext highlighter-rouge">precision</code>无法应用于整数，如果你对整数应用<code class="language-plaintext highlighter-rouge">precision</code>，则会触发异常。</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Receipt</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kt">double</span> <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">Formatter</span> <span class="n">f</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Formatter</span><span class="o">(</span><span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">);</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">printTitle</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">f</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"%-15s %5s %10s \n"</span><span class="o">,</span> <span class="s">"Item"</span><span class="o">,</span> <span class="s">"Qty"</span><span class="o">,</span> <span class="s">"Price"</span><span class="o">);</span>
        <span class="n">f</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"%-15s %5s %10s \n"</span><span class="o">,</span> <span class="s">"----"</span><span class="o">,</span> <span class="s">"---"</span><span class="o">,</span> <span class="s">"-----"</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">print</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">,</span> <span class="kt">int</span> <span class="n">qty</span><span class="o">,</span> <span class="kt">double</span> <span class="n">price</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">f</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"%-15.15s %5d %10.2f \n"</span><span class="o">,</span> <span class="n">name</span><span class="o">,</span> <span class="n">qty</span><span class="o">,</span> <span class="n">price</span><span class="o">);</span>
        <span class="n">total</span> <span class="o">+=</span> <span class="n">price</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">printTotal</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">f</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"%-15s %5s %10.2f \n"</span><span class="o">,</span> <span class="s">"Tax"</span><span class="o">,</span> <span class="s">""</span><span class="o">,</span> <span class="n">total</span> <span class="o">*</span> <span class="mf">0.06</span><span class="o">);</span>
        <span class="n">f</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"%-15s %5s %10s \n"</span><span class="o">,</span> <span class="s">"Tax"</span><span class="o">,</span> <span class="s">""</span><span class="o">,</span> <span class="s">"-----"</span><span class="o">);</span>
        <span class="n">f</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"%-15s %5s %10.2f \n"</span><span class="o">,</span> <span class="s">"Total"</span><span class="o">,</span> <span class="s">""</span><span class="o">,</span> <span class="n">total</span> <span class="o">*</span> <span class="mf">1.06</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Receipt</span> <span class="n">receipt</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Receipt</span><span class="o">();</span>
        <span class="n">receipt</span><span class="o">.</span><span class="na">printTitle</span><span class="o">();</span>
        <span class="n">receipt</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"Jack's Magic Beans"</span><span class="o">,</span><span class="mi">4</span><span class="o">,</span><span class="mf">4.25</span><span class="o">);</span>
        <span class="n">receipt</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"Princess Peas"</span><span class="o">,</span><span class="mi">3</span><span class="o">,</span><span class="mf">5.1</span><span class="o">);</span>
        <span class="n">receipt</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"Three Bears Porridge"</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mf">14.29</span><span class="o">);</span>
        <span class="n">receipt</span><span class="o">.</span><span class="na">printTotal</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="cm">/*
Item              Qty      Price
----              ---      -----
Jack's Magic Be     4       4.25
Princess Peas       3       5.10
Three Bears Por     1      14.29
Tax                         1.42
Tax                        -----
Total                      25.06

 */</span>
</pre></table></code></div></div><h3 id="1355-formatter转换">13.5.5 Formatter转换</h3><p>类型转换字符：</p><ul><li>d 整数型（十进制）<li>c Unicode字符<li>b Boolean值<li>s String<li>f 浮点数（十进制）<li>e 浮点数（科学计数）<li>x 整数（十六进制）<li>h 散列码（十六进制）<li>% 字符”%”</ul><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Conversion</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Formatter</span> <span class="n">f</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Formatter</span><span class="o">(</span><span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">);</span>
        <span class="kt">char</span> <span class="n">u</span> <span class="o">=</span> <span class="sc">'a'</span><span class="o">;</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"u = 'a'"</span><span class="o">);</span>
        <span class="n">f</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"s: %s\n"</span><span class="o">,</span> <span class="n">u</span><span class="o">);</span>
<span class="c1">//        f.format("d: %d\n", u);</span>
        <span class="n">f</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"c: %c\n"</span><span class="o">,</span> <span class="n">u</span><span class="o">);</span>
        <span class="n">f</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"b: %b\n"</span><span class="o">,</span> <span class="n">u</span><span class="o">);</span>
<span class="c1">//        f.format("f: %f\n", u);</span>
<span class="c1">//        f.format("e: %e\n", u);</span>
<span class="c1">//        f.format("x: %x\n", u);</span>
<span class="c1">//        f.format("h: %h\n", u);</span>
        <span class="kt">int</span> <span class="n">v</span> <span class="o">=</span> <span class="mi">121</span><span class="o">;</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"v = 121"</span><span class="o">);</span>
        <span class="n">f</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"d: %d\n"</span><span class="o">,</span> <span class="n">v</span><span class="o">);</span>
        <span class="n">f</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"c: %c\n"</span><span class="o">,</span> <span class="n">v</span><span class="o">);</span>
        <span class="n">f</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"b: %b\n"</span><span class="o">,</span> <span class="n">v</span><span class="o">);</span>
        <span class="n">f</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"s: %s\n"</span><span class="o">,</span> <span class="n">v</span><span class="o">);</span>
<span class="c1">//        f.format("f: %f\n", v);</span>
<span class="c1">//        f.format("e: %e\n", v);</span>
        <span class="n">f</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"x: %x\n"</span><span class="o">,</span> <span class="n">v</span><span class="o">);</span>
        <span class="n">f</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"h: %h\n"</span><span class="o">,</span> <span class="n">v</span><span class="o">);</span>
        <span class="nc">BigInteger</span> <span class="n">w</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BigInteger</span><span class="o">(</span><span class="s">"50000000000000"</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"w = new BigInteger(\"50000000000000\")"</span><span class="o">);</span>
        <span class="n">f</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"d: %d\n"</span><span class="o">,</span> <span class="n">w</span><span class="o">);</span>
       <span class="c1">// f.format("c: %c\n", w);</span>
        <span class="n">f</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"b: %b\n"</span><span class="o">,</span> <span class="n">w</span><span class="o">);</span>
        <span class="n">f</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"s: %s\n"</span><span class="o">,</span> <span class="n">w</span><span class="o">);</span>
<span class="c1">//        f.format("f: %f\n", w);</span>
<span class="c1">//        f.format("e: %e\n", w);</span>
        <span class="n">f</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"x: %x\n"</span><span class="o">,</span> <span class="n">w</span><span class="o">);</span>
        <span class="n">f</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"h: %h\n"</span><span class="o">,</span> <span class="n">w</span><span class="o">);</span>
        <span class="kt">double</span> <span class="n">x</span> <span class="o">=</span> <span class="mf">179.543</span><span class="o">;</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"x = 179.543"</span><span class="o">);</span>
<span class="c1">//        f.format("d: %d\n", x);</span>
<span class="c1">//        f.format("c: %c\n", x);</span>
        <span class="n">f</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"b: %b\n"</span><span class="o">,</span> <span class="n">x</span><span class="o">);</span>
        <span class="n">f</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"s: %s\n"</span><span class="o">,</span> <span class="n">x</span><span class="o">);</span>
        <span class="n">f</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"f: %f\n"</span><span class="o">,</span> <span class="n">x</span><span class="o">);</span>
        <span class="n">f</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"e: %e\n"</span><span class="o">,</span> <span class="n">x</span><span class="o">);</span>
<span class="c1">//        f.format("x: %x\n", x);</span>
        <span class="n">f</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"h: %h\n"</span><span class="o">,</span> <span class="n">x</span><span class="o">);</span>
        <span class="nc">Conversion</span> <span class="n">y</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Conversion</span><span class="o">();</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"y = new Conversion()"</span><span class="o">);</span>
<span class="c1">//        f.format("d: %d\n", y);</span>
<span class="c1">//        f.format("c: %c\n", y);</span>
        <span class="n">f</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"b: %b\n"</span><span class="o">,</span> <span class="n">y</span><span class="o">);</span>
        <span class="n">f</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"s: %s\n"</span><span class="o">,</span> <span class="n">y</span><span class="o">);</span>
<span class="c1">//        f.format("f: %f\n", y);</span>
<span class="c1">//        f.format("e: %e\n", y);</span>
<span class="c1">//        f.format("x: %x\n", y);</span>
        <span class="n">f</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"h: %h\n"</span><span class="o">,</span> <span class="n">y</span><span class="o">);</span>
        <span class="kt">boolean</span> <span class="n">z</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"z = false"</span><span class="o">);</span>

<span class="c1">//        f.format("d: %d\n", z);</span>
<span class="c1">//        f.format("c: %c\n", z);</span>
        <span class="n">f</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"b: %b\n"</span><span class="o">,</span> <span class="n">z</span><span class="o">);</span>
        <span class="n">f</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"s: %s\n"</span><span class="o">,</span> <span class="n">z</span><span class="o">);</span>
<span class="c1">//        f.format("f: %f\n", z);</span>
<span class="c1">//        f.format("e: %e\n", z);</span>
<span class="c1">//        f.format("x: %x\n", z);</span>
        <span class="n">f</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"h: %h\n"</span><span class="o">,</span> <span class="n">z</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="cm">/*
u = 'a'
s: a
c: a
b: true
v = 121
d: 121
c: y
b: true
s: 121
x: 79
h: 79
w = new BigInteger("50000000000000")
d: 50000000000000
b: true
s: 50000000000000
x: 2d79883d2000
h: 8842a1a7
x = 179.543
b: true
s: 179.543
f: 179.543000
e: 1.795430e+02
h: 1ef462c
y = new Conversion()
b: true
s: strings.Conversion@7440e464
h: 7440e464
z = false
b: false
s: false
h: 4d5
 */</span>
</pre></table></code></div></div><p>程序中的每个变量都用到了<code class="language-plaintext highlighter-rouge">b</code>转换。虽然它对各种类型都是合法的，但其行为却不一定与你想象的一致。对于<code class="language-plaintext highlighter-rouge">boolean</code>基本类型或<code class="language-plaintext highlighter-rouge">Boolean</code>对象，其转换结果是对应的<code class="language-plaintext highlighter-rouge">true</code>或<code class="language-plaintext highlighter-rouge">false</code>。但是，对其他类型的参数，只要该参数不为<code class="language-plaintext highlighter-rouge">null</code>，那转换的结果就永远都是<code class="language-plaintext highlighter-rouge">true</code>。即使是数字0，转换结果依然是<code class="language-plaintext highlighter-rouge">true</code>，而这在其他语言中，往往转换为<code class="language-plaintext highlighter-rouge">false</code>。</p><h3 id="56-stringformat">5.6 String.format()</h3><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">DatabaseException</span> <span class="kd">extends</span> <span class="nc">Exception</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="nf">DatabaseException</span><span class="o">(</span><span class="kt">int</span> <span class="n">transactionID</span><span class="o">,</span><span class="kt">int</span> <span class="n">queryID</span><span class="o">,</span><span class="nc">String</span> <span class="n">message</span><span class="o">){</span>
        <span class="kd">super</span><span class="o">(</span><span class="nc">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"(t%d, q%d) %s"</span><span class="o">,</span><span class="n">transactionID</span><span class="o">,</span><span class="n">queryID</span><span class="o">,</span><span class="n">message</span><span class="o">));</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span><span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">DatabaseException</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span><span class="mi">7</span><span class="o">,</span><span class="s">"Write failed"</span><span class="o">);</span>
        <span class="o">}</span><span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">){</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="cm">/*
strings.DatabaseException: (t3, q7) Write failed

 */</span>
</pre></table></code></div></div><p><strong>一个十六进制转储（dump）工具</strong></p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Hex</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">String</span> <span class="nf">format</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">data</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">StringBuilder</span> <span class="n">result</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StringBuilder</span><span class="o">();</span>
        <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">byte</span> <span class="n">b</span> <span class="o">:</span> <span class="n">data</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">n</span> <span class="o">%</span> <span class="mi">16</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">result</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="nc">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"%05X: "</span><span class="o">,</span> <span class="n">n</span><span class="o">));</span>
            <span class="o">}</span>
            <span class="n">result</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="nc">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"%02X"</span><span class="o">,</span> <span class="n">b</span><span class="o">));</span>
            <span class="n">n</span><span class="o">++;</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">n</span> <span class="o">%</span> <span class="mi">16</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">result</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">"\n"</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="n">result</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">"\n"</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="k">if</span><span class="o">(</span><span class="n">args</span><span class="o">.</span><span class="na">length</span><span class="o">==</span><span class="mi">0</span><span class="o">){</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">format</span><span class="o">(</span><span class="nc">BinaryFile</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="s">"Hex.class"</span><span class="o">)));</span>
        <span class="o">}</span><span class="k">else</span><span class="o">{</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="nc">BinaryFile</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="k">new</span> <span class="nc">File</span><span class="o">(</span><span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">])));</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><h2 id="136-正则表达式">13.6 正则表达式</h2><h3 id="1361-基础">13.6.1 基础</h3><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Splitting</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">String</span> <span class="n">knights</span> <span class="o">=</span>
            <span class="s">"Then, when you have found the shrubbery, you must "</span> <span class="o">+</span>
                    <span class="s">"cut down the mightiest tree in the forest... "</span> <span class="o">+</span>
                    <span class="s">"with... a herring!"</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">split</span><span class="o">(</span><span class="nc">String</span> <span class="n">regex</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="nc">Arrays</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">knights</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="n">regex</span><span class="o">)));</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">split</span><span class="o">(</span><span class="s">" "</span><span class="o">);</span>
        <span class="n">split</span><span class="o">(</span><span class="s">"\\W+"</span><span class="o">);</span> <span class="c1">//非单词字符</span>
        <span class="n">split</span><span class="o">(</span><span class="s">"n\\W+"</span><span class="o">);</span> <span class="c1">//n后面跟着一个或多个非单词字符</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="cm">/*
[Then,, when, you, have, found, the, shrubbery,, you, must, cut, down,
the, mightiest, tree, in, the, forest..., with..., a, herring!]
[Then, when, you, have, found, the, shrubbery, you, must, cut, down,
the, mightiest, tree, in, the, forest, with, a, herring]
[The, whe, you have found the shrubbery, you must cut dow,
 the mightiest tree i, the forest... with... a herring!]

 */</span>
</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Replacing</span> <span class="o">{</span>
    <span class="kd">static</span> <span class="nc">String</span> <span class="n">s</span> <span class="o">=</span> <span class="nc">Splitting</span><span class="o">.</span><span class="na">knights</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">s</span><span class="o">.</span><span class="na">replaceFirst</span><span class="o">(</span><span class="s">"f\\w+"</span><span class="o">,</span><span class="s">"located"</span><span class="o">));</span><span class="c1">//以f开头后面跟一个或多个字母</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">s</span><span class="o">.</span><span class="na">replaceAll</span><span class="o">(</span><span class="s">"shrubbery|tree|herring"</span><span class="o">,</span><span class="s">"banana"</span><span class="o">));</span><span class="c1">//匹配三个单词中的任意一个</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><h3 id="1362-创建正则表达式">13.6.2 创建正则表达式</h3><p>字符类（character classes）:</p><ul><li>· ：任意字符<li>[abc]：包含a、b和c的任何字符<li>：除了a、b和c之外的任何字符<li>[a-zA-Z]：从a到z或从A到Z的任何字符<li>[abc[hij]]：任意a、b、c、h、i和j<li>[a-z&amp;&amp;[hij]]：任意h、i或j<li>\s：空白符<li>\S：非空白符<li>\d：数字[0-9]<li>\D：非数字<li>\w：词字符[a-zA-Z0-9]<li>\W：非词字符</ul><p>逻辑操作符：</p><ul><li>XY：Y跟在X后面<li>X|Y：X或Y<li>(X): 捕获组，可以在表达式中用\i引用第i个捕获组</ul><p>边界匹配符</p><ul><li>^：一行的开始<li>$：一行的结束<li>\b：词的边界<li>\B：非词的边界<li>\G：前一个匹配的结束</ul><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Rudolph</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">for</span> <span class="o">(</span><span class="nc">String</span> <span class="n">pattern</span> <span class="o">:</span> <span class="k">new</span> <span class="nc">String</span><span class="o">[]{</span><span class="s">"Rudolph"</span><span class="o">,</span> <span class="s">"[rR]udolph"</span><span class="o">,</span>
                <span class="s">"[rR][aeiou][a-z]ol.*"</span><span class="o">,</span> <span class="s">"R.*"</span><span class="o">})</span> <span class="o">{</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Rudolph"</span><span class="o">.</span><span class="na">matches</span><span class="o">(</span><span class="n">pattern</span><span class="o">));</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="cm">/*
true
true
true
true
 */</span>
</pre></table></code></div></div><h3 id="1363-量词">13.6.3 量词</h3><p>量词描述了一个模式吸收输入文本的方式：</p><ul><li><code class="language-plaintext highlighter-rouge">贪婪型</code>：量词总是贪婪的，除非有其他的选项被设置。贪婪表达式会为所有可能的模式发现尽可能多的匹配。导致此问题的一个典型理由就是假定我们的模式仅能匹配第一个可能的字符组，如果它是贪婪的，那么它就会继续往下匹配。<li><code class="language-plaintext highlighter-rouge">勉强型</code>：用问好来指定，这个量词匹配满足模式所需要的最少字符数。因此也称作懒惰的、最少匹配的、非贪婪的、或不贪婪的。<li><code class="language-plaintext highlighter-rouge">占有型</code>：目前，这种类型的量词只有在<code class="language-plaintext highlighter-rouge">Java</code>语言中才可用（在其他语言中不可用），并且也更高级，因此我们大概不会立刻用到它。当正则表达式被应用于字符串时，它会产生相当多的状态，以便在匹配失败时可以回溯。而“占有的”量词并不保存这些中间状态，因此它们可以防止回溯。它们常常用于防止正则表达式失控，因此可以使正则表达式执行起来更有效。</ul><h3 id="1364-pattern和matcher">13.6.4 Pattern和Matcher</h3><p>比起功能有限的<code class="language-plaintext highlighter-rouge">String</code>类。我们更愿意构建功能强大的正则表达式对象。用<code class="language-plaintext highlighter-rouge">Pattern.compile()</code>方法来编译你的正则表达式。它会根据你的<code class="language-plaintext highlighter-rouge">String</code>类型的正则表达式生成一个<code class="language-plaintext highlighter-rouge">Pattern</code>对象。接下来，把你想要检索的字符串传入<code class="language-plaintext highlighter-rouge">Pattern</code>对象的<code class="language-plaintext highlighter-rouge">matcher()</code>方法。<code class="language-plaintext highlighter-rouge">matcher()</code>方法会生成一个<code class="language-plaintext highlighter-rouge">Matcher</code>对象。</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestRegularExpression</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">args</span><span class="o">.</span><span class="na">length</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Usage:\njava TestRegularExpression characterSequence regularExpression+"</span><span class="o">);</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">exit</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Input: \""</span> <span class="o">+</span> <span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">+</span> <span class="s">"\""</span><span class="o">);</span>
        <span class="k">for</span> <span class="o">(</span><span class="nc">String</span> <span class="n">arg</span> <span class="o">:</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Regular expression: \""</span> <span class="o">+</span> <span class="n">arg</span> <span class="o">+</span> <span class="s">"\""</span><span class="o">);</span>
            <span class="nc">Pattern</span> <span class="n">p</span> <span class="o">=</span> <span class="nc">Pattern</span><span class="o">.</span><span class="na">compile</span><span class="o">(</span><span class="n">arg</span><span class="o">);</span>
            <span class="nc">Matcher</span> <span class="n">m</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="na">matcher</span><span class="o">(</span><span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]);</span>
            <span class="k">while</span> <span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">find</span><span class="o">())</span> <span class="o">{</span>
                <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Match \""</span> <span class="o">+</span> <span class="n">m</span><span class="o">.</span><span class="na">group</span><span class="o">()</span> <span class="o">+</span> <span class="s">"\" at positions "</span> <span class="o">+</span> <span class="n">m</span><span class="o">.</span><span class="na">start</span><span class="o">()</span> <span class="o">+</span> <span class="s">"-"</span> <span class="o">+</span> <span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">end</span><span class="o">()</span> <span class="o">-</span> <span class="mi">1</span><span class="o">));</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>java strings.TestRegularExpression "abcabcabcdefabc" "abc+" "(abc)+" "(abc){2,}"
</pre></table></code></div></div><p>输出：</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="nl">Input:</span> <span class="s">"abcabcabcdefabc"</span>
<span class="nc">Regular</span> <span class="nl">expression:</span> <span class="s">"abcabcabcdefabc"</span>
<span class="nc">Match</span> <span class="s">"abcabcabcdefabc"</span> <span class="n">at</span> <span class="n">positions</span> <span class="mi">0</span><span class="o">-</span><span class="mi">14</span>
<span class="nc">Regular</span> <span class="nl">expression:</span> <span class="s">"abc+"</span>
<span class="nc">Match</span> <span class="s">"abc"</span> <span class="n">at</span> <span class="n">positions</span> <span class="mi">0</span><span class="o">-</span><span class="mi">2</span>
<span class="nc">Match</span> <span class="s">"abc"</span> <span class="n">at</span> <span class="n">positions</span> <span class="mi">3</span><span class="o">-</span><span class="mi">5</span>
<span class="nc">Match</span> <span class="s">"abc"</span> <span class="n">at</span> <span class="n">positions</span> <span class="mi">6</span><span class="o">-</span><span class="mi">8</span>
<span class="nc">Match</span> <span class="s">"abc"</span> <span class="n">at</span> <span class="n">positions</span> <span class="mi">12</span><span class="o">-</span><span class="mi">14</span>
<span class="nc">Regular</span> <span class="nl">expression:</span> <span class="s">"(abc)+"</span>
<span class="nc">Match</span> <span class="s">"abcabcabc"</span> <span class="n">at</span> <span class="n">positions</span> <span class="mi">0</span><span class="o">-</span><span class="mi">8</span>
<span class="nc">Match</span> <span class="s">"abc"</span> <span class="n">at</span> <span class="n">positions</span> <span class="mi">12</span><span class="o">-</span><span class="mi">14</span>
<span class="nc">Regular</span> <span class="nl">expression:</span> <span class="s">"(abc){2,}"</span>
<span class="nc">Match</span> <span class="s">"abcabcabc"</span> <span class="n">at</span> <span class="n">positions</span> <span class="mi">0</span><span class="o">-</span><span class="mi">8</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">Pattern</code>对象表示编译后的正则表达式。从例子中可以看到，使用已编译的<code class="language-plaintext highlighter-rouge">Pattern</code>对象上的<code class="language-plaintext highlighter-rouge">matcher()</code>方法，加上一个输入字符串，从而共同构造了一个<code class="language-plaintext highlighter-rouge">Matcher</code>对象。同时，<code class="language-plaintext highlighter-rouge">Pattern</code>类还提供了<code class="language-plaintext highlighter-rouge">static</code>方法。</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">matches</span><span class="o">(</span><span class="nc">String</span> <span class="n">regex</span><span class="o">,</span><span class="nc">CharSequence</span> <span class="n">input</span><span class="o">)</span>
</pre></table></code></div></div><p>该方法用以检查<code class="language-plaintext highlighter-rouge">regex</code>是否匹配整个<code class="language-plaintext highlighter-rouge">CharSequence</code>类型的<code class="language-plaintext highlighter-rouge">input</code>参数。编译后的<code class="language-plaintext highlighter-rouge">Pattern</code>对象还提供了<code class="language-plaintext highlighter-rouge">split()</code>方法，它从匹配了<code class="language-plaintext highlighter-rouge">regex</code>的地方分割输入字符串，返回分割后的字符串<code class="language-plaintext highlighter-rouge">String</code>数组。</p><p>通过调用<code class="language-plaintext highlighter-rouge">Pattern.matcher()</code>方法，并传入一个字符串参数，我们得到了一个<code class="language-plaintext highlighter-rouge">Matcher</code>对象。使用<code class="language-plaintext highlighter-rouge">Matcher</code>上的方法，我们将能够判断各种不同类型的匹配是否成功：</p><ul><li>boolean matches()<li>boolean lookingAt()<li>boolean find()<li>boolean find(int start)</ul><p>其中<code class="language-plaintext highlighter-rouge">matches()</code>方法用来判断整个输入字符串是否匹配正则表达式模式，而<code class="language-plaintext highlighter-rouge">lookingAt()</code>则用来判断该字符串（不必是整个字符串）的始部分是否能够匹配模式。</p><h4 id="find">find()</h4><p><code class="language-plaintext highlighter-rouge">Matcher.find()</code>方法可用来在<code class="language-plaintext highlighter-rouge">CharSequence</code>中查找多个匹配。</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Finding</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Matcher</span> <span class="n">m</span> <span class="o">=</span> <span class="nc">Pattern</span><span class="o">.</span><span class="na">compile</span><span class="o">(</span><span class="s">"\\w+"</span><span class="o">).</span><span class="na">matcher</span><span class="o">(</span><span class="s">"Evening is full of the linnet's wings"</span><span class="o">);</span>
        <span class="k">while</span> <span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">find</span><span class="o">())</span> <span class="o">{</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">group</span><span class="o">()</span> <span class="o">+</span> <span class="s">", "</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">();</span>
        <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
        <span class="k">while</span> <span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">i</span><span class="o">))</span> <span class="o">{</span><span class="c1">//不断重新设定搜索的起始位置</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">group</span><span class="o">()</span> <span class="o">+</span> <span class="s">", "</span><span class="o">);</span>
            <span class="n">i</span><span class="o">++;</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="cm">/*

Evening, is, full, of, the, linnet, s, wings, 

Evening, vening, ening, ning, ing, ng, g, is, is, s, full, full, ull, ll, l, of, of, f, 
the, the, he, e, linnet, linnet, innet, nnet, net, et, t, s, s, wings, wings, ings, ngs, gs, s, 

 */</span>
</pre></table></code></div></div><h4 id="组groups">组（Groups）</h4><p>组是用括号划分的正则表达式，可以根据组的编号来引用某个组。组号为0表示整个表达式，组号1表示被第一对括号括起来的组，依次类推。因此，在下面这个表达式,</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>A(B(C))D
</pre></table></code></div></div><p>中有三个组：组0是ABCD，组1是BC，组2是C。</p><p><code class="language-plaintext highlighter-rouge">Matcher</code>对象提供了一系列方法，用以获取与组相关的信息：</p><ul><li>groupCount()：返回该匹配器的模式中的分组数目，第0组不包括在内。<li>group()：返回前一次匹配操作（例如find())的第0组（整个匹配）。<li>group(int i)：返回前一次匹配操作的第i组。指定的组没有匹配输入字符串的任何部分，则将会返回<code class="language-plaintext highlighter-rouge">null</code>。<li>start(int group)：返回在前一次匹配操作中寻找到的组的起始索引。<li>end(int group)：返回在前一次匹配操作中寻找到的组的最后一个字符索引加一的值。</ul><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Groups</span> <span class="o">{</span>
    <span class="kd">static</span> <span class="kd">public</span> <span class="kd">final</span> <span class="nc">String</span> <span class="no">POEM</span> <span class="o">=</span>
            <span class="s">"Twas brillig, and the slithy toves\n"</span> <span class="o">+</span>
                    <span class="s">"Did gyre and gimble in the wabe.\n"</span> <span class="o">+</span>
                    <span class="s">"All mimsy were the borogoves,\n"</span> <span class="o">+</span>
                    <span class="s">"And the mome raths outgrabe.\n\n"</span> <span class="o">+</span>
                    <span class="s">"Beware the Jabberwock, my son,\n"</span> <span class="o">+</span>
                    <span class="s">"The jaws that bite, the claws that catch.\n"</span> <span class="o">+</span>
                    <span class="s">"Beware the Jubjub bird, and shun\n"</span> <span class="o">+</span>
                    <span class="s">"The frumious Bandersnatch."</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Matcher</span> <span class="n">m</span> <span class="o">=</span> <span class="nc">Pattern</span><span class="o">.</span><span class="na">compile</span><span class="o">(</span><span class="s">"(?m)(\\S+)\\s+((\\S+)\\s+(\\S+))$"</span><span class="o">).</span><span class="na">matcher</span><span class="o">(</span><span class="no">POEM</span><span class="o">);</span>
        <span class="k">while</span> <span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">find</span><span class="o">())</span> <span class="o">{</span>
            <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">m</span><span class="o">.</span><span class="na">groupCount</span><span class="o">();</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"["</span> <span class="o">+</span> <span class="n">m</span><span class="o">.</span><span class="na">group</span><span class="o">(</span><span class="n">i</span><span class="o">)</span> <span class="o">+</span> <span class="s">"]"</span><span class="o">);</span>
            <span class="o">}</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="cm">/*
[the slithy toves][the][slithy toves][slithy][toves]
[in the wabe.][in][the wabe.][the][wabe.]
[were the borogoves,][were][the borogoves,][the][borogoves,]
[mome raths outgrabe.][mome][raths outgrabe.][raths][outgrabe.]
[Jabberwock, my son,][Jabberwock,][my son,][my][son,]
[claws that catch.][claws][that catch.][that][catch.]
[bird, and shun][bird,][and shun][and][shun]
[The frumious Bandersnatch.][The][frumious Bandersnatch.][frumious][Bandersnatch.]
 */</span>
</pre></table></code></div></div><p><strong>start()与end()</strong></p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">StartEnd</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">String</span> <span class="n">input</span> <span class="o">=</span>
            <span class="s">"As long as there is injustice, whenever a\n"</span> <span class="o">+</span>
                    <span class="s">"Targathian baby cries out, wherever a distress\n"</span> <span class="o">+</span>
                    <span class="s">"signal sounds among the stars... We'll be there.\n"</span> <span class="o">+</span>
                    <span class="s">"This fine ship, and this fine crew ...\n"</span> <span class="o">+</span>
                    <span class="s">"Never give up! Never surrender!"</span><span class="o">;</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Display</span> <span class="o">{</span>
        <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">regexPrinted</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
        <span class="kd">private</span> <span class="nc">String</span> <span class="n">regex</span><span class="o">;</span>

        <span class="nc">Display</span><span class="o">(</span><span class="nc">String</span> <span class="n">regex</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">this</span><span class="o">.</span><span class="na">regex</span> <span class="o">=</span> <span class="n">regex</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="kt">void</span> <span class="nf">display</span><span class="o">(</span><span class="nc">String</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(!</span><span class="n">regexPrinted</span><span class="o">)</span> <span class="o">{</span>
                <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">regex</span><span class="o">);</span>
                <span class="n">regexPrinted</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
            <span class="o">}</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">message</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">static</span> <span class="kt">void</span> <span class="nf">examine</span><span class="o">(</span><span class="nc">String</span> <span class="n">s</span><span class="o">,</span> <span class="nc">String</span> <span class="n">regex</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Display</span> <span class="n">d</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Display</span><span class="o">(</span><span class="n">regex</span><span class="o">);</span>
        <span class="nc">Pattern</span> <span class="n">p</span> <span class="o">=</span> <span class="nc">Pattern</span><span class="o">.</span><span class="na">compile</span><span class="o">(</span><span class="n">regex</span><span class="o">);</span>
        <span class="nc">Matcher</span> <span class="n">m</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="na">matcher</span><span class="o">(</span><span class="n">s</span><span class="o">);</span>
        <span class="k">while</span> <span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">find</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">d</span><span class="o">.</span><span class="na">display</span><span class="o">(</span><span class="s">"find() '"</span> <span class="o">+</span> <span class="n">m</span><span class="o">.</span><span class="na">group</span><span class="o">()</span> <span class="o">+</span> <span class="s">"' start = "</span>
                    <span class="o">+</span> <span class="n">m</span><span class="o">.</span><span class="na">start</span><span class="o">()</span> <span class="o">+</span> <span class="s">" end = "</span> <span class="o">+</span> <span class="n">m</span><span class="o">.</span><span class="na">end</span><span class="o">());</span>
        <span class="o">}</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">lookingAt</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">d</span><span class="o">.</span><span class="na">display</span><span class="o">(</span><span class="s">"lookingAt() start = "</span> <span class="o">+</span> <span class="n">m</span><span class="o">.</span><span class="na">start</span><span class="o">()</span> <span class="o">+</span> <span class="s">" end = "</span> <span class="o">+</span> <span class="n">m</span><span class="o">.</span><span class="na">end</span><span class="o">());</span>
        <span class="o">}</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">matches</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">d</span><span class="o">.</span><span class="na">display</span><span class="o">(</span><span class="s">"matches() start = "</span> <span class="o">+</span> <span class="n">m</span><span class="o">.</span><span class="na">start</span><span class="o">()</span> <span class="o">+</span> <span class="s">" end = "</span> <span class="o">+</span> <span class="n">m</span><span class="o">.</span><span class="na">end</span><span class="o">());</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">for</span> <span class="o">(</span><span class="nc">String</span> <span class="n">in</span> <span class="o">:</span> <span class="n">input</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">"\n"</span><span class="o">))</span> <span class="o">{</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"input : "</span> <span class="o">+</span> <span class="n">in</span><span class="o">);</span>
            <span class="k">for</span> <span class="o">(</span><span class="nc">String</span> <span class="n">regex</span> <span class="o">:</span> <span class="k">new</span> <span class="nc">String</span><span class="o">[]{</span><span class="s">"\\w*ere\\w*"</span><span class="o">,</span>
                    <span class="s">"\\w*ever"</span><span class="o">,</span> <span class="s">"T\\w+"</span><span class="o">,</span> <span class="s">"Never.*?!"</span><span class="o">})</span> <span class="o">{</span>
                <span class="n">examine</span><span class="o">(</span><span class="n">in</span><span class="o">,</span> <span class="n">regex</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="cm">/*
input : As long as there is injustice, whenever a
\w*ere\w*
find() 'there' start = 11 end = 16
\w*ever
find() 'whenever' start = 31 end = 39
input : Targathian baby cries out, wherever a distress
\w*ere\w*
find() 'wherever' start = 27 end = 35
\w*ever
find() 'wherever' start = 27 end = 35
T\w+
find() 'Targathian' start = 0 end = 10
lookingAt() start = 0 end = 10
input : signal sounds among the stars... We'll be there.
\w*ere\w*
find() 'there' start = 42 end = 47
input : This fine ship, and this fine crew ...
T\w+
find() 'This' start = 0 end = 4
lookingAt() start = 0 end = 4
input : Never give up! Never surrender!
\w*ever
find() 'Never' start = 0 end = 5
find() 'Never' start = 15 end = 20
lookingAt() start = 0 end = 5
Never.*?!
find() 'Never give up!' start = 0 end = 14
find() 'Never surrender!' start = 15 end = 31
lookingAt() start = 0 end = 14
matches() start = 0 end = 31
 */</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">find()</code>可以在输入的任意位置定位正则表达式，而<code class="language-plaintext highlighter-rouge">lookingAt()</code>和<code class="language-plaintext highlighter-rouge">matches()</code>只有在正则表达式与输入的最开始处就开始匹配时才会成功。<code class="language-plaintext highlighter-rouge">matches()</code>只有在整个输入都匹配正则表达式时才会成功，而<code class="language-plaintext highlighter-rouge">lookingAt()</code>只要输入的第一部分匹配就会成功。</p><p><strong>Pattern标记</strong></p><p><code class="language-plaintext highlighter-rouge">Pattern</code>类的<code class="language-plaintext highlighter-rouge">compile()</code>方法还有另一个版本，它接受一个标记参数，已调整匹配的行为：</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nc">Pattern</span> <span class="nc">Pattern</span><span class="o">.</span><span class="na">compile</span><span class="o">(</span><span class="nc">String</span> <span class="n">regex</span><span class="o">,</span><span class="kt">int</span> <span class="n">flag</span><span class="o">)</span>
</pre></table></code></div></div><p>其中的<code class="language-plaintext highlighter-rouge">flag</code>来自以下<code class="language-plaintext highlighter-rouge">Pattern</code>类中的常量。</p><ul><li><code class="language-plaintext highlighter-rouge">Pattern.CANON_EQ</code>：两个字符当且仅当它们的完全规范分解相匹配时，就认为它们是匹配的。例如，如果我们指定这个标记，表达式<code class="language-plaintext highlighter-rouge">a\u030A</code>就会匹配字符串字符串<code class="language-plaintext highlighter-rouge">?</code>。在默认的情况下，匹配不考虑规范的等价性。<li><code class="language-plaintext highlighter-rouge">Pattern.CASE_INSENSITIVE(?i)</code>：默认情况下，大小写不敏感的匹配假定只有<code class="language-plaintext highlighter-rouge">US-ASCII</code>字符集中的字符才能进行。这个标记允许模式匹配不必考虑大小写（大写或小写）。通过指定<code class="language-plaintext highlighter-rouge">UNICODE_CASE</code>标记及结合此标记，基于<code class="language-plaintext highlighter-rouge">Unicode</code>的大小写不敏感的匹配就可以开启了。<li><code class="language-plaintext highlighter-rouge">Pattern.COMMENTS(?x)</code>：在这种模式下，空格符将被忽略掉，并且以<code class="language-plaintext highlighter-rouge">#</code>开始直到行末的注释也会被忽略掉。通过嵌入的标记表达式也可以开启<code class="language-plaintext highlighter-rouge">Unix</code>的行模式。<li><code class="language-plaintext highlighter-rouge">Pattern.DOTALL(?s)</code>：在<code class="language-plaintext highlighter-rouge">dotall</code>模式下，表达式“.”匹配所有字符，包括行终结符。默认情况下，“.”表达式不匹配行终结符。<li><code class="language-plaintext highlighter-rouge">Pattern.MuLTILINE(?m)</code>：在多行模式下，表达式<code class="language-plaintext highlighter-rouge">^</code>和<code class="language-plaintext highlighter-rouge">$</code>分别匹配一行的开始和结束。<code class="language-plaintext highlighter-rouge">^</code>还匹配输入字符串的开始，而<code class="language-plaintext highlighter-rouge">$</code>还匹配输入字符串的结尾。默认情况下，这些表达式仅匹配输入的完整字符串的开始和结束。<li><code class="language-plaintext highlighter-rouge">Pattern.UNICODE_CASE(?u)</code>：当指定这个标记，并且开启<code class="language-plaintext highlighter-rouge">CASE_INSENSITIVE</code>时，大小写不敏感的匹配将按照与<code class="language-plaintext highlighter-rouge">Unicode</code>标准相一致的方式进行。默认情况下，大小写不敏感的匹配假定只能在<code class="language-plaintext highlighter-rouge">US-ASCII</code>字符集中的字符才能进行。<li><code class="language-plaintext highlighter-rouge">Pattern.UNIX_LINES(?d)</code>：在这种模式下，在<code class="language-plaintext highlighter-rouge">.</code>、<code class="language-plaintext highlighter-rouge">^</code>和<code class="language-plaintext highlighter-rouge">$</code>行为中，只识别行终结符<code class="language-plaintext highlighter-rouge">\n</code>。</ul><p>在这些标记中，<code class="language-plaintext highlighter-rouge">Pattern.CASE_INSENSITIVE</code>、<code class="language-plaintext highlighter-rouge">Pattern.MULTILINE</code>以及<code class="language-plaintext highlighter-rouge">Pattern.COMMENTS</code>特别有用。</p><p>可以通过“或”(|)操作符</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ReFlags</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Pattern</span> <span class="n">p</span> <span class="o">=</span> <span class="nc">Pattern</span><span class="o">.</span><span class="na">compile</span><span class="o">(</span><span class="s">"^java"</span><span class="o">,</span> <span class="nc">Pattern</span><span class="o">.</span><span class="na">CASE_INSENSITIVE</span> <span class="o">|</span> <span class="nc">Pattern</span><span class="o">.</span><span class="na">MULTILINE</span><span class="o">);</span>
        <span class="nc">Matcher</span> <span class="n">m</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="na">matcher</span><span class="o">(</span>
                <span class="s">"java has regex\nJava has regex\n"</span> <span class="o">+</span>
                        <span class="s">"JAVA has pretty good regular expressions\n"</span> <span class="o">+</span>
                        <span class="s">"Regular expressions are in Java"</span>
        <span class="o">);</span>
        <span class="k">while</span> <span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">find</span><span class="o">()){</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">group</span><span class="o">());</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="cm">/*
java
Java
JAVA
 */</span>
</pre></table></code></div></div><h3 id="1365-split">13.6.5 split()</h3><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SplitDemo</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">input</span> <span class="o">=</span> <span class="s">"THis!!unusual use!!of exclamation!!points"</span><span class="o">;</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="nc">Arrays</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="nc">Pattern</span><span class="o">.</span><span class="na">compile</span><span class="o">(</span><span class="s">"!!"</span><span class="o">).</span><span class="na">split</span><span class="o">(</span><span class="n">input</span><span class="o">)));</span>
        <span class="c1">//限制将输入分割成字符串的数量</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="nc">Arrays</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="nc">Pattern</span><span class="o">.</span><span class="na">compile</span><span class="o">(</span><span class="s">"!!"</span><span class="o">).</span><span class="na">split</span><span class="o">(</span><span class="n">input</span><span class="o">,</span> <span class="mi">3</span><span class="o">)));</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="cm">/*
[THis, unusual use, of exclamation, points]
[THis, unusual use, of exclamation!!points]
 */</span>
</pre></table></code></div></div><h3 id="1366-替换操作">13.6.6 替换操作</h3><ul><li>replaceFirst(String replacement)<li>replaceAll(String replacement)：替换所有匹配成功的部分。<li>appendReplacement(StringButter sbuf,String replacement)：执行渐进式的替换，允许你调用其他方法来生成或处理<code class="language-plaintext highlighter-rouge">replacement</code>，使你能够以编程的方式将目标分割成组，从而具备更强大的替换功能。<li>appendTail(StringBuffer sbuf)：在执行了一次货多次<code class="language-plaintext highlighter-rouge">appendReplacement()</code>之后，调用此方法可以将输入字符串余下的部分复制到<code class="language-plaintext highlighter-rouge">sbuf</code>中。</ul><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
</pre><td class="rouge-code"><pre><span class="cm">/*!Here's a block of text to use as input to
   the regular expression matcher. Note that we'll
   first extract the block of text by looking for
   the special delimiters, then process the
   extracted block. !*/</span>


<span class="kn">import</span> <span class="nn">net.mindview.util.TextFile</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.regex.Matcher</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.regex.Pattern</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TheReplacements</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">s</span> <span class="o">=</span> <span class="nc">TextFile</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="s">"src/main/java/strings/TheReplacements.java"</span><span class="o">);</span>
        <span class="nc">Matcher</span> <span class="n">mInput</span> <span class="o">=</span>
                <span class="nc">Pattern</span><span class="o">.</span><span class="na">compile</span><span class="o">(</span><span class="s">"/\\*!(.*)!\\*/"</span><span class="o">,</span> <span class="nc">Pattern</span><span class="o">.</span><span class="na">DOTALL</span><span class="o">)</span>
                        <span class="o">.</span><span class="na">matcher</span><span class="o">(</span><span class="n">s</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">mInput</span><span class="o">.</span><span class="na">find</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">mInput</span><span class="o">.</span><span class="na">group</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="c1">//将存在两个或两个以上空格的地方,缩减为一个空格,并且</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="na">replaceAll</span><span class="o">(</span><span class="s">" {2,}"</span><span class="o">,</span> <span class="s">" "</span><span class="o">);</span>
        <span class="c1">//删除每行开头部分的所有空格</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="na">replaceAll</span><span class="o">(</span><span class="s">"(?m)^ +"</span><span class="o">,</span><span class="s">""</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">s</span><span class="o">);</span>
        <span class="c1">//replaceFirst只对找到的第一个匹配进行替换</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="na">replaceFirst</span><span class="o">(</span><span class="s">"[aeiou]"</span><span class="o">,</span> <span class="s">"(VOWEL1)"</span><span class="o">);</span>
        <span class="nc">StringBuffer</span> <span class="n">sbuf</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StringBuffer</span><span class="o">();</span>
        <span class="nc">Pattern</span> <span class="n">p</span> <span class="o">=</span> <span class="nc">Pattern</span><span class="o">.</span><span class="na">compile</span><span class="o">(</span><span class="s">"[aeiou]"</span><span class="o">);</span>
        <span class="nc">Matcher</span> <span class="n">m</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="na">matcher</span><span class="o">(</span><span class="n">s</span><span class="o">);</span>
        <span class="k">while</span> <span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">find</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">m</span><span class="o">.</span><span class="na">appendReplacement</span><span class="o">(</span><span class="n">sbuf</span><span class="o">,</span> <span class="n">m</span><span class="o">.</span><span class="na">group</span><span class="o">().</span><span class="na">toUpperCase</span><span class="o">());</span>
        <span class="o">}</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">sbuf</span><span class="o">);</span>
        <span class="n">m</span><span class="o">.</span><span class="na">appendTail</span><span class="o">(</span><span class="n">sbuf</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">sbuf</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="cm">/*
Here's a block of text to use as input to
the regular expression matcher. Note that we'll
first extract the block of text by looking for
the special delimiters, then process the
extracted block.
H(VOWEL1)rE's A blOck Of tExt tO UsE As InpUt tO
thE rEgUlAr ExprEssIOn mAtchEr. NOtE thAt wE'll
fIrst ExtrAct thE blOck Of tExt by lOOkIng fOr
thE spEcIAl dElImItErs, thEn prOcEss thE
ExtrActEd blO
H(VOWEL1)rE's A blOck Of tExt tO UsE As InpUt tO
thE rEgUlAr ExprEssIOn mAtchEr. NOtE thAt wE'll
fIrst ExtrAct thE blOck Of tExt by lOOkIng fOr
thE spEcIAl dElImItErs, thEn prOcEss thE
ExtrActEd blOck. 
 */</span>
</pre></table></code></div></div><h3 id="1367-reset">13.6.7 reset()</h3><p>通过<code class="language-plaintext highlighter-rouge">reset()</code>方法，可以将现有的<code class="language-plaintext highlighter-rouge">Matcher</code>对象应用于一个新的字符序列：</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Resetting</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Matcher</span> <span class="n">m</span> <span class="o">=</span> <span class="nc">Pattern</span><span class="o">.</span><span class="na">compile</span><span class="o">(</span><span class="s">"[frb][aiu][gx]"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">matcher</span><span class="o">(</span><span class="s">"fix the rug with bags"</span><span class="o">);</span>
        <span class="k">while</span> <span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">find</span><span class="o">())</span> <span class="o">{</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">group</span><span class="o">()</span> <span class="o">+</span> <span class="s">" "</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">();</span>
        <span class="n">m</span><span class="o">.</span><span class="na">reset</span><span class="o">(</span><span class="s">"fix the rig with rags"</span><span class="o">);</span>
        <span class="k">while</span> <span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">find</span><span class="o">())</span> <span class="o">{</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">group</span><span class="o">()</span> <span class="o">+</span> <span class="s">" "</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><h3 id="1368-正则表达式与java-io">13.6.8 正则表达式与Java I/O</h3><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">JGrep</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span><span class="o">(</span><span class="n">args</span><span class="o">.</span><span class="na">length</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">){</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Usage: java JGrep file regex"</span><span class="o">);</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">exit</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="nc">Pattern</span> <span class="n">p</span> <span class="o">=</span> <span class="nc">Pattern</span><span class="o">.</span><span class="na">compile</span><span class="o">(</span><span class="n">args</span><span class="o">[</span><span class="mi">1</span><span class="o">]);</span>
        <span class="kt">int</span> <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
        <span class="nc">Matcher</span> <span class="n">m</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="na">matcher</span><span class="o">(</span><span class="s">""</span><span class="o">);</span>
        <span class="k">for</span> <span class="o">(</span><span class="nc">String</span> <span class="n">line</span> <span class="o">:</span> <span class="k">new</span> <span class="nc">TextFile</span><span class="o">(</span><span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]))</span> <span class="o">{</span>
            <span class="n">m</span><span class="o">.</span><span class="na">reset</span><span class="o">(</span><span class="n">line</span><span class="o">);</span>
            <span class="k">while</span> <span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">find</span><span class="o">()){</span>
                <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">index</span><span class="o">++</span> <span class="o">+</span> <span class="s">": "</span><span class="o">+</span><span class="n">m</span><span class="o">.</span><span class="na">group</span><span class="o">()+</span><span class="s">": "</span><span class="o">+</span><span class="n">m</span><span class="o">.</span><span class="na">start</span><span class="o">());</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><h2 id="137-扫描输入">13.7 扫描输入</h2><p>从文件或标准输入读取数据时一件相当痛苦的事情。一般的解决之道就是读入一行文本，对其进行粉刺，然后使用<code class="language-plaintext highlighter-rouge">Integer</code>、<code class="language-plaintext highlighter-rouge">Double</code>等类的各种解析方法来解析数据：</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SimpleRead</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">BufferedReader</span> <span class="n">input</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="nc">StringReader</span><span class="o">(</span><span class="s">"Sir Robin of Camelot \n22 1.61803"</span><span class="o">));</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"What is your name?"</span><span class="o">);</span>
            <span class="nc">String</span> <span class="n">name</span> <span class="o">=</span> <span class="n">input</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"How old are you? What is your favorite double?"</span><span class="o">);</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"(input: &lt;age&gt; &lt;double&gt;)"</span><span class="o">);</span>
            <span class="nc">String</span> <span class="n">numbers</span> <span class="o">=</span> <span class="n">input</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">numbers</span><span class="o">);</span>
            <span class="nc">String</span><span class="o">[]</span> <span class="n">numArray</span> <span class="o">=</span> <span class="n">numbers</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">" "</span><span class="o">);</span>
            <span class="kt">int</span> <span class="n">age</span> <span class="o">=</span> <span class="nc">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">numArray</span><span class="o">[</span><span class="mi">0</span><span class="o">]);</span>
            <span class="kt">double</span> <span class="n">favorite</span> <span class="o">=</span> <span class="nc">Double</span><span class="o">.</span><span class="na">parseDouble</span><span class="o">(</span><span class="n">numArray</span><span class="o">[</span><span class="mi">1</span><span class="o">]);</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"Hi %s.\n"</span><span class="o">,</span> <span class="n">name</span><span class="o">);</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"In 5 years you will be %d.\n"</span><span class="o">,</span> <span class="n">age</span> <span class="o">+</span> <span class="mi">5</span><span class="o">);</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"My favorite double is %f."</span><span class="o">,</span> <span class="n">favorite</span> <span class="o">/</span> <span class="mi">2</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"I/O exception"</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="cm">/*
What is your name?
Sir Robin of Camelot
How old are you? What is your favorite double?
(input: &lt;age&gt; &lt;double&gt;)
22 1.61803
Hi Sir Robin of Camelot .
In 5 years you will be 27.
My favorite double is 0.809015.
 */</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">Java SE5</code>新增了<code class="language-plaintext highlighter-rouge">Scanner</code>类，可以大大减轻扫描输入的工作负担：</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">BetterRead</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Scanner</span> <span class="n">stdin</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Scanner</span><span class="o">(</span><span class="nc">SimpleRead</span><span class="o">.</span><span class="na">input</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"What is your name?"</span><span class="o">);</span>
        <span class="nc">String</span> <span class="n">name</span> <span class="o">=</span> <span class="n">stdin</span><span class="o">.</span><span class="na">nextLine</span><span class="o">();</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"How old are you? What is your favorite double?"</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"input: &lt;age&gt; &lt;double&gt;"</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">age</span> <span class="o">=</span> <span class="n">stdin</span><span class="o">.</span><span class="na">nextInt</span><span class="o">();</span>
        <span class="kt">double</span> <span class="n">favorite</span> <span class="o">=</span> <span class="n">stdin</span><span class="o">.</span><span class="na">nextDouble</span><span class="o">();</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"Hi %s.\n"</span><span class="o">,</span> <span class="n">name</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"In 5 years you will be %d.\n"</span><span class="o">,</span> <span class="n">age</span> <span class="o">+</span> <span class="mi">5</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"My favorite double is %f."</span><span class="o">,</span> <span class="n">favorite</span> <span class="o">/</span> <span class="mi">2</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="cm">/*
What is your name?
Sir Robin of Camelot
How old are you? What is your favorite double?
input: &lt;age&gt; &lt;double&gt;
Hi Sir Robin of Camelot .
In 5 years you will be 27.
My favorite double is 0.809015.
 */</span>
</pre></table></code></div></div><h3 id="71-scanner定界符">7.1 Scanner定界符</h3><p>在默认情况下，<code class="language-plaintext highlighter-rouge">Scanner</code>根据空白字符对输入进行分词，但是你可以用正则表达式指定自己所需的定界符：</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ScannerDelimiter</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Scanner</span> <span class="n">scanner</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Scanner</span><span class="o">(</span><span class="s">"12,42,78,99,42"</span><span class="o">);</span>
        <span class="n">scanner</span><span class="o">.</span><span class="na">useDelimiter</span><span class="o">(</span><span class="s">"\\s*,\\s*"</span><span class="o">);</span>
        <span class="k">while</span> <span class="o">(</span><span class="n">scanner</span><span class="o">.</span><span class="na">hasNext</span><span class="o">()){</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">scanner</span><span class="o">.</span><span class="na">nextInt</span><span class="o">());</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="cm">/*
12
42
78
99
42
 */</span>
</pre></table></code></div></div><h3 id="72-用正则表达式扫描">7.2 用正则表达式扫描</h3><p>除了能够扫描基本类型之外，还可以使用自定义的正则表达式进行扫描，这在扫描复杂数据的时候非常有用。</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ThreatAnalyzer</span> <span class="o">{</span>
    <span class="kd">static</span> <span class="nc">String</span> <span class="n">threatData</span> <span class="o">=</span>
            <span class="s">"58.27.82.161@02/10/2005\n"</span><span class="o">+</span>
            <span class="s">"204.45.234.40@02/11/2005\n"</span><span class="o">+</span>
            <span class="s">"58.27.82.161@02/11/2005\n"</span><span class="o">+</span>
            <span class="s">"58.27.82.161@02/12/2005\n"</span><span class="o">+</span>
            <span class="s">"58.27.82.161@02/12/2005\n"</span><span class="o">+</span>
            <span class="s">"[Next log section with different data format]"</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Scanner</span> <span class="n">scanner</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Scanner</span><span class="o">(</span><span class="n">threatData</span><span class="o">);</span>
        <span class="nc">String</span> <span class="n">pattern</span> <span class="o">=</span> <span class="s">"(\\d+[.]\\d+[.]\\d+[.]\\d+)@"</span> <span class="o">+</span>
                <span class="s">"(\\d{2}/\\d{2}/\\d{4})"</span><span class="o">;</span>
        <span class="k">while</span> <span class="o">(</span><span class="n">scanner</span><span class="o">.</span><span class="na">hasNext</span><span class="o">(</span><span class="n">pattern</span><span class="o">)){</span>
            <span class="n">scanner</span><span class="o">.</span><span class="na">next</span><span class="o">(</span><span class="n">pattern</span><span class="o">);</span>
            <span class="nc">MatchResult</span> <span class="n">match</span> <span class="o">=</span> <span class="n">scanner</span><span class="o">.</span><span class="na">match</span><span class="o">();</span>
            <span class="nc">String</span> <span class="n">ip</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="na">group</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
            <span class="nc">String</span> <span class="n">date</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="na">group</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"Threat on %s from %s\n"</span><span class="o">,</span><span class="n">date</span><span class="o">,</span><span class="n">ip</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="cm">/*
Threat on 02/10/2005 from 58.27.82.161
Threat on 02/11/2005 from 204.45.234.40
Threat on 02/11/2005 from 58.27.82.161
Threat on 02/12/2005 from 58.27.82.161
Threat on 02/12/2005 from 58.27.82.161
 */</span>
</pre></table></code></div></div><h2 id="138-stringtokenizer">13.8 StringTokenizer</h2><p>在<code class="language-plaintext highlighter-rouge">Java</code>引入正则表达式和<code class="language-plaintext highlighter-rouge">Scanner</code>类之前，分割字符串的唯一方法是使用<code class="language-plaintext highlighter-rouge">StringTokenizer</code>来分词。</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ReplacingStringTokenizer</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">input</span> <span class="o">=</span> <span class="s">"But I'm not dead yet! I feel happy!"</span><span class="o">;</span>
        <span class="nc">StringTokenizer</span> <span class="n">stoke</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StringTokenizer</span><span class="o">(</span><span class="n">input</span><span class="o">);</span>
        <span class="k">while</span> <span class="o">(</span><span class="n">stoke</span><span class="o">.</span><span class="na">hasMoreElements</span><span class="o">()){</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">stoke</span><span class="o">.</span><span class="na">nextToken</span><span class="o">()+</span><span class="s">" "</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">();</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="nc">Arrays</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">input</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">" "</span><span class="o">)));</span>
        <span class="nc">Scanner</span> <span class="n">scanner</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Scanner</span><span class="o">(</span><span class="n">input</span><span class="o">);</span>
        <span class="k">while</span> <span class="o">(</span><span class="n">scanner</span><span class="o">.</span><span class="na">hasNext</span><span class="o">()){</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">scanner</span><span class="o">.</span><span class="na">next</span><span class="o">()+</span><span class="s">" "</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="cm">/*
But I'm not dead yet! I feel happy!
[But, I'm, not, dead, yet!, I, feel, happy!]
But I'm not dead yet! I feel happy!
 */</span>
</pre></table></code></div></div><h2 id="string相关面试题">String相关面试题</h2><ul><li><li>String、StringBuffer、StringBuilder区别</ul><h2 id="参考">参考</h2><ul><li><a href="https://deerchao.net/tutorials/regex/regex.htm">正则表达式30分钟入门教程</a></ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/java/'>Java</a>, <a href='/categories/thinking-in-java/'>Thinking in Java</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/thinking-in-java/" class="post-tag no-text-decoration" >Thinking in Java</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=《Java编程思想》第13章字符串 - malinkang&url=https://malinkang.cn/posts/thinking-in-java-strings/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=《Java编程思想》第13章字符串 - malinkang&u=https://malinkang.cn/posts/thinking-in-java-strings/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=《Java编程思想》第13章字符串 - malinkang&url=https://malinkang.cn/posts/thinking-in-java-strings/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/dagger-guide/">Dagger使用指南</a><li><a href="/posts/understanding-the-jvm-runtime-data-areas/">《深入理解JVM》第2章Java内存区域与内存溢出异常</a><li><a href="/posts/understanding-the-jvm-garbage-collection/">《深入理解JVM》第3章垃圾收集器</a><li><a href="/posts/understanding-the-jvm-class-file-structure/">《深入理解JVM》第6章类文件结构</a><li><a href="/posts/understanding-the-jvm-class-loader/">《深入理解JVM》第7章虚拟机类加载机制</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/">源码分析</a> <a class="post-tag" href="/tags/thinking-in-java/">Thinking in Java</a> <a class="post-tag" href="/tags/android/">Android</a> <a class="post-tag" href="/tags/effective-java/">Effective Java</a> <a class="post-tag" href="/tags/kotlin/">Kotlin</a> <a class="post-tag" href="/tags/java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98/">Java并发编程实战</a> <a class="post-tag" href="/tags/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3jvm/">深入理解JVM</a> <a class="post-tag" href="/tags/android/">android</a> <a class="post-tag" href="/tags/databinding/">databinding</a> <a class="post-tag" href="/tags/recyclerview/">RecyclerView</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/thinking-in-java-arrays/"><div class="card-body"> <span class="timeago small" > Jun 25, 2013 <i class="unloaded">2013-06-25T21:39:36+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>《Java编程思想》第16章数组</h3><div class="text-muted small"><p> 数组为什么特殊 数组与其他种类的容器之间的区别有三方面：效率、类型和保存基本类型的能力。在Java中，数组是一种效率最高的存储和随机访问对象引用序列的方式。数组就是一个简单的线性序列，这使得元素访问非常快速。但是为这种速度所付出的代价是数组对象的大小被固定，并且在其生命周期中不可改变。 数组之所以优于泛型之前的容器，就是因为你可以创建一个数组去持有某种具体类型。这意味着你可以通过编译期检...</p></div></div></a></div><div class="card"> <a href="/posts/thinking-in-java-containers-in-depth/"><div class="card-body"> <span class="timeago small" > Jul 2, 2013 <i class="unloaded">2013-07-02T21:39:36+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>《Java编程思想》第17章容器深入研究</h3><div class="text-muted small"><p> 填充容器 与Arrays版本一样，此fill()方法也是只复制同一个对象引用来填充整个容器的，并且只对List对象有用，但是所产生的列表可以传递给构造器或addAll()方法： 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 //: containers/FillingLists.java // The Col...</p></div></div></a></div><div class="card"> <a href="/posts/thinking-in-java-everything-is-an-object/"><div class="card-body"> <span class="timeago small" > Mar 20, 2013 <i class="unloaded">2013-03-20T00:26:34+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>《Java编程思想》第2章一切都是对象</h3><div class="text-muted small"><p> 2.2 必须由你创建所有对象 2.2.1 存储到什么地方 2.2.2 特例：基本类型 在程序设计中经常用到一系列类型，它们需要特殊对待。可以把它们想象成“基本”类型。之所以特殊对待，是因为new将对象存储在“堆”里，故用new创建一个对象，特别是小的、简单的变量，往往不是很有效。因此，对于这些类型，Java采取与C和C++相同的方法。也就是说，不用new来创建变量，而是创建一个并非是引...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/thinking-in-java-error-handling-with-exceptions/" class="btn btn-outline-primary" prompt="Older"><p>《Java编程思想》第12章通过异常处理错误</p></a> <a href="/posts/thinking-in-java-type-information/" class="btn btn-outline-primary" prompt="Newer"><p>《Java编程思想》第14章类型信息</p></a></div><div id="disqus" class="pt-2 pb-2"><p class="text-center text-muted small pb-5"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script src="/assets/js/lib/jquery.disqusloader.min.js"></script> <script> const options = { scriptUrl: '//malinkang-cn.disqus.com/embed.js', disqusConfig: function() { this.page.title = '《Java编程思想》第13章字符串'; this.page.url = 'https://malinkang.cn/posts/thinking-in-java-strings/'; this.page.identifier = '/posts/thinking-in-java-strings/'; } }; $.disqusLoader('#disqus', options); </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://twitter.com/malinkang">malinkang</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/">源码分析</a> <a class="post-tag" href="/tags/thinking-in-java/">Thinking in Java</a> <a class="post-tag" href="/tags/android/">Android</a> <a class="post-tag" href="/tags/effective-java/">Effective Java</a> <a class="post-tag" href="/tags/kotlin/">Kotlin</a> <a class="post-tag" href="/tags/java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98/">Java并发编程实战</a> <a class="post-tag" href="/tags/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3jvm/">深入理解JVM</a> <a class="post-tag" href="/tags/android/">android</a> <a class="post-tag" href="/tags/databinding/">databinding</a> <a class="post-tag" href="/tags/recyclerview/">RecyclerView</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://malinkang.cn{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>

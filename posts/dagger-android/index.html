<!DOCTYPE html><html lang="zh-CN" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="Dagger2在Android中的使用" /><meta property="og:locale" content="zh_CN" /><meta name="description" content="原文" /><meta property="og:description" content="原文" /><link rel="canonical" href="https://malinkang.cn/posts/dagger-android/" /><meta property="og:url" content="https://malinkang.cn/posts/dagger-android/" /><meta property="og:site_name" content="malinkang" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2018-07-25T11:56:12+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Dagger2在Android中的使用" /><meta name="twitter:site" content="@malinkang" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"description":"原文","headline":"Dagger2在Android中的使用","dateModified":"2021-07-07T14:54:59+08:00","url":"https://malinkang.cn/posts/dagger-android/","datePublished":"2018-07-25T11:56:12+08:00","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://malinkang.cn/posts/dagger-android/"},"@context":"https://schema.org"}</script><title>Dagger2在Android中的使用 | malinkang</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="malinkang"><meta name="application-name" content="malinkang"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://malinkang-1253444926.cos.ap-beijing.myqcloud.com/images/avatar.jpeg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">malinkang</a></div><div class="site-subtitle font-italic">人生最可悲的事情，莫过于胸怀大志，却又虚度光阴。</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>分类</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>标签</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>归档</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>关于</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/malinkang" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/malinkang" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['linkang.ma','gmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Dagger2在Android中的使用</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Dagger2在Android中的使用</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> malinkang </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Wed, Jul 25, 2018, 11:56 AM +0800" prep="on" > Jul 25, 2018 <i class="unloaded">2018-07-25T11:56:12+08:00</i> </span></div><div> <span> <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Wed, Jul 7, 2021, 2:54 PM +0800" prefix="Updated " > Jul 7 <i class="unloaded">2021-07-07T14:54:59+08:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2504 words">13 min</span></div></div><div class="post-content"><ul><li><a href="https://google.github.io/dagger/android">原文</a></ul><p>与其他大多数依赖注入框架相比，<code class="language-plaintext highlighter-rouge">Dagger2</code>的主要优点之一是其严格生成的实现（无反射）意味着它可以在<code class="language-plaintext highlighter-rouge">Android</code>应用程序中使用。但是，在<code class="language-plaintext highlighter-rouge">Android</code>应用程序中使用<code class="language-plaintext highlighter-rouge">Dagger</code>时仍有一些注意事项。</p><h2 id="为什么android上的dagger很难">为什么Android上的Dagger很难</h2><p>使用<code class="language-plaintext highlighter-rouge">Dagger</code>编写<code class="language-plaintext highlighter-rouge">Android</code>应用程序的主要困难之一是很多<code class="language-plaintext highlighter-rouge">Android</code>框架类都是由操作系统本身实例化的，例如<code class="language-plaintext highlighter-rouge">Activity</code>和<code class="language-plaintext highlighter-rouge">Fragment</code>，但是如果<code class="language-plaintext highlighter-rouge">Dagger</code>可以创建所有注入的对象，则<code class="language-plaintext highlighter-rouge">Dagger</code>的效果最好。相反，您必须在生命周期方法中执行成员注入。这意味着许多类最终看起来像：</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="k">public</span> <span class="k">class</span> <span class="nc">FrombulationActivity</span> <span class="n">extends</span> <span class="n">Activity</span> <span class="p">{</span>
  <span class="err">@</span><span class="n">Inject</span> <span class="n">Frombulator</span> <span class="n">frombulator</span><span class="p">;</span>

  <span class="err">@</span><span class="n">Override</span>
  <span class="k">public</span> <span class="kt">void</span> <span class="n">onCreate</span><span class="p">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">super</span><span class="p">.</span><span class="n">onCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">);</span>
    <span class="c1">// DO THIS FIRST. Otherwise frombulator might be null!</span>
    <span class="p">((</span><span class="n">SomeApplicationBaseType</span><span class="p">)</span> <span class="n">getContext</span><span class="p">().</span><span class="n">getApplicationContext</span><span class="p">())</span>
        <span class="p">.</span><span class="n">getApplicationComponent</span><span class="p">()</span>
        <span class="p">.</span><span class="n">newActivityComponentBuilder</span><span class="p">()</span>
        <span class="p">.</span><span class="n">activity</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
        <span class="p">.</span><span class="n">build</span><span class="p">()</span>
        <span class="p">.</span><span class="n">inject</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    <span class="c1">// ... now you can write the exciting code</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>这有几个问题：</p><ul><li><p>复制粘贴代码使得以后很难再进行重构。随着越来越多的开发者复制粘贴该块，越来越少的人知道它到底是做什么的。</p><li><p>更根本的是，它要求请求注入的类型（FrombulationActivity）知道其注入器。即使这是通过接口而不是具体类型来完成的，它也打破了依赖注入的核心原则：一个类不应该知道它是如何被注入的。</p></ul><h3 id="注入activity对象">注入Activity对象</h3><ol><li><p>在您的应用程序组件中安装<code class="language-plaintext highlighter-rouge">AndroidInjectionModule</code>以确保这些基本类型所需的所有绑定都可用。</p><li><p>首先编写一个实现<code class="language-plaintext highlighter-rouge">AndroidInjector&lt;YourActivity&gt;</code>的<code class="language-plaintext highlighter-rouge">@Subcomponent</code>和一个继承<code class="language-plaintext highlighter-rouge">AndroidInjector.Builder&lt;YourActivity&gt;</code>的<code class="language-plaintext highlighter-rouge">@Subcomponent.Builder</code>。</p></ol><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="nd">@Subcomponent</span><span class="o">(</span><span class="n">modules</span> <span class="o">=</span> <span class="o">...)</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">YourActivitySubcomponent</span> <span class="kd">extends</span> <span class="nc">AndroidInjector</span><span class="o">&lt;</span><span class="nc">YourActivity</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="nd">@Subcomponent</span><span class="o">.</span><span class="na">Builder</span>
  <span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">Builder</span> <span class="kd">extends</span> <span class="nc">AndroidInjector</span><span class="o">.</span><span class="na">Builder</span><span class="o">&lt;</span><span class="nc">YourActivity</span><span class="o">&gt;</span> <span class="o">{}</span>
<span class="o">}</span>
</pre></table></code></div></div><ol><li>定义子组件后，通过定义一个绑定子组件层次结构并将其添加到注入应用程序的组件的模块，将其添加到组件层次结构中。</ol><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="nd">@Module</span><span class="o">(</span><span class="n">subcomponents</span> <span class="o">=</span> <span class="nc">YourActivitySubcomponent</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">YourActivityModule</span> <span class="o">{</span>
  <span class="nd">@Binds</span>
  <span class="nd">@IntoMap</span>
  <span class="nd">@ActivityKey</span><span class="o">(</span><span class="nc">YourActivity</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
  <span class="kd">abstract</span> <span class="nc">AndroidInjector</span><span class="o">.</span><span class="na">Factory</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="nc">Activity</span><span class="o">&gt;</span>
      <span class="nf">bindYourActivityInjectorFactory</span><span class="o">(</span><span class="nc">YourActivitySubcomponent</span><span class="o">.</span><span class="na">Builder</span> <span class="n">builder</span><span class="o">);</span>
<span class="o">}</span>

<span class="nd">@Component</span><span class="o">(</span><span class="n">modules</span> <span class="o">=</span> <span class="o">{...,</span> <span class="nc">YourActivityModule</span><span class="o">.</span><span class="na">class</span><span class="o">})</span>
<span class="kd">interface</span> <span class="nc">YourApplicationComponent</span> <span class="o">{}</span>
</pre></table></code></div></div><p>专业提示：如果您的子组件及其构建器没有第2步中提到的其他方法或超类型，您可以使用<code class="language-plaintext highlighter-rouge">@ContributesAndroidInjector</code>为您生成它们。添加一个抽象模块方法，该方法返回您的<code class="language-plaintext highlighter-rouge">activity</code>，使用<code class="language-plaintext highlighter-rouge">@ContributesAndroidInjector</code>对其进行注释，并指定要安装到子组件中的模块，而不是步骤2和3。如果子组件需要作用域，则也可以将范围注释应用于该方法。</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nd">@ActivityScope</span>
<span class="nd">@ContributesAndroidInjector</span><span class="o">(</span><span class="n">modules</span> <span class="o">=</span> <span class="o">{</span> <span class="cm">/* modules to install into the subcomponent */</span> <span class="o">})</span>
<span class="kd">abstract</span> <span class="nc">YourActivity</span> <span class="nf">contributeYourActivityInjector</span><span class="o">();</span>
</pre></table></code></div></div><ol><li>接下来，让您的<code class="language-plaintext highlighter-rouge">Application</code>实现<code class="language-plaintext highlighter-rouge">HasActivityInjector</code>并且<code class="language-plaintext highlighter-rouge">@Inject</code>一个从<code class="language-plaintext highlighter-rouge">activityInjector()</code>方法返回的<code class="language-plaintext highlighter-rouge">DispatchingAndroidInjector&lt;Activity&gt;</code>。</ol><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">YourApplication</span> <span class="kd">extends</span> <span class="nc">Application</span> <span class="kd">implements</span> <span class="nc">HasActivityInjector</span> <span class="o">{</span>
  <span class="nd">@Inject</span> <span class="nc">DispatchingAndroidInjector</span><span class="o">&lt;</span><span class="nc">Activity</span><span class="o">&gt;</span> <span class="n">dispatchingActivityInjector</span><span class="o">;</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">();</span>
    <span class="nc">DaggerYourApplicationComponent</span><span class="o">.</span><span class="na">create</span><span class="o">()</span>
        <span class="o">.</span><span class="na">inject</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="nc">AndroidInjector</span><span class="o">&lt;</span><span class="nc">Activity</span><span class="o">&gt;</span> <span class="nf">activityInjector</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">dispatchingActivityInjector</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><ol><li>最终，在你的<code class="language-plaintext highlighter-rouge">Activity.onCreate()</code>方法中，在调用<code class="language-plaintext highlighter-rouge">super.onCreate();</code>之前调用<code class="language-plaintext highlighter-rouge">AndroidInjection.inject(this)</code>。</ol><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">YourActivity</span> <span class="kd">extends</span> <span class="nc">Activity</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="nc">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">AndroidInjection</span><span class="o">.</span><span class="na">inject</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
    <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><h4 id="如何工作">如何工作</h4><p><code class="language-plaintext highlighter-rouge">AndroidInjection.inject()</code>从<code class="language-plaintext highlighter-rouge">Application</code>中获取一个<code class="language-plaintext highlighter-rouge">DispatchingAndroidInjector&lt;Activity&gt;</code>并且传递你的<code class="language-plaintext highlighter-rouge">activity</code>到<code class="language-plaintext highlighter-rouge">inject(this)</code>。<code class="language-plaintext highlighter-rouge">DispatchingAndroidInjector</code>为您的Activity类（它是YourActivitySubcomponent.Builder）查找<code class="language-plaintext highlighter-rouge">AndroidInjector.Factory</code>，创建<code class="language-plaintext highlighter-rouge">AndroidInjector（它是YourActivitySubcomponent）</code>，并将您的Activity传递给<code class="language-plaintext highlighter-rouge">inject（YourActivity）</code>。</p><p><code class="language-plaintext highlighter-rouge">AndroidInjection</code>的<code class="language-plaintext highlighter-rouge">inject</code>方法</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre><span class="cm">/**
 * Injects {@code activity} if an associated {@link AndroidInjector} implementation can be found,
 * otherwise throws an {@link IllegalArgumentException}.
 *
 * @throws RuntimeException if the {@link Application} doesn't implement {@link
 *     HasActivityInjector}.
 */</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">inject</span><span class="o">(</span><span class="nc">Activity</span> <span class="n">activity</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">checkNotNull</span><span class="o">(</span><span class="n">activity</span><span class="o">,</span> <span class="s">"activity"</span><span class="o">);</span>
  <span class="nc">Application</span> <span class="n">application</span> <span class="o">=</span> <span class="n">activity</span><span class="o">.</span><span class="na">getApplication</span><span class="o">();</span>
  <span class="k">if</span> <span class="o">(!(</span><span class="n">application</span> <span class="k">instanceof</span> <span class="nc">HasActivityInjector</span><span class="o">))</span> <span class="o">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span>
        <span class="nc">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span>
            <span class="s">"%s does not implement %s"</span><span class="o">,</span>
            <span class="n">application</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getCanonicalName</span><span class="o">(),</span>
            <span class="nc">HasActivityInjector</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getCanonicalName</span><span class="o">()));</span>
  <span class="o">}</span>
<span class="c1">//</span>
  <span class="nc">AndroidInjector</span><span class="o">&lt;</span><span class="nc">Activity</span><span class="o">&gt;</span> <span class="n">activityInjector</span> <span class="o">=</span>
      <span class="o">((</span><span class="nc">HasActivityInjector</span><span class="o">)</span> <span class="n">application</span><span class="o">).</span><span class="na">activityInjector</span><span class="o">();</span>
  <span class="n">checkNotNull</span><span class="o">(</span><span class="n">activityInjector</span><span class="o">,</span> <span class="s">"%s.activityInjector() returned null"</span><span class="o">,</span> <span class="n">application</span><span class="o">.</span><span class="na">getClass</span><span class="o">());</span>

  <span class="n">activityInjector</span><span class="o">.</span><span class="na">inject</span><span class="o">(</span><span class="n">activity</span><span class="o">);</span>
<span class="o">}</span>

</pre></table></code></div></div><h3 id="注入fragment对象">注入Fragment对象</h3><blockquote><p>Injecting a Fragment is just as simple as injecting an Activity. Define your subcomponent in the same way, replacing Activity type parameters with Fragment, @ActivityKey with @FragmentKey, and HasActivityInjector with HasFragmentInjector.</p></blockquote><p>注入一个<code class="language-plaintext highlighter-rouge">Fragment</code>像注入一个<code class="language-plaintext highlighter-rouge">Activity</code>一样简单。以相同的方式定义你的<code class="language-plaintext highlighter-rouge">subcomponent</code>，使用<code class="language-plaintext highlighter-rouge">Fragment</code>替换<code class="language-plaintext highlighter-rouge">Activity</code>，<code class="language-plaintext highlighter-rouge">@FragmentKey</code>替换<code class="language-plaintext highlighter-rouge">@ActivityKey</code>,<code class="language-plaintext highlighter-rouge">HasFragmentInjector</code>替换<code class="language-plaintext highlighter-rouge">HasActivityInjector</code>。</p><blockquote><p>Instead of injecting in onCreate() as is done for Activity types, inject Fragments to in onAttach().</p></blockquote><p>不像在<code class="language-plaintext highlighter-rouge">Activity</code>类型中那样在<code class="language-plaintext highlighter-rouge">onCreate()</code>中注入，而是在<code class="language-plaintext highlighter-rouge">onAttach()</code>中注入<code class="language-plaintext highlighter-rouge">Fragment</code>。</p><blockquote><p>Unlike the modules defined for Activitys, you have a choice of where to install modules for Fragments. You can make your Fragment component a subcomponent of another Fragment component, an Activity component, or the Application component — it all depends on which other bindings your Fragment requires. After deciding on the component location, make the corresponding type implement HasFragmentInjector. For example, if your Fragment needs bindings from YourActivitySubcomponent, your code will look something like this:</p></blockquote><p>与为<code class="language-plaintext highlighter-rouge">Activity</code>定义的模块不同，您可以选择在哪里为<code class="language-plaintext highlighter-rouge">Fragments</code>安装模块。你可以让你的<code class="language-plaintext highlighter-rouge">Fragment</code>组件成为另一个<code class="language-plaintext highlighter-rouge">Fragment</code>子组件，<code class="language-plaintext highlighter-rouge">Activity</code>组件或<code class="language-plaintext highlighter-rouge">Application</code>组件的一个子组件 - 这一切都取决于你的<code class="language-plaintext highlighter-rouge">Fragment</code>需要的其他绑定。确定组件位置后，使相应的类型实现<code class="language-plaintext highlighter-rouge">HasFragmentInjector</code>。例如，如果您的<code class="language-plaintext highlighter-rouge">Fragment</code>需要来自<code class="language-plaintext highlighter-rouge">YourActivitySubcomponent</code>的绑定，那么您的代码将如下所示：</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">YourActivity</span> <span class="kd">extends</span> <span class="nc">Activity</span>
    <span class="kd">implements</span> <span class="nc">HasFragmentInjector</span> <span class="o">{</span>
  <span class="nd">@Inject</span> <span class="nc">DispatchingAndroidInjector</span><span class="o">&lt;</span><span class="nc">Fragment</span><span class="o">&gt;</span> <span class="n">fragmentInjector</span><span class="o">;</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="nc">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">AndroidInjection</span><span class="o">.</span><span class="na">inject</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
    <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
    <span class="c1">// ...</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="nc">AndroidInjector</span><span class="o">&lt;</span><span class="nc">Fragment</span><span class="o">&gt;</span> <span class="nf">fragmentInjector</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">fragmentInjector</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">YourFragment</span> <span class="kd">extends</span> <span class="nc">Fragment</span> <span class="o">{</span>
  <span class="nd">@Inject</span> <span class="nc">SomeDependency</span> <span class="n">someDep</span><span class="o">;</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onAttach</span><span class="o">(</span><span class="nc">Activity</span> <span class="n">activity</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">AndroidInjection</span><span class="o">.</span><span class="na">inject</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
    <span class="kd">super</span><span class="o">.</span><span class="na">onAttach</span><span class="o">(</span><span class="n">activity</span><span class="o">);</span>
    <span class="c1">// ...</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="nd">@Subcomponent</span><span class="o">(</span><span class="n">modules</span> <span class="o">=</span> <span class="o">...)</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">YourFragmentSubcomponent</span> <span class="kd">extends</span> <span class="nc">AndroidInjector</span><span class="o">&lt;</span><span class="nc">YourFragment</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="nd">@Subcomponent</span><span class="o">.</span><span class="na">Builder</span>
  <span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">Builder</span> <span class="kd">extends</span> <span class="nc">AndroidInjector</span><span class="o">.</span><span class="na">Builder</span><span class="o">&lt;</span><span class="nc">YourFragment</span><span class="o">&gt;</span> <span class="o">{}</span>
<span class="o">}</span>

<span class="nd">@Module</span><span class="o">(</span><span class="n">subcomponents</span> <span class="o">=</span> <span class="nc">YourFragmentSubcomponent</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">YourFragmentModule</span> <span class="o">{</span>
  <span class="nd">@Binds</span>
  <span class="nd">@IntoMap</span>
  <span class="nd">@FragmentKey</span><span class="o">(</span><span class="nc">YourFragment</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
  <span class="kd">abstract</span> <span class="nc">AndroidInjector</span><span class="o">.</span><span class="na">Factory</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="nc">Fragment</span><span class="o">&gt;</span>
      <span class="nf">bindYourFragmentInjectorFactory</span><span class="o">(</span><span class="nc">YourFragmentSubcomponent</span><span class="o">.</span><span class="na">Builder</span> <span class="n">builder</span><span class="o">);</span>
<span class="o">}</span>

<span class="nd">@Subcomponent</span><span class="o">(</span><span class="n">modules</span> <span class="o">=</span> <span class="o">{</span> <span class="nc">YourFragmentModule</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="o">...</span> <span class="o">}</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">YourActivityOrYourApplicationComponent</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>

</pre></table></code></div></div><h3 id="基本框架类型">基本框架类型</h3><blockquote><p>Because DispatchingAndroidInjector looks up the appropriate AndroidInjector.Factory by the class at runtime, a base class can implement HasActivityInjector/HasFragmentInjector/etc as well as call AndroidInjection.inject(). All each subclass needs to do is bind a corresponding @Subcomponent. Dagger provides a few base types that do this, such as DaggerActivity and DaggerFragment, if you don’t have a complicated class hierarchy. Dagger also provides a DaggerApplication for the same purpose — all you need to do is to extend it and override the applicationInjector() method to return the component that should inject the Application.</p></blockquote><p>因为<code class="language-plaintext highlighter-rouge">DispatchingAndroidInjector</code>在运行时按类查找适当的<code class="language-plaintext highlighter-rouge">AndroidInjector.Factory</code>，所以基类可以实现<code class="language-plaintext highlighter-rouge">HasActivityInjector</code>、<code class="language-plaintext highlighter-rouge">HasFragmentInjectoretc</code>等等以及调用<code class="language-plaintext highlighter-rouge">AndroidInjection.inject()</code>。每个子类都需要做的就是绑定一个对应的<code class="language-plaintext highlighter-rouge">@Subcomponent</code>。如果您没有复杂的类层次结构，<code class="language-plaintext highlighter-rouge">Dagger</code>会提供一些基本类型，例如<code class="language-plaintext highlighter-rouge">DaggerActivity</code>和<code class="language-plaintext highlighter-rouge">DaggerFragment</code>。Dagger还为同样的目的提供了一个DaggerApplication你需要做的就是扩展它并覆盖applicationInjector()方法来返回应该注入应用程序的组件。</p><p>以下类型也包括在内：</p><ul><li>DaggerService和DaggerIntentService<li>DaggerBroadcastReceiver<li>DaggerContentProvider</ul><blockquote><p>Note: DaggerBroadcastReceiver should only be used when the BroadcastReceiver is registered in the AndroidManifest.xml. When the BroadcastReceiver is created in your own code, prefer constructor injection instead.</p></blockquote><p>注意：DaggerBroadcastReceiver只能在AndroidManifest.xml中注册BroadcastReceiver时使用。在您自己的代码中创建BroadcastReceiver时，请改为使用构造函数注入。</p><h3 id="支持库">支持库</h3><blockquote><p>For users of the Android support library, parallel types exist in the dagger.android.support package. Note that while support Fragment users have to bind AndroidInjector.Factory&lt;? extends android.support.v4.app.Fragment&gt;, AppCompat users should continue to implement AndroidInjector.Factory&lt;? extends Activity&gt; and not &lt;? extends AppCompatActivity&gt; (or FragmentActivity).</p></blockquote><p>对于Android支持库的用户，<code class="language-plaintext highlighter-rouge">dagger.android.support</code>包中存在并行类型。请注意，尽管支持<code class="language-plaintext highlighter-rouge">Fragment</code>的用户必须绑定<code class="language-plaintext highlighter-rouge">AndroidInjector.Factory &lt;？extends android.support.v4.app.Fragment&gt;</code>，<code class="language-plaintext highlighter-rouge">AppCompat</code>用户应该继续实现<code class="language-plaintext highlighter-rouge">AndroidInjector.Factory &lt;？extends Activity&gt;</code>而不是<code class="language-plaintext highlighter-rouge">&lt;？extends AppCompatActivity&gt;</code>（或FragmentActivity）。</p><h3 id="如何获取它">如何获取它</h3><p>将以下内容添加到您的build.gradle中：</p><div class="language-groovy highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="n">dependencies</span> <span class="o">{</span>
  <span class="n">compile</span> <span class="s1">'com.google.dagger:dagger-android:2.x'</span>
  <span class="n">compile</span> <span class="s1">'com.google.dagger:dagger-android-support:2.x'</span> <span class="c1">// if you use the support libraries</span>
  <span class="n">annotationProcessor</span> <span class="s1">'com.google.dagger:dagger-android-processor:2.x'</span>
<span class="o">}</span>
</pre></table></code></div></div><h3 id="何时注入">何时注入</h3><blockquote><p>Constructor injection is preferred whenever possible because javac will ensure that no field is referenced before it has been set, which helps avoid NullPointerExceptions. When members injection is required (as discussed above), prefer to inject as early as possible. For this reason, DaggerActivity calls AndroidInjection.inject() immediately in onCreate(), before calling super.onCreate(), and DaggerFragment does the same in onAttach(), which also prevents inconsistencies if the Fragment is reattached.</p></blockquote><p>只要有可能，构造函数注入是首选，因为javac将确保没有字段在被设置之前被引用，这有助于避免NullPointerException。 当需要成员注射（如上所述）时，倾向于尽早注射。 出于这个原因，DaggerActivity在调用<code class="language-plaintext highlighter-rouge">super.onCreate()</code>之前立即在<code class="language-plaintext highlighter-rouge">onCreate()</code>中调用AndroidInjection.inject()，并且DaggerFragment在onAttach()中也是这样做的，这也可以防止在重新连接片段时出现不一致。</p><blockquote><p>It is crucial to call AndroidInjection.inject() before super.onCreate() in an Activity, since the call to super attaches Fragments from the previous activity instance during configuration change, which in turn injects the Fragments. In order for the Fragment injection to succeed, the Activity must already be injected. For users of ErrorProne, it is a compiler error to call AndroidInjection.inject() after super.onCreate().</p></blockquote><p>在Activity中的super.onCreate()之前调用AndroidInjection.inject()是非常重要的，因为超级调用在配置更改期间将前一个活动实例的碎片连接到Fragments，而这又会导致碎片。 为了使片段注入成功，该活动必须已经被注入。 对于ErrorProne的用户，在super.onCreate()之后调用AndroidInjection.inject()是一个编译器错误。</p><h3 id="常见问题">常见问题</h3><blockquote><p>AndroidInjector.Factory is intended to be a stateless interface so that implementors don’t have to worry about managing state related to the object which will be injected. When DispatchingAndroidInjector requests a AndroidInjector.Factory, it does so through a Provider so that it doesn’t explicitly retain any instances of the factory. Because the AndroidInjector.Builder implementation that is generated by Dagger does retain an instance of the Activity/Fragment/etc that is being injected, it is a compile-time error to apply a scope to the methods which provide them. If you are positive that your AndroidInjector.Factory does not retain an instance to the injected object, you may suppress this error by applying @SuppressWarnings(“dagger.android.ScopedInjectoryFactory”) to your module method.</p></blockquote><p>AndroidInjector.Factory旨在成为无状态接口，以便实现者不必担心管理与将被注入的对象相关的状态。 当DispatchingAndroidInjector请求一个AndroidInjector.Factory时，它通过一个Provider来这样做，以便它不明确地保留工厂的任何实例。 由于由Dagger生成的AndroidInjector.Builder实现确实保留了正在被注入的Activity / Fragment /等的实例，因此将范围应用于提供它们的方法时发生编译时错误。 如果你肯定你的AndroidInjector.Factory没有为注入对象保留一个实例，你可以通过在模块方法中应用@SuppressWarnings（“dagger.android.ScopedInjectoryFactory”）来消除这个错误。</p><h3 id="有用链接">有用链接</h3><ul><li><a href="https://medium.com/@iammert/new-android-injector-with-dagger-2-part-1-8baa60152abe">New Android Injector with Dagger 2 — part 1</a></ul></div><div class="post-tail-wrapper text-muted"><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/dagger/" class="post-tag no-text-decoration" >Dagger</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Dagger2在Android中的使用 - malinkang&url=https://malinkang.cn/posts/dagger-android/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Dagger2在Android中的使用 - malinkang&u=https://malinkang.cn/posts/dagger-android/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Dagger2在Android中的使用 - malinkang&url=https://malinkang.cn/posts/dagger-android/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/dagger-guide/">Dagger使用指南</a><li><a href="/posts/understanding-the-jvm-runtime-data-areas/">《深入理解JVM》第2章Java内存区域与内存溢出异常</a><li><a href="/posts/understanding-the-jvm-garbage-collection/">《深入理解JVM》第3章垃圾收集器</a><li><a href="/posts/understanding-the-jvm-class-file-structure/">《深入理解JVM》第6章类文件结构</a><li><a href="/posts/understanding-the-jvm-class-loader/">《深入理解JVM》第7章虚拟机类加载机制</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/">源码分析</a> <a class="post-tag" href="/tags/thinking-in-java/">Thinking in Java</a> <a class="post-tag" href="/tags/android/">Android</a> <a class="post-tag" href="/tags/effective-java/">Effective Java</a> <a class="post-tag" href="/tags/kotlin/">Kotlin</a> <a class="post-tag" href="/tags/java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98/">Java并发编程实战</a> <a class="post-tag" href="/tags/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3jvm/">深入理解JVM</a> <a class="post-tag" href="/tags/android/">android</a> <a class="post-tag" href="/tags/databinding/">databinding</a> <a class="post-tag" href="/tags/recyclerview/">RecyclerView</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/dagger-guide/"><div class="card-body"> <span class="timeago small" > Jul 25, 2016 <i class="unloaded">2016-07-25T09:47:31+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Dagger使用指南</h3><div class="text-muted small"><p> 任何应用程序中最好的类是那些做事情的类：BarcodeDecoder，KoopaPhysicsEngine和AudioStreamer。 这些类具有依赖性; 也许是一个BarcodeCameraFinder，DefaultPhysicsEngine和一个HttpStreamer。 相比之下，任何应用程序中最糟糕的类是那些占用空间而又没有做太多事情类：BarcodeDecoderFactor...</p></div></div></a></div><div class="card"> <a href="/posts/deskclock-analysis/"><div class="card-body"> <span class="timeago small" > Jan 19 <i class="unloaded">2021-01-19T17:21:04+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>系统闹钟源码分析</h3><div class="text-muted small"><p> 核心类 UI部分 DeskClock：主界面，由ViewPager实现。 DeskClockFragment：首页四个Fragment的基类。 AlarmClockFragment：闹钟Fragment ClockFragment：时钟Fragment StopwatchFragment：秒表Fragm...</p></div></div></a></div><div class="card"> <a href="/posts/bound-services/"><div class="card-body"> <span class="timeago small" > Dec 15, 2020 <i class="unloaded">2020-12-15T03:18:41+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>绑定服务</h3><div class="text-muted small"><p> 绑定服务是 Service 类的实现，可让其他应用与其进行绑定和交互。如要为服务提供绑定，您必须实现 onBind() 回调方法。该方法会返回 IBinder 对象，该对象定义的编程接口可供客户端用来与服务进行交互。 客户端通过调用 bindService() 绑定到服务。调用时，它必须提供 ServiceConnection 的实现，后者会监控与服务的连接。bindService() 的...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/navigation-implementing/" class="btn btn-outline-primary" prompt="Older"><p>实现navigation</p></a> <a href="/posts/kotlin-functions/" class="btn btn-outline-primary" prompt="Newer"><p>Kotlin函数</p></a></div><div id="disqus" class="pt-2 pb-2"><p class="text-center text-muted small pb-5"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script src="/assets/js/lib/jquery.disqusloader.min.js"></script> <script> const options = { scriptUrl: '//malinkang-cn.disqus.com/embed.js', disqusConfig: function() { this.page.title = 'Dagger2在Android中的使用'; this.page.url = 'https://malinkang.cn/posts/dagger-android/'; this.page.identifier = '/posts/dagger-android/'; } }; $.disqusLoader('#disqus', options); </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://twitter.com/malinkang">malinkang</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/">源码分析</a> <a class="post-tag" href="/tags/thinking-in-java/">Thinking in Java</a> <a class="post-tag" href="/tags/android/">Android</a> <a class="post-tag" href="/tags/effective-java/">Effective Java</a> <a class="post-tag" href="/tags/kotlin/">Kotlin</a> <a class="post-tag" href="/tags/java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98/">Java并发编程实战</a> <a class="post-tag" href="/tags/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3jvm/">深入理解JVM</a> <a class="post-tag" href="/tags/android/">android</a> <a class="post-tag" href="/tags/databinding/">databinding</a> <a class="post-tag" href="/tags/recyclerview/">RecyclerView</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://malinkang.cn{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>

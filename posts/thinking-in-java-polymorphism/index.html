<!DOCTYPE html><html lang="zh-CN" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="《Java编程思想》第8章多态" /><meta property="og:locale" content="zh_CN" /><meta name="description" content="8.1 再论向上转型" /><meta property="og:description" content="8.1 再论向上转型" /><link rel="canonical" href="https://malinkang.cn/posts/thinking-in-java-polymorphism/" /><meta property="og:url" content="https://malinkang.cn/posts/thinking-in-java-polymorphism/" /><meta property="og:site_name" content="malinkang" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2013-04-30T21:39:36+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="《Java编程思想》第8章多态" /><meta name="twitter:site" content="@malinkang" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"description":"8.1 再论向上转型","headline":"《Java编程思想》第8章多态","dateModified":"2013-04-30T21:39:36+08:00","url":"https://malinkang.cn/posts/thinking-in-java-polymorphism/","datePublished":"2013-04-30T21:39:36+08:00","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://malinkang.cn/posts/thinking-in-java-polymorphism/"},"@context":"https://schema.org"}</script><title>《Java编程思想》第8章多态 | malinkang</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="malinkang"><meta name="application-name" content="malinkang"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://malinkang-1253444926.cos.ap-beijing.myqcloud.com/images/avatar.jpeg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">malinkang</a></div><div class="site-subtitle font-italic">人生最可悲的事情，莫过于胸怀大志，却又虚度光阴。</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>分类</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>标签</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>归档</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>关于</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/malinkang" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/malinkang" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['linkang.ma','gmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>《Java编程思想》第8章多态</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>《Java编程思想》第8章多态</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> malinkang </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Tue, Apr 30, 2013, 9:39 PM +0800" prep="on" > Apr 30, 2013 <i class="unloaded">2013-04-30T21:39:36+08:00</i> </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="4075 words">22 min</span></div></div><div class="post-content"><h2 id="81-再论向上转型">8.1 再论向上转型</h2><p>对某个对象的引用视为对其基类型的引用的做法被称作<code class="language-plaintext highlighter-rouge">向上转型</code>。</p><p>单独创建一个奏乐符（Note）类：</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="c1">//: polymorphism/music/Note.java</span>
<span class="c1">// Notes to play on musical instruments.</span>
<span class="kn">package</span> <span class="nn">polymorphism.music</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">enum</span> <span class="nc">Note</span> <span class="o">{</span>
    <span class="no">MIDDLE_C</span><span class="o">,</span> <span class="no">C_SHARP</span><span class="o">,</span> <span class="no">B_FLAT</span><span class="o">;</span> <span class="c1">// Etc.</span>
<span class="o">}</span> <span class="c1">///:~</span>
</pre></table></code></div></div><p>乐器类<code class="language-plaintext highlighter-rouge">Instrument</code>:</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="c1">//: polymorphism/music/Instrument.java</span>
<span class="kn">package</span> <span class="nn">polymorphism.music</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">net</span><span class="o">.</span><span class="na">mindview</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">Print</span><span class="o">.*;</span>

<span class="kd">class</span> <span class="nc">Instrument</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">play</span><span class="o">(</span><span class="nc">Note</span> <span class="n">n</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">print</span><span class="o">(</span><span class="s">"Instrument.play()"</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
 <span class="c1">///:~</span>
</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="c1">//: polymorphism/music/Wind.java</span>
<span class="kn">package</span> <span class="nn">polymorphism.music</span><span class="o">;</span>

<span class="c1">// Wind objects are instruments</span>
<span class="c1">// because they have the same interface:</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Wind</span> <span class="kd">extends</span> <span class="nc">Instrument</span> <span class="o">{</span>
  <span class="c1">// Redefine interface method:</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">play</span><span class="o">(</span><span class="nc">Note</span> <span class="n">n</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Wind.play() "</span> <span class="o">+</span> <span class="n">n</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~</span>
</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="c1">//: polymorphism/music/Music.java</span>
<span class="c1">// Inheritance &amp; upcasting.</span>
<span class="kn">package</span> <span class="nn">polymorphism.music</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Music</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">tune</span><span class="o">(</span><span class="nc">Instrument</span> <span class="n">i</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// ...</span>
    <span class="n">i</span><span class="o">.</span><span class="na">play</span><span class="o">(</span><span class="nc">Note</span><span class="o">.</span><span class="na">MIDDLE_C</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Wind</span> <span class="n">flute</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Wind</span><span class="o">();</span>
    <span class="n">tune</span><span class="o">(</span><span class="n">flute</span><span class="o">);</span> <span class="c1">// Upcasting</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output:
Wind.play() MIDDLE_C
*/</span><span class="c1">//:~</span>
</pre></table></code></div></div><h3 id="811-忘记对象类型">8.1.1 忘记对象类型</h3><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
</pre><td class="rouge-code"><pre><span class="c1">//: polymorphism/music/Music2.java</span>
<span class="c1">// Overloading instead of upcasting.</span>
<span class="kn">package</span> <span class="nn">polymorphism.music</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">net</span><span class="o">.</span><span class="na">mindview</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">Print</span><span class="o">.*;</span>

<span class="kd">class</span> <span class="nc">Stringed</span> <span class="kd">extends</span> <span class="nc">Instrument</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">play</span><span class="o">(</span><span class="nc">Note</span> <span class="n">n</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">print</span><span class="o">(</span><span class="s">"Stringed.play() "</span> <span class="o">+</span> <span class="n">n</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Brass</span> <span class="kd">extends</span> <span class="nc">Instrument</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">play</span><span class="o">(</span><span class="nc">Note</span> <span class="n">n</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">print</span><span class="o">(</span><span class="s">"Brass.play() "</span> <span class="o">+</span> <span class="n">n</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Music2</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">tune</span><span class="o">(</span><span class="nc">Wind</span> <span class="n">i</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">i</span><span class="o">.</span><span class="na">play</span><span class="o">(</span><span class="nc">Note</span><span class="o">.</span><span class="na">MIDDLE_C</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">tune</span><span class="o">(</span><span class="nc">Stringed</span> <span class="n">i</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">i</span><span class="o">.</span><span class="na">play</span><span class="o">(</span><span class="nc">Note</span><span class="o">.</span><span class="na">MIDDLE_C</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">tune</span><span class="o">(</span><span class="nc">Brass</span> <span class="n">i</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">i</span><span class="o">.</span><span class="na">play</span><span class="o">(</span><span class="nc">Note</span><span class="o">.</span><span class="na">MIDDLE_C</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Wind</span> <span class="n">flute</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Wind</span><span class="o">();</span>
    <span class="nc">Stringed</span> <span class="n">violin</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Stringed</span><span class="o">();</span>
    <span class="nc">Brass</span> <span class="n">frenchHorn</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Brass</span><span class="o">();</span>
    <span class="n">tune</span><span class="o">(</span><span class="n">flute</span><span class="o">);</span> <span class="c1">// No upcasting</span>
    <span class="n">tune</span><span class="o">(</span><span class="n">violin</span><span class="o">);</span>
    <span class="n">tune</span><span class="o">(</span><span class="n">frenchHorn</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output:
Wind.play() MIDDLE_C
Stringed.play() MIDDLE_C
Brass.play() MIDDLE_C
*/</span><span class="c1">//:~</span>
</pre></table></code></div></div><h2 id="82转机">8.2转机</h2><h3 id="821-方法调用绑定">8.2.1 方法调用绑定</h3><p>将一个方法调用同一个方法主体关联起来被称作<code class="language-plaintext highlighter-rouge">绑定</code>。若在程序执行前进行绑定，叫做<code class="language-plaintext highlighter-rouge">前期绑定</code>。</p><p>运行时根据对象的类型进行绑定就是<code class="language-plaintext highlighter-rouge">后期绑定</code>。后期绑定也叫做<code class="language-plaintext highlighter-rouge">动态绑定</code>或<code class="language-plaintext highlighter-rouge">运行时绑定</code>。<strong>如果一种语言想要实现后期绑定，就必须具有某种机制，以便在运行时能判断对象的类型，从而调用恰当的方法。也就是说，编译器一直不知道对象的类型，但是方法调用机制能找到正确的方法体，并加以调用</strong>。</p><h3 id="822-产生正确的行为">8.2.2 产生正确的行为</h3><p><code class="language-plaintext highlighter-rouge">Java</code>中所有方法都是通过动态绑定实现多态。</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
</pre><td class="rouge-code"><pre><span class="c1">//: polymorphism/shape/Shape.java</span>
<span class="kn">package</span> <span class="nn">polymorphism.shape</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Shape</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">draw</span><span class="o">()</span> <span class="o">{}</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">erase</span><span class="o">()</span> <span class="o">{}</span>
<span class="o">}</span> <span class="c1">///:~</span>


<span class="c1">//: polymorphism/shape/Circle.java</span>
<span class="kn">package</span> <span class="nn">polymorphism.shape</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">net</span><span class="o">.</span><span class="na">mindview</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">Print</span><span class="o">.*;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Circle</span> <span class="kd">extends</span> <span class="nc">Shape</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">draw</span><span class="o">()</span> <span class="o">{</span> <span class="n">print</span><span class="o">(</span><span class="s">"Circle.draw()"</span><span class="o">);</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">erase</span><span class="o">()</span> <span class="o">{</span> <span class="n">print</span><span class="o">(</span><span class="s">"Circle.erase()"</span><span class="o">);</span> <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~</span>

<span class="c1">//: polymorphism/shape/Square.java</span>
<span class="kn">package</span> <span class="nn">polymorphism.shape</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">net</span><span class="o">.</span><span class="na">mindview</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">Print</span><span class="o">.*;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Square</span> <span class="kd">extends</span> <span class="nc">Shape</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">draw</span><span class="o">()</span> <span class="o">{</span> <span class="n">print</span><span class="o">(</span><span class="s">"Square.draw()"</span><span class="o">);</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">erase</span><span class="o">()</span> <span class="o">{</span> <span class="n">print</span><span class="o">(</span><span class="s">"Square.erase()"</span><span class="o">);</span> <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~</span>

<span class="c1">//: polymorphism/shape/Triangle.java</span>
<span class="kn">package</span> <span class="nn">polymorphism.shape</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">net</span><span class="o">.</span><span class="na">mindview</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">Print</span><span class="o">.*;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Triangle</span> <span class="kd">extends</span> <span class="nc">Shape</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">draw</span><span class="o">()</span> <span class="o">{</span> <span class="n">print</span><span class="o">(</span><span class="s">"Triangle.draw()"</span><span class="o">);</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">erase</span><span class="o">()</span> <span class="o">{</span> <span class="n">print</span><span class="o">(</span><span class="s">"Triangle.erase()"</span><span class="o">);</span> <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~</span>
<span class="c1">//: polymorphism/shape/RandomShapeGenerator.java</span>
<span class="c1">// A "factory" that randomly creates shapes.</span>
<span class="kn">package</span> <span class="nn">polymorphism.shape</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">RandomShapeGenerator</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="nc">Random</span> <span class="n">rand</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Random</span><span class="o">(</span><span class="mi">47</span><span class="o">);</span>
  <span class="kd">public</span> <span class="nc">Shape</span> <span class="nf">next</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">switch</span><span class="o">(</span><span class="n">rand</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="mi">3</span><span class="o">))</span> <span class="o">{</span>
      <span class="k">default</span><span class="o">:</span>
      <span class="k">case</span> <span class="mi">0</span><span class="o">:</span> <span class="k">return</span> <span class="k">new</span> <span class="nc">Circle</span><span class="o">();</span>
      <span class="k">case</span> <span class="mi">1</span><span class="o">:</span> <span class="k">return</span> <span class="k">new</span> <span class="nc">Square</span><span class="o">();</span>
      <span class="k">case</span> <span class="mi">2</span><span class="o">:</span> <span class="k">return</span> <span class="k">new</span> <span class="nc">Triangle</span><span class="o">();</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~</span>

<span class="c1">//: polymorphism/Shapes.java</span>
<span class="c1">// Polymorphism in Java.</span>
<span class="kn">import</span> <span class="nn">polymorphism.shape.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Shapes</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="nc">RandomShapeGenerator</span> <span class="n">gen</span> <span class="o">=</span>
    <span class="k">new</span> <span class="nf">RandomShapeGenerator</span><span class="o">();</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Shape</span><span class="o">[]</span> <span class="n">s</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Shape</span><span class="o">[</span><span class="mi">9</span><span class="o">];</span>
    <span class="c1">// Fill up the array with shapes:</span>
    <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">s</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span>
      <span class="n">s</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="n">gen</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
    <span class="c1">// Make polymorphic method calls:</span>
    <span class="k">for</span><span class="o">(</span><span class="nc">Shape</span> <span class="n">shp</span> <span class="o">:</span> <span class="n">s</span><span class="o">)</span>
      <span class="n">shp</span><span class="o">.</span><span class="na">draw</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output:
Triangle.draw()
Triangle.draw()
Square.draw()
Triangle.draw()
Square.draw()
Triangle.draw()
Square.draw()
Triangle.draw()
Circle.draw()
*/</span><span class="c1">//:~</span>
</pre></table></code></div></div><p>每个<code class="language-plaintext highlighter-rouge">return</code>语句取得一个指向某个<code class="language-plaintext highlighter-rouge">Circle</code>、<code class="language-plaintext highlighter-rouge">Square</code>或者<code class="language-plaintext highlighter-rouge">Triangle</code>的引用，并将其以<code class="language-plaintext highlighter-rouge">Shape</code>类型从<code class="language-plaintext highlighter-rouge">next()</code>方法中发送出去。所以无论我们在上面时候调用<code class="language-plaintext highlighter-rouge">next()</code>方法时，是绝对不可能知道具体类型到底是什么，因为我们总是只能获得一个通用的<code class="language-plaintext highlighter-rouge">Shape</code>引用。</p><p>随机选择几何形状是为了让大家理解：在编译时，编译器不需要获得任何特殊信息就能进行正确的调用。对<code class="language-plaintext highlighter-rouge">draw()</code>方法的所有调用都是通过动态绑定进行的。</p><h3 id="823-可扩展性">8.2.3 可扩展性</h3><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
</pre><td class="rouge-code"><pre><span class="c1">//: polymorphism/music3/Music3.java</span>
<span class="c1">// An extensible program.</span>
<span class="kn">package</span> <span class="nn">polymorphism.music3</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">polymorphism.music.Note</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">net</span><span class="o">.</span><span class="na">mindview</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">Print</span><span class="o">.*;</span>

<span class="kd">class</span> <span class="nc">Instrument</span> <span class="o">{</span>
  <span class="kt">void</span> <span class="nf">play</span><span class="o">(</span><span class="nc">Note</span> <span class="n">n</span><span class="o">)</span> <span class="o">{</span> <span class="n">print</span><span class="o">(</span><span class="s">"Instrument.play() "</span> <span class="o">+</span> <span class="n">n</span><span class="o">);</span> <span class="o">}</span>
  <span class="nc">String</span> <span class="nf">what</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="s">"Instrument"</span><span class="o">;</span> <span class="o">}</span>
  <span class="kt">void</span> <span class="nf">adjust</span><span class="o">()</span> <span class="o">{</span> <span class="n">print</span><span class="o">(</span><span class="s">"Adjusting Instrument"</span><span class="o">);</span> <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Wind</span> <span class="kd">extends</span> <span class="nc">Instrument</span> <span class="o">{</span>
  <span class="kt">void</span> <span class="nf">play</span><span class="o">(</span><span class="nc">Note</span> <span class="n">n</span><span class="o">)</span> <span class="o">{</span> <span class="n">print</span><span class="o">(</span><span class="s">"Wind.play() "</span> <span class="o">+</span> <span class="n">n</span><span class="o">);</span> <span class="o">}</span>
  <span class="nc">String</span> <span class="nf">what</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="s">"Wind"</span><span class="o">;</span> <span class="o">}</span>
  <span class="kt">void</span> <span class="nf">adjust</span><span class="o">()</span> <span class="o">{</span> <span class="n">print</span><span class="o">(</span><span class="s">"Adjusting Wind"</span><span class="o">);</span> <span class="o">}</span>
<span class="o">}</span>    

<span class="kd">class</span> <span class="nc">Percussion</span> <span class="kd">extends</span> <span class="nc">Instrument</span> <span class="o">{</span>
  <span class="kt">void</span> <span class="nf">play</span><span class="o">(</span><span class="nc">Note</span> <span class="n">n</span><span class="o">)</span> <span class="o">{</span> <span class="n">print</span><span class="o">(</span><span class="s">"Percussion.play() "</span> <span class="o">+</span> <span class="n">n</span><span class="o">);</span> <span class="o">}</span>
  <span class="nc">String</span> <span class="nf">what</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="s">"Percussion"</span><span class="o">;</span> <span class="o">}</span>
  <span class="kt">void</span> <span class="nf">adjust</span><span class="o">()</span> <span class="o">{</span> <span class="n">print</span><span class="o">(</span><span class="s">"Adjusting Percussion"</span><span class="o">);</span> <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Stringed</span> <span class="kd">extends</span> <span class="nc">Instrument</span> <span class="o">{</span>
  <span class="kt">void</span> <span class="nf">play</span><span class="o">(</span><span class="nc">Note</span> <span class="n">n</span><span class="o">)</span> <span class="o">{</span> <span class="n">print</span><span class="o">(</span><span class="s">"Stringed.play() "</span> <span class="o">+</span> <span class="n">n</span><span class="o">);</span> <span class="o">}</span>
  <span class="nc">String</span> <span class="nf">what</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="s">"Stringed"</span><span class="o">;</span> <span class="o">}</span>
  <span class="kt">void</span> <span class="nf">adjust</span><span class="o">()</span> <span class="o">{</span> <span class="n">print</span><span class="o">(</span><span class="s">"Adjusting Stringed"</span><span class="o">);</span> <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Brass</span> <span class="kd">extends</span> <span class="nc">Wind</span> <span class="o">{</span>
  <span class="kt">void</span> <span class="nf">play</span><span class="o">(</span><span class="nc">Note</span> <span class="n">n</span><span class="o">)</span> <span class="o">{</span> <span class="n">print</span><span class="o">(</span><span class="s">"Brass.play() "</span> <span class="o">+</span> <span class="n">n</span><span class="o">);</span> <span class="o">}</span>
  <span class="kt">void</span> <span class="nf">adjust</span><span class="o">()</span> <span class="o">{</span> <span class="n">print</span><span class="o">(</span><span class="s">"Adjusting Brass"</span><span class="o">);</span> <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Woodwind</span> <span class="kd">extends</span> <span class="nc">Wind</span> <span class="o">{</span>
  <span class="kt">void</span> <span class="nf">play</span><span class="o">(</span><span class="nc">Note</span> <span class="n">n</span><span class="o">)</span> <span class="o">{</span> <span class="n">print</span><span class="o">(</span><span class="s">"Woodwind.play() "</span> <span class="o">+</span> <span class="n">n</span><span class="o">);</span> <span class="o">}</span>
  <span class="nc">String</span> <span class="nf">what</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="s">"Woodwind"</span><span class="o">;</span> <span class="o">}</span>
<span class="o">}</span>    

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Music3</span> <span class="o">{</span>
  <span class="c1">// Doesn't care about type, so new types</span>
  <span class="c1">// added to the system still work right:</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">tune</span><span class="o">(</span><span class="nc">Instrument</span> <span class="n">i</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// ...</span>
    <span class="n">i</span><span class="o">.</span><span class="na">play</span><span class="o">(</span><span class="nc">Note</span><span class="o">.</span><span class="na">MIDDLE_C</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">tuneAll</span><span class="o">(</span><span class="nc">Instrument</span><span class="o">[]</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">for</span><span class="o">(</span><span class="nc">Instrument</span> <span class="n">i</span> <span class="o">:</span> <span class="n">e</span><span class="o">)</span>
      <span class="n">tune</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
  <span class="o">}</span>    
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// Upcasting during addition to the array:</span>
    <span class="nc">Instrument</span><span class="o">[]</span> <span class="n">orchestra</span> <span class="o">=</span> <span class="o">{</span>
      <span class="k">new</span> <span class="nf">Wind</span><span class="o">(),</span>
      <span class="k">new</span> <span class="nf">Percussion</span><span class="o">(),</span>
      <span class="k">new</span> <span class="nf">Stringed</span><span class="o">(),</span>
      <span class="k">new</span> <span class="nf">Brass</span><span class="o">(),</span>
      <span class="k">new</span> <span class="nf">Woodwind</span><span class="o">()</span>
    <span class="o">};</span>
    <span class="n">tuneAll</span><span class="o">(</span><span class="n">orchestra</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output:
Wind.play() MIDDLE_C
Percussion.play() MIDDLE_C
Stringed.play() MIDDLE_C
Brass.play() MIDDLE_C
Woodwind.play() MIDDLE_C
*/</span><span class="c1">//:~</span>
</pre></table></code></div></div><p>多态是一项让程序员“将改变的事物与未变的事物分离开来”的重要技术。</p><h3 id="824-缺陷覆盖私有方法">8.2.4 缺陷：“覆盖”私有方法</h3><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="c1">//: polymorphism/PrivateOverride.java</span>
<span class="c1">// Trying to override a private method.</span>
<span class="kn">package</span> <span class="nn">polymorphism</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">net</span><span class="o">.</span><span class="na">mindview</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">Print</span><span class="o">.*;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PrivateOverride</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kt">void</span> <span class="nf">f</span><span class="o">()</span> <span class="o">{</span> <span class="n">print</span><span class="o">(</span><span class="s">"private f()"</span><span class="o">);</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">PrivateOverride</span> <span class="n">po</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Derived</span><span class="o">();</span>
    <span class="n">po</span><span class="o">.</span><span class="na">f</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Derived</span> <span class="kd">extends</span> <span class="nc">PrivateOverride</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">f</span><span class="o">()</span> <span class="o">{</span> <span class="n">print</span><span class="o">(</span><span class="s">"public f()"</span><span class="o">);</span> <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output:
private f()
*/</span><span class="c1">//:~</span>
</pre></table></code></div></div><p>只有非<code class="language-plaintext highlighter-rouge">private</code>方法才可以被覆盖；在导出类中，对于基类中的<code class="language-plaintext highlighter-rouge">private</code>方法，最好采用不同的名字。</p><h3 id="825-缺陷域与静态方法">8.2.5 缺陷：域与静态方法</h3><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre><td class="rouge-code"><pre><span class="c1">//: polymorphism/FieldAccess.java</span>
<span class="c1">// Direct field access is determined at compile time.</span>

<span class="kd">class</span> <span class="nc">Super</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="n">field</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getField</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">field</span><span class="o">;</span> <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Sub</span> <span class="kd">extends</span> <span class="nc">Super</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="n">field</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getField</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">field</span><span class="o">;</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getSuperField</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="kd">super</span><span class="o">.</span><span class="na">field</span><span class="o">;</span> <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FieldAccess</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Super</span> <span class="n">sup</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Sub</span><span class="o">();</span> <span class="c1">// Upcast</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"sup.field = "</span> <span class="o">+</span> <span class="n">sup</span><span class="o">.</span><span class="na">field</span> <span class="o">+</span>
      <span class="s">", sup.getField() = "</span> <span class="o">+</span> <span class="n">sup</span><span class="o">.</span><span class="na">getField</span><span class="o">());</span>
    <span class="nc">Sub</span> <span class="n">sub</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Sub</span><span class="o">();</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"sub.field = "</span> <span class="o">+</span>
      <span class="n">sub</span><span class="o">.</span><span class="na">field</span> <span class="o">+</span> <span class="s">", sub.getField() = "</span> <span class="o">+</span>
      <span class="n">sub</span><span class="o">.</span><span class="na">getField</span><span class="o">()</span> <span class="o">+</span>
      <span class="s">", sub.getSuperField() = "</span> <span class="o">+</span>
      <span class="n">sub</span><span class="o">.</span><span class="na">getSuperField</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output:
sup.field = 0, sup.getField() = 1
sub.field = 1, sub.getField() = 1, sub.getSuperField() = 0
*/</span><span class="c1">//:~</span>
</pre></table></code></div></div><p>当<code class="language-plaintext highlighter-rouge">Sub</code>对象转型为<code class="language-plaintext highlighter-rouge">Super</code>引用时，任何域访问操作都将由编译器解析，因此不是多态的。在本例中，为<code class="language-plaintext highlighter-rouge">Super.field</code>和<code class="language-plaintext highlighter-rouge">Sub.field</code>分配了不同的存储空间。这样，<code class="language-plaintext highlighter-rouge">Sub</code>实际上包含两个称为<code class="language-plaintext highlighter-rouge">field</code>的域：它自己的和它从<code class="language-plaintext highlighter-rouge">Super</code>处得到的。然而，在引用<code class="language-plaintext highlighter-rouge">Sub</code>中的<code class="language-plaintext highlighter-rouge">field</code>时所产生的默认域并非<code class="language-plaintext highlighter-rouge">Super</code>版本的<code class="language-plaintext highlighter-rouge">field</code>域。因此，为了得到<code class="language-plaintext highlighter-rouge">Super.field</code>，必须显式地指明<code class="language-plaintext highlighter-rouge">super.field</code>。</p><p>如果某个方法是静态的，它的行为就不具有多态性：</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre><td class="rouge-code"><pre><span class="c1">//: polymorphism/StaticPolymorphism.java</span>
<span class="c1">// Static methods are not polymorphic.</span>

<span class="kd">class</span> <span class="nc">StaticSuper</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="nc">String</span> <span class="nf">staticGet</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="s">"Base staticGet()"</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="nc">String</span> <span class="nf">dynamicGet</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="s">"Base dynamicGet()"</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">StaticSub</span> <span class="kd">extends</span> <span class="nc">StaticSuper</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="nc">String</span> <span class="nf">staticGet</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="s">"Derived staticGet()"</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="nc">String</span> <span class="nf">dynamicGet</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="s">"Derived dynamicGet()"</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">StaticPolymorphism</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">StaticSuper</span> <span class="n">sup</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StaticSub</span><span class="o">();</span> <span class="c1">// Upcast</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">sup</span><span class="o">.</span><span class="na">staticGet</span><span class="o">());</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">sup</span><span class="o">.</span><span class="na">dynamicGet</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output:
Base staticGet()
Derived dynamicGet()
*/</span><span class="c1">//:~</span>
</pre></table></code></div></div><p>静态方法是与类，而并非与单个对象相关联</p><h2 id="83构造器和多态">8.3构造器和多态</h2><p>构造器不具有多态性（它们实际上是<code class="language-plaintext highlighter-rouge">static</code>方法，只不过该<code class="language-plaintext highlighter-rouge">static</code>声明是隐式的）。</p><h3 id="831-构造器的调用顺序">8.3.1 构造器的调用顺序</h3><p>基类的构造器总是在导出类的构造过程中被调用，而且按照继承层次逐渐向上链接，以使每个基类的构造器都能得到调用。这样做是有意义的，因为构造器具有一项特殊任务：检查对象是否被正确地构造。导出类只能访问它自己的成员，不能访问基类中的成员。只有基类的构造器才具有恰当的知识和权限来对自己的元素进行初始化。因此，必须令所有构造器都得到调用，否则就不可能正确构造完整对象。这正是编译器为什么要强制每个导出类部分都必须调用构造器的原因。</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
</pre><td class="rouge-code"><pre><span class="c1">//: polymorphism/Sandwich.java</span>
<span class="c1">// Order of constructor calls.</span>
<span class="kn">package</span> <span class="nn">polymorphism</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">net</span><span class="o">.</span><span class="na">mindview</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">Print</span><span class="o">.*;</span>

<span class="kd">class</span> <span class="nc">Meal</span> <span class="o">{</span>
  <span class="nc">Meal</span><span class="o">()</span> <span class="o">{</span> <span class="n">print</span><span class="o">(</span><span class="s">"Meal()"</span><span class="o">);</span> <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Bread</span> <span class="o">{</span>
  <span class="nc">Bread</span><span class="o">()</span> <span class="o">{</span> <span class="n">print</span><span class="o">(</span><span class="s">"Bread()"</span><span class="o">);</span> <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Cheese</span> <span class="o">{</span>
  <span class="nc">Cheese</span><span class="o">()</span> <span class="o">{</span> <span class="n">print</span><span class="o">(</span><span class="s">"Cheese()"</span><span class="o">);</span> <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Lettuce</span> <span class="o">{</span>
  <span class="nc">Lettuce</span><span class="o">()</span> <span class="o">{</span> <span class="n">print</span><span class="o">(</span><span class="s">"Lettuce()"</span><span class="o">);</span> <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Lunch</span> <span class="kd">extends</span> <span class="nc">Meal</span> <span class="o">{</span>
  <span class="nc">Lunch</span><span class="o">()</span> <span class="o">{</span> <span class="n">print</span><span class="o">(</span><span class="s">"Lunch()"</span><span class="o">);</span> <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">PortableLunch</span> <span class="kd">extends</span> <span class="nc">Lunch</span> <span class="o">{</span>
  <span class="nc">PortableLunch</span><span class="o">()</span> <span class="o">{</span> <span class="n">print</span><span class="o">(</span><span class="s">"PortableLunch()"</span><span class="o">);}</span>
<span class="o">}</span>
<span class="c1">//先调用静态方法main() 再初始化字段</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Sandwich</span> <span class="kd">extends</span> <span class="nc">PortableLunch</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="nc">Bread</span> <span class="n">b</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Bread</span><span class="o">();</span>
  <span class="kd">private</span> <span class="nc">Cheese</span> <span class="n">c</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Cheese</span><span class="o">();</span>
  <span class="kd">private</span> <span class="nc">Lettuce</span> <span class="n">l</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Lettuce</span><span class="o">();</span>
  <span class="kd">public</span> <span class="nf">Sandwich</span><span class="o">()</span> <span class="o">{</span> <span class="n">print</span><span class="o">(</span><span class="s">"Sandwich()"</span><span class="o">);</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">new</span> <span class="nf">Sandwich</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output:
Meal()
Lunch()
PortableLunch()
Bread()
Cheese()
Lettuce()
Sandwich()
*/</span><span class="c1">//:~</span>
</pre></table></code></div></div><h3 id="832-继承与清理">8.3.2 继承与清理</h3><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
</pre><td class="rouge-code"><pre><span class="c1">//: polymorphism/Frog.java</span>
<span class="c1">// Cleanup and inheritance.</span>
<span class="kn">package</span> <span class="nn">polymorphism</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">net</span><span class="o">.</span><span class="na">mindview</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">Print</span><span class="o">.*;</span>

<span class="kd">class</span> <span class="nc">Characteristic</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="nc">String</span> <span class="n">s</span><span class="o">;</span>
  <span class="nc">Characteristic</span><span class="o">(</span><span class="nc">String</span> <span class="n">s</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">;</span>
    <span class="n">print</span><span class="o">(</span><span class="s">"Creating Characteristic "</span> <span class="o">+</span> <span class="n">s</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">dispose</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">print</span><span class="o">(</span><span class="s">"disposing Characteristic "</span> <span class="o">+</span> <span class="n">s</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Description</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="nc">String</span> <span class="n">s</span><span class="o">;</span>
  <span class="nc">Description</span><span class="o">(</span><span class="nc">String</span> <span class="n">s</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">;</span>
    <span class="n">print</span><span class="o">(</span><span class="s">"Creating Description "</span> <span class="o">+</span> <span class="n">s</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">dispose</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">print</span><span class="o">(</span><span class="s">"disposing Description "</span> <span class="o">+</span> <span class="n">s</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">LivingCreature</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="nc">Characteristic</span> <span class="n">p</span> <span class="o">=</span>
    <span class="k">new</span> <span class="nf">Characteristic</span><span class="o">(</span><span class="s">"is alive"</span><span class="o">);</span> <span class="c1">//1 </span>
  <span class="kd">private</span> <span class="nc">Description</span> <span class="n">t</span> <span class="o">=</span>
    <span class="k">new</span> <span class="nf">Description</span><span class="o">(</span><span class="s">"Basic Living Creature"</span><span class="o">);</span> <span class="c1">//2</span>
  <span class="nc">LivingCreature</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">print</span><span class="o">(</span><span class="s">"LivingCreature()"</span><span class="o">);</span> <span class="c1">//3</span>
  <span class="o">}</span>
  <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">dispose</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">print</span><span class="o">(</span><span class="s">"LivingCreature dispose"</span><span class="o">);</span>
    <span class="n">t</span><span class="o">.</span><span class="na">dispose</span><span class="o">();</span>
    <span class="n">p</span><span class="o">.</span><span class="na">dispose</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Animal</span> <span class="kd">extends</span> <span class="nc">LivingCreature</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="nc">Characteristic</span> <span class="n">p</span> <span class="o">=</span>
    <span class="k">new</span> <span class="nf">Characteristic</span><span class="o">(</span><span class="s">"has heart"</span><span class="o">);</span> <span class="c1">//4</span>
  <span class="kd">private</span> <span class="nc">Description</span> <span class="n">t</span> <span class="o">=</span>
    <span class="k">new</span> <span class="nf">Description</span><span class="o">(</span><span class="s">"Animal not Vegetable"</span><span class="o">);</span> <span class="c1">//5</span>
  <span class="nc">Animal</span><span class="o">()</span> <span class="o">{</span> <span class="n">print</span><span class="o">(</span><span class="s">"Animal()"</span><span class="o">);</span> <span class="o">}</span> <span class="c1">//6 </span>
  <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">dispose</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">print</span><span class="o">(</span><span class="s">"Animal dispose"</span><span class="o">);</span>
    <span class="n">t</span><span class="o">.</span><span class="na">dispose</span><span class="o">();</span>
    <span class="n">p</span><span class="o">.</span><span class="na">dispose</span><span class="o">();</span>
    <span class="kd">super</span><span class="o">.</span><span class="na">dispose</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Amphibian</span> <span class="kd">extends</span> <span class="nc">Animal</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="nc">Characteristic</span> <span class="n">p</span> <span class="o">=</span>
    <span class="k">new</span> <span class="nf">Characteristic</span><span class="o">(</span><span class="s">"can live in water"</span><span class="o">);</span> <span class="c1">// 7</span>
  <span class="kd">private</span> <span class="nc">Description</span> <span class="n">t</span> <span class="o">=</span>
    <span class="k">new</span> <span class="nf">Description</span><span class="o">(</span><span class="s">"Both water and land"</span><span class="o">);</span> <span class="c1">// 8</span>
  <span class="nc">Amphibian</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">print</span><span class="o">(</span><span class="s">"Amphibian()"</span><span class="o">);</span> <span class="c1">//9</span>
  <span class="o">}</span>
  <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">dispose</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">print</span><span class="o">(</span><span class="s">"Amphibian dispose"</span><span class="o">);</span>
    <span class="n">t</span><span class="o">.</span><span class="na">dispose</span><span class="o">();</span>
    <span class="n">p</span><span class="o">.</span><span class="na">dispose</span><span class="o">();</span>
    <span class="kd">super</span><span class="o">.</span><span class="na">dispose</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Frog</span> <span class="kd">extends</span> <span class="nc">Amphibian</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="nc">Characteristic</span> <span class="n">p</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Characteristic</span><span class="o">(</span><span class="s">"Croaks"</span><span class="o">);</span> <span class="c1">//10</span>
  <span class="kd">private</span> <span class="nc">Description</span> <span class="n">t</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Description</span><span class="o">(</span><span class="s">"Eats Bugs"</span><span class="o">);</span> <span class="c1">// 11</span>
  <span class="kd">public</span> <span class="nf">Frog</span><span class="o">()</span> <span class="o">{</span> <span class="n">print</span><span class="o">(</span><span class="s">"Frog()"</span><span class="o">);</span> <span class="o">}</span> <span class="c1">//12</span>
  <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">dispose</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">print</span><span class="o">(</span><span class="s">"Frog dispose"</span><span class="o">);</span> <span class="c1">//14</span>
    <span class="n">t</span><span class="o">.</span><span class="na">dispose</span><span class="o">();</span> <span class="c1">//15</span>
    <span class="n">p</span><span class="o">.</span><span class="na">dispose</span><span class="o">();</span> <span class="c1">//16</span>
    <span class="kd">super</span><span class="o">.</span><span class="na">dispose</span><span class="o">();</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Frog</span> <span class="n">frog</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Frog</span><span class="o">();</span>
    <span class="n">print</span><span class="o">(</span><span class="s">"Bye!"</span><span class="o">);</span> <span class="c1">//13</span>
    <span class="n">frog</span><span class="o">.</span><span class="na">dispose</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output:
Creating Characteristic is alive
Creating Description Basic Living Creature
LivingCreature()
Creating Characteristic has heart
Creating Description Animal not Vegetable
Animal()
Creating Characteristic can live in water
Creating Description Both water and land
Amphibian()
Creating Characteristic Croaks
Creating Description Eats Bugs
Frog()
Bye!
Frog dispose
disposing Description Eats Bugs
disposing Characteristic Croaks
Amphibian dispose
disposing Description Both water and land
disposing Characteristic can live in water
Animal dispose
disposing Description Animal not Vegetable
disposing Characteristic has heart
LivingCreature dispose
disposing Description Basic Living Creature
disposing Characteristic is alive
*/</span><span class="c1">//:~</span>
</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
</pre><td class="rouge-code"><pre><span class="c1">//: polymorphism/ReferenceCounting.java</span>
<span class="c1">// Cleaning up shared member objects.</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">net</span><span class="o">.</span><span class="na">mindview</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">Print</span><span class="o">.*;</span>

<span class="kd">class</span> <span class="nc">Shared</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">refcount</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="kt">long</span> <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">id</span> <span class="o">=</span> <span class="n">counter</span><span class="o">++;</span>
  <span class="kd">public</span> <span class="nf">Shared</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">print</span><span class="o">(</span><span class="s">"Creating "</span> <span class="o">+</span> <span class="k">this</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addRef</span><span class="o">()</span> <span class="o">{</span> <span class="n">refcount</span><span class="o">++;</span> <span class="o">}</span>
  <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">dispose</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">if</span><span class="o">(--</span><span class="n">refcount</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span>
      <span class="n">print</span><span class="o">(</span><span class="s">"Disposing "</span> <span class="o">+</span> <span class="k">this</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="nc">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="s">"Shared "</span> <span class="o">+</span> <span class="n">id</span><span class="o">;</span> <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Composing</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="nc">Shared</span> <span class="n">shared</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="kt">long</span> <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">id</span> <span class="o">=</span> <span class="n">counter</span><span class="o">++;</span>
  <span class="kd">public</span> <span class="nf">Composing</span><span class="o">(</span><span class="nc">Shared</span> <span class="n">shared</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">print</span><span class="o">(</span><span class="s">"Creating "</span> <span class="o">+</span> <span class="k">this</span><span class="o">);</span>
    <span class="k">this</span><span class="o">.</span><span class="na">shared</span> <span class="o">=</span> <span class="n">shared</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">shared</span><span class="o">.</span><span class="na">addRef</span><span class="o">();</span>
  <span class="o">}</span>
  <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">dispose</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">print</span><span class="o">(</span><span class="s">"disposing "</span> <span class="o">+</span> <span class="k">this</span><span class="o">);</span>
    <span class="n">shared</span><span class="o">.</span><span class="na">dispose</span><span class="o">();</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="nc">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="s">"Composing "</span> <span class="o">+</span> <span class="n">id</span><span class="o">;</span> <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ReferenceCounting</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Shared</span> <span class="n">shared</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Shared</span><span class="o">();</span>
    <span class="nc">Composing</span><span class="o">[]</span> <span class="n">composing</span> <span class="o">=</span> <span class="o">{</span> <span class="k">new</span> <span class="nc">Composing</span><span class="o">(</span><span class="n">shared</span><span class="o">),</span>
      <span class="k">new</span> <span class="nf">Composing</span><span class="o">(</span><span class="n">shared</span><span class="o">),</span> <span class="k">new</span> <span class="nc">Composing</span><span class="o">(</span><span class="n">shared</span><span class="o">),</span>
      <span class="k">new</span> <span class="nf">Composing</span><span class="o">(</span><span class="n">shared</span><span class="o">),</span> <span class="k">new</span> <span class="nc">Composing</span><span class="o">(</span><span class="n">shared</span><span class="o">)</span> <span class="o">};</span>
    <span class="k">for</span><span class="o">(</span><span class="nc">Composing</span> <span class="n">c</span> <span class="o">:</span> <span class="n">composing</span><span class="o">)</span>
      <span class="n">c</span><span class="o">.</span><span class="na">dispose</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output:
Creating Shared 0
Creating Composing 0
Creating Composing 1
Creating Composing 2
Creating Composing 3
Creating Composing 4
disposing Composing 0
disposing Composing 1
disposing Composing 2
disposing Composing 3
disposing Composing 4
Disposing Shared 0
*/</span><span class="c1">//:~</span>
</pre></table></code></div></div><h3 id="833-构造器内部的多态方法的行为">8.3.3 构造器内部的多态方法的行为</h3><p>如果要调用构造器内部的一个动态绑定方法，就要用到那个方法的被覆盖后的定义。然而，这个调用的效果可能相当难以预料，因为被覆盖的方法在对象完全构造之前就会被调用。这可能会造成一些难于发现的隐藏错误。</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre><td class="rouge-code"><pre><span class="c1">//: polymorphism/PolyConstructors.java</span>
<span class="c1">// Constructors and polymorphism</span>
<span class="c1">// don't produce what you might expect.</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">net</span><span class="o">.</span><span class="na">mindview</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">Print</span><span class="o">.*;</span>

<span class="kd">class</span> <span class="nc">Glyph</span> <span class="o">{</span>
  <span class="kt">void</span> <span class="nf">draw</span><span class="o">()</span> <span class="o">{</span> <span class="n">print</span><span class="o">(</span><span class="s">"Glyph.draw()"</span><span class="o">);</span> <span class="o">}</span>
  <span class="nc">Glyph</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">print</span><span class="o">(</span><span class="s">"Glyph() before draw()"</span><span class="o">);</span>
    <span class="n">draw</span><span class="o">();</span> <span class="c1">//？？为什么调用子类的方法</span>
    <span class="n">print</span><span class="o">(</span><span class="s">"Glyph() after draw()"</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>    

<span class="kd">class</span> <span class="nc">RoundGlyph</span> <span class="kd">extends</span> <span class="nc">Glyph</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">radius</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
  <span class="nc">RoundGlyph</span><span class="o">(</span><span class="kt">int</span> <span class="n">r</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">radius</span> <span class="o">=</span> <span class="n">r</span><span class="o">;</span>
    <span class="n">print</span><span class="o">(</span><span class="s">"RoundGlyph.RoundGlyph(), radius = "</span> <span class="o">+</span> <span class="n">radius</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kt">void</span> <span class="nf">draw</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">print</span><span class="o">(</span><span class="s">"RoundGlyph.draw(), radius = "</span> <span class="o">+</span> <span class="n">radius</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>    

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PolyConstructors</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">new</span> <span class="nf">RoundGlyph</span><span class="o">(</span><span class="mi">5</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output:
Glyph() before draw()
RoundGlyph.draw(), radius = 0
Glyph() after draw()
RoundGlyph.RoundGlyph(), radius = 5
*/</span><span class="c1">//:~</span>
</pre></table></code></div></div><p>很早之前看了篇文章<a href="https://coolshell.cn/articles/1106.html#comment-345">JAVA构造时成员初始化的陷阱</a>觉得很神奇，重读《Java编程思想》才发现，书中早有讲解。</p><h2 id="84-协变返回类型">8.4 协变返回类型</h2><p><code class="language-plaintext highlighter-rouge">Java SE5</code>添加了协变返回类型，它表示在导出类中的被覆盖方法可以返回基类方法的返回类型的某种导出类型：</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre><td class="rouge-code"><pre><span class="c1">//: polymorphism/CovariantReturn.java</span>

<span class="kd">class</span> <span class="nc">Grain</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="nc">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="s">"Grain"</span><span class="o">;</span> <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Wheat</span> <span class="kd">extends</span> <span class="nc">Grain</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="nc">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="s">"Wheat"</span><span class="o">;</span> <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Mill</span> <span class="o">{</span>
  <span class="nc">Grain</span> <span class="nf">process</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="k">new</span> <span class="nc">Grain</span><span class="o">();</span> <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">WheatMill</span> <span class="kd">extends</span> <span class="nc">Mill</span> <span class="o">{</span>
  <span class="nc">Wheat</span> <span class="nf">process</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="k">new</span> <span class="nc">Wheat</span><span class="o">();</span> <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CovariantReturn</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Mill</span> <span class="n">m</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Mill</span><span class="o">();</span>
    <span class="nc">Grain</span> <span class="n">g</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="na">process</span><span class="o">();</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">g</span><span class="o">);</span>
    <span class="n">m</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">WheatMill</span><span class="o">();</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="na">process</span><span class="o">();</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">g</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output:
Grain
Wheat
*/</span><span class="c1">//:~</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">Java SE5</code>与<code class="language-plaintext highlighter-rouge">Java</code>较早版本之间的主要差异就是焦躁的版本将强制<code class="language-plaintext highlighter-rouge">process()</code>的覆盖版本必须返回<code class="language-plaintext highlighter-rouge">Grain</code>，而不能返回<code class="language-plaintext highlighter-rouge">Wheat</code>，尽管<code class="language-plaintext highlighter-rouge">Wheat</code>是从<code class="language-plaintext highlighter-rouge">Grain</code>导出的，因而也应该是一种合法的返回类型。协变返回类型允许返回更具体的<code class="language-plaintext highlighter-rouge">Wheat</code>类型。</p><h2 id="85-用继承进行设计">8.5 用继承进行设计</h2><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre><td class="rouge-code"><pre><span class="c1">//: polymorphism/Transmogrify.java</span>
<span class="c1">// Dynamically changing the behavior of an object</span>
<span class="c1">// via composition (the "State" design pattern).</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">net</span><span class="o">.</span><span class="na">mindview</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">Print</span><span class="o">.*;</span>

<span class="kd">class</span> <span class="nc">Actor</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">act</span><span class="o">()</span> <span class="o">{}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">HappyActor</span> <span class="kd">extends</span> <span class="nc">Actor</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">act</span><span class="o">()</span> <span class="o">{</span> <span class="n">print</span><span class="o">(</span><span class="s">"HappyActor"</span><span class="o">);</span> <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">SadActor</span> <span class="kd">extends</span> <span class="nc">Actor</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">act</span><span class="o">()</span> <span class="o">{</span> <span class="n">print</span><span class="o">(</span><span class="s">"SadActor"</span><span class="o">);</span> <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Stage</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="nc">Actor</span> <span class="n">actor</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HappyActor</span><span class="o">();</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">change</span><span class="o">()</span> <span class="o">{</span> <span class="n">actor</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SadActor</span><span class="o">();</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">performPlay</span><span class="o">()</span> <span class="o">{</span> <span class="n">actor</span><span class="o">.</span><span class="na">act</span><span class="o">();</span> <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Transmogrify</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Stage</span> <span class="n">stage</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Stage</span><span class="o">();</span>
    <span class="n">stage</span><span class="o">.</span><span class="na">performPlay</span><span class="o">();</span>
    <span class="n">stage</span><span class="o">.</span><span class="na">change</span><span class="o">();</span>
    <span class="n">stage</span><span class="o">.</span><span class="na">performPlay</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output:
HappyActor
SadActor
*/</span><span class="c1">//:~</span>
</pre></table></code></div></div><h2 id="扩展阅读">扩展阅读</h2><h4 id="老人的讨论帖你知道为什么嘛"><a href="https://bbs.csdn.net/topics/310238132">[老人的讨论帖]你知道为什么嘛？</a></h4><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="c1">//属性不存在动态绑定</span>
<span class="kd">class</span> <span class="nc">A</span> <span class="o">{</span>
   <span class="kd">public</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">10</span><span class="o">;</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">B</span> <span class="kd">extends</span> <span class="no">A</span><span class="o">{</span>
   <span class="kd">public</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">20</span><span class="o">;</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestPolm1</span><span class="o">{</span>
   <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span> <span class="n">args</span><span class="o">[]){</span>
      <span class="no">B</span> <span class="n">b</span> <span class="o">=</span> <span class="k">new</span> <span class="no">B</span><span class="o">();</span>
      <span class="no">A</span> <span class="n">a</span> <span class="o">=</span> <span class="n">b</span><span class="o">;</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">b</span><span class="o">.</span><span class="na">i</span><span class="o">);</span> <span class="c1">//20 </span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">a</span><span class="o">.</span><span class="na">i</span><span class="o">);</span> <span class="c1">//10</span>
   <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="nc">A</span> <span class="o">{</span>
   <span class="kd">private</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">10</span><span class="o">;</span>

   <span class="kd">public</span> <span class="kt">void</span> <span class="nf">printI</span><span class="o">(){</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
   <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">B</span> <span class="kd">extends</span> <span class="no">A</span><span class="o">{</span>
   <span class="kd">private</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">20</span><span class="o">;</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestPolm2</span><span class="o">{</span>
   <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span> <span class="n">args</span><span class="o">[]){</span>
      <span class="no">B</span> <span class="n">b</span> <span class="o">=</span> <span class="k">new</span> <span class="no">B</span><span class="o">();</span>
      <span class="no">A</span> <span class="n">a</span> <span class="o">=</span> <span class="n">b</span><span class="o">;</span>
      <span class="c1">//都是调用的B的printI方法</span>
      <span class="n">b</span><span class="o">.</span><span class="na">printI</span><span class="o">();</span><span class="c1">//20</span>
      <span class="n">a</span><span class="o">.</span><span class="na">printI</span><span class="o">();</span><span class="c1">//20</span>
   <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="nc">A</span> <span class="o">{</span>
   <span class="kd">private</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">10</span><span class="o">;</span>

   <span class="kd">public</span> <span class="kt">void</span> <span class="nf">printI</span><span class="o">(){</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
   <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">B</span> <span class="kd">extends</span> <span class="no">A</span><span class="o">{</span>
   <span class="kd">private</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">20</span><span class="o">;</span>

   <span class="kd">public</span> <span class="kt">void</span> <span class="nf">printI</span><span class="o">(){</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
   <span class="o">}</span>
<span class="o">}</span>
<span class="c1">//这个其实和上个例子一样，都是访问的B的方法</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestPolm3</span><span class="o">{</span>
   <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span> <span class="n">args</span><span class="o">[]){</span>
      <span class="no">B</span> <span class="n">b</span> <span class="o">=</span> <span class="k">new</span> <span class="no">B</span><span class="o">();</span>
      <span class="no">A</span> <span class="n">a</span> <span class="o">=</span> <span class="n">b</span><span class="o">;</span>
      <span class="n">b</span><span class="o">.</span><span class="na">printI</span><span class="o">();</span> <span class="c1">//20</span>
      <span class="n">a</span><span class="o">.</span><span class="na">printI</span><span class="o">();</span> <span class="c1">//20 </span>
   <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div></div><div class="post-tail-wrapper text-muted"><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/thinking-in-java/" class="post-tag no-text-decoration" >Thinking in Java</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=《Java编程思想》第8章多态 - malinkang&url=https://malinkang.cn/posts/thinking-in-java-polymorphism/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=《Java编程思想》第8章多态 - malinkang&u=https://malinkang.cn/posts/thinking-in-java-polymorphism/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=《Java编程思想》第8章多态 - malinkang&url=https://malinkang.cn/posts/thinking-in-java-polymorphism/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/dagger-guide/">Dagger使用指南</a><li><a href="/posts/understanding-the-jvm-runtime-data-areas/">《深入理解JVM》第2章Java内存区域与内存溢出异常</a><li><a href="/posts/understanding-the-jvm-garbage-collection/">《深入理解JVM》第3章垃圾收集器</a><li><a href="/posts/understanding-the-jvm-class-file-structure/">《深入理解JVM》第6章类文件结构</a><li><a href="/posts/understanding-the-jvm-class-loader/">《深入理解JVM》第7章虚拟机类加载机制</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/">源码分析</a> <a class="post-tag" href="/tags/thinking-in-java/">Thinking in Java</a> <a class="post-tag" href="/tags/android/">Android</a> <a class="post-tag" href="/tags/effective-java/">Effective Java</a> <a class="post-tag" href="/tags/kotlin/">Kotlin</a> <a class="post-tag" href="/tags/java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98/">Java并发编程实战</a> <a class="post-tag" href="/tags/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3jvm/">深入理解JVM</a> <a class="post-tag" href="/tags/android/">android</a> <a class="post-tag" href="/tags/databinding/">databinding</a> <a class="post-tag" href="/tags/recyclerview/">RecyclerView</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/thinking-in-java-everything-is-an-object/"><div class="card-body"> <span class="timeago small" > Mar 20, 2013 <i class="unloaded">2013-03-20T00:26:34+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>《Java编程思想》第2章一切都是对象</h3><div class="text-muted small"><p> 2.2 必须由你创建所有对象 2.2.1 存储到什么地方 2.2.2 特例：基本类型 在程序设计中经常用到一系列类型，它们需要特殊对待。可以把它们想象成“基本”类型。之所以特殊对待，是因为new将对象存储在“堆”里，故用new创建一个对象，特别是小的、简单的变量，往往不是很有效。因此，对于这些类型，Java采取与C和C++相同的方法。也就是说，不用new来创建变量，而是创建一个并非是引...</p></div></div></a></div><div class="card"> <a href="/posts/thinking-in-java-operators/"><div class="card-body"> <span class="timeago small" > Mar 26, 2013 <i class="unloaded">2013-03-26T21:39:36+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>《Java编程思想》第3章操作符</h3><div class="text-muted small"><p></p></div></div></a></div><div class="card"> <a href="/posts/thinking-in-java-controlling-execution/"><div class="card-body"> <span class="timeago small" > Apr 2, 2013 <i class="unloaded">2013-04-02T21:39:36+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>《Java编程思想》第4章控制流程</h3><div class="text-muted small"><p></p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/thinking-in-java-reusing-classes/" class="btn btn-outline-primary" prompt="Older"><p>《Java编程思想》第7章复用类</p></a> <a href="/posts/thinking-in-java-interfaces/" class="btn btn-outline-primary" prompt="Newer"><p>《Java编程思想》第9章接口</p></a></div><div id="disqus" class="pt-2 pb-2"><p class="text-center text-muted small pb-5"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script src="/assets/js/lib/jquery.disqusloader.min.js"></script> <script> const options = { scriptUrl: '//malinkang-cn.disqus.com/embed.js', disqusConfig: function() { this.page.title = '《Java编程思想》第8章多态'; this.page.url = 'https://malinkang.cn/posts/thinking-in-java-polymorphism/'; this.page.identifier = '/posts/thinking-in-java-polymorphism/'; } }; $.disqusLoader('#disqus', options); </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://twitter.com/malinkang">malinkang</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/">源码分析</a> <a class="post-tag" href="/tags/thinking-in-java/">Thinking in Java</a> <a class="post-tag" href="/tags/android/">Android</a> <a class="post-tag" href="/tags/effective-java/">Effective Java</a> <a class="post-tag" href="/tags/kotlin/">Kotlin</a> <a class="post-tag" href="/tags/java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98/">Java并发编程实战</a> <a class="post-tag" href="/tags/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3jvm/">深入理解JVM</a> <a class="post-tag" href="/tags/android/">android</a> <a class="post-tag" href="/tags/databinding/">databinding</a> <a class="post-tag" href="/tags/recyclerview/">RecyclerView</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://malinkang.cn{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>

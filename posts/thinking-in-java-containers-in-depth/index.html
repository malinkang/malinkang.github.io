<!DOCTYPE html><html lang="zh-CN" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="《Java编程思想》第17章容器深入研究" /><meta property="og:locale" content="zh_CN" /><meta name="description" content="填充容器" /><meta property="og:description" content="填充容器" /><link rel="canonical" href="https://malinkang.cn/posts/thinking-in-java-containers-in-depth/" /><meta property="og:url" content="https://malinkang.cn/posts/thinking-in-java-containers-in-depth/" /><meta property="og:site_name" content="malinkang" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2013-07-02T21:39:36+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="《Java编程思想》第17章容器深入研究" /><meta name="twitter:site" content="@malinkang" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"description":"填充容器","headline":"《Java编程思想》第17章容器深入研究","dateModified":"2021-07-07T14:54:59+08:00","url":"https://malinkang.cn/posts/thinking-in-java-containers-in-depth/","datePublished":"2013-07-02T21:39:36+08:00","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://malinkang.cn/posts/thinking-in-java-containers-in-depth/"},"@context":"https://schema.org"}</script><title>《Java编程思想》第17章容器深入研究 | malinkang</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="malinkang"><meta name="application-name" content="malinkang"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://malinkang-1253444926.cos.ap-beijing.myqcloud.com/images/avatar.jpeg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">malinkang</a></div><div class="site-subtitle font-italic">人生最可悲的事情，莫过于胸怀大志，却又虚度光阴。</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>分类</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>标签</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>归档</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>关于</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/malinkang" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/malinkang" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['linkang.ma','gmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>《Java编程思想》第17章容器深入研究</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>《Java编程思想》第17章容器深入研究</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> malinkang </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Tue, Jul 2, 2013, 9:39 PM +0800" prep="on" > Jul 2, 2013 <i class="unloaded">2013-07-02T21:39:36+08:00</i> </span></div><div> <span> <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Wed, Jul 7, 2021, 2:54 PM +0800" prefix="Updated " > Jul 7 <i class="unloaded">2021-07-07T14:54:59+08:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="8908 words">49 min</span></div></div><div class="post-content"><h2 id="填充容器">填充容器</h2><p>与<code class="language-plaintext highlighter-rouge">Arrays</code>版本一样，此<code class="language-plaintext highlighter-rouge">fill()</code>方法也是只复制同一个对象引用来填充整个容器的，并且只对<code class="language-plaintext highlighter-rouge">List</code>对象有用，但是所产生的列表可以传递给构造器或<code class="language-plaintext highlighter-rouge">addAll()</code>方法：</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre><td class="rouge-code"><pre><span class="c1">//: containers/FillingLists.java</span>
<span class="c1">// The Collections.fill() &amp; Collections.nCopies() methods.</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">class</span> <span class="nc">StringAddress</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="nc">String</span> <span class="n">s</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">StringAddress</span><span class="o">(</span><span class="nc">String</span> <span class="n">s</span><span class="o">)</span> <span class="o">{</span> <span class="k">this</span><span class="o">.</span><span class="na">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">;</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="nc">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="kd">super</span><span class="o">.</span><span class="na">toString</span><span class="o">()</span> <span class="o">+</span> <span class="s">" "</span> <span class="o">+</span> <span class="n">s</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FillingLists</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">List</span><span class="o">&lt;</span><span class="nc">StringAddress</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">StringAddress</span><span class="o">&gt;(</span>
      <span class="nc">Collections</span><span class="o">.</span><span class="na">nCopies</span><span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="k">new</span> <span class="nc">StringAddress</span><span class="o">(</span><span class="s">"Hello"</span><span class="o">)));</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">list</span><span class="o">);</span>
    <span class="nc">Collections</span><span class="o">.</span><span class="na">fill</span><span class="o">(</span><span class="n">list</span><span class="o">,</span> <span class="k">new</span> <span class="nc">StringAddress</span><span class="o">(</span><span class="s">"World!"</span><span class="o">));</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">list</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output: (Sample)
[StringAddress@82ba41 Hello, StringAddress@82ba41 Hello, StringAddress@82ba41 Hello, StringAddress@82ba41 Hello]
[StringAddress@923e30 World!, StringAddress@923e30 World!, StringAddress@923e30 World!, StringAddress@923e30 World!]
*/</span><span class="c1">//:~</span>
</pre></table></code></div></div><p>这个示例展示了两种用对单个对象的引用来填充<code class="language-plaintext highlighter-rouge">Collection</code>的方式，第一种是使用<code class="language-plaintext highlighter-rouge">Collection.nCopies()</code>创建传递给构造器的<code class="language-plaintext highlighter-rouge">List</code>，这里填充的是<code class="language-plaintext highlighter-rouge">ArrayList</code>。第二种使用的<code class="language-plaintext highlighter-rouge">fill()</code>方法的用处更有限，因为它只能替换已经在<code class="language-plaintext highlighter-rouge">List</code>中存在的元素，而不能添加新的元素。</p><h3 id="一种generator解决方案">一种Generator解决方案</h3><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="c1">//: net/mindview/util/CollectionData.java</span>
<span class="c1">// A Collection filled with data using a generator object.</span>
<span class="kn">package</span> <span class="nn">net.mindview.util</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CollectionData</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="nf">CollectionData</span><span class="o">(</span><span class="nc">Generator</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">gen</span><span class="o">,</span> <span class="kt">int</span> <span class="n">quantity</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">quantity</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span>
      <span class="n">add</span><span class="o">(</span><span class="n">gen</span><span class="o">.</span><span class="na">next</span><span class="o">());</span>
  <span class="o">}</span>
  <span class="c1">// A generic convenience method:</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="nc">CollectionData</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="nf">list</span><span class="o">(</span><span class="nc">Generator</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">gen</span><span class="o">,</span> <span class="kt">int</span> <span class="n">quantity</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nc">CollectionData</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;(</span><span class="n">gen</span><span class="o">,</span> <span class="n">quantity</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~</span>
</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre><span class="c1">//: containers/CollectionDataTest.java</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">net.mindview.util.*</span><span class="o">;</span>

<span class="kd">class</span> <span class="nc">Government</span> <span class="kd">implements</span> <span class="nc">Generator</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="nc">String</span><span class="o">[]</span> <span class="n">foundation</span> <span class="o">=</span> <span class="o">(</span><span class="s">"strange women lying in ponds "</span> <span class="o">+</span>
    <span class="s">"distributing swords is no basis for a system of "</span> <span class="o">+</span>
    <span class="s">"government"</span><span class="o">).</span><span class="na">split</span><span class="o">(</span><span class="s">" "</span><span class="o">);</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">index</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nc">String</span> <span class="nf">next</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">foundation</span><span class="o">[</span><span class="n">index</span><span class="o">++];</span> <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CollectionDataTest</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">set</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">LinkedHashSet</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;(</span>
      <span class="k">new</span> <span class="nc">CollectionData</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;(</span><span class="k">new</span> <span class="nc">Government</span><span class="o">(),</span> <span class="mi">15</span><span class="o">));</span>
    <span class="c1">// Using the convenience method:</span>
    <span class="n">set</span><span class="o">.</span><span class="na">addAll</span><span class="o">(</span><span class="nc">CollectionData</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="k">new</span> <span class="nc">Government</span><span class="o">(),</span> <span class="mi">15</span><span class="o">));</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">set</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output:
[strange, women, lying, in, ponds, distributing, swords, is, no, basis, for, a, system, of, government]
*/</span><span class="c1">//:~</span>
</pre></table></code></div></div><p>这些元素的顺序与它们的插入顺序相同，因为<code class="language-plaintext highlighter-rouge">LinkedHashSet</code>维护的是保持了插入顺序的链接列表。</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre><span class="c1">//: containers/CollectionDataTest.java</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">net.mindview.util.*</span><span class="o">;</span>

<span class="kd">class</span> <span class="nc">Government</span> <span class="kd">implements</span> <span class="nc">Generator</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="nc">String</span><span class="o">[]</span> <span class="n">foundation</span> <span class="o">=</span> <span class="o">(</span><span class="s">"strange women lying in ponds "</span> <span class="o">+</span>
    <span class="s">"distributing swords is no basis for a system of "</span> <span class="o">+</span>
    <span class="s">"government"</span><span class="o">).</span><span class="na">split</span><span class="o">(</span><span class="s">" "</span><span class="o">);</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">index</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nc">String</span> <span class="nf">next</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">foundation</span><span class="o">[</span><span class="n">index</span><span class="o">++];</span> <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CollectionDataTest</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">set</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">LinkedHashSet</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;(</span>
      <span class="k">new</span> <span class="nc">CollectionData</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;(</span><span class="k">new</span> <span class="nc">Government</span><span class="o">(),</span> <span class="mi">15</span><span class="o">));</span>
    <span class="c1">// Using the convenience method:</span>
    <span class="n">set</span><span class="o">.</span><span class="na">addAll</span><span class="o">(</span><span class="nc">CollectionData</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="k">new</span> <span class="nc">Government</span><span class="o">(),</span> <span class="mi">15</span><span class="o">));</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">set</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output:
[strange, women, lying, in, ponds, distributing, swords, is, no, basis, for, a, system, of, government]
*/</span><span class="c1">//:~</span>
</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="c1">//: containers/CollectionDataGeneration.java</span>
<span class="c1">// Using the Generators defined in the Arrays chapter.</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">net.mindview.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CollectionDataGeneration</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;(</span>
      <span class="nc">CollectionData</span><span class="o">.</span><span class="na">list</span><span class="o">(</span> <span class="c1">// Convenience method</span>
        <span class="k">new</span> <span class="nc">RandomGenerator</span><span class="o">.</span><span class="na">String</span><span class="o">(</span><span class="mi">9</span><span class="o">),</span> <span class="mi">10</span><span class="o">)));</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="k">new</span> <span class="nc">HashSet</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;(</span>
      <span class="k">new</span> <span class="nc">CollectionData</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;(</span>
        <span class="k">new</span> <span class="nc">RandomGenerator</span><span class="o">.</span><span class="na">Integer</span><span class="o">(),</span> <span class="mi">10</span><span class="o">)));</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output:
[YNzbrnyGc, FOWZnTcQr, GseGZMmJM, RoEsuEcUO, neOEdLsmw, HLGEahKcx, rEqUCBbkI, naMesbtWH, kjUrUkZPg, wsqPzDyCy]
[573, 4779, 871, 4367, 6090, 7882, 2017, 8037, 3455, 299]
*/</span><span class="c1">//:~</span>
</pre></table></code></div></div><h3 id="map生成器">Map生成器</h3><p>定义第一个<code class="language-plaintext highlighter-rouge">Pair</code>类。</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="c1">//: net/mindview/util/Pair.java</span>
<span class="kn">package</span> <span class="nn">net.mindview.util</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Pair</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">final</span> <span class="no">K</span> <span class="n">key</span><span class="o">;</span>
  <span class="kd">public</span> <span class="kd">final</span> <span class="no">V</span> <span class="n">value</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">Pair</span><span class="o">(</span><span class="no">K</span> <span class="n">k</span><span class="o">,</span> <span class="no">V</span> <span class="n">v</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">key</span> <span class="o">=</span> <span class="n">k</span><span class="o">;</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">v</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~</span>
</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
</pre><td class="rouge-code"><pre><span class="c1">//: net/mindview/util/MapData.java</span>
<span class="c1">// A Map filled with data using a generator object.</span>
<span class="kn">package</span> <span class="nn">net.mindview.util</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MapData</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="nc">LinkedHashMap</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="c1">// A single Pair Generator:</span>
  <span class="kd">public</span> <span class="nf">MapData</span><span class="o">(</span><span class="nc">Generator</span><span class="o">&lt;</span><span class="nc">Pair</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;&gt;</span> <span class="n">gen</span><span class="o">,</span> <span class="kt">int</span> <span class="n">quantity</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">quantity</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
      <span class="nc">Pair</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;</span> <span class="n">p</span> <span class="o">=</span> <span class="n">gen</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
      <span class="n">put</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">key</span><span class="o">,</span> <span class="n">p</span><span class="o">.</span><span class="na">value</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
  <span class="c1">// Two separate Generators:</span>
  <span class="kd">public</span> <span class="nf">MapData</span><span class="o">(</span><span class="nc">Generator</span><span class="o">&lt;</span><span class="no">K</span><span class="o">&gt;</span> <span class="n">genK</span><span class="o">,</span> <span class="nc">Generator</span><span class="o">&lt;</span><span class="no">V</span><span class="o">&gt;</span> <span class="n">genV</span><span class="o">,</span><span class="kt">int</span> <span class="n">quantity</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">quantity</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
      <span class="n">put</span><span class="o">(</span><span class="n">genK</span><span class="o">.</span><span class="na">next</span><span class="o">(),</span> <span class="n">genV</span><span class="o">.</span><span class="na">next</span><span class="o">());</span>
    <span class="o">}</span>
  <span class="o">}</span>
  <span class="c1">// A key Generator and a single value:</span>
  <span class="kd">public</span> <span class="nf">MapData</span><span class="o">(</span><span class="nc">Generator</span><span class="o">&lt;</span><span class="no">K</span><span class="o">&gt;</span> <span class="n">genK</span><span class="o">,</span> <span class="no">V</span> <span class="n">value</span><span class="o">,</span> <span class="kt">int</span> <span class="n">quantity</span><span class="o">){</span>
    <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">quantity</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
      <span class="n">put</span><span class="o">(</span><span class="n">genK</span><span class="o">.</span><span class="na">next</span><span class="o">(),</span> <span class="n">value</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
  <span class="c1">// An Iterable and a value Generator:</span>
  <span class="kd">public</span> <span class="nf">MapData</span><span class="o">(</span><span class="nc">Iterable</span><span class="o">&lt;</span><span class="no">K</span><span class="o">&gt;</span> <span class="n">genK</span><span class="o">,</span> <span class="nc">Generator</span><span class="o">&lt;</span><span class="no">V</span><span class="o">&gt;</span> <span class="n">genV</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">for</span><span class="o">(</span><span class="no">K</span> <span class="n">key</span> <span class="o">:</span> <span class="n">genK</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">put</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">genV</span><span class="o">.</span><span class="na">next</span><span class="o">());</span>
    <span class="o">}</span>
  <span class="o">}</span>
  <span class="c1">// An Iterable and a single value:</span>
  <span class="kd">public</span> <span class="nf">MapData</span><span class="o">(</span><span class="nc">Iterable</span><span class="o">&lt;</span><span class="no">K</span><span class="o">&gt;</span> <span class="n">genK</span><span class="o">,</span> <span class="no">V</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">for</span><span class="o">(</span><span class="no">K</span> <span class="n">key</span> <span class="o">:</span> <span class="n">genK</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">put</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">value</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
  <span class="c1">// Generic convenience methods:</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;</span> <span class="nc">MapData</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;</span> <span class="nf">map</span><span class="o">(</span><span class="nc">Generator</span><span class="o">&lt;</span><span class="nc">Pair</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;&gt;</span> <span class="n">gen</span><span class="o">,</span> <span class="kt">int</span> <span class="n">quantity</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nc">MapData</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;(</span><span class="n">gen</span><span class="o">,</span> <span class="n">quantity</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;</span> <span class="nc">MapData</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;</span> <span class="nf">map</span><span class="o">(</span><span class="nc">Generator</span><span class="o">&lt;</span><span class="no">K</span><span class="o">&gt;</span> <span class="n">genK</span><span class="o">,</span> <span class="nc">Generator</span><span class="o">&lt;</span><span class="no">V</span><span class="o">&gt;</span> <span class="n">genV</span><span class="o">,</span> <span class="kt">int</span> <span class="n">quantity</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nc">MapData</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;(</span><span class="n">genK</span><span class="o">,</span> <span class="n">genV</span><span class="o">,</span> <span class="n">quantity</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;</span> <span class="nc">MapData</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;</span> <span class="nf">map</span><span class="o">(</span><span class="nc">Generator</span><span class="o">&lt;</span><span class="no">K</span><span class="o">&gt;</span> <span class="n">genK</span><span class="o">,</span> <span class="no">V</span> <span class="n">value</span><span class="o">,</span> <span class="kt">int</span> <span class="n">quantity</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nc">MapData</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;(</span><span class="n">genK</span><span class="o">,</span> <span class="n">value</span><span class="o">,</span> <span class="n">quantity</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;</span> <span class="nc">MapData</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;</span> <span class="nf">map</span><span class="o">(</span><span class="nc">Iterable</span><span class="o">&lt;</span><span class="no">K</span><span class="o">&gt;</span> <span class="n">genK</span><span class="o">,</span> <span class="nc">Generator</span><span class="o">&lt;</span><span class="no">V</span><span class="o">&gt;</span> <span class="n">genV</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nc">MapData</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;(</span><span class="n">genK</span><span class="o">,</span> <span class="n">genV</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;</span> <span class="nc">MapData</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;</span> <span class="nf">map</span><span class="o">(</span><span class="nc">Iterable</span><span class="o">&lt;</span><span class="no">K</span><span class="o">&gt;</span> <span class="n">genK</span><span class="o">,</span> <span class="no">V</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nc">MapData</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;(</span><span class="n">genK</span><span class="o">,</span> <span class="n">value</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~</span>
</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
</pre><td class="rouge-code"><pre><span class="c1">//: containers/MapDataTest.java</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">net.mindview.util.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">net</span><span class="o">.</span><span class="na">mindview</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">Print</span><span class="o">.*;</span>

<span class="kd">class</span> <span class="nc">Letters</span> <span class="kd">implements</span> <span class="nc">Generator</span><span class="o">&lt;</span><span class="nc">Pair</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">,</span><span class="nc">String</span><span class="o">&gt;&gt;,</span>
  <span class="nc">Iterable</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">9</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">number</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kt">char</span> <span class="n">letter</span> <span class="o">=</span> <span class="sc">'A'</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nc">Pair</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">,</span><span class="nc">String</span><span class="o">&gt;</span> <span class="nf">next</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nc">Pair</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">,</span><span class="nc">String</span><span class="o">&gt;(</span>
      <span class="n">number</span><span class="o">++,</span> <span class="s">""</span> <span class="o">+</span> <span class="n">letter</span><span class="o">++);</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="nc">Iterator</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="nf">iterator</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nc">Iterator</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;()</span> <span class="o">{</span>
      <span class="kd">public</span> <span class="nc">Integer</span> <span class="nf">next</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">number</span><span class="o">++;</span> <span class="o">}</span>
      <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">hasNext</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">number</span> <span class="o">&lt;</span> <span class="n">size</span><span class="o">;</span> <span class="o">}</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">remove</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">UnsupportedOperationException</span><span class="o">();</span>
      <span class="o">}</span>
    <span class="o">};</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MapDataTest</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// Pair Generator:</span>
    <span class="n">print</span><span class="o">(</span><span class="nc">MapData</span><span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="k">new</span> <span class="nc">Letters</span><span class="o">(),</span> <span class="mi">11</span><span class="o">));</span>
    <span class="c1">// Two separate generators:</span>
    <span class="n">print</span><span class="o">(</span><span class="nc">MapData</span><span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="k">new</span> <span class="nc">CountingGenerator</span><span class="o">.</span><span class="na">Character</span><span class="o">(),</span>
      <span class="k">new</span> <span class="nc">RandomGenerator</span><span class="o">.</span><span class="na">String</span><span class="o">(</span><span class="mi">3</span><span class="o">),</span> <span class="mi">8</span><span class="o">));</span>
    <span class="c1">// A key Generator and a single value:</span>
    <span class="n">print</span><span class="o">(</span><span class="nc">MapData</span><span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="k">new</span> <span class="nc">CountingGenerator</span><span class="o">.</span><span class="na">Character</span><span class="o">(),</span>
      <span class="s">"Value"</span><span class="o">,</span> <span class="mi">6</span><span class="o">));</span>
    <span class="c1">// An Iterable and a value Generator:</span>
    <span class="n">print</span><span class="o">(</span><span class="nc">MapData</span><span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="k">new</span> <span class="nc">Letters</span><span class="o">(),</span>
      <span class="k">new</span> <span class="nc">RandomGenerator</span><span class="o">.</span><span class="na">String</span><span class="o">(</span><span class="mi">3</span><span class="o">)));</span>
    <span class="c1">// An Iterable and a single value:</span>
    <span class="n">print</span><span class="o">(</span><span class="nc">MapData</span><span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="k">new</span> <span class="nc">Letters</span><span class="o">(),</span> <span class="s">"Pop"</span><span class="o">));</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output:
{1=A, 2=B, 3=C, 4=D, 5=E, 6=F, 7=G, 8=H, 9=I, 10=J, 11=K}
{a=YNz, b=brn, c=yGc, d=FOW, e=ZnT, f=cQr, g=Gse, h=GZM}
{a=Value, b=Value, c=Value, d=Value, e=Value, f=Value}
{1=mJM, 2=RoE, 3=suE, 4=cUO, 5=neO, 6=EdL, 7=smw, 8=HLG}
{1=Pop, 2=Pop, 3=Pop, 4=Pop, 5=Pop, 6=Pop, 7=Pop, 8=Pop}
*/</span><span class="c1">//:~</span>
</pre></table></code></div></div><h3 id="使用abstract类">使用Abstract类</h3><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
</pre><td class="rouge-code"><pre><span class="c1">//: net/mindview/util/Countries.java</span>
<span class="c1">// "Flyweight" Maps and Lists of sample data.</span>
<span class="kn">package</span> <span class="nn">net.mindview.util</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">net</span><span class="o">.</span><span class="na">mindview</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">Print</span><span class="o">.*;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Countries</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">String</span><span class="o">[][]</span> <span class="no">DATA</span> <span class="o">=</span> <span class="o">{</span>
    <span class="c1">// Africa</span>
    <span class="o">{</span><span class="s">"ALGERIA"</span><span class="o">,</span><span class="s">"Algiers"</span><span class="o">},</span> <span class="o">{</span><span class="s">"ANGOLA"</span><span class="o">,</span><span class="s">"Luanda"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"BENIN"</span><span class="o">,</span><span class="s">"Porto-Novo"</span><span class="o">},</span> <span class="o">{</span><span class="s">"BOTSWANA"</span><span class="o">,</span><span class="s">"Gaberone"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"BURKINA FASO"</span><span class="o">,</span><span class="s">"Ouagadougou"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"BURUNDI"</span><span class="o">,</span><span class="s">"Bujumbura"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"CAMEROON"</span><span class="o">,</span><span class="s">"Yaounde"</span><span class="o">},</span> <span class="o">{</span><span class="s">"CAPE VERDE"</span><span class="o">,</span><span class="s">"Praia"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"CENTRAL AFRICAN REPUBLIC"</span><span class="o">,</span><span class="s">"Bangui"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"CHAD"</span><span class="o">,</span><span class="s">"N'djamena"</span><span class="o">},</span>  <span class="o">{</span><span class="s">"COMOROS"</span><span class="o">,</span><span class="s">"Moroni"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"CONGO"</span><span class="o">,</span><span class="s">"Brazzaville"</span><span class="o">},</span> <span class="o">{</span><span class="s">"DJIBOUTI"</span><span class="o">,</span><span class="s">"Dijibouti"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"EGYPT"</span><span class="o">,</span><span class="s">"Cairo"</span><span class="o">},</span> <span class="o">{</span><span class="s">"EQUATORIAL GUINEA"</span><span class="o">,</span><span class="s">"Malabo"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"ERITREA"</span><span class="o">,</span><span class="s">"Asmara"</span><span class="o">},</span> <span class="o">{</span><span class="s">"ETHIOPIA"</span><span class="o">,</span><span class="s">"Addis Ababa"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"GABON"</span><span class="o">,</span><span class="s">"Libreville"</span><span class="o">},</span> <span class="o">{</span><span class="s">"THE GAMBIA"</span><span class="o">,</span><span class="s">"Banjul"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"GHANA"</span><span class="o">,</span><span class="s">"Accra"</span><span class="o">},</span> <span class="o">{</span><span class="s">"GUINEA"</span><span class="o">,</span><span class="s">"Conakry"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"BISSAU"</span><span class="o">,</span><span class="s">"Bissau"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"COTE D'IVOIR (IVORY COAST)"</span><span class="o">,</span><span class="s">"Yamoussoukro"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"KENYA"</span><span class="o">,</span><span class="s">"Nairobi"</span><span class="o">},</span> <span class="o">{</span><span class="s">"LESOTHO"</span><span class="o">,</span><span class="s">"Maseru"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"LIBERIA"</span><span class="o">,</span><span class="s">"Monrovia"</span><span class="o">},</span> <span class="o">{</span><span class="s">"LIBYA"</span><span class="o">,</span><span class="s">"Tripoli"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"MADAGASCAR"</span><span class="o">,</span><span class="s">"Antananarivo"</span><span class="o">},</span> <span class="o">{</span><span class="s">"MALAWI"</span><span class="o">,</span><span class="s">"Lilongwe"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"MALI"</span><span class="o">,</span><span class="s">"Bamako"</span><span class="o">},</span> <span class="o">{</span><span class="s">"MAURITANIA"</span><span class="o">,</span><span class="s">"Nouakchott"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"MAURITIUS"</span><span class="o">,</span><span class="s">"Port Louis"</span><span class="o">},</span> <span class="o">{</span><span class="s">"MOROCCO"</span><span class="o">,</span><span class="s">"Rabat"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"MOZAMBIQUE"</span><span class="o">,</span><span class="s">"Maputo"</span><span class="o">},</span> <span class="o">{</span><span class="s">"NAMIBIA"</span><span class="o">,</span><span class="s">"Windhoek"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"NIGER"</span><span class="o">,</span><span class="s">"Niamey"</span><span class="o">},</span> <span class="o">{</span><span class="s">"NIGERIA"</span><span class="o">,</span><span class="s">"Abuja"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"RWANDA"</span><span class="o">,</span><span class="s">"Kigali"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"SAO TOME E PRINCIPE"</span><span class="o">,</span><span class="s">"Sao Tome"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"SENEGAL"</span><span class="o">,</span><span class="s">"Dakar"</span><span class="o">},</span> <span class="o">{</span><span class="s">"SEYCHELLES"</span><span class="o">,</span><span class="s">"Victoria"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"SIERRA LEONE"</span><span class="o">,</span><span class="s">"Freetown"</span><span class="o">},</span> <span class="o">{</span><span class="s">"SOMALIA"</span><span class="o">,</span><span class="s">"Mogadishu"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"SOUTH AFRICA"</span><span class="o">,</span><span class="s">"Pretoria/Cape Town"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"SUDAN"</span><span class="o">,</span><span class="s">"Khartoum"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"SWAZILAND"</span><span class="o">,</span><span class="s">"Mbabane"</span><span class="o">},</span> <span class="o">{</span><span class="s">"TANZANIA"</span><span class="o">,</span><span class="s">"Dodoma"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"TOGO"</span><span class="o">,</span><span class="s">"Lome"</span><span class="o">},</span> <span class="o">{</span><span class="s">"TUNISIA"</span><span class="o">,</span><span class="s">"Tunis"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"UGANDA"</span><span class="o">,</span><span class="s">"Kampala"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"DEMOCRATIC REPUBLIC OF THE CONGO (ZAIRE)"</span><span class="o">,</span>
     <span class="s">"Kinshasa"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"ZAMBIA"</span><span class="o">,</span><span class="s">"Lusaka"</span><span class="o">},</span> <span class="o">{</span><span class="s">"ZIMBABWE"</span><span class="o">,</span><span class="s">"Harare"</span><span class="o">},</span>
    <span class="c1">// Asia</span>
    <span class="o">{</span><span class="s">"AFGHANISTAN"</span><span class="o">,</span><span class="s">"Kabul"</span><span class="o">},</span> <span class="o">{</span><span class="s">"BAHRAIN"</span><span class="o">,</span><span class="s">"Manama"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"BANGLADESH"</span><span class="o">,</span><span class="s">"Dhaka"</span><span class="o">},</span> <span class="o">{</span><span class="s">"BHUTAN"</span><span class="o">,</span><span class="s">"Thimphu"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"BRUNEI"</span><span class="o">,</span><span class="s">"Bandar Seri Begawan"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"CAMBODIA"</span><span class="o">,</span><span class="s">"Phnom Penh"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"CHINA"</span><span class="o">,</span><span class="s">"Beijing"</span><span class="o">},</span> <span class="o">{</span><span class="s">"CYPRUS"</span><span class="o">,</span><span class="s">"Nicosia"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"INDIA"</span><span class="o">,</span><span class="s">"New Delhi"</span><span class="o">},</span> <span class="o">{</span><span class="s">"INDONESIA"</span><span class="o">,</span><span class="s">"Jakarta"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"IRAN"</span><span class="o">,</span><span class="s">"Tehran"</span><span class="o">},</span> <span class="o">{</span><span class="s">"IRAQ"</span><span class="o">,</span><span class="s">"Baghdad"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"ISRAEL"</span><span class="o">,</span><span class="s">"Jerusalem"</span><span class="o">},</span> <span class="o">{</span><span class="s">"JAPAN"</span><span class="o">,</span><span class="s">"Tokyo"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"JORDAN"</span><span class="o">,</span><span class="s">"Amman"</span><span class="o">},</span> <span class="o">{</span><span class="s">"KUWAIT"</span><span class="o">,</span><span class="s">"Kuwait City"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"LAOS"</span><span class="o">,</span><span class="s">"Vientiane"</span><span class="o">},</span> <span class="o">{</span><span class="s">"LEBANON"</span><span class="o">,</span><span class="s">"Beirut"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"MALAYSIA"</span><span class="o">,</span><span class="s">"Kuala Lumpur"</span><span class="o">},</span> <span class="o">{</span><span class="s">"THE MALDIVES"</span><span class="o">,</span><span class="s">"Male"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"MONGOLIA"</span><span class="o">,</span><span class="s">"Ulan Bator"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"MYANMAR (BURMA)"</span><span class="o">,</span><span class="s">"Rangoon"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"NEPAL"</span><span class="o">,</span><span class="s">"Katmandu"</span><span class="o">},</span> <span class="o">{</span><span class="s">"NORTH KOREA"</span><span class="o">,</span><span class="s">"P'yongyang"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"OMAN"</span><span class="o">,</span><span class="s">"Muscat"</span><span class="o">},</span> <span class="o">{</span><span class="s">"PAKISTAN"</span><span class="o">,</span><span class="s">"Islamabad"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"PHILIPPINES"</span><span class="o">,</span><span class="s">"Manila"</span><span class="o">},</span> <span class="o">{</span><span class="s">"QATAR"</span><span class="o">,</span><span class="s">"Doha"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"SAUDI ARABIA"</span><span class="o">,</span><span class="s">"Riyadh"</span><span class="o">},</span> <span class="o">{</span><span class="s">"SINGAPORE"</span><span class="o">,</span><span class="s">"Singapore"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"SOUTH KOREA"</span><span class="o">,</span><span class="s">"Seoul"</span><span class="o">},</span> <span class="o">{</span><span class="s">"SRI LANKA"</span><span class="o">,</span><span class="s">"Colombo"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"SYRIA"</span><span class="o">,</span><span class="s">"Damascus"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"TAIWAN (REPUBLIC OF CHINA)"</span><span class="o">,</span><span class="s">"Taipei"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"THAILAND"</span><span class="o">,</span><span class="s">"Bangkok"</span><span class="o">},</span> <span class="o">{</span><span class="s">"TURKEY"</span><span class="o">,</span><span class="s">"Ankara"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"UNITED ARAB EMIRATES"</span><span class="o">,</span><span class="s">"Abu Dhabi"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"VIETNAM"</span><span class="o">,</span><span class="s">"Hanoi"</span><span class="o">},</span> <span class="o">{</span><span class="s">"YEMEN"</span><span class="o">,</span><span class="s">"Sana'a"</span><span class="o">},</span>
    <span class="c1">// Australia and Oceania</span>
    <span class="o">{</span><span class="s">"AUSTRALIA"</span><span class="o">,</span><span class="s">"Canberra"</span><span class="o">},</span> <span class="o">{</span><span class="s">"FIJI"</span><span class="o">,</span><span class="s">"Suva"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"KIRIBATI"</span><span class="o">,</span><span class="s">"Bairiki"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"MARSHALL ISLANDS"</span><span class="o">,</span><span class="s">"Dalap-Uliga-Darrit"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"MICRONESIA"</span><span class="o">,</span><span class="s">"Palikir"</span><span class="o">},</span> <span class="o">{</span><span class="s">"NAURU"</span><span class="o">,</span><span class="s">"Yaren"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"NEW ZEALAND"</span><span class="o">,</span><span class="s">"Wellington"</span><span class="o">},</span> <span class="o">{</span><span class="s">"PALAU"</span><span class="o">,</span><span class="s">"Koror"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"PAPUA NEW GUINEA"</span><span class="o">,</span><span class="s">"Port Moresby"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"SOLOMON ISLANDS"</span><span class="o">,</span><span class="s">"Honaira"</span><span class="o">},</span> <span class="o">{</span><span class="s">"TONGA"</span><span class="o">,</span><span class="s">"Nuku'alofa"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"TUVALU"</span><span class="o">,</span><span class="s">"Fongafale"</span><span class="o">},</span> <span class="o">{</span><span class="s">"VANUATU"</span><span class="o">,</span><span class="s">"&lt; Port-Vila"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"WESTERN SAMOA"</span><span class="o">,</span><span class="s">"Apia"</span><span class="o">},</span>
    <span class="c1">// Eastern Europe and former USSR</span>
    <span class="o">{</span><span class="s">"ARMENIA"</span><span class="o">,</span><span class="s">"Yerevan"</span><span class="o">},</span> <span class="o">{</span><span class="s">"AZERBAIJAN"</span><span class="o">,</span><span class="s">"Baku"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"BELARUS (BYELORUSSIA)"</span><span class="o">,</span><span class="s">"Minsk"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"BULGARIA"</span><span class="o">,</span><span class="s">"Sofia"</span><span class="o">},</span> <span class="o">{</span><span class="s">"GEORGIA"</span><span class="o">,</span><span class="s">"Tbilisi"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"KAZAKSTAN"</span><span class="o">,</span><span class="s">"Almaty"</span><span class="o">},</span> <span class="o">{</span><span class="s">"KYRGYZSTAN"</span><span class="o">,</span><span class="s">"Alma-Ata"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"MOLDOVA"</span><span class="o">,</span><span class="s">"Chisinau"</span><span class="o">},</span> <span class="o">{</span><span class="s">"RUSSIA"</span><span class="o">,</span><span class="s">"Moscow"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"TAJIKISTAN"</span><span class="o">,</span><span class="s">"Dushanbe"</span><span class="o">},</span> <span class="o">{</span><span class="s">"TURKMENISTAN"</span><span class="o">,</span><span class="s">"Ashkabad"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"UKRAINE"</span><span class="o">,</span><span class="s">"Kyiv"</span><span class="o">},</span> <span class="o">{</span><span class="s">"UZBEKISTAN"</span><span class="o">,</span><span class="s">"Tashkent"</span><span class="o">},</span>
    <span class="c1">// Europe</span>
    <span class="o">{</span><span class="s">"ALBANIA"</span><span class="o">,</span><span class="s">"Tirana"</span><span class="o">},</span> <span class="o">{</span><span class="s">"ANDORRA"</span><span class="o">,</span><span class="s">"Andorra la Vella"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"AUSTRIA"</span><span class="o">,</span><span class="s">"Vienna"</span><span class="o">},</span> <span class="o">{</span><span class="s">"BELGIUM"</span><span class="o">,</span><span class="s">"Brussels"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"BOSNIA"</span><span class="o">,</span><span class="s">"-"</span><span class="o">},</span> <span class="o">{</span><span class="s">"HERZEGOVINA"</span><span class="o">,</span><span class="s">"Sarajevo"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"CROATIA"</span><span class="o">,</span><span class="s">"Zagreb"</span><span class="o">},</span> <span class="o">{</span><span class="s">"CZECH REPUBLIC"</span><span class="o">,</span><span class="s">"Prague"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"DENMARK"</span><span class="o">,</span><span class="s">"Copenhagen"</span><span class="o">},</span> <span class="o">{</span><span class="s">"ESTONIA"</span><span class="o">,</span><span class="s">"Tallinn"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"FINLAND"</span><span class="o">,</span><span class="s">"Helsinki"</span><span class="o">},</span> <span class="o">{</span><span class="s">"FRANCE"</span><span class="o">,</span><span class="s">"Paris"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"GERMANY"</span><span class="o">,</span><span class="s">"Berlin"</span><span class="o">},</span> <span class="o">{</span><span class="s">"GREECE"</span><span class="o">,</span><span class="s">"Athens"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"HUNGARY"</span><span class="o">,</span><span class="s">"Budapest"</span><span class="o">},</span> <span class="o">{</span><span class="s">"ICELAND"</span><span class="o">,</span><span class="s">"Reykjavik"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"IRELAND"</span><span class="o">,</span><span class="s">"Dublin"</span><span class="o">},</span> <span class="o">{</span><span class="s">"ITALY"</span><span class="o">,</span><span class="s">"Rome"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"LATVIA"</span><span class="o">,</span><span class="s">"Riga"</span><span class="o">},</span> <span class="o">{</span><span class="s">"LIECHTENSTEIN"</span><span class="o">,</span><span class="s">"Vaduz"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"LITHUANIA"</span><span class="o">,</span><span class="s">"Vilnius"</span><span class="o">},</span> <span class="o">{</span><span class="s">"LUXEMBOURG"</span><span class="o">,</span><span class="s">"Luxembourg"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"MACEDONIA"</span><span class="o">,</span><span class="s">"Skopje"</span><span class="o">},</span> <span class="o">{</span><span class="s">"MALTA"</span><span class="o">,</span><span class="s">"Valletta"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"MONACO"</span><span class="o">,</span><span class="s">"Monaco"</span><span class="o">},</span> <span class="o">{</span><span class="s">"MONTENEGRO"</span><span class="o">,</span><span class="s">"Podgorica"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"THE NETHERLANDS"</span><span class="o">,</span><span class="s">"Amsterdam"</span><span class="o">},</span> <span class="o">{</span><span class="s">"NORWAY"</span><span class="o">,</span><span class="s">"Oslo"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"POLAND"</span><span class="o">,</span><span class="s">"Warsaw"</span><span class="o">},</span> <span class="o">{</span><span class="s">"PORTUGAL"</span><span class="o">,</span><span class="s">"Lisbon"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"ROMANIA"</span><span class="o">,</span><span class="s">"Bucharest"</span><span class="o">},</span> <span class="o">{</span><span class="s">"SAN MARINO"</span><span class="o">,</span><span class="s">"San Marino"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"SERBIA"</span><span class="o">,</span><span class="s">"Belgrade"</span><span class="o">},</span> <span class="o">{</span><span class="s">"SLOVAKIA"</span><span class="o">,</span><span class="s">"Bratislava"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"SLOVENIA"</span><span class="o">,</span><span class="s">"Ljuijana"</span><span class="o">},</span> <span class="o">{</span><span class="s">"SPAIN"</span><span class="o">,</span><span class="s">"Madrid"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"SWEDEN"</span><span class="o">,</span><span class="s">"Stockholm"</span><span class="o">},</span> <span class="o">{</span><span class="s">"SWITZERLAND"</span><span class="o">,</span><span class="s">"Berne"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"UNITED KINGDOM"</span><span class="o">,</span><span class="s">"London"</span><span class="o">},</span> <span class="o">{</span><span class="s">"VATICAN CITY"</span><span class="o">,</span><span class="s">"---"</span><span class="o">},</span>
    <span class="c1">// North and Central America</span>
    <span class="o">{</span><span class="s">"ANTIGUA AND BARBUDA"</span><span class="o">,</span><span class="s">"Saint John's"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"BAHAMAS"</span><span class="o">,</span><span class="s">"Nassau"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"BARBADOS"</span><span class="o">,</span><span class="s">"Bridgetown"</span><span class="o">},</span> <span class="o">{</span><span class="s">"BELIZE"</span><span class="o">,</span><span class="s">"Belmopan"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"CANADA"</span><span class="o">,</span><span class="s">"Ottawa"</span><span class="o">},</span> <span class="o">{</span><span class="s">"COSTA RICA"</span><span class="o">,</span><span class="s">"San Jose"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"CUBA"</span><span class="o">,</span><span class="s">"Havana"</span><span class="o">},</span> <span class="o">{</span><span class="s">"DOMINICA"</span><span class="o">,</span><span class="s">"Roseau"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"DOMINICAN REPUBLIC"</span><span class="o">,</span><span class="s">"Santo Domingo"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"EL SALVADOR"</span><span class="o">,</span><span class="s">"San Salvador"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"GRENADA"</span><span class="o">,</span><span class="s">"Saint George's"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"GUATEMALA"</span><span class="o">,</span><span class="s">"Guatemala City"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"HAITI"</span><span class="o">,</span><span class="s">"Port-au-Prince"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"HONDURAS"</span><span class="o">,</span><span class="s">"Tegucigalpa"</span><span class="o">},</span> <span class="o">{</span><span class="s">"JAMAICA"</span><span class="o">,</span><span class="s">"Kingston"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"MEXICO"</span><span class="o">,</span><span class="s">"Mexico City"</span><span class="o">},</span> <span class="o">{</span><span class="s">"NICARAGUA"</span><span class="o">,</span><span class="s">"Managua"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"PANAMA"</span><span class="o">,</span><span class="s">"Panama City"</span><span class="o">},</span> <span class="o">{</span><span class="s">"ST. KITTS"</span><span class="o">,</span><span class="s">"-"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"NEVIS"</span><span class="o">,</span><span class="s">"Basseterre"</span><span class="o">},</span> <span class="o">{</span><span class="s">"ST. LUCIA"</span><span class="o">,</span><span class="s">"Castries"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"ST. VINCENT AND THE GRENADINES"</span><span class="o">,</span><span class="s">"Kingstown"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"UNITED STATES OF AMERICA"</span><span class="o">,</span><span class="s">"Washington, D.C."</span><span class="o">},</span>
    <span class="c1">// South America</span>
    <span class="o">{</span><span class="s">"ARGENTINA"</span><span class="o">,</span><span class="s">"Buenos Aires"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"BOLIVIA"</span><span class="o">,</span><span class="s">"Sucre (legal)/La Paz(administrative)"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"BRAZIL"</span><span class="o">,</span><span class="s">"Brasilia"</span><span class="o">},</span> <span class="o">{</span><span class="s">"CHILE"</span><span class="o">,</span><span class="s">"Santiago"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"COLOMBIA"</span><span class="o">,</span><span class="s">"Bogota"</span><span class="o">},</span> <span class="o">{</span><span class="s">"ECUADOR"</span><span class="o">,</span><span class="s">"Quito"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"GUYANA"</span><span class="o">,</span><span class="s">"Georgetown"</span><span class="o">},</span> <span class="o">{</span><span class="s">"PARAGUAY"</span><span class="o">,</span><span class="s">"Asuncion"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"PERU"</span><span class="o">,</span><span class="s">"Lima"</span><span class="o">},</span> <span class="o">{</span><span class="s">"SURINAME"</span><span class="o">,</span><span class="s">"Paramaribo"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"TRINIDAD AND TOBAGO"</span><span class="o">,</span><span class="s">"Port of Spain"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"URUGUAY"</span><span class="o">,</span><span class="s">"Montevideo"</span><span class="o">},</span> <span class="o">{</span><span class="s">"VENEZUELA"</span><span class="o">,</span><span class="s">"Caracas"</span><span class="o">},</span>
  <span class="o">};</span>
  <span class="c1">// Use AbstractMap by implementing entrySet()</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">FlyweightMap</span> <span class="kd">extends</span> <span class="nc">AbstractMap</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">String</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Entry</span> <span class="kd">implements</span> <span class="nc">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">String</span><span class="o">&gt;</span> <span class="o">{</span>
      <span class="kt">int</span> <span class="n">index</span><span class="o">;</span>
      <span class="nc">Entry</span><span class="o">(</span><span class="kt">int</span> <span class="n">index</span><span class="o">)</span> <span class="o">{</span> <span class="k">this</span><span class="o">.</span><span class="na">index</span> <span class="o">=</span> <span class="n">index</span><span class="o">;</span> <span class="o">}</span>
      <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="nc">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="no">DATA</span><span class="o">[</span><span class="n">index</span><span class="o">][</span><span class="mi">0</span><span class="o">].</span><span class="na">equals</span><span class="o">(</span><span class="n">o</span><span class="o">);</span>
      <span class="o">}</span>
      <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getKey</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="no">DATA</span><span class="o">[</span><span class="n">index</span><span class="o">][</span><span class="mi">0</span><span class="o">];</span> <span class="o">}</span>
      <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getValue</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="no">DATA</span><span class="o">[</span><span class="n">index</span><span class="o">][</span><span class="mi">1</span><span class="o">];</span> <span class="o">}</span>
      <span class="kd">public</span> <span class="nc">String</span> <span class="nf">setValue</span><span class="o">(</span><span class="nc">String</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">UnsupportedOperationException</span><span class="o">();</span>
      <span class="o">}</span>
      <span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="no">DATA</span><span class="o">[</span><span class="n">index</span><span class="o">][</span><span class="mi">0</span><span class="o">].</span><span class="na">hashCode</span><span class="o">();</span>
      <span class="o">}</span>
    <span class="o">}</span>
    <span class="c1">// Use AbstractSet by implementing size() &amp; iterator()</span>
    <span class="kd">static</span> <span class="kd">class</span> <span class="nc">EntrySet</span> <span class="kd">extends</span> <span class="nc">AbstractSet</span><span class="o">&lt;</span><span class="nc">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">String</span><span class="o">&gt;&gt;</span> <span class="o">{</span>
      <span class="kd">private</span> <span class="kt">int</span> <span class="n">size</span><span class="o">;</span>
      <span class="nc">EntrySet</span><span class="o">(</span><span class="kt">int</span> <span class="n">size</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span><span class="o">(</span><span class="n">size</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">)</span>
          <span class="k">this</span><span class="o">.</span><span class="na">size</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
        <span class="c1">// Can't be any bigger than the array:</span>
        <span class="k">else</span> <span class="nf">if</span><span class="o">(</span><span class="n">size</span> <span class="o">&gt;</span> <span class="no">DATA</span><span class="o">.</span><span class="na">length</span><span class="o">)</span>
          <span class="k">this</span><span class="o">.</span><span class="na">size</span> <span class="o">=</span> <span class="no">DATA</span><span class="o">.</span><span class="na">length</span><span class="o">;</span>
        <span class="k">else</span>
          <span class="k">this</span><span class="o">.</span><span class="na">size</span> <span class="o">=</span> <span class="n">size</span><span class="o">;</span>
      <span class="o">}</span>
      <span class="kd">public</span> <span class="kt">int</span> <span class="nf">size</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">size</span><span class="o">;</span> <span class="o">}</span>
      <span class="kd">private</span> <span class="kd">class</span> <span class="nc">Iter</span> <span class="kd">implements</span> <span class="nc">Iterator</span><span class="o">&lt;</span><span class="nc">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">String</span><span class="o">&gt;&gt;</span> <span class="o">{</span>
        <span class="c1">// Only one Entry object per Iterator:</span>
        <span class="kd">private</span> <span class="nc">Entry</span> <span class="n">entry</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Entry</span><span class="o">(-</span><span class="mi">1</span><span class="o">);</span>
        <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">hasNext</span><span class="o">()</span> <span class="o">{</span>
          <span class="k">return</span> <span class="n">entry</span><span class="o">.</span><span class="na">index</span> <span class="o">&lt;</span> <span class="n">size</span> <span class="o">-</span> <span class="mi">1</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="nc">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">String</span><span class="o">&gt;</span> <span class="nf">next</span><span class="o">()</span> <span class="o">{</span>
          <span class="n">entry</span><span class="o">.</span><span class="na">index</span><span class="o">++;</span>
          <span class="k">return</span> <span class="n">entry</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">remove</span><span class="o">()</span> <span class="o">{</span>
          <span class="k">throw</span> <span class="k">new</span> <span class="nf">UnsupportedOperationException</span><span class="o">();</span>
        <span class="o">}</span>
      <span class="o">}</span>
      <span class="kd">public</span>
      <span class="nc">Iterator</span><span class="o">&lt;</span><span class="nc">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">String</span><span class="o">&gt;&gt;</span> <span class="nf">iterator</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">Iter</span><span class="o">();</span>
      <span class="o">}</span>
    <span class="o">}</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">String</span><span class="o">&gt;&gt;</span> <span class="n">entries</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">EntrySet</span><span class="o">(</span><span class="no">DATA</span><span class="o">.</span><span class="na">length</span><span class="o">);</span>
    <span class="kd">public</span> <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">String</span><span class="o">&gt;&gt;</span> <span class="nf">entrySet</span><span class="o">()</span> <span class="o">{</span>
      <span class="k">return</span> <span class="n">entries</span><span class="o">;</span>
    <span class="o">}</span>
  <span class="o">}</span>
  <span class="c1">// Create a partial map of 'size' countries:</span>
  <span class="kd">static</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">String</span><span class="o">&gt;</span> <span class="nf">select</span><span class="o">(</span><span class="kd">final</span> <span class="kt">int</span> <span class="n">size</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">FlyweightMap</span><span class="o">()</span> <span class="o">{</span>
      <span class="kd">public</span> <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">String</span><span class="o">&gt;&gt;</span> <span class="nf">entrySet</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">EntrySet</span><span class="o">(</span><span class="n">size</span><span class="o">);</span>
      <span class="o">}</span>
    <span class="o">};</span>
  <span class="o">}</span>
  <span class="kd">static</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">map</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">FlyweightMap</span><span class="o">();</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">String</span><span class="o">&gt;</span> <span class="nf">capitals</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">map</span><span class="o">;</span> <span class="c1">// The entire map</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">String</span><span class="o">&gt;</span> <span class="nf">capitals</span><span class="o">(</span><span class="kt">int</span> <span class="n">size</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="nf">select</span><span class="o">(</span><span class="n">size</span><span class="o">);</span> <span class="c1">// A partial map</span>
  <span class="o">}</span>
  <span class="kd">static</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">names</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;(</span><span class="n">map</span><span class="o">.</span><span class="na">keySet</span><span class="o">());</span>
  <span class="c1">// All the names:</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="nf">names</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">names</span><span class="o">;</span> <span class="o">}</span>
  <span class="c1">// A partial list:</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="nf">names</span><span class="o">(</span><span class="kt">int</span> <span class="n">size</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;(</span><span class="n">select</span><span class="o">(</span><span class="n">size</span><span class="o">).</span><span class="na">keySet</span><span class="o">());</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">print</span><span class="o">(</span><span class="n">capitals</span><span class="o">(</span><span class="mi">10</span><span class="o">));</span>
    <span class="n">print</span><span class="o">(</span><span class="n">names</span><span class="o">(</span><span class="mi">10</span><span class="o">));</span>
    <span class="n">print</span><span class="o">(</span><span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">String</span><span class="o">&gt;(</span><span class="n">capitals</span><span class="o">(</span><span class="mi">3</span><span class="o">)));</span>
    <span class="n">print</span><span class="o">(</span><span class="k">new</span> <span class="nc">LinkedHashMap</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">String</span><span class="o">&gt;(</span><span class="n">capitals</span><span class="o">(</span><span class="mi">3</span><span class="o">)));</span>
    <span class="n">print</span><span class="o">(</span><span class="k">new</span> <span class="nc">TreeMap</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">String</span><span class="o">&gt;(</span><span class="n">capitals</span><span class="o">(</span><span class="mi">3</span><span class="o">)));</span>
    <span class="n">print</span><span class="o">(</span><span class="k">new</span> <span class="nc">Hashtable</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">String</span><span class="o">&gt;(</span><span class="n">capitals</span><span class="o">(</span><span class="mi">3</span><span class="o">)));</span>
    <span class="n">print</span><span class="o">(</span><span class="k">new</span> <span class="nc">HashSet</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;(</span><span class="n">names</span><span class="o">(</span><span class="mi">6</span><span class="o">)));</span>
    <span class="n">print</span><span class="o">(</span><span class="k">new</span> <span class="nc">LinkedHashSet</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;(</span><span class="n">names</span><span class="o">(</span><span class="mi">6</span><span class="o">)));</span>
    <span class="n">print</span><span class="o">(</span><span class="k">new</span> <span class="nc">TreeSet</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;(</span><span class="n">names</span><span class="o">(</span><span class="mi">6</span><span class="o">)));</span>
    <span class="n">print</span><span class="o">(</span><span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;(</span><span class="n">names</span><span class="o">(</span><span class="mi">6</span><span class="o">)));</span>
    <span class="n">print</span><span class="o">(</span><span class="k">new</span> <span class="nc">LinkedList</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;(</span><span class="n">names</span><span class="o">(</span><span class="mi">6</span><span class="o">)));</span>
    <span class="n">print</span><span class="o">(</span><span class="n">capitals</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="s">"BRAZIL"</span><span class="o">));</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output:
{ALGERIA=Algiers, ANGOLA=Luanda, BENIN=Porto-Novo, BOTSWANA=Gaberone, BULGARIA=Sofia, BURKINA FASO=Ouagadougou, BURUNDI=Bujumbura, CAMEROON=Yaounde, CAPE VERDE=Praia, CENTRAL AFRICAN REPUBLIC=Bangui}
[ALGERIA, ANGOLA, BENIN, BOTSWANA, BULGARIA, BURKINA FASO, BURUNDI, CAMEROON, CAPE VERDE, CENTRAL AFRICAN REPUBLIC]
{BENIN=Porto-Novo, ANGOLA=Luanda, ALGERIA=Algiers}
{ALGERIA=Algiers, ANGOLA=Luanda, BENIN=Porto-Novo}
{ALGERIA=Algiers, ANGOLA=Luanda, BENIN=Porto-Novo}
{ALGERIA=Algiers, ANGOLA=Luanda, BENIN=Porto-Novo}
[BULGARIA, BURKINA FASO, BOTSWANA, BENIN, ANGOLA, ALGERIA]
[ALGERIA, ANGOLA, BENIN, BOTSWANA, BULGARIA, BURKINA FASO]
[ALGERIA, ANGOLA, BENIN, BOTSWANA, BULGARIA, BURKINA FASO]
[ALGERIA, ANGOLA, BENIN, BOTSWANA, BULGARIA, BURKINA FASO]
[ALGERIA, ANGOLA, BENIN, BOTSWANA, BULGARIA, BURKINA FASO]
Brasilia
*/</span><span class="c1">//:~</span>
</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
</pre><td class="rouge-code"><pre><span class="c1">//: net/mindview/util/CountingMapData.java</span>
<span class="c1">// Unlimited-length Map containing sample data.</span>
<span class="kn">package</span> <span class="nn">net.mindview.util</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CountingMapData</span> <span class="kd">extends</span> <span class="nc">AbstractMap</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">,</span><span class="nc">String</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">size</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="nc">String</span><span class="o">[]</span> <span class="n">chars</span> <span class="o">=</span> <span class="s">"A B C D E F G H I J K L M N O P Q R S T U V W X Y Z"</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">" "</span><span class="o">);</span>
  <span class="kd">public</span> <span class="nf">CountingMapData</span><span class="o">(</span><span class="kt">int</span> <span class="n">size</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span><span class="o">(</span><span class="n">size</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">)</span> <span class="k">this</span><span class="o">.</span><span class="na">size</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">size</span> <span class="o">=</span> <span class="n">size</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Entry</span> <span class="kd">implements</span> <span class="nc">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">,</span><span class="nc">String</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">index</span><span class="o">;</span>
    <span class="nc">Entry</span><span class="o">(</span><span class="kt">int</span> <span class="n">index</span><span class="o">)</span> <span class="o">{</span> <span class="k">this</span><span class="o">.</span><span class="na">index</span> <span class="o">=</span> <span class="n">index</span><span class="o">;</span> <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="nc">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">return</span> <span class="nc">Integer</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">index</span><span class="o">).</span><span class="na">equals</span><span class="o">(</span><span class="n">o</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="nc">Integer</span> <span class="nf">getKey</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">index</span><span class="o">;</span> <span class="o">}</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getValue</span><span class="o">()</span> <span class="o">{</span>
      <span class="k">return</span> <span class="n">chars</span><span class="o">[</span><span class="n">index</span> <span class="o">%</span> <span class="n">chars</span><span class="o">.</span><span class="na">length</span><span class="o">]</span> <span class="o">+</span> <span class="nc">Integer</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">index</span> <span class="o">/</span> <span class="n">chars</span><span class="o">.</span><span class="na">length</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">setValue</span><span class="o">(</span><span class="nc">String</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nf">UnsupportedOperationException</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span>
      <span class="k">return</span> <span class="nc">Integer</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">index</span><span class="o">).</span><span class="na">hashCode</span><span class="o">();</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;&gt;</span> <span class="nf">entrySet</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// LinkedHashSet retains initialization order:</span>
    <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">,</span><span class="nc">String</span><span class="o">&gt;&gt;</span> <span class="n">entries</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">LinkedHashSet</span><span class="o">&lt;</span><span class="nc">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">,</span><span class="nc">String</span><span class="o">&gt;&gt;();</span>
    <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">size</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span>
      <span class="n">entries</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nc">Entry</span><span class="o">(</span><span class="n">i</span><span class="o">));</span>
    <span class="k">return</span> <span class="n">entries</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="k">new</span> <span class="nc">CountingMapData</span><span class="o">(</span><span class="mi">60</span><span class="o">));</span><span class="c1">//调用toString方法，toString方法中调用entrySet()方法。</span>
  <span class="o">}</span>
<span class="o">}</span>  <span class="cm">/* Output:
{0=A0, 1=B0, 2=C0, 3=D0, 4=E0, 5=F0, 6=G0, 7=H0, 8=I0, 9=J0, 10=K0, 11=L0, 12=M0, 13=N0, 14=O0, 15=P0, 16=Q0, 17=R0, 18=S0, 19=T0, 20=U0, 21=V0, 22=W0, 23=X0, 24=Y0, 25=Z0, 26=A1, 27=B1, 28=C1, 29=D1, 30=E1, 31=F1, 32=G1, 33=H1, 34=I1, 35=J1, 36=K1, 37=L1, 38=M1, 39=N1, 40=O1, 41=P1, 42=Q1, 43=R1, 44=S1, 45=T1, 46=U1, 47=V1, 48=W1, 49=X1, 50=Y1, 51=Z1, 52=A2, 53=B2, 54=C2, 55=D2, 56=E2, 57=F2, 58=G2, 59=H2}
*/</span><span class="c1">//:~</span>
</pre></table></code></div></div><h2 id="collection的功能方法">Collection的功能方法</h2><p><code class="language-plaintext highlighter-rouge">Collection</code>所有操作：</p><div class="table-wrapper"><table><thead><tr><th>boolean add(T)<th> <tbody><tr><td>boolean addAll(Collection&lt;? extends T&gt;)<td> <tr><td>void clear()<td> <tr><td>boolean contains(T)<td> <tr><td>boolean isEmpty()<td> <tr><td>Iterator iterator()<td> <tr><td>boolean remove(Object)<td> <tr><td>boolean removeAll(Collection&lt;?&gt;)<td> <tr><td>boolean retainAll(Collection&lt;?&gt;)<td>只保留这个列表中包含在指定集合中的元素。换句话说，从这个列表中删除所有不包含在指定集合中的元素。如果这个列表改变，则为true。<tr><td>int size()<td> <tr><td>Object[] toArray()：<td> <tr><td>T[] toArray(T[] a)<td> <tr><td> <td> </table></div><h3 id="retainall">retainAll()</h3><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">list1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;(</span><span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">5</span><span class="o">));</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">list2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;(</span><span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">6</span><span class="o">,</span> <span class="mi">7</span><span class="o">));</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">list3</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;(</span><span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">));</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">list4</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;(</span><span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">5</span><span class="o">));</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">list1</span><span class="o">.</span><span class="na">retainAll</span><span class="o">(</span><span class="n">list1</span><span class="o">));</span> <span class="c1">//false</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">list1</span><span class="o">.</span><span class="na">retainAll</span><span class="o">(</span><span class="n">list2</span><span class="o">));</span> <span class="c1">//true</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"list1 = "</span> <span class="o">+</span> <span class="n">list1</span><span class="o">);</span> <span class="c1">//list1 = [3, 4, 5]</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">list3</span><span class="o">.</span><span class="na">retainAll</span><span class="o">(</span><span class="n">list4</span><span class="o">));</span> <span class="c1">//false</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"list3 = "</span> <span class="o">+</span> <span class="n">list3</span><span class="o">);</span> <span class="c1">//list3 = [1, 2, 3]</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">list4</span><span class="o">.</span><span class="na">retainAll</span><span class="o">(</span><span class="n">list3</span><span class="o">));</span> <span class="c1">//true</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"list4 = "</span> <span class="o">+</span> <span class="n">list4</span><span class="o">);</span> <span class="c1">//list4 = [1, 2, 3]</span>
</pre></table></code></div></div><h2 id="可选操作">可选操作</h2><p>最常见的未获支持的操作，都来源于背后由固定尺寸的数据结构支持的容器。当你用<code class="language-plaintext highlighter-rouge">Arrays.asList()</code>将数组转换为<code class="language-plaintext highlighter-rouge">List</code>时，就会得到这样的容器。</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
</pre><td class="rouge-code"><pre><span class="c1">//: containers/Unsupported.java</span>
<span class="c1">// Unsupported operations in Java containers.</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Unsupported</span> <span class="o">{</span>
  <span class="kd">static</span> <span class="kt">void</span> <span class="nf">test</span><span class="o">(</span><span class="nc">String</span> <span class="n">msg</span><span class="o">,</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"--- "</span> <span class="o">+</span> <span class="n">msg</span> <span class="o">+</span> <span class="s">" ---"</span><span class="o">);</span>
    <span class="nc">Collection</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">c</span> <span class="o">=</span> <span class="n">list</span><span class="o">;</span>
    <span class="nc">Collection</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">subList</span> <span class="o">=</span> <span class="n">list</span><span class="o">.</span><span class="na">subList</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span><span class="mi">8</span><span class="o">);</span>
    <span class="c1">// Copy of the sublist:</span>
    <span class="nc">Collection</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">c2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;(</span><span class="n">subList</span><span class="o">);</span>
    <span class="k">try</span> <span class="o">{</span> <span class="n">c</span><span class="o">.</span><span class="na">retainAll</span><span class="o">(</span><span class="n">c2</span><span class="o">);</span> <span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"retainAll(): "</span> <span class="o">+</span> <span class="n">e</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">try</span> <span class="o">{</span> <span class="n">c</span><span class="o">.</span><span class="na">removeAll</span><span class="o">(</span><span class="n">c2</span><span class="o">);</span> <span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"removeAll(): "</span> <span class="o">+</span> <span class="n">e</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">try</span> <span class="o">{</span> <span class="n">c</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span> <span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"clear(): "</span> <span class="o">+</span> <span class="n">e</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">try</span> <span class="o">{</span> <span class="n">c</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"X"</span><span class="o">);</span> <span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"add(): "</span> <span class="o">+</span> <span class="n">e</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">try</span> <span class="o">{</span> <span class="n">c</span><span class="o">.</span><span class="na">addAll</span><span class="o">(</span><span class="n">c2</span><span class="o">);</span> <span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"addAll(): "</span> <span class="o">+</span> <span class="n">e</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">try</span> <span class="o">{</span> <span class="n">c</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="s">"C"</span><span class="o">);</span> <span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"remove(): "</span> <span class="o">+</span> <span class="n">e</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="c1">// The List.set() method modifies the value but</span>
    <span class="c1">// doesn't change the size of the data structure:</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">list</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="s">"X"</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"List.set(): "</span> <span class="o">+</span> <span class="n">e</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span>
      <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="s">"A B C D E F G H I J K L"</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">" "</span><span class="o">));</span>
    <span class="n">test</span><span class="o">(</span><span class="s">"Modifiable Copy"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;(</span><span class="n">list</span><span class="o">));</span>
    <span class="n">test</span><span class="o">(</span><span class="s">"Arrays.asList()"</span><span class="o">,</span> <span class="n">list</span><span class="o">);</span>
    <span class="n">test</span><span class="o">(</span><span class="s">"unmodifiableList()"</span><span class="o">,</span>
      <span class="nc">Collections</span><span class="o">.</span><span class="na">unmodifiableList</span><span class="o">(</span>
        <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;(</span><span class="n">list</span><span class="o">)));</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output:
--- Modifiable Copy ---
--- Arrays.asList() ---
retainAll(): java.lang.UnsupportedOperationException
removeAll(): java.lang.UnsupportedOperationException
clear(): java.lang.UnsupportedOperationException
add(): java.lang.UnsupportedOperationException
addAll(): java.lang.UnsupportedOperationException
remove(): java.lang.UnsupportedOperationException
--- unmodifiableList() ---
retainAll(): java.lang.UnsupportedOperationException
removeAll(): java.lang.UnsupportedOperationException
clear(): java.lang.UnsupportedOperationException
add(): java.lang.UnsupportedOperationException
addAll(): java.lang.UnsupportedOperationException
remove(): java.lang.UnsupportedOperationException
List.set(): java.lang.UnsupportedOperationException
*/</span><span class="c1">//:~</span>
</pre></table></code></div></div><p>把<code class="language-plaintext highlighter-rouge">Arrays.asList()</code>的结果作为构造器的参数传递给任何<code class="language-plaintext highlighter-rouge">Collection</code>，这样可以生成允许使用所有的方法的普通容器</p><h2 id="list的功能方法">List的功能方法</h2><div class="table-wrapper"><table><thead><tr><th>int indexOf(Object o);<th> <tbody><tr><td>int lastIndexOf(Object o);<td> <tr><td>ListIterator<E> listIterator();</E><td> <tr><td>ListIterator<E> listIterator(int index);</E><td> <tr><td>List<E> subList(int fromIndex, int toIndex);</E><td> </table></div><h3 id="listiterator">listIterator()</h3><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;(</span><span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">5</span><span class="o">));</span>
<span class="nc">ListIterator</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">iterator</span> <span class="o">=</span> <span class="n">list</span><span class="o">.</span><span class="na">listIterator</span><span class="o">(</span><span class="mi">5</span><span class="o">);</span>
<span class="k">while</span> <span class="o">(</span><span class="n">iterator</span><span class="o">.</span><span class="na">hasPrevious</span><span class="o">())</span> <span class="o">{</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">iterator</span><span class="o">.</span><span class="na">previous</span><span class="o">()+</span><span class="s">","</span><span class="o">);</span> <span class="c1">//5,4,3,2,1,</span>
<span class="o">}</span>
</pre></table></code></div></div><h2 id="set和存储顺序">Set和存储顺序</h2><ul><li>Set(interface)：存入<code class="language-plaintext highlighter-rouge">Set</code>的每个元素都必须是唯一的，因为<code class="language-plaintext highlighter-rouge">Set</code>不保存重复元素，加入<code class="language-plaintext highlighter-rouge">Set</code>的元素必须定义<code class="language-plaintext highlighter-rouge">equals()</code>方法以确保对象的唯一性。<code class="language-plaintext highlighter-rouge">Set</code>与<code class="language-plaintext highlighter-rouge">Collection</code>有完全一样的接口。<code class="language-plaintext highlighter-rouge">Set</code>接口不保证维护元素的次序。<li>HashSet：为快速查找而设计的<code class="language-plaintext highlighter-rouge">Set</code>，存入<code class="language-plaintext highlighter-rouge">HashSet</code>的元素必须定义<code class="language-plaintext highlighter-rouge">hasCode()</code>。<li>TreeSet：保持次序的Set，底层为树结构，使用它可以从<code class="language-plaintext highlighter-rouge">Set</code>中提取有序的序列，元素必须实现<code class="language-plaintext highlighter-rouge">Comparable</code>接口。<li>LinkedHashSet：具有<code class="language-plaintext highlighter-rouge">HashSet</code>的查询速度，且内部使用链表维护元素的顺序。于是在使用迭代器遍历<code class="language-plaintext highlighter-rouge">Set</code>时，结果会按元素插入的次序显示，元素也必须定义<code class="language-plaintext highlighter-rouge">hashCode()</code>方法。</ul><p>你必须为散列存储和树型存储都创建一个<code class="language-plaintext highlighter-rouge">equals()</code>方法。但是<code class="language-plaintext highlighter-rouge">hashCode()</code>只有在这个类将会被置于<code class="language-plaintext highlighter-rouge">HashSet</code>或者<code class="language-plaintext highlighter-rouge">LinkedHashSet</code>中时才是必须的。</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
</pre><td class="rouge-code"><pre><span class="c1">//: containers/TypesForSets.java</span>
<span class="c1">// Methods necessary to put your own type in a Set.</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">class</span> <span class="nc">SetType</span> <span class="o">{</span>
  <span class="kt">int</span> <span class="n">i</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">SetType</span><span class="o">(</span><span class="kt">int</span> <span class="n">n</span><span class="o">)</span> <span class="o">{</span> <span class="n">i</span> <span class="o">=</span> <span class="n">n</span><span class="o">;</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="nc">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">o</span> <span class="k">instanceof</span> <span class="nc">SetType</span> <span class="o">&amp;&amp;</span> <span class="o">(</span><span class="n">i</span> <span class="o">==</span> <span class="o">((</span><span class="nc">SetType</span><span class="o">)</span><span class="n">o</span><span class="o">).</span><span class="na">i</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="nc">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="nc">Integer</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">i</span><span class="o">);</span> <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">HashType</span> <span class="kd">extends</span> <span class="nc">SetType</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="nf">HashType</span><span class="o">(</span><span class="kt">int</span> <span class="n">n</span><span class="o">)</span> <span class="o">{</span> <span class="kd">super</span><span class="o">(</span><span class="n">n</span><span class="o">);</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">i</span><span class="o">;</span> <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">TreeType</span> <span class="kd">extends</span> <span class="nc">SetType</span> <span class="kd">implements</span> <span class="nc">Comparable</span><span class="o">&lt;</span><span class="nc">TreeType</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="nf">TreeType</span><span class="o">(</span><span class="kt">int</span> <span class="n">n</span><span class="o">)</span> <span class="o">{</span> <span class="kd">super</span><span class="o">(</span><span class="n">n</span><span class="o">);</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">compareTo</span><span class="o">(</span><span class="nc">TreeType</span> <span class="n">arg</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="o">(</span><span class="n">arg</span><span class="o">.</span><span class="na">i</span> <span class="o">&lt;</span> <span class="n">i</span> <span class="o">?</span> <span class="o">-</span><span class="mi">1</span> <span class="o">:</span> <span class="o">(</span><span class="n">arg</span><span class="o">.</span><span class="na">i</span> <span class="o">==</span> <span class="n">i</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="mi">1</span><span class="o">));</span><span class="c1">//倒序</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TypesForSets</span> <span class="o">{</span>
  <span class="kd">static</span> <span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="nc">Set</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="nf">fill</span><span class="o">(</span><span class="nc">Set</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">set</span><span class="o">,</span> <span class="nc">Class</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">type</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span>
          <span class="n">set</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">type</span><span class="o">.</span><span class="na">getConstructor</span><span class="o">(</span><span class="kt">int</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">newInstance</span><span class="o">(</span><span class="n">i</span><span class="o">));</span>
    <span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">set</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">static</span> <span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="kt">void</span> <span class="nf">test</span><span class="o">(</span><span class="nc">Set</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">set</span><span class="o">,</span> <span class="nc">Class</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">type</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">fill</span><span class="o">(</span><span class="n">set</span><span class="o">,</span> <span class="n">type</span><span class="o">);</span>
    <span class="n">fill</span><span class="o">(</span><span class="n">set</span><span class="o">,</span> <span class="n">type</span><span class="o">);</span> <span class="c1">// Try to add duplicates</span>
    <span class="n">fill</span><span class="o">(</span><span class="n">set</span><span class="o">,</span> <span class="n">type</span><span class="o">);</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">set</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">test</span><span class="o">(</span><span class="k">new</span> <span class="nc">HashSet</span><span class="o">&lt;</span><span class="nc">HashType</span><span class="o">&gt;(),</span> <span class="nc">HashType</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="n">test</span><span class="o">(</span><span class="k">new</span> <span class="nc">LinkedHashSet</span><span class="o">&lt;</span><span class="nc">HashType</span><span class="o">&gt;(),</span> <span class="nc">HashType</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="n">test</span><span class="o">(</span><span class="k">new</span> <span class="nc">TreeSet</span><span class="o">&lt;</span><span class="nc">TreeType</span><span class="o">&gt;(),</span> <span class="nc">TreeType</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="c1">// Things that don't work:</span>
    <span class="n">test</span><span class="o">(</span><span class="k">new</span> <span class="nc">HashSet</span><span class="o">&lt;</span><span class="nc">SetType</span><span class="o">&gt;(),</span> <span class="nc">SetType</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="n">test</span><span class="o">(</span><span class="k">new</span> <span class="nc">HashSet</span><span class="o">&lt;</span><span class="nc">TreeType</span><span class="o">&gt;(),</span> <span class="nc">TreeType</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="n">test</span><span class="o">(</span><span class="k">new</span> <span class="nc">LinkedHashSet</span><span class="o">&lt;</span><span class="nc">SetType</span><span class="o">&gt;(),</span> <span class="nc">SetType</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="n">test</span><span class="o">(</span><span class="k">new</span> <span class="nc">LinkedHashSet</span><span class="o">&lt;</span><span class="nc">TreeType</span><span class="o">&gt;(),</span> <span class="nc">TreeType</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">test</span><span class="o">(</span><span class="k">new</span> <span class="nc">TreeSet</span><span class="o">&lt;</span><span class="nc">SetType</span><span class="o">&gt;(),</span> <span class="nc">SetType</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
    <span class="o">}</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">test</span><span class="o">(</span><span class="k">new</span> <span class="nc">TreeSet</span><span class="o">&lt;</span><span class="nc">HashType</span><span class="o">&gt;(),</span> <span class="nc">HashType</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output: (Sample)
[2, 4, 9, 8, 6, 1, 3, 7, 5, 0]
[0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
[9, 8, 7, 6, 5, 4, 3, 2, 1, 0]
[9, 9, 7, 5, 1, 2, 6, 3, 0, 7, 2, 4, 4, 7, 9, 1, 3, 6, 2, 4, 3, 0, 5, 0, 8, 8, 8, 6, 5, 1]//存储在HashSet的SetType
[0, 5, 5, 6, 5, 0, 3, 1, 9, 8, 4, 2, 3, 9, 7, 3, 4, 4, 0, 7, 1, 9, 6, 2, 1, 8, 2, 8, 6, 7]//存储在HashSet的TreeType
[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
java.lang.ClassCastException: SetType cannot be cast to java.lang.Comparable
java.lang.ClassCastException: HashType cannot be cast to java.lang.Comparable
*/</span><span class="c1">//:~</span>
</pre></table></code></div></div><p>对于没有重新定义<code class="language-plaintext highlighter-rouge">hashCode()</code>方法的<code class="language-plaintext highlighter-rouge">SetType</code>或<code class="language-plaintext highlighter-rouge">TreeType</code>，如果将它们放置到任何散列实现中都会产生重复值，这样就违反了<code class="language-plaintext highlighter-rouge">Set</code>的基本契约。如果尝试着在<code class="language-plaintext highlighter-rouge">TreeSet</code>中使用没有实现<code class="language-plaintext highlighter-rouge">Comparable</code>的类型，将会抛出一个异常。</p><h3 id="sortedset">SortedSet</h3><ul><li>Object first()：返回容器中的第一个元素<li>Object last()：返回容器中的最末一个元素<li>Sorted subSet(fromElement,toElement)：生成此<code class="language-plaintext highlighter-rouge">Set</code>的子集，范围从<code class="language-plaintext highlighter-rouge">fromElement</code>（包含）到<code class="language-plaintext highlighter-rouge">toElement</code>（不包含）。<li>Sorted headSet(toElement)：生成此<code class="language-plaintext highlighter-rouge">Set</code>的子集，由小于<code class="language-plaintext highlighter-rouge">toElement</code>的元素组成。<li>Sorted tailSet(fromElement)：生成此<code class="language-plaintext highlighter-rouge">Set</code>的子集，由大于或等于<code class="language-plaintext highlighter-rouge">fromElement</code>的元素组成。</ul><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
</pre><td class="rouge-code"><pre><span class="c1">//: containers/SortedSetDemo.java</span>
<span class="c1">// What you can do with a TreeSet.</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">net</span><span class="o">.</span><span class="na">mindview</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">Print</span><span class="o">.*;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SortedSetDemo</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">SortedSet</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">sortedSet</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">TreeSet</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;();</span>
    <span class="nc">Collections</span><span class="o">.</span><span class="na">addAll</span><span class="o">(</span><span class="n">sortedSet</span><span class="o">,</span>
      <span class="s">"one two three four five six seven eight"</span>
        <span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">" "</span><span class="o">));</span>
    <span class="n">print</span><span class="o">(</span><span class="n">sortedSet</span><span class="o">);</span>
    <span class="nc">String</span> <span class="n">low</span> <span class="o">=</span> <span class="n">sortedSet</span><span class="o">.</span><span class="na">first</span><span class="o">();</span>
    <span class="nc">String</span> <span class="n">high</span> <span class="o">=</span> <span class="n">sortedSet</span><span class="o">.</span><span class="na">last</span><span class="o">();</span>
    <span class="n">print</span><span class="o">(</span><span class="n">low</span><span class="o">);</span>
    <span class="n">print</span><span class="o">(</span><span class="n">high</span><span class="o">);</span>
    <span class="nc">Iterator</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">it</span> <span class="o">=</span> <span class="n">sortedSet</span><span class="o">.</span><span class="na">iterator</span><span class="o">();</span>
    <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">6</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
      <span class="k">if</span><span class="o">(</span><span class="n">i</span> <span class="o">==</span> <span class="mi">3</span><span class="o">)</span> <span class="n">low</span> <span class="o">=</span> <span class="n">it</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
      <span class="k">if</span><span class="o">(</span><span class="n">i</span> <span class="o">==</span> <span class="mi">6</span><span class="o">)</span> <span class="n">high</span> <span class="o">=</span> <span class="n">it</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
      <span class="k">else</span> <span class="n">it</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="n">print</span><span class="o">(</span><span class="n">low</span><span class="o">);</span>
    <span class="n">print</span><span class="o">(</span><span class="n">high</span><span class="o">);</span>
    <span class="n">print</span><span class="o">(</span><span class="n">sortedSet</span><span class="o">.</span><span class="na">subSet</span><span class="o">(</span><span class="n">low</span><span class="o">,</span> <span class="n">high</span><span class="o">));</span>
    <span class="n">print</span><span class="o">(</span><span class="n">sortedSet</span><span class="o">.</span><span class="na">headSet</span><span class="o">(</span><span class="n">high</span><span class="o">));</span>
    <span class="n">print</span><span class="o">(</span><span class="n">sortedSet</span><span class="o">.</span><span class="na">tailSet</span><span class="o">(</span><span class="n">low</span><span class="o">));</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output:
[eight, five, four, one, seven, six, three, two]
eight
two
one
two
[one, seven, six, three]
[eight, five, four, one, seven, six, three]
[one, seven, six, three, two]
*/</span><span class="c1">//:~</span>
</pre></table></code></div></div><h2 id="队列">队列</h2><div class="table-wrapper"><table><thead><tr><th>boolean add(E e);<th>add 方法是往队列里添加一个元素，如果队列满了，就会抛出异常来提示队列已满。<tbody><tr><td>boolean offer(E e);<td>offer 方法用来插入一个元素，并用返回值来提示插入是否成功。如果添加成功会返回 true，而如果队列已经满了，此时继续调用 offer 方法的话，它不会抛出异常。<tr><td>E remove();<td>remove 方法的作用是删除元素，如果我们删除的队列是空的，那么 remove 方法就会抛出异常。<tr><td>E poll();<td> <tr><td>E element();<td>element 方法是返回队列的头部节点，但是并不删除。队列是空的就会抛出异常。<tr><td>E peek();<td> </table></div><h3 id="添加">添加</h3><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="nc">BlockingQueue</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">queue</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayBlockingQueue</span><span class="o">&lt;&gt;(</span><span class="mi">2</span><span class="o">);</span>
<span class="n">queue</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
<span class="n">queue</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span>
<span class="c1">//queue.add(3); // Queue full</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">queue</span><span class="o">);</span><span class="c1">//[1, 2]</span>
</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="nc">BlockingQueue</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">queue</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayBlockingQueue</span><span class="o">&lt;&gt;(</span><span class="mi">2</span><span class="o">);</span>
<span class="n">queue</span><span class="o">.</span><span class="na">offer</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">queue</span><span class="o">.</span><span class="na">offer</span><span class="o">(</span><span class="mi">2</span><span class="o">));</span><span class="c1">//true</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">queue</span><span class="o">.</span><span class="na">offer</span><span class="o">(</span><span class="mi">3</span><span class="o">));</span><span class="c1">//false</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">queue</span><span class="o">);</span>
</pre></table></code></div></div><p>除了优先级队列，<code class="language-plaintext highlighter-rouge">Queue</code>将精确地按照元素被置于<code class="language-plaintext highlighter-rouge">Queue</code>中的顺序产生它们。</p><h3 id="优先级队列">优先级队列</h3><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
</pre><td class="rouge-code"><pre><span class="c1">//: containers/ToDoList.java</span>
<span class="c1">// A more complex use of PriorityQueue.</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">class</span> <span class="nc">ToDoList</span> <span class="kd">extends</span> <span class="nc">PriorityQueue</span><span class="o">&lt;</span><span class="nc">ToDoList</span><span class="o">.</span><span class="na">ToDoItem</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kd">static</span> <span class="kd">class</span> <span class="nc">ToDoItem</span> <span class="kd">implements</span> <span class="nc">Comparable</span><span class="o">&lt;</span><span class="nc">ToDoItem</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kt">char</span> <span class="n">primary</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">secondary</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">item</span><span class="o">;</span>
    <span class="kd">public</span> <span class="nf">ToDoItem</span><span class="o">(</span><span class="nc">String</span> <span class="n">td</span><span class="o">,</span> <span class="kt">char</span> <span class="n">pri</span><span class="o">,</span> <span class="kt">int</span> <span class="n">sec</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">primary</span> <span class="o">=</span> <span class="n">pri</span><span class="o">;</span>
      <span class="n">secondary</span> <span class="o">=</span> <span class="n">sec</span><span class="o">;</span>
      <span class="n">item</span> <span class="o">=</span> <span class="n">td</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">compareTo</span><span class="o">(</span><span class="nc">ToDoItem</span> <span class="n">arg</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">if</span><span class="o">(</span><span class="n">primary</span> <span class="o">&gt;</span> <span class="n">arg</span><span class="o">.</span><span class="na">primary</span><span class="o">)</span>
        <span class="k">return</span> <span class="o">+</span><span class="mi">1</span><span class="o">;</span>
      <span class="k">if</span><span class="o">(</span><span class="n">primary</span> <span class="o">==</span> <span class="n">arg</span><span class="o">.</span><span class="na">primary</span><span class="o">)</span>
        <span class="k">if</span><span class="o">(</span><span class="n">secondary</span> <span class="o">&gt;</span> <span class="n">arg</span><span class="o">.</span><span class="na">secondary</span><span class="o">)</span>
          <span class="k">return</span> <span class="o">+</span><span class="mi">1</span><span class="o">;</span>
        <span class="k">else</span> <span class="nf">if</span><span class="o">(</span><span class="n">secondary</span> <span class="o">==</span> <span class="n">arg</span><span class="o">.</span><span class="na">secondary</span><span class="o">)</span>
          <span class="k">return</span> <span class="mi">0</span><span class="o">;</span>
      <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
      <span class="k">return</span> <span class="nc">Character</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">primary</span><span class="o">)</span> <span class="o">+</span>
        <span class="n">secondary</span> <span class="o">+</span> <span class="s">": "</span> <span class="o">+</span> <span class="n">item</span><span class="o">;</span>
    <span class="o">}</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="nc">String</span> <span class="n">td</span><span class="o">,</span> <span class="kt">char</span> <span class="n">pri</span><span class="o">,</span> <span class="kt">int</span> <span class="n">sec</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nc">ToDoItem</span><span class="o">(</span><span class="n">td</span><span class="o">,</span> <span class="n">pri</span><span class="o">,</span> <span class="n">sec</span><span class="o">));</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">ToDoList</span> <span class="n">toDoList</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ToDoList</span><span class="o">();</span>
    <span class="n">toDoList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"Empty trash"</span><span class="o">,</span> <span class="sc">'C'</span><span class="o">,</span> <span class="mi">4</span><span class="o">);</span>
    <span class="n">toDoList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"Feed dog"</span><span class="o">,</span> <span class="sc">'A'</span><span class="o">,</span> <span class="mi">2</span><span class="o">);</span>
    <span class="n">toDoList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"Feed bird"</span><span class="o">,</span> <span class="sc">'B'</span><span class="o">,</span> <span class="mi">7</span><span class="o">);</span>
    <span class="n">toDoList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"Mow lawn"</span><span class="o">,</span> <span class="sc">'C'</span><span class="o">,</span> <span class="mi">3</span><span class="o">);</span>
    <span class="n">toDoList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"Water lawn"</span><span class="o">,</span> <span class="sc">'A'</span><span class="o">,</span> <span class="mi">1</span><span class="o">);</span>
    <span class="n">toDoList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"Feed cat"</span><span class="o">,</span> <span class="sc">'B'</span><span class="o">,</span> <span class="mi">1</span><span class="o">);</span>
    <span class="k">while</span><span class="o">(!</span><span class="n">toDoList</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">toDoList</span><span class="o">.</span><span class="na">remove</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output:
A1: Water lawn
A2: Feed dog
B1: Feed cat
B7: Feed bird
C3: Mow lawn
C4: Empty trash
*/</span><span class="c1">//:~</span>
</pre></table></code></div></div><h3 id="双向队列">双向队列</h3><p>在<code class="language-plaintext highlighter-rouge">LinkedList</code>中包含支持双向队列的方法。</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="nc">LinkedList</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">deque</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">LinkedList</span><span class="o">&lt;&gt;();</span>
<span class="n">deque</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
<span class="n">deque</span><span class="o">.</span><span class="na">addLast</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span>
<span class="n">deque</span><span class="o">.</span><span class="na">addFirst</span><span class="o">(</span><span class="mi">3</span><span class="o">);</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">deque</span><span class="o">);</span> <span class="c1">//[3, 1, 2]</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">deque</span><span class="o">.</span><span class="na">peek</span><span class="o">());</span><span class="c1">//3</span>
<span class="n">deque</span><span class="o">.</span><span class="na">remove</span><span class="o">();</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">deque</span><span class="o">);</span> <span class="c1">//[1, 2]</span>
<span class="n">deque</span><span class="o">.</span><span class="na">removeLast</span><span class="o">();</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">deque</span><span class="o">);</span><span class="c1">//[1]</span>
</pre></table></code></div></div><h2 id="map">Map</h2><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://i.imgur.com/iwoHbui.png" alt="Imgur" /></p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
</pre><td class="rouge-code"><pre><span class="c1">//: containers/AssociativeArray.java</span>
<span class="c1">// Associates keys with values.</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">net</span><span class="o">.</span><span class="na">mindview</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">Print</span><span class="o">.*;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AssociativeArray</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="nc">Object</span><span class="o">[][]</span> <span class="n">pairs</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">index</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">AssociativeArray</span><span class="o">(</span><span class="kt">int</span> <span class="n">length</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">pairs</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Object</span><span class="o">[</span><span class="n">length</span><span class="o">][</span><span class="mi">2</span><span class="o">];</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">put</span><span class="o">(</span><span class="no">K</span> <span class="n">key</span><span class="o">,</span> <span class="no">V</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span><span class="o">(</span><span class="n">index</span> <span class="o">&gt;=</span> <span class="n">pairs</span><span class="o">.</span><span class="na">length</span><span class="o">)</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nf">ArrayIndexOutOfBoundsException</span><span class="o">();</span>
    <span class="n">pairs</span><span class="o">[</span><span class="n">index</span><span class="o">++]</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Object</span><span class="o">[]{</span> <span class="n">key</span><span class="o">,</span> <span class="n">value</span> <span class="o">};</span>
  <span class="o">}</span>
  <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"unchecked"</span><span class="o">)</span>
  <span class="kd">public</span> <span class="no">V</span> <span class="nf">get</span><span class="o">(</span><span class="no">K</span> <span class="n">key</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">index</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span>
      <span class="k">if</span><span class="o">(</span><span class="n">key</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">pairs</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="mi">0</span><span class="o">]))</span>
        <span class="k">return</span> <span class="o">(</span><span class="no">V</span><span class="o">)</span><span class="n">pairs</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="mi">1</span><span class="o">];</span>
    <span class="k">return</span> <span class="kc">null</span><span class="o">;</span> <span class="c1">// Did not find key</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="nc">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
    <span class="nc">StringBuilder</span> <span class="n">result</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StringBuilder</span><span class="o">();</span>
    <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">index</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
      <span class="n">result</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">pairs</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="mi">0</span><span class="o">].</span><span class="na">toString</span><span class="o">());</span>
      <span class="n">result</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">" : "</span><span class="o">);</span>
      <span class="n">result</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">pairs</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="mi">1</span><span class="o">].</span><span class="na">toString</span><span class="o">());</span>
      <span class="k">if</span><span class="o">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">index</span> <span class="o">-</span> <span class="mi">1</span><span class="o">)</span>
        <span class="n">result</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">"\n"</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">AssociativeArray</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">map</span> <span class="o">=</span>
      <span class="k">new</span> <span class="nc">AssociativeArray</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">String</span><span class="o">&gt;(</span><span class="mi">6</span><span class="o">);</span>
    <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"sky"</span><span class="o">,</span> <span class="s">"blue"</span><span class="o">);</span>
    <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"grass"</span><span class="o">,</span> <span class="s">"green"</span><span class="o">);</span>
    <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"ocean"</span><span class="o">,</span> <span class="s">"dancing"</span><span class="o">);</span>
    <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"tree"</span><span class="o">,</span> <span class="s">"tall"</span><span class="o">);</span>
    <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"earth"</span><span class="o">,</span> <span class="s">"brown"</span><span class="o">);</span>
    <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"sun"</span><span class="o">,</span> <span class="s">"warm"</span><span class="o">);</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"extra"</span><span class="o">,</span> <span class="s">"object"</span><span class="o">);</span> <span class="c1">// Past the end</span>
    <span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="nc">ArrayIndexOutOfBoundsException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">print</span><span class="o">(</span><span class="s">"Too many objects!"</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="n">print</span><span class="o">(</span><span class="n">map</span><span class="o">);</span>
    <span class="n">print</span><span class="o">(</span><span class="n">map</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"ocean"</span><span class="o">));</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output:
Too many objects!
sky : blue
grass : green
ocean : dancing
tree : tall
earth : brown
sun : warm
dancing
*/</span><span class="c1">//:~</span>
</pre></table></code></div></div><h3 id="性能">性能</h3><ul><li>HashMap：<code class="language-plaintext highlighter-rouge">Map</code>基于散列表的实现（它取代了Hashtable），插入和查询键值对的开销是固定的。可以通过构造器设置<code class="language-plaintext highlighter-rouge">容量</code>和<code class="language-plaintext highlighter-rouge">负载因子</code>，以调整容器的性能。<li>LinkedHashMap：类似于<code class="language-plaintext highlighter-rouge">HashMap</code>，但是迭代遍历的顺序是插入次序，或者是<strong>最近最少使用（LRU）</strong>的次序。只比<code class="language-plaintext highlighter-rouge">HashMap</code>慢一点，而在迭代访问时反而更快，因为它使用链表维护内部次序。<li>TreeMap：基于红黑树的实现。查看“键”或“键值对”时，它们会被排序（次序由Comparable或Comparator决定）。 <code class="language-plaintext highlighter-rouge">TreeMap</code>的特点在于，所得到的结果是经过排序的。<code class="language-plaintext highlighter-rouge">TreeMap</code>是唯一的带有<code class="language-plaintext highlighter-rouge">subMap()</code>方法的<code class="language-plaintext highlighter-rouge">Map</code>，它可以返回一个子树。<li>WeakHashMap：<code class="language-plaintext highlighter-rouge">弱键（weak key）</code>映射，允许释放映射所指向的对象，这是为解决某类特殊问题而设计的。如果映射之外没有引用指向某个“键”，则次“键”可以被垃圾收集器回收。<li>ConcurrentHashMap：一种线程安全的<code class="language-plaintext highlighter-rouge">Map</code>，它不涉及同步加锁。<li>IdentityHashMap：使用==替代<code class="language-plaintext highlighter-rouge">equals()</code>对“键”进行比较的散列映射。专为解决特殊问题而设计的。</ul><p>任何键都必须具有一个<code class="language-plaintext highlighter-rouge">equals()</code>方法；如果键被用于散列Map，那么它必须还具有恰当的<code class="language-plaintext highlighter-rouge">hashCode()</code>方法；如果键被用于<code class="language-plaintext highlighter-rouge">TreeMap</code>，那么它必须实现<code class="language-plaintext highlighter-rouge">Comparable</code>。</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
</pre><td class="rouge-code"><pre><span class="c1">//: containers/Maps.java</span>
<span class="c1">// Things you can do with Maps.</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">net.mindview.util.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">net</span><span class="o">.</span><span class="na">mindview</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">Print</span><span class="o">.*;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Maps</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">printKeys</span><span class="o">(</span><span class="nc">Map</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">,</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">map</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">printnb</span><span class="o">(</span><span class="s">"Size = "</span> <span class="o">+</span> <span class="n">map</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">+</span> <span class="s">", "</span><span class="o">);</span>
    <span class="n">printnb</span><span class="o">(</span><span class="s">"Keys: "</span><span class="o">);</span>
    <span class="n">print</span><span class="o">(</span><span class="n">map</span><span class="o">.</span><span class="na">keySet</span><span class="o">());</span> <span class="c1">// Produce a Set of the keys</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">test</span><span class="o">(</span><span class="nc">Map</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">,</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">map</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">print</span><span class="o">(</span><span class="n">map</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getSimpleName</span><span class="o">());</span>
    <span class="n">map</span><span class="o">.</span><span class="na">putAll</span><span class="o">(</span><span class="k">new</span> <span class="nc">CountingMapData</span><span class="o">(</span><span class="mi">25</span><span class="o">));</span>
    <span class="c1">// Map has 'Set' behavior for keys:</span>
    <span class="n">map</span><span class="o">.</span><span class="na">putAll</span><span class="o">(</span><span class="k">new</span> <span class="nc">CountingMapData</span><span class="o">(</span><span class="mi">25</span><span class="o">));</span>
    <span class="n">printKeys</span><span class="o">(</span><span class="n">map</span><span class="o">);</span>
    <span class="c1">// Producing a Collection of the values:</span>
    <span class="n">printnb</span><span class="o">(</span><span class="s">"Values: "</span><span class="o">);</span>
    <span class="n">print</span><span class="o">(</span><span class="n">map</span><span class="o">.</span><span class="na">values</span><span class="o">());</span>
    <span class="n">print</span><span class="o">(</span><span class="n">map</span><span class="o">);</span>
    <span class="n">print</span><span class="o">(</span><span class="s">"map.containsKey(11): "</span> <span class="o">+</span> <span class="n">map</span><span class="o">.</span><span class="na">containsKey</span><span class="o">(</span><span class="mi">11</span><span class="o">));</span>
    <span class="n">print</span><span class="o">(</span><span class="s">"map.get(11): "</span> <span class="o">+</span> <span class="n">map</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">11</span><span class="o">));</span>
    <span class="n">print</span><span class="o">(</span><span class="s">"map.containsValue(\"F0\"): "</span>
      <span class="o">+</span> <span class="n">map</span><span class="o">.</span><span class="na">containsValue</span><span class="o">(</span><span class="s">"F0"</span><span class="o">));</span>
    <span class="nc">Integer</span> <span class="n">key</span> <span class="o">=</span> <span class="n">map</span><span class="o">.</span><span class="na">keySet</span><span class="o">().</span><span class="na">iterator</span><span class="o">().</span><span class="na">next</span><span class="o">();</span>
    <span class="n">print</span><span class="o">(</span><span class="s">"First key in map: "</span> <span class="o">+</span> <span class="n">key</span><span class="o">);</span>
    <span class="n">map</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">key</span><span class="o">);</span>
    <span class="n">printKeys</span><span class="o">(</span><span class="n">map</span><span class="o">);</span>
    <span class="n">map</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>
    <span class="n">print</span><span class="o">(</span><span class="s">"map.isEmpty(): "</span> <span class="o">+</span> <span class="n">map</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">());</span>
    <span class="n">map</span><span class="o">.</span><span class="na">putAll</span><span class="o">(</span><span class="k">new</span> <span class="nc">CountingMapData</span><span class="o">(</span><span class="mi">25</span><span class="o">));</span>
    <span class="c1">// Operations on the Set change the Map:</span>
    <span class="n">map</span><span class="o">.</span><span class="na">keySet</span><span class="o">().</span><span class="na">removeAll</span><span class="o">(</span><span class="n">map</span><span class="o">.</span><span class="na">keySet</span><span class="o">());</span>
    <span class="n">print</span><span class="o">(</span><span class="s">"map.isEmpty(): "</span> <span class="o">+</span> <span class="n">map</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">());</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">test</span><span class="o">(</span><span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">,</span><span class="nc">String</span><span class="o">&gt;());</span>
    <span class="n">test</span><span class="o">(</span><span class="k">new</span> <span class="nc">TreeMap</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">,</span><span class="nc">String</span><span class="o">&gt;());</span>
    <span class="n">test</span><span class="o">(</span><span class="k">new</span> <span class="nc">LinkedHashMap</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">,</span><span class="nc">String</span><span class="o">&gt;());</span>
    <span class="n">test</span><span class="o">(</span><span class="k">new</span> <span class="nc">IdentityHashMap</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">,</span><span class="nc">String</span><span class="o">&gt;());</span>
    <span class="n">test</span><span class="o">(</span><span class="k">new</span> <span class="nc">ConcurrentHashMap</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">,</span><span class="nc">String</span><span class="o">&gt;());</span>
    <span class="n">test</span><span class="o">(</span><span class="k">new</span> <span class="nc">WeakHashMap</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">,</span><span class="nc">String</span><span class="o">&gt;());</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output:
HashMap
Size = 25, Keys: [15, 8, 23, 16, 7, 22, 9, 21, 6, 1, 14, 24, 4, 19, 11, 18, 3, 12, 17, 2, 13, 20, 10, 5, 0]
Values: [P0, I0, X0, Q0, H0, W0, J0, V0, G0, B0, O0, Y0, E0, T0, L0, S0, D0, M0, R0, C0, N0, U0, K0, F0, A0]
{15=P0, 8=I0, 23=X0, 16=Q0, 7=H0, 22=W0, 9=J0, 21=V0, 6=G0, 1=B0, 14=O0, 24=Y0, 4=E0, 19=T0, 11=L0, 18=S0, 3=D0, 12=M0, 17=R0, 2=C0, 13=N0, 20=U0, 10=K0, 5=F0, 0=A0}
map.containsKey(11): true
map.get(11): L0
map.containsValue("F0"): true
First key in map: 15
Size = 24, Keys: [8, 23, 16, 7, 22, 9, 21, 6, 1, 14, 24, 4, 19, 11, 18, 3, 12, 17, 2, 13, 20, 10, 5, 0]
map.isEmpty(): true
map.isEmpty(): true
...
*/</span><span class="c1">//:~</span>
</pre></table></code></div></div><h3 id="sortedmap">SortedMap</h3><p>使用<code class="language-plaintext highlighter-rouge">SortedMap</code>，可以确保键处于排序状态。</p><ul><li>Comparator comparator()：返回当前<code class="language-plaintext highlighter-rouge">Map</code>使用的<code class="language-plaintext highlighter-rouge">Comparator</code>；或者返回 <code class="language-plaintext highlighter-rouge">null</code>，表示以自然方式排序。<li>T firstKey()：返回Map中的第一个键。<li>T lastKey()：返回Map中最末一个键。<li>SortedMap subMap(fromKey,toKey)：生成此Map的子集，范围由<code class="language-plaintext highlighter-rouge">fromKey</code>到<code class="language-plaintext highlighter-rouge">toKey</code>的键确定。<li>SortedMap headMap(toKey)：由键小于<code class="language-plaintext highlighter-rouge">toKey</code>的所有键值对组成。<li>SortedMap tailMap(fromKey)：由键大于或等于<code class="language-plaintext highlighter-rouge">fromKey</code>的所有键值对组成。</ul><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
</pre><td class="rouge-code"><pre><span class="c1">//: containers/SortedMapDemo.java</span>
<span class="c1">// What you can do with a TreeMap.</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">net.mindview.util.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">net</span><span class="o">.</span><span class="na">mindview</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">Print</span><span class="o">.*;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SortedMapDemo</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">TreeMap</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">,</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">sortedMap</span> <span class="o">=</span>
      <span class="k">new</span> <span class="nc">TreeMap</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">,</span><span class="nc">String</span><span class="o">&gt;(</span><span class="k">new</span> <span class="nc">CountingMapData</span><span class="o">(</span><span class="mi">10</span><span class="o">));</span>
    <span class="n">print</span><span class="o">(</span><span class="n">sortedMap</span><span class="o">);</span>
    <span class="nc">Integer</span> <span class="n">low</span> <span class="o">=</span> <span class="n">sortedMap</span><span class="o">.</span><span class="na">firstKey</span><span class="o">();</span>
    <span class="nc">Integer</span> <span class="n">high</span> <span class="o">=</span> <span class="n">sortedMap</span><span class="o">.</span><span class="na">lastKey</span><span class="o">();</span>
    <span class="n">print</span><span class="o">(</span><span class="n">low</span><span class="o">);</span>
    <span class="n">print</span><span class="o">(</span><span class="n">high</span><span class="o">);</span>
    <span class="nc">Iterator</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">it</span> <span class="o">=</span> <span class="n">sortedMap</span><span class="o">.</span><span class="na">keySet</span><span class="o">().</span><span class="na">iterator</span><span class="o">();</span>
    <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">6</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
      <span class="k">if</span><span class="o">(</span><span class="n">i</span> <span class="o">==</span> <span class="mi">3</span><span class="o">)</span> <span class="n">low</span> <span class="o">=</span> <span class="n">it</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
      <span class="k">if</span><span class="o">(</span><span class="n">i</span> <span class="o">==</span> <span class="mi">6</span><span class="o">)</span> <span class="n">high</span> <span class="o">=</span> <span class="n">it</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
      <span class="k">else</span> <span class="n">it</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="n">print</span><span class="o">(</span><span class="n">low</span><span class="o">);</span>
    <span class="n">print</span><span class="o">(</span><span class="n">high</span><span class="o">);</span>
    <span class="n">print</span><span class="o">(</span><span class="n">sortedMap</span><span class="o">.</span><span class="na">subMap</span><span class="o">(</span><span class="n">low</span><span class="o">,</span> <span class="n">high</span><span class="o">));</span>
    <span class="n">print</span><span class="o">(</span><span class="n">sortedMap</span><span class="o">.</span><span class="na">headMap</span><span class="o">(</span><span class="n">high</span><span class="o">));</span>
    <span class="n">print</span><span class="o">(</span><span class="n">sortedMap</span><span class="o">.</span><span class="na">tailMap</span><span class="o">(</span><span class="n">low</span><span class="o">));</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output:
{0=A0, 1=B0, 2=C0, 3=D0, 4=E0, 5=F0, 6=G0, 7=H0, 8=I0, 9=J0}
0
9
3
7
{3=D0, 4=E0, 5=F0, 6=G0}
{0=A0, 1=B0, 2=C0, 3=D0, 4=E0, 5=F0, 6=G0}
{3=D0, 4=E0, 5=F0, 6=G0, 7=H0, 8=I0, 9=J0}
*/</span><span class="c1">//:~</span>
</pre></table></code></div></div><h3 id="linkedhashmap">LinkedHashMap</h3><p><code class="language-plaintext highlighter-rouge">LinkedHashMap</code>散列化所有的元素，但是在遍历键值对时，却又以元素的插入顺序返回键值对。此外，可以在构造器中设定<code class="language-plaintext highlighter-rouge">LinkedHashMap</code>，使之采用基于访问的<code class="language-plaintext highlighter-rouge">最近最少使用（LRU）</code>算法，于是没有被访问过的元素就会出现在队列的前面。</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre><td class="rouge-code"><pre><span class="c1">//: containers/LinkedHashMapDemo.java</span>
<span class="c1">// What you can do with a LinkedHashMap.</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">net.mindview.util.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">net</span><span class="o">.</span><span class="na">mindview</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">Print</span><span class="o">.*;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">LinkedHashMapDemo</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">LinkedHashMap</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">,</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">linkedMap</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">LinkedHashMap</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">,</span><span class="nc">String</span><span class="o">&gt;(</span><span class="k">new</span> <span class="nc">CountingMapData</span><span class="o">(</span><span class="mi">9</span><span class="o">));</span>
    <span class="n">print</span><span class="o">(</span><span class="n">linkedMap</span><span class="o">);</span>
    <span class="c1">// Least-recently-used order:</span>
    <span class="n">linkedMap</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">LinkedHashMap</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">,</span><span class="nc">String</span><span class="o">&gt;(</span><span class="mi">16</span><span class="o">,</span> <span class="mf">0.75f</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span><span class="c1">//</span>
    <span class="n">linkedMap</span><span class="o">.</span><span class="na">putAll</span><span class="o">(</span><span class="k">new</span> <span class="nc">CountingMapData</span><span class="o">(</span><span class="mi">9</span><span class="o">));</span>
    <span class="n">print</span><span class="o">(</span><span class="n">linkedMap</span><span class="o">);</span>
    <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="c1">// Cause accesses:</span>
      <span class="n">linkedMap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
    <span class="n">print</span><span class="o">(</span><span class="n">linkedMap</span><span class="o">);</span>
    <span class="n">linkedMap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
    <span class="n">print</span><span class="o">(</span><span class="n">linkedMap</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output:
{0=A0, 1=B0, 2=C0, 3=D0, 4=E0, 5=F0, 6=G0, 7=H0, 8=I0}
{0=A0, 1=B0, 2=C0, 3=D0, 4=E0, 5=F0, 6=G0, 7=H0, 8=I0}
{6=G0, 7=H0, 8=I0, 0=A0, 1=B0, 2=C0, 3=D0, 4=E0, 5=F0}
{6=G0, 7=H0, 8=I0, 1=B0, 2=C0, 3=D0, 4=E0, 5=F0, 0=A0}
*/</span><span class="c1">//:~</span>
</pre></table></code></div></div><h2 id="散列和散列码">散列和散列码</h2><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
</pre><td class="rouge-code"><pre><span class="c1">//: containers/Groundhog.java</span>
<span class="c1">// Looks plausible, but doesn't work as a HashMap key.</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Groundhog</span> <span class="o">{</span>
  <span class="kd">protected</span> <span class="kt">int</span> <span class="n">number</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">Groundhog</span><span class="o">(</span><span class="kt">int</span> <span class="n">n</span><span class="o">)</span> <span class="o">{</span> <span class="n">number</span> <span class="o">=</span> <span class="n">n</span><span class="o">;</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="nc">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="s">"Groundhog #"</span> <span class="o">+</span> <span class="n">number</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~</span>


<span class="c1">//: containers/Prediction.java</span>
<span class="c1">// Predicting the weather with groundhogs.</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Prediction</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="nc">Random</span> <span class="n">rand</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Random</span><span class="o">(</span><span class="mi">47</span><span class="o">);</span>
  <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">shadow</span> <span class="o">=</span> <span class="n">rand</span><span class="o">.</span><span class="na">nextDouble</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nc">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">if</span><span class="o">(</span><span class="n">shadow</span><span class="o">)</span>
      <span class="k">return</span> <span class="s">"Six more weeks of Winter!"</span><span class="o">;</span>
    <span class="k">else</span>
      <span class="k">return</span> <span class="s">"Early Spring!"</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~</span>

<span class="c1">//: containers/SpringDetector.java</span>
<span class="c1">// What will the weather be?</span>
<span class="kn">import</span> <span class="nn">java.lang.reflect.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">net</span><span class="o">.</span><span class="na">mindview</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">Print</span><span class="o">.*;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SpringDetector</span> <span class="o">{</span>
  <span class="c1">// Uses a Groundhog or class derived from Groundhog:</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="no">T</span> <span class="kd">extends</span> <span class="nc">Groundhog</span><span class="o">&gt;</span>
  <span class="kt">void</span> <span class="nf">detectSpring</span><span class="o">(</span><span class="nc">Class</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">type</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
    <span class="nc">Constructor</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">ghog</span> <span class="o">=</span> <span class="n">type</span><span class="o">.</span><span class="na">getConstructor</span><span class="o">(</span><span class="kt">int</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">Groundhog</span><span class="o">,</span><span class="nc">Prediction</span><span class="o">&gt;</span> <span class="n">map</span> <span class="o">=</span>
      <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;</span><span class="nc">Groundhog</span><span class="o">,</span><span class="nc">Prediction</span><span class="o">&gt;();</span>
    <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span>
      <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">ghog</span><span class="o">.</span><span class="na">newInstance</span><span class="o">(</span><span class="n">i</span><span class="o">),</span> <span class="k">new</span> <span class="nc">Prediction</span><span class="o">());</span>
    <span class="n">print</span><span class="o">(</span><span class="s">"map = "</span> <span class="o">+</span> <span class="n">map</span><span class="o">);</span>
    <span class="nc">Groundhog</span> <span class="n">gh</span> <span class="o">=</span> <span class="n">ghog</span><span class="o">.</span><span class="na">newInstance</span><span class="o">(</span><span class="mi">3</span><span class="o">);</span>
    <span class="n">print</span><span class="o">(</span><span class="s">"Looking up prediction for "</span> <span class="o">+</span> <span class="n">gh</span><span class="o">);</span>
    <span class="k">if</span><span class="o">(</span><span class="n">map</span><span class="o">.</span><span class="na">containsKey</span><span class="o">(</span><span class="n">gh</span><span class="o">))</span>
      <span class="n">print</span><span class="o">(</span><span class="n">map</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">gh</span><span class="o">));</span>
    <span class="k">else</span>
      <span class="nf">print</span><span class="o">(</span><span class="s">"Key not found: "</span> <span class="o">+</span> <span class="n">gh</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
    <span class="n">detectSpring</span><span class="o">(</span><span class="nc">Groundhog</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output:
map = {Groundhog #3=Early Spring!, Groundhog #7=Early Spring!, Groundhog #5=Early Spring!, Groundhog #9=Six more weeks of Winter!, Groundhog #8=Six more weeks of Winter!, Groundhog #0=Six more weeks of Winter!, Groundhog #6=Early Spring!, Groundhog #4=Six more weeks of Winter!, Groundhog #1=Six more weeks of Winter!, Groundhog #2=Early Spring!}
Looking up prediction for Groundhog #3
Key not found: Groundhog #3
*/</span><span class="c1">//:~</span>
</pre></table></code></div></div><p>正确的<code class="language-plaintext highlighter-rouge">equals()</code>方法必须满足下列5个条件： 1. 自反性。对任意x，x.equals(x)一定返回<code class="language-plaintext highlighter-rouge">true</code>。 2. 对称性。对任意x和y，如果<code class="language-plaintext highlighter-rouge">y.equals(x)</code>返回<code class="language-plaintext highlighter-rouge">true</code>，则<code class="language-plaintext highlighter-rouge">x.equals(y)</code>也返回<code class="language-plaintext highlighter-rouge">true</code>。 3. 传递性。对任意x、y、z，如果有<code class="language-plaintext highlighter-rouge">x.equals(y)</code>返回<code class="language-plaintext highlighter-rouge">true</code>，则<code class="language-plaintext highlighter-rouge">x.equals(z)</code>一定返回<code class="language-plaintext highlighter-rouge">true</code>。 4. 一致性。对任意x和y，如果对象中用于等价比较的信息没有改变，那么无论调用<code class="language-plaintext highlighter-rouge">x.equals(y)</code>多少次，返回的结果应该保持一致，要么一直是<code class="language-plaintext highlighter-rouge">true</code>，要么一直是<code class="language-plaintext highlighter-rouge">false</code>。 5. 对任何不是<code class="language-plaintext highlighter-rouge">null</code>的x，<code class="language-plaintext highlighter-rouge">x.equals(null)</code>一定返回<code class="language-plaintext highlighter-rouge">false</code>。</p><p>同时重载<code class="language-plaintext highlighter-rouge">hashCode()</code>和<code class="language-plaintext highlighter-rouge">equals()</code>：</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre><span class="c1">//: containers/Groundhog2.java</span>
<span class="c1">// A class that's used as a key in a HashMap</span>
<span class="c1">// must override hashCode() and equals().</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Groundhog2</span> <span class="kd">extends</span> <span class="nc">Groundhog</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="nf">Groundhog2</span><span class="o">(</span><span class="kt">int</span> <span class="n">n</span><span class="o">)</span> <span class="o">{</span> <span class="kd">super</span><span class="o">(</span><span class="n">n</span><span class="o">);</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">number</span><span class="o">;</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="nc">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">o</span> <span class="k">instanceof</span> <span class="nc">Groundhog2</span> <span class="o">&amp;&amp;</span>
      <span class="o">(</span><span class="n">number</span> <span class="o">==</span> <span class="o">((</span><span class="nc">Groundhog2</span><span class="o">)</span><span class="n">o</span><span class="o">).</span><span class="na">number</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~</span>

<span class="c1">//: containers/SpringDetector2.java</span>
<span class="c1">// A working key.</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SpringDetector2</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
    <span class="nc">SpringDetector</span><span class="o">.</span><span class="na">detectSpring</span><span class="o">(</span><span class="nc">Groundhog2</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output:
map = {Groundhog #2=Early Spring!, Groundhog #4=Six more weeks of Winter!, Groundhog #9=Six more weeks of Winter!, Groundhog #8=Six more weeks of Winter!, Groundhog #6=Early Spring!, Groundhog #1=Six more weeks of Winter!, Groundhog #3=Early Spring!, Groundhog #7=Early Spring!, Groundhog #5=Early Spring!, Groundhog #0=Six more weeks of Winter!}
Looking up prediction for Groundhog #3
Early Spring!
*/</span><span class="c1">//:~</span>
</pre></table></code></div></div><h3 id="理解hashcode">理解hashCode()</h3><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
</pre><td class="rouge-code"><pre><span class="c1">//: containers/SlowMap.java</span>
<span class="c1">// A Map implemented with ArrayLists.</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">net.mindview.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SlowMap</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="nc">AbstractMap</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="no">K</span><span class="o">&gt;</span> <span class="n">keys</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="no">K</span><span class="o">&gt;();</span>
  <span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="no">V</span><span class="o">&gt;</span> <span class="n">values</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="no">V</span><span class="o">&gt;();</span>
  <span class="kd">public</span> <span class="no">V</span> <span class="nf">put</span><span class="o">(</span><span class="no">K</span> <span class="n">key</span><span class="o">,</span> <span class="no">V</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
    <span class="no">V</span> <span class="n">oldValue</span> <span class="o">=</span> <span class="n">get</span><span class="o">(</span><span class="n">key</span><span class="o">);</span> <span class="c1">// The old value or null</span>
    <span class="k">if</span><span class="o">(!</span><span class="n">keys</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">key</span><span class="o">))</span> <span class="o">{</span>
      <span class="n">keys</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">key</span><span class="o">);</span>
      <span class="n">values</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">value</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">else</span>
      <span class="n">values</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">keys</span><span class="o">.</span><span class="na">indexOf</span><span class="o">(</span><span class="n">key</span><span class="o">),</span> <span class="n">value</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">oldValue</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="no">V</span> <span class="nf">get</span><span class="o">(</span><span class="nc">Object</span> <span class="n">key</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// key is type Object, not K</span>
    <span class="k">if</span><span class="o">(!</span><span class="n">keys</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">key</span><span class="o">))</span>
      <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
    <span class="k">return</span> <span class="n">values</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">keys</span><span class="o">.</span><span class="na">indexOf</span><span class="o">(</span><span class="n">key</span><span class="o">));</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;&gt;</span> <span class="nf">entrySet</span><span class="o">()</span> <span class="o">{</span>
    <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;&gt;</span> <span class="n">set</span><span class="o">=</span> <span class="k">new</span> <span class="nc">HashSet</span><span class="o">&lt;</span><span class="nc">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;&gt;();</span>
    <span class="nc">Iterator</span><span class="o">&lt;</span><span class="no">K</span><span class="o">&gt;</span> <span class="n">ki</span> <span class="o">=</span> <span class="n">keys</span><span class="o">.</span><span class="na">iterator</span><span class="o">();</span>
    <span class="nc">Iterator</span><span class="o">&lt;</span><span class="no">V</span><span class="o">&gt;</span> <span class="n">vi</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="na">iterator</span><span class="o">();</span>
    <span class="k">while</span><span class="o">(</span><span class="n">ki</span><span class="o">.</span><span class="na">hasNext</span><span class="o">())</span>
      <span class="n">set</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nc">MapEntry</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;(</span><span class="n">ki</span><span class="o">.</span><span class="na">next</span><span class="o">(),</span> <span class="n">vi</span><span class="o">.</span><span class="na">next</span><span class="o">()));</span>
    <span class="k">return</span> <span class="n">set</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">SlowMap</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">m</span><span class="o">=</span> <span class="k">new</span> <span class="nc">SlowMap</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">String</span><span class="o">&gt;();</span>
    <span class="n">m</span><span class="o">.</span><span class="na">putAll</span><span class="o">(</span><span class="nc">Countries</span><span class="o">.</span><span class="na">capitals</span><span class="o">(</span><span class="mi">15</span><span class="o">));</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">m</span><span class="o">);</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"BULGARIA"</span><span class="o">));</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">entrySet</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output:
{CAMEROON=Yaounde, CHAD=N'djamena, CONGO=Brazzaville, CAPE VERDE=Praia, ALGERIA=Algiers, COMOROS=Moroni, CENTRAL AFRICAN REPUBLIC=Bangui, BOTSWANA=Gaberone, BURUNDI=Bujumbura, BENIN=Porto-Novo, BULGARIA=Sofia, EGYPT=Cairo, ANGOLA=Luanda, BURKINA FASO=Ouagadougou, DJIBOUTI=Dijibouti}
Sofia
[CAMEROON=Yaounde, CHAD=N'djamena, CONGO=Brazzaville, CAPE VERDE=Praia, ALGERIA=Algiers, COMOROS=Moroni, CENTRAL AFRICAN REPUBLIC=Bangui, BOTSWANA=Gaberone, BURUNDI=Bujumbura, BENIN=Porto-Novo, BULGARIA=Sofia, EGYPT=Cairo, ANGOLA=Luanda, BURKINA FASO=Ouagadougou, DJIBOUTI=Dijibouti]
*/</span><span class="c1">//:~</span>
</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre><td class="rouge-code"><pre><span class="c1">//: containers/MapEntry.java</span>
<span class="c1">// A simple Map.Entry for sample Map implementations.</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MapEntry</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;</span> <span class="kd">implements</span> <span class="nc">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="no">K</span> <span class="n">key</span><span class="o">;</span>
  <span class="kd">private</span> <span class="no">V</span> <span class="n">value</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">MapEntry</span><span class="o">(</span><span class="no">K</span> <span class="n">key</span><span class="o">,</span> <span class="no">V</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">key</span> <span class="o">=</span> <span class="n">key</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="no">K</span> <span class="nf">getKey</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">key</span><span class="o">;</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="no">V</span> <span class="nf">getValue</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">value</span><span class="o">;</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="no">V</span> <span class="nf">setValue</span><span class="o">(</span><span class="no">V</span> <span class="n">v</span><span class="o">)</span> <span class="o">{</span>
    <span class="no">V</span> <span class="n">result</span> <span class="o">=</span> <span class="n">value</span><span class="o">;</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">v</span><span class="o">;</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="o">(</span><span class="n">key</span><span class="o">==</span><span class="kc">null</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="n">key</span><span class="o">.</span><span class="na">hashCode</span><span class="o">())</span> <span class="o">^</span>
      <span class="o">(</span><span class="n">value</span><span class="o">==</span><span class="kc">null</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="n">value</span><span class="o">.</span><span class="na">hashCode</span><span class="o">());</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="nc">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span><span class="o">(!(</span><span class="n">o</span> <span class="k">instanceof</span> <span class="nc">MapEntry</span><span class="o">))</span> <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
    <span class="nc">MapEntry</span> <span class="n">me</span> <span class="o">=</span> <span class="o">(</span><span class="nc">MapEntry</span><span class="o">)</span><span class="n">o</span><span class="o">;</span>
    <span class="k">return</span>
      <span class="o">(</span><span class="n">key</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span>
       <span class="n">me</span><span class="o">.</span><span class="na">getKey</span><span class="o">()</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">:</span> <span class="n">key</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">me</span><span class="o">.</span><span class="na">getKey</span><span class="o">()))</span> <span class="o">&amp;&amp;</span>
      <span class="o">(</span><span class="n">value</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span>
       <span class="n">me</span><span class="o">.</span><span class="na">getValue</span><span class="o">()==</span> <span class="kc">null</span> <span class="o">:</span> <span class="n">value</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">me</span><span class="o">.</span><span class="na">getValue</span><span class="o">()));</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="nc">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">key</span> <span class="o">+</span> <span class="s">"="</span> <span class="o">+</span> <span class="n">value</span><span class="o">;</span> <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~</span>
</pre></table></code></div></div><h3 id="为速度而散列">为速度而散列</h3><p>散列将键保存在某处，以便能够很快找到。存储一组元素最快的数据结构是数组，所以使用它来表示键的信息。数组并不保存键本来。而是通过键对象生成一个数字，将其作为数组的下标。这个数字就是散列码，由定义在<code class="language-plaintext highlighter-rouge">Object</code>中的，且可能由你的类覆盖的<code class="language-plaintext highlighter-rouge">hashCode()</code>方法生成。</p><p>为解决数组容量被固定的问题，不同的键可以产生相同的下标。也就是说，可能会有<code class="language-plaintext highlighter-rouge">冲突</code>。因此，数组多大就不重要了，任何键总能在数组中找到它的位置。</p><p>于是查询一个值的过程首先就是计算散列码，然后使用散列码查询数组。如果能够保证没有冲突，那可就有一个<code class="language-plaintext highlighter-rouge">完美的散列函数</code>，但是这种情况只是特例。通常，冲突由<code class="language-plaintext highlighter-rouge">外部链接处理</code>：数组并不直接保存值，而是保存值的<code class="language-plaintext highlighter-rouge">list</code>。然后对<code class="language-plaintext highlighter-rouge">list</code>中的值使用<code class="language-plaintext highlighter-rouge">equals()</code>方法进行线性的查询。这部分的查询自然比较慢，但是，如果散列函数好的话，数组的每个位置就只有较少的值。因此，不是查询整个<code class="language-plaintext highlighter-rouge">list</code>，而是快速地跳到数组的某个位置，只对很少的元素进行比较。这便是<code class="language-plaintext highlighter-rouge">HashMap</code>会如此快的原因。</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
</pre><td class="rouge-code"><pre><span class="c1">//: containers/SimpleHashMap.java</span>
<span class="c1">// A demonstration hashed Map.</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">net.mindview.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SimpleHashMap</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="nc">AbstractMap</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="c1">// Choose a prime number for the hash table</span>
  <span class="c1">// size, to achieve a uniform distribution:</span>
  <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="no">SIZE</span> <span class="o">=</span> <span class="mi">997</span><span class="o">;</span>
  <span class="c1">// You can't have a physical array of generics,</span>
  <span class="c1">// but you can upcast to one:</span>
  <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"unchecked"</span><span class="o">)</span>
  <span class="nc">LinkedList</span><span class="o">&lt;</span><span class="nc">MapEntry</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;&gt;[]</span> <span class="n">buckets</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">LinkedList</span><span class="o">[</span><span class="no">SIZE</span><span class="o">];</span>
  <span class="kd">public</span> <span class="no">V</span> <span class="nf">put</span><span class="o">(</span><span class="no">K</span> <span class="n">key</span><span class="o">,</span> <span class="no">V</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
    <span class="no">V</span> <span class="n">oldValue</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="kt">int</span> <span class="n">index</span> <span class="o">=</span> <span class="nc">Math</span><span class="o">.</span><span class="na">abs</span><span class="o">(</span><span class="n">key</span><span class="o">.</span><span class="na">hashCode</span><span class="o">())</span> <span class="o">%</span> <span class="no">SIZE</span><span class="o">;</span>
    <span class="k">if</span><span class="o">(</span><span class="n">buckets</span><span class="o">[</span><span class="n">index</span><span class="o">]</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span>
      <span class="n">buckets</span><span class="o">[</span><span class="n">index</span><span class="o">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">LinkedList</span><span class="o">&lt;</span><span class="nc">MapEntry</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;&gt;();</span>
    <span class="nc">LinkedList</span><span class="o">&lt;</span><span class="nc">MapEntry</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;&gt;</span> <span class="n">bucket</span> <span class="o">=</span> <span class="n">buckets</span><span class="o">[</span><span class="n">index</span><span class="o">];</span>
    <span class="nc">MapEntry</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;</span> <span class="n">pair</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MapEntry</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;(</span><span class="n">key</span><span class="o">,</span> <span class="n">value</span><span class="o">);</span>
    <span class="kt">boolean</span> <span class="n">found</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
    <span class="nc">ListIterator</span><span class="o">&lt;</span><span class="nc">MapEntry</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;&gt;</span> <span class="n">it</span> <span class="o">=</span> <span class="n">bucket</span><span class="o">.</span><span class="na">listIterator</span><span class="o">();</span>
    <span class="k">while</span><span class="o">(</span><span class="n">it</span><span class="o">.</span><span class="na">hasNext</span><span class="o">())</span> <span class="o">{</span>
      <span class="nc">MapEntry</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;</span> <span class="n">iPair</span> <span class="o">=</span> <span class="n">it</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
      <span class="k">if</span><span class="o">(</span><span class="n">iPair</span><span class="o">.</span><span class="na">getKey</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="n">key</span><span class="o">))</span> <span class="o">{</span>
        <span class="n">oldValue</span> <span class="o">=</span> <span class="n">iPair</span><span class="o">.</span><span class="na">getValue</span><span class="o">();</span>
        <span class="n">it</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">pair</span><span class="o">);</span> <span class="c1">// Replace old with new</span>
        <span class="n">found</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
        <span class="k">break</span><span class="o">;</span>
      <span class="o">}</span>
    <span class="o">}</span>
    <span class="k">if</span><span class="o">(!</span><span class="n">found</span><span class="o">)</span>
      <span class="n">buckets</span><span class="o">[</span><span class="n">index</span><span class="o">].</span><span class="na">add</span><span class="o">(</span><span class="n">pair</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">oldValue</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="no">V</span> <span class="nf">get</span><span class="o">(</span><span class="nc">Object</span> <span class="n">key</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">index</span> <span class="o">=</span> <span class="nc">Math</span><span class="o">.</span><span class="na">abs</span><span class="o">(</span><span class="n">key</span><span class="o">.</span><span class="na">hashCode</span><span class="o">())</span> <span class="o">%</span> <span class="no">SIZE</span><span class="o">;</span>
    <span class="k">if</span><span class="o">(</span><span class="n">buckets</span><span class="o">[</span><span class="n">index</span><span class="o">]</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
    <span class="k">for</span><span class="o">(</span><span class="nc">MapEntry</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;</span> <span class="n">iPair</span> <span class="o">:</span> <span class="n">buckets</span><span class="o">[</span><span class="n">index</span><span class="o">])</span>
      <span class="k">if</span><span class="o">(</span><span class="n">iPair</span><span class="o">.</span><span class="na">getKey</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="n">key</span><span class="o">))</span>
        <span class="k">return</span> <span class="n">iPair</span><span class="o">.</span><span class="na">getValue</span><span class="o">();</span>
    <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;&gt;</span> <span class="nf">entrySet</span><span class="o">()</span> <span class="o">{</span>
    <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;&gt;</span> <span class="n">set</span><span class="o">=</span> <span class="k">new</span> <span class="nc">HashSet</span><span class="o">&lt;</span><span class="nc">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;&gt;();</span>
    <span class="k">for</span><span class="o">(</span><span class="nc">LinkedList</span><span class="o">&lt;</span><span class="nc">MapEntry</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;&gt;</span> <span class="n">bucket</span> <span class="o">:</span> <span class="n">buckets</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">if</span><span class="o">(</span><span class="n">bucket</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="k">continue</span><span class="o">;</span>
      <span class="k">for</span><span class="o">(</span><span class="nc">MapEntry</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;</span> <span class="n">mpair</span> <span class="o">:</span> <span class="n">bucket</span><span class="o">)</span>
        <span class="n">set</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">mpair</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">set</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">SimpleHashMap</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">m</span> <span class="o">=</span>
      <span class="k">new</span> <span class="nc">SimpleHashMap</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">String</span><span class="o">&gt;();</span>
    <span class="n">m</span><span class="o">.</span><span class="na">putAll</span><span class="o">(</span><span class="nc">Countries</span><span class="o">.</span><span class="na">capitals</span><span class="o">(</span><span class="mi">25</span><span class="o">));</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">m</span><span class="o">);</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"ERITREA"</span><span class="o">));</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">entrySet</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output:
{CAMEROON=Yaounde, CONGO=Brazzaville, CHAD=N'djamena, COTE D'IVOIR (IVORY COAST)=Yamoussoukro, CENTRAL AFRICAN REPUBLIC=Bangui, GUINEA=Conakry, BOTSWANA=Gaberone, BISSAU=Bissau, EGYPT=Cairo, ANGOLA=Luanda, BURKINA FASO=Ouagadougou, ERITREA=Asmara, THE GAMBIA=Banjul, KENYA=Nairobi, GABON=Libreville, CAPE VERDE=Praia, ALGERIA=Algiers, COMOROS=Moroni, EQUATORIAL GUINEA=Malabo, BURUNDI=Bujumbura, BENIN=Porto-Novo, BULGARIA=Sofia, GHANA=Accra, DJIBOUTI=Dijibouti, ETHIOPIA=Addis Ababa}
Asmara
[CAMEROON=Yaounde, CONGO=Brazzaville, CHAD=N'djamena, COTE D'IVOIR (IVORY COAST)=Yamoussoukro, CENTRAL AFRICAN REPUBLIC=Bangui, GUINEA=Conakry, BOTSWANA=Gaberone, BISSAU=Bissau, EGYPT=Cairo, ANGOLA=Luanda, BURKINA FASO=Ouagadougou, ERITREA=Asmara, THE GAMBIA=Banjul, KENYA=Nairobi, GABON=Libreville, CAPE VERDE=Praia, ALGERIA=Algiers, COMOROS=Moroni, EQUATORIAL GUINEA=Malabo, BURUNDI=Bujumbura, BENIN=Porto-Novo, BULGARIA=Sofia, GHANA=Accra, DJIBOUTI=Dijibouti, ETHIOPIA=Addis Ababa]
*/</span><span class="c1">//:~</span>
</pre></table></code></div></div><p>由于散列表中“槽位”通常称为<code class="language-plaintext highlighter-rouge">桶位（bucket）</code>，因此我们将表示实际散列表的数组命名为<code class="language-plaintext highlighter-rouge">bucket</code>，为使散列分布均匀，桶的数量通常使用质数。注意，为了能够自动处理冲突，使用一个<code class="language-plaintext highlighter-rouge">LinkedList</code>的数组；每一个新的元素只是直接添加到list末尾的某个特定桶位中。</p><h3 id="覆盖hashcode">覆盖hashCode()</h3><p>首先，你无法控制<code class="language-plaintext highlighter-rouge">bucket</code>数组的下标值的产生。这个值依赖于具体的<code class="language-plaintext highlighter-rouge">HashMap</code>对象的容量，而容量的改变与容器的充满程度和负载因子有关。<code class="language-plaintext highlighter-rouge">hashCode()</code>生成的结果，经过处理后成为桶位的下标。</p><p>设计<code class="language-plaintext highlighter-rouge">hashCode()</code>时最重要的因素就是：无论何时，对同一个对象调用<code class="language-plaintext highlighter-rouge">hashCode()</code>都应该生成同样的值。如果将一个对象用<code class="language-plaintext highlighter-rouge">put()</code>添加进<code class="language-plaintext highlighter-rouge">HashMap</code>时产生一个<code class="language-plaintext highlighter-rouge">hashCode()</code>值，而用<code class="language-plaintext highlighter-rouge">get()</code>取出时却产生了另一个<code class="language-plaintext highlighter-rouge">hashCode</code>值，那么聚无法重新取得该对象了。所以，如果你的<code class="language-plaintext highlighter-rouge">hashCode()</code>方法依赖于对象中易变的数据，用户就要当心了，因为此数据变化时，<code class="language-plaintext highlighter-rouge">hashCode()</code>就会生成一个不同的散列码，相当于产生了一个不同的键。</p><p>此外，也不应该使<code class="language-plaintext highlighter-rouge">hashCode()</code>依赖于具有唯一性的对象信息，尤其是使用<code class="language-plaintext highlighter-rouge">this</code>的值，这只能产生很糟糕的<code class="language-plaintext highlighter-rouge">hashCode()</code>。因为这样无法生成一个新的键，使之与<code class="language-plaintext highlighter-rouge">put()</code>中原始的键值对中的键相同。</p><p>Effective Java 为怎样写出一份像样<code class="language-plaintext highlighter-rouge">hashCode()</code>给出了基本的指导： 1.给int变量result赋予某个非零值常量，例如17 2.为对象内每个有意义的域f（即每个可以做equals()操作的域）计算出一个int散列码c:</p><div class="table-wrapper"><table><thead><tr><th style="text-align: left">域类型<th style="text-align: left">计算<tbody><tr><td style="text-align: left">boolean<td style="text-align: left">c=(f?0:1)<tr><td style="text-align: left">byte、char、short或int<td style="text-align: left">c=(int)f<tr><td style="text-align: left">long<td style="text-align: left">c=(int)(f^f&gt;&gt;&gt;32)<tr><td style="text-align: left">float<td style="text-align: left">c=Float.floatToIntBits(f)<tr><td style="text-align: left">double<td style="text-align: left">long l= Double.doubleToLongBits();c=(int)(l^(l&gt;&gt;&gt;32))<tr><td style="text-align: left">Object,其equals()调用这个域的equals()<td style="text-align: left">c=f.hashCode()<tr><td style="text-align: left">数组<td style="text-align: left">对每个元素应用上述规则</table></div><p>3.合并计算得到的散列码</p><p>result = 37*result+c;</p><p>4.返回result. 5.检查hashCode()最后生成的结果，确保相同的对象有相同的散列码。</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
</pre><td class="rouge-code"><pre><span class="c1">//: containers/CountedString.java</span>
<span class="c1">// Creating a good hashCode().</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">net</span><span class="o">.</span><span class="na">mindview</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">Print</span><span class="o">.*;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CountedString</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">created</span> <span class="o">=</span>
    <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;();</span>
  <span class="kd">private</span> <span class="nc">String</span> <span class="n">s</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">id</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">CountedString</span><span class="o">(</span><span class="nc">String</span> <span class="n">str</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">str</span><span class="o">;</span>
    <span class="n">created</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">s</span><span class="o">);</span>
    <span class="c1">// id is the total number of instances</span>
    <span class="c1">// of this string in use by CountedString:</span>
    <span class="k">for</span><span class="o">(</span><span class="nc">String</span> <span class="n">s2</span> <span class="o">:</span> <span class="n">created</span><span class="o">)</span>
      <span class="k">if</span><span class="o">(</span><span class="n">s2</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">s</span><span class="o">))</span>
        <span class="n">id</span><span class="o">++;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="nc">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="s">"String: "</span> <span class="o">+</span> <span class="n">s</span> <span class="o">+</span> <span class="s">" id: "</span> <span class="o">+</span> <span class="n">id</span> <span class="o">+</span>
      <span class="s">" hashCode(): "</span> <span class="o">+</span> <span class="n">hashCode</span><span class="o">();</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// The very simple approach:</span>
    <span class="c1">// return s.hashCode() * id;</span>
    <span class="c1">// Using Joshua Bloch's recipe:</span>
    <span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="mi">17</span><span class="o">;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="mi">37</span> <span class="o">*</span> <span class="n">result</span> <span class="o">+</span> <span class="n">s</span><span class="o">.</span><span class="na">hashCode</span><span class="o">();</span>
    <span class="n">result</span> <span class="o">=</span> <span class="mi">37</span> <span class="o">*</span> <span class="n">result</span> <span class="o">+</span> <span class="n">id</span><span class="o">;</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="nc">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">o</span> <span class="k">instanceof</span> <span class="nc">CountedString</span> <span class="o">&amp;&amp;</span>
      <span class="n">s</span><span class="o">.</span><span class="na">equals</span><span class="o">(((</span><span class="nc">CountedString</span><span class="o">)</span><span class="n">o</span><span class="o">).</span><span class="na">s</span><span class="o">)</span> <span class="o">&amp;&amp;</span>
      <span class="n">id</span> <span class="o">==</span> <span class="o">((</span><span class="nc">CountedString</span><span class="o">)</span><span class="n">o</span><span class="o">).</span><span class="na">id</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">CountedString</span><span class="o">,</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">map</span> <span class="o">=</span>
      <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;</span><span class="nc">CountedString</span><span class="o">,</span><span class="nc">Integer</span><span class="o">&gt;();</span>
    <span class="nc">CountedString</span><span class="o">[]</span> <span class="n">cs</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">CountedString</span><span class="o">[</span><span class="mi">5</span><span class="o">];</span>
    <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">cs</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
      <span class="n">cs</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">CountedString</span><span class="o">(</span><span class="s">"hi"</span><span class="o">);</span>
      <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">cs</span><span class="o">[</span><span class="n">i</span><span class="o">],</span> <span class="n">i</span><span class="o">);</span> <span class="c1">// Autobox int -&gt; Integer</span>
    <span class="o">}</span>
    <span class="n">print</span><span class="o">(</span><span class="n">map</span><span class="o">);</span>
    <span class="k">for</span><span class="o">(</span><span class="nc">CountedString</span> <span class="n">cstring</span> <span class="o">:</span> <span class="n">cs</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">print</span><span class="o">(</span><span class="s">"Looking up "</span> <span class="o">+</span> <span class="n">cstring</span><span class="o">);</span>
      <span class="n">print</span><span class="o">(</span><span class="n">map</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">cstring</span><span class="o">));</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output: (Sample)
{String: hi id: 4 hashCode(): 146450=3, String: hi id: 1 hashCode(): 146447=0, String: hi id: 3 hashCode(): 146449=2, String: hi id: 5 hashCode(): 146451=4, String: hi id: 2 hashCode(): 146448=1}
Looking up String: hi id: 1 hashCode(): 146447
0
Looking up String: hi id: 2 hashCode(): 146448
1
Looking up String: hi id: 3 hashCode(): 146449
2
Looking up String: hi id: 4 hashCode(): 146450
3
Looking up String: hi id: 5 hashCode(): 146451
4
*/</span><span class="c1">//:~</span>
</pre></table></code></div></div><h2 id="10选择接口的不同实现">10.选择接口的不同实现</h2><h3 id="101-性能测试框架">10.1 性能测试框架</h3><h3 id="102-对list的选择">10.2 对List的选择</h3><h3 id="103-微基准测试的危险">10.3 微基准测试的危险</h3><h3 id="104-对set的选择">10.4 对Set的选择</h3><h3 id="105-对map的选择">10.5 对Map的选择</h3><h2 id="11实用方法">11.实用方法</h2><h3 id="111-list的排序和查询">11.1 List的排序和查询</h3><h3 id="112-设定collection或map为不可修改">11.2 设定Collection或Map为不可修改</h3><h3 id="113-collection或map的同步控制">11.3 Collection或Map的同步控制</h3><h2 id="12持有引用">12.持有引用</h2><h3 id="121-weakhashmap">12.1 WeakHashMap</h3><h2 id="13java1011的容器">13.Java1.0/1.1的容器</h2><h3 id="132-hashtable">13.2 Hashtable</h3><h3 id="133-stack">13.3 Stack</h3><h3 id="134-bitset">13.4 BitSet</h3></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/java/'>Java</a>, <a href='/categories/thinking-in-java/'>Thinking in Java</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/thinking-in-java/" class="post-tag no-text-decoration" >Thinking in Java</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=《Java编程思想》第17章容器深入研究 - malinkang&url=https://malinkang.cn/posts/thinking-in-java-containers-in-depth/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=《Java编程思想》第17章容器深入研究 - malinkang&u=https://malinkang.cn/posts/thinking-in-java-containers-in-depth/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=《Java编程思想》第17章容器深入研究 - malinkang&url=https://malinkang.cn/posts/thinking-in-java-containers-in-depth/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/dagger-guide/">Dagger使用指南</a><li><a href="/posts/understanding-the-jvm-runtime-data-areas/">《深入理解JVM》第2章Java内存区域与内存溢出异常</a><li><a href="/posts/understanding-the-jvm-garbage-collection/">《深入理解JVM》第3章垃圾收集器</a><li><a href="/posts/understanding-the-jvm-class-file-structure/">《深入理解JVM》第6章类文件结构</a><li><a href="/posts/understanding-the-jvm-class-loader/">《深入理解JVM》第7章虚拟机类加载机制</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/">源码分析</a> <a class="post-tag" href="/tags/thinking-in-java/">Thinking in Java</a> <a class="post-tag" href="/tags/android/">Android</a> <a class="post-tag" href="/tags/effective-java/">Effective Java</a> <a class="post-tag" href="/tags/kotlin/">Kotlin</a> <a class="post-tag" href="/tags/java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98/">Java并发编程实战</a> <a class="post-tag" href="/tags/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3jvm/">深入理解JVM</a> <a class="post-tag" href="/tags/android/">android</a> <a class="post-tag" href="/tags/databinding/">databinding</a> <a class="post-tag" href="/tags/recyclerview/">RecyclerView</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/thinking-in-java-strings/"><div class="card-body"> <span class="timeago small" > Jun 4, 2013 <i class="unloaded">2013-06-04T21:39:36+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>《Java编程思想》第13章字符串</h3><div class="text-muted small"><p> 第13章 字符串 13.1 不可变String public class Immutable { public static String upcase(String s){ return s.toUpperCase(); } public static void main(String[] args) { String q = ...</p></div></div></a></div><div class="card"> <a href="/posts/thinking-in-java-arrays/"><div class="card-body"> <span class="timeago small" > Jun 25, 2013 <i class="unloaded">2013-06-25T21:39:36+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>《Java编程思想》第16章数组</h3><div class="text-muted small"><p> 数组为什么特殊 数组与其他种类的容器之间的区别有三方面：效率、类型和保存基本类型的能力。在Java中，数组是一种效率最高的存储和随机访问对象引用序列的方式。数组就是一个简单的线性序列，这使得元素访问非常快速。但是为这种速度所付出的代价是数组对象的大小被固定，并且在其生命周期中不可改变。 数组之所以优于泛型之前的容器，就是因为你可以创建一个数组去持有某种具体类型。这意味着你可以通过编译期检...</p></div></div></a></div><div class="card"> <a href="/posts/thinking-in-java-everything-is-an-object/"><div class="card-body"> <span class="timeago small" > Mar 20, 2013 <i class="unloaded">2013-03-20T00:26:34+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>《Java编程思想》第2章一切都是对象</h3><div class="text-muted small"><p> 2.2 必须由你创建所有对象 2.2.1 存储到什么地方 2.2.2 特例：基本类型 在程序设计中经常用到一系列类型，它们需要特殊对待。可以把它们想象成“基本”类型。之所以特殊对待，是因为new将对象存储在“堆”里，故用new创建一个对象，特别是小的、简单的变量，往往不是很有效。因此，对于这些类型，Java采取与C和C++相同的方法。也就是说，不用new来创建变量，而是创建一个并非是引...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/thinking-in-java-arrays/" class="btn btn-outline-primary" prompt="Older"><p>《Java编程思想》第16章数组</p></a> <a href="/posts/thinking-in-java-i-o/" class="btn btn-outline-primary" prompt="Newer"><p>《Java编程思想》第18章I/O系统</p></a></div><div id="disqus" class="pt-2 pb-2"><p class="text-center text-muted small pb-5"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script src="/assets/js/lib/jquery.disqusloader.min.js"></script> <script> const options = { scriptUrl: '//malinkang-cn.disqus.com/embed.js', disqusConfig: function() { this.page.title = '《Java编程思想》第17章容器深入研究'; this.page.url = 'https://malinkang.cn/posts/thinking-in-java-containers-in-depth/'; this.page.identifier = '/posts/thinking-in-java-containers-in-depth/'; } }; $.disqusLoader('#disqus', options); </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://twitter.com/malinkang">malinkang</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/">源码分析</a> <a class="post-tag" href="/tags/thinking-in-java/">Thinking in Java</a> <a class="post-tag" href="/tags/android/">Android</a> <a class="post-tag" href="/tags/effective-java/">Effective Java</a> <a class="post-tag" href="/tags/kotlin/">Kotlin</a> <a class="post-tag" href="/tags/java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98/">Java并发编程实战</a> <a class="post-tag" href="/tags/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3jvm/">深入理解JVM</a> <a class="post-tag" href="/tags/android/">android</a> <a class="post-tag" href="/tags/databinding/">databinding</a> <a class="post-tag" href="/tags/recyclerview/">RecyclerView</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://malinkang.cn{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>

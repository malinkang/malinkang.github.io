<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Recyclerview源码分析一 - 人生最可悲的事情，莫过于胸怀大志，却又虚度光阴。</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="malinkang" /><meta name="description" content="RecyclerView是我们开发中最常用的控件，RecyclerView是如何工作的，如何处理缓存的有助于解决一些使用RecyclerView的bug和优化RecyclerView。
" /><meta name="keywords" content="Hugo, theme, even" />






<meta name="generator" content="Hugo 0.80.0 with theme even" />


<link rel="canonical" href="https://malinkang.cn/post/recyclerview-analysis-1/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.c12ac5d6e912b28ec1fcd71d47773cc8112a03296d4ff03660135b54f0923299.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="Recyclerview源码分析一" />
<meta property="og:description" content="RecyclerView是我们开发中最常用的控件，RecyclerView是如何工作的，如何处理缓存的有助于解决一些使用RecyclerView的bug和优化RecyclerView。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://malinkang.cn/post/recyclerview-analysis-1/" />
<meta property="article:published_time" content="2020-09-02T16:39:09+08:00" />
<meta property="article:modified_time" content="2020-09-02T16:39:09+08:00" />
<meta itemprop="name" content="Recyclerview源码分析一">
<meta itemprop="description" content="RecyclerView是我们开发中最常用的控件，RecyclerView是如何工作的，如何处理缓存的有助于解决一些使用RecyclerView的bug和优化RecyclerView。">
<meta itemprop="datePublished" content="2020-09-02T16:39:09+08:00" />
<meta itemprop="dateModified" content="2020-09-02T16:39:09+08:00" />
<meta itemprop="wordCount" content="2987">



<meta itemprop="keywords" content="Android,RecyclerView," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Recyclerview源码分析一"/>
<meta name="twitter:description" content="RecyclerView是我们开发中最常用的控件，RecyclerView是如何工作的，如何处理缓存的有助于解决一些使用RecyclerView的bug和优化RecyclerView。"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Malinkang&#39;s Blog</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">首页</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">归档</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">标签</li>
      </a>
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">Malinkang&#39;s Blog</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">首页</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">归档</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">标签</a>
      </li>
  </ul>
</nav>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Recyclerview源码分析一</h1>

      <div class="post-meta">
        <span class="post-time"> 2020-09-02 </span>
        
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#准备源码">准备源码</a></li>
    <li><a href="#recyclerview">RecyclerView</a></li>
    <li><a href="#adapter">Adapter</a></li>
    <li><a href="#viewholder">ViewHolder</a></li>
    <li><a href="#layoutmanager">LayoutManager</a></li>
    <li><a href="#itemdecoration">ItemDecoration</a></li>
    <li><a href="#itemanimator">ItemAnimator</a></li>
    <li><a href="#recycler">Recycler</a></li>
    <li><a href="#recycledviewpool">RecycledViewPool</a></li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p><code>RecyclerView</code>是我们开发中最常用的控件，<code>RecyclerView</code>是如何工作的，如何处理缓存的有助于解决一些使用<code>RecyclerView</code>的bug和优化<code>RecyclerView</code>。</p>
<h2 id="准备源码">准备源码</h2>
<p>分析源码之前我们需要先准备一份源码。</p>
<ol>
<li>
<p>按照<a href="https://android.googlesource.com/platform/frameworks/support/">官方文档</a>下载一份<code>support</code>源码</p>
</li>
<li>
<p>用AndroidStudio打开源码</p>
</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">#进入support目录
cd androidx-master-dev/frameworks/support
./studiow
</code></pre></td></tr></table>
</div>
</div><ol start="3">
<li>
<p>我们可以在源码中添加一些日志</p>
</li>
<li>
<p>打包</p>
</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-groovy" data-lang="groovy"><span class="o">./</span><span class="n">gradlew</span> <span class="n">createArchive</span>
</code></pre></td></tr></table>
</div>
</div><ol start="5">
<li>创建一个工程，在项目的<code>build.gradle</code>文件的 &ldquo;repositories&quot;属性的顶部加上以下内容。这样项目中依赖的<code>RecyclerView</code>就是你添加了日志的<code>RecyclerView</code>。</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-groovy" data-lang="groovy"><span class="n">maven</span> <span class="o">{</span> <span class="n">url</span> <span class="s1">&#39;/Volumes/android/androidx-master-dev/out/androidx/build/support_repo/&#39;</span> <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="recyclerview">RecyclerView</h2>
<p><code>RecyclerView</code>内部定义了如下几个内部类。</p>
<p><img src="/images/recyclerview-1.png" alt=""></p>
<p>我们接下来将逐个分析每个内部类的主要功能，和一些常用的方法。后面再把各个部分串起来看他们是如何工作的。</p>
<h2 id="adapter">Adapter</h2>
<p><code>Adapter</code>是一个典型的适配器模式。负责将数据转换成<code>ItemView</code>，然后添加到<code>RecyclerView</code>。</p>
<p>常用方法</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">abstract</span> <span class="n">VH</span> <span class="nf">onCreateViewHolder</span><span class="o">(</span><span class="nd">@NonNull</span> <span class="n">ViewGroup</span> <span class="n">parent</span><span class="o">,</span> <span class="kt">int</span> <span class="n">viewType</span><span class="o">);</span>

<span class="kd">public</span> <span class="kd">abstract</span> <span class="kt">void</span> <span class="nf">onBindViewHolder</span><span class="o">(</span><span class="nd">@NonNull</span> <span class="n">VH</span> <span class="n">holder</span><span class="o">,</span> <span class="kt">int</span> <span class="n">position</span><span class="o">);</span>

<span class="kd">public</span> <span class="kt">int</span> <span class="nf">getItemViewType</span><span class="o">(</span><span class="kt">int</span> <span class="n">position</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">return</span> <span class="n">0</span><span class="o">;</span>
<span class="o">}</span>

<span class="o">*</span> <span class="nd">@see</span> <span class="err">#</span><span class="n">notifyItemChanged</span><span class="o">(</span><span class="kt">int</span><span class="o">)</span>
<span class="o">*</span> <span class="nd">@see</span> <span class="err">#</span><span class="n">notifyItemInserted</span><span class="o">(</span><span class="kt">int</span><span class="o">)</span>
<span class="o">*</span> <span class="nd">@see</span> <span class="err">#</span><span class="n">notifyItemRemoved</span><span class="o">(</span><span class="kt">int</span><span class="o">)</span>
<span class="o">*</span> <span class="nd">@see</span> <span class="err">#</span><span class="n">notifyItemRangeChanged</span><span class="o">(</span><span class="kt">int</span><span class="o">,</span> <span class="kt">int</span><span class="o">)</span>
<span class="o">*</span> <span class="nd">@see</span> <span class="err">#</span><span class="n">notifyItemRangeInserted</span><span class="o">(</span><span class="kt">int</span><span class="o">,</span> <span class="kt">int</span><span class="o">)</span>
<span class="o">*</span> <span class="nd">@see</span> <span class="err">#</span><span class="n">notifyItemRangeRemoved</span><span class="o">(</span><span class="kt">int</span><span class="o">,</span> <span class="kt">int</span><span class="o">)</span>
<span class="o">*/</span>
<span class="kd">public</span> <span class="kd">final</span> <span class="kt">void</span> <span class="nf">notifyDataSetChanged</span><span class="o">()</span> <span class="o">{</span>
  <span class="n">mObservable</span><span class="o">.</span><span class="na">notifyChanged</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="viewholder">ViewHolder</h2>
<p>在使用<code>ListView</code>的时候我们都使用过<code>ViewHolder</code>.<code>ViewHolder</code>主要是为了防止多次<code>findViewById</code>.</p>
<h2 id="layoutmanager">LayoutManager</h2>
<blockquote>
<p>A LayoutManager is responsible for measuring and positioning item views within a RecyclerView as well as determining the policy for when to recycle item views that are no longer visible to the user. By changing the LayoutManager a RecyclerView can be used to implement a standard vertically scrolling list,a uniform grid, staggered grids, horizontally scrolling collections and more. Several stock layout managers are provided for general use.</p>
</blockquote>
<p><code>LayoutManager</code>负责测量和定位RecyclerView中的项目视图，以及决定何时回收用户不再可见的项目视图。通过改变<code>LayoutManager</code>，一个<code>RecyclerView</code>可以被用来实现一个标准的垂直滚动列表，一个统一的网格，交错的网格，水平滚动的集合等等。系统提供了几种常用的布局管理器。</p>
<h2 id="itemdecoration">ItemDecoration</h2>
<p><code>ItemDecoration</code>顾名思义就是用来对Item进行装饰的。我们最常用的就是为每个Item添加分割线。</p>
<h2 id="itemanimator">ItemAnimator</h2>
<p><code>ItemAnimator</code>定义了当适配器发生变化时的动画。我们可以调用RecyclerView的setItemAnimator方法设置<code>ItemAnimator</code>.系统为我们默认设置了一个<code>DefaultItemAnimator</code>。</p>
<h2 id="recycler">Recycler</h2>
<p><code>Recycler</code>的官方解释如下：</p>
<blockquote>
<p>A Recycler is responsible for managing scrapped or detached item views for reuse.</p>
</blockquote>
<p><code>Recycler</code>负责管理废弃或拆分的<code>item views</code>，以便再利用。</p>
<blockquote>
<p>A &ldquo;scrapped&rdquo; view is a view that is still attached to its parent RecyclerView but that has been marked for removal or reuse.</p>
</blockquote>
<p>一个 ”废弃“的<code>view</code>是一个仍然附着在它的父<code>RecyclerView</code>上的<code>view</code>，但它已经被标记为移除或重用。</p>
<blockquote>
<p>Typical use of a Recycler by a LayoutManager will be to obtain views for an adapter&rsquo;s data set representing the data at a given position or item ID. If the view to be reused is considered &ldquo;dirty&rdquo; the adapter will be asked to rebind it. If not, the view can be quickly reused by the LayoutManager with no further work. Clean views that have not may be repositioned by a LayoutManager without remeasurement.</p>
</blockquote>
<p><code>LayoutManager</code>对<code>Recycler</code>的典型使用是为适配器的数据集获取给定位置或<code>item ID</code>的数据的视图。如果要重用的视图被认为是 &ldquo;脏的&rdquo;，适配器将被要求重新绑定它。如果不是，该视图可以被<code>LayoutManager</code>快速重用，而无需进一步的工作。没有的干净视图可以由<code>LayoutManager</code>重新定位，而无需重新测量。</p>
<p>简单来说<code>Recycler</code>用来缓存和从缓存中获取<code>ViewHoder</code>的。<code>Recycler</code>中定义了如下几个<code>list</code>来存放缓存：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"> <span class="c1">//存放废弃的view
</span><span class="c1"></span> <span class="kd">final</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">ViewHolder</span><span class="o">&gt;</span> <span class="n">mAttachedScrap</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
 <span class="c1">//存放改变的废弃的view
</span><span class="c1"></span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">ViewHolder</span><span class="o">&gt;</span> <span class="n">mChangedScrap</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
 <span class="c1">//缓存view
</span><span class="c1"></span> <span class="kd">final</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">ViewHolder</span><span class="o">&gt;</span> <span class="n">mCachedViews</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">ViewHolder</span><span class="o">&gt;();</span>
 <span class="c1">//最多缓存个数
</span><span class="c1"></span> <span class="kt">int</span> <span class="n">mViewCacheMax</span> <span class="o">=</span> <span class="n">DEFAULT_CACHE_SIZE</span><span class="o">;</span>
 <span class="c1">//默认缓存为2
</span><span class="c1"></span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">DEFAULT_CACHE_SIZE</span> <span class="o">=</span> <span class="n">2</span><span class="o">;</span>
 <span class="c1">//更新缓存大小
</span><span class="c1"></span><span class="kt">void</span> <span class="nf">updateViewCacheSize</span><span class="o">()</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">extraCache</span> <span class="o">=</span> <span class="n">mLayout</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">mLayout</span><span class="o">.</span><span class="na">mPrefetchMaxCountObserved</span> <span class="o">:</span> <span class="n">0</span><span class="o">;</span>
    <span class="n">mViewCacheMax</span> <span class="o">=</span> <span class="n">mRequestedCacheMax</span> <span class="o">+</span> <span class="n">extraCache</span><span class="o">;</span>

    <span class="c1">// first, try the views that can be recycled
</span><span class="c1"></span>    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">mCachedViews</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">-</span> <span class="n">1</span><span class="o">;</span>
            <span class="n">i</span> <span class="o">&gt;=</span> <span class="n">0</span> <span class="o">&amp;&amp;</span> <span class="n">mCachedViews</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">&gt;</span> <span class="n">mViewCacheMax</span><span class="o">;</span> <span class="n">i</span><span class="o">--)</span> <span class="o">{</span>
        <span class="n">recycleCachedViewAt</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>查找这几个list的<code>add</code>和<code>remove</code>以及<code>clear</code>方法调用。</p>
<p><code>mCachedViews</code>的<code>add</code>、<code>remove</code>以及<code>clear</code>方法调用。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//从mCachedViews中移除
</span><span class="c1"></span><span class="kt">void</span> <span class="nf">recycleCachedViewAt</span><span class="o">(</span><span class="kt">int</span> <span class="n">cachedViewIndex</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">ViewHolder</span> <span class="n">viewHolder</span> <span class="o">=</span> <span class="n">mCachedViews</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">cachedViewIndex</span><span class="o">);</span>
    <span class="c1">//从mCachedViews中移除添加到RecycledViewPool
</span><span class="c1"></span>    <span class="n">addViewHolderToRecycledViewPool</span><span class="o">(</span><span class="n">viewHolder</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
    <span class="n">mCachedViews</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">cachedViewIndex</span><span class="o">);</span>
<span class="o">}</span>
<span class="c1">//添加到RecycledViewPool
</span><span class="c1"></span><span class="kt">void</span> <span class="nf">addViewHolderToRecycledViewPool</span><span class="o">(</span><span class="nd">@NonNull</span> <span class="n">ViewHolder</span> <span class="n">holder</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">dispatchRecycled</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">clearNestedRecyclerViewIfNotNested</span><span class="o">(</span><span class="n">holder</span><span class="o">);</span>
    <span class="n">View</span> <span class="n">itemView</span> <span class="o">=</span> <span class="n">holder</span><span class="o">.</span><span class="na">itemView</span><span class="o">;</span>
    <span class="c1">//
</span><span class="c1"></span>    <span class="n">holder</span><span class="o">.</span><span class="na">mBindingAdapter</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="n">holder</span><span class="o">.</span><span class="na">mOwnerRecyclerView</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="c1">//调用RecycledViewPool的putRecycledView方法
</span><span class="c1"></span>    <span class="n">getRecycledViewPool</span><span class="o">().</span><span class="na">putRecycledView</span><span class="o">(</span><span class="n">holder</span><span class="o">);</span>
<span class="o">}</span>
<span class="c1">//添加到mCachedViews中
</span><span class="c1"></span><span class="kt">void</span> <span class="nf">recycleViewHolderInternal</span><span class="o">(</span><span class="n">ViewHolder</span> <span class="n">holder</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">forceRecycle</span> <span class="o">||</span> <span class="n">holder</span><span class="o">.</span><span class="na">isRecyclable</span><span class="o">())</span> <span class="o">{</span>
      <span class="c1">//存入到mCachedViews中
</span><span class="c1"></span>      <span class="k">if</span> <span class="o">(</span><span class="n">mViewCacheMax</span> <span class="o">&gt;</span> <span class="n">0</span>
              <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">holder</span><span class="o">.</span><span class="na">hasAnyOfTheFlags</span><span class="o">(</span><span class="n">ViewHolder</span><span class="o">.</span><span class="na">FLAG_INVALID</span>
              <span class="o">|</span> <span class="n">ViewHolder</span><span class="o">.</span><span class="na">FLAG_REMOVED</span>
              <span class="o">|</span> <span class="n">ViewHolder</span><span class="o">.</span><span class="na">FLAG_UPDATE</span>
              <span class="o">|</span> <span class="n">ViewHolder</span><span class="o">.</span><span class="na">FLAG_ADAPTER_POSITION_UNKNOWN</span><span class="o">))</span> <span class="o">{</span>
          <span class="c1">// Retire oldest cached view
</span><span class="c1"></span>          <span class="kt">int</span> <span class="n">cachedViewSize</span> <span class="o">=</span> <span class="n">mCachedViews</span><span class="o">.</span><span class="na">size</span><span class="o">();</span>
          <span class="c1">//当mCachedViews size超过最大缓存数时移除第一个
</span><span class="c1"></span>          <span class="k">if</span> <span class="o">(</span><span class="n">cachedViewSize</span> <span class="o">&gt;=</span> <span class="n">mViewCacheMax</span> <span class="o">&amp;&amp;</span> <span class="n">cachedViewSize</span> <span class="o">&gt;</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span>
              <span class="n">recycleCachedViewAt</span><span class="o">(</span><span class="n">0</span><span class="o">);</span>
              <span class="n">cachedViewSize</span><span class="o">--;</span>
          <span class="o">}</span>

          <span class="kt">int</span> <span class="n">targetCacheIndex</span> <span class="o">=</span> <span class="n">cachedViewSize</span><span class="o">;</span>
          <span class="k">if</span> <span class="o">(</span><span class="n">ALLOW_THREAD_GAP_WORK</span>
                  <span class="o">&amp;&amp;</span> <span class="n">cachedViewSize</span> <span class="o">&gt;</span> <span class="n">0</span>
                  <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">mPrefetchRegistry</span><span class="o">.</span><span class="na">lastPrefetchIncludedPosition</span><span class="o">(</span><span class="n">holder</span><span class="o">.</span><span class="na">mPosition</span><span class="o">))</span> <span class="o">{</span>
              <span class="c1">// when adding the view, skip past most recently prefetched views
</span><span class="c1"></span>              <span class="kt">int</span> <span class="n">cacheIndex</span> <span class="o">=</span> <span class="n">cachedViewSize</span> <span class="o">-</span> <span class="n">1</span><span class="o">;</span>
              <span class="k">while</span> <span class="o">(</span><span class="n">cacheIndex</span> <span class="o">&gt;=</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span>
                  <span class="kt">int</span> <span class="n">cachedPos</span> <span class="o">=</span> <span class="n">mCachedViews</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">cacheIndex</span><span class="o">).</span><span class="na">mPosition</span><span class="o">;</span>
                  <span class="k">if</span> <span class="o">(!</span><span class="n">mPrefetchRegistry</span><span class="o">.</span><span class="na">lastPrefetchIncludedPosition</span><span class="o">(</span><span class="n">cachedPos</span><span class="o">))</span> <span class="o">{</span>
                      <span class="k">break</span><span class="o">;</span>
                  <span class="o">}</span>
                  <span class="n">cacheIndex</span><span class="o">--;</span>
              <span class="o">}</span>
              <span class="n">targetCacheIndex</span> <span class="o">=</span> <span class="n">cacheIndex</span> <span class="o">+</span> <span class="n">1</span><span class="o">;</span>
          <span class="o">}</span>
          <span class="n">mCachedViews</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">targetCacheIndex</span><span class="o">,</span> <span class="n">holder</span><span class="o">);</span>
          <span class="n">cached</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
      <span class="o">}</span>
      <span class="c1">//不满足条件的时候存入RecyclerViewPool
</span><span class="c1"></span>      <span class="k">if</span> <span class="o">(!</span><span class="n">cached</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">addViewHolderToRecycledViewPool</span><span class="o">(</span><span class="n">holder</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
          <span class="n">recycled</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
      <span class="o">}</span>
  <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
      <span class="c1">// NOTE: A view can fail to be recycled when it is scrolled off while an animation
</span><span class="c1"></span>      <span class="c1">// runs. In this case, the item is eventually recycled by
</span><span class="c1"></span>      <span class="c1">// ItemAnimatorRestoreListener#onAnimationFinished.
</span><span class="c1"></span>
      <span class="c1">// TODO: consider cancelling an animation when an item is removed scrollBy,
</span><span class="c1"></span>      <span class="c1">// to return it to the pool faster
</span><span class="c1"></span>  <span class="o">}</span>
<span class="o">}</span>
<span class="c1">//
</span><span class="c1"></span><span class="kt">void</span> <span class="nf">recycleAndClearCachedViews</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="n">mCachedViews</span><span class="o">.</span><span class="na">size</span><span class="o">();</span>
    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">count</span> <span class="o">-</span> <span class="n">1</span><span class="o">;</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span><span class="o">--)</span> <span class="o">{</span>
        <span class="n">recycleCachedViewAt</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="n">mCachedViews</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>
    <span class="c1">//...
</span><span class="c1"></span><span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p><code>mAttachedScrap</code>和<code>mChangedScrap</code>的<code>add</code>、<code>remove</code>以及<code>clear</code>方法调用。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="cm">/**
</span><span class="cm">  * Mark an attached view as scrap.
</span><span class="cm">  *
</span><span class="cm">  * &lt;p&gt;&#34;Scrap&#34; views are still attached to their parent RecyclerView but are eligible
</span><span class="cm">  * for rebinding and reuse. Requests for a view for a given position may return a
</span><span class="cm">  * reused or rebound scrap view instance.&lt;/p&gt;
</span><span class="cm">  *
</span><span class="cm">  * @param view View to scrap
</span><span class="cm">  */</span>
<span class="kt">void</span> <span class="nf">scrapView</span><span class="o">(</span><span class="n">View</span> <span class="n">view</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">ViewHolder</span> <span class="n">holder</span> <span class="o">=</span> <span class="n">getChildViewHolderInt</span><span class="o">(</span><span class="n">view</span><span class="o">);</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">holder</span><span class="o">.</span><span class="na">hasAnyOfTheFlags</span><span class="o">(</span><span class="n">ViewHolder</span><span class="o">.</span><span class="na">FLAG_REMOVED</span> <span class="o">|</span> <span class="n">ViewHolder</span><span class="o">.</span><span class="na">FLAG_INVALID</span><span class="o">)</span>
            <span class="o">||</span> <span class="o">!</span><span class="n">holder</span><span class="o">.</span><span class="na">isUpdated</span><span class="o">()</span> <span class="o">||</span> <span class="n">canReuseUpdatedViewHolder</span><span class="o">(</span><span class="n">holder</span><span class="o">))</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">holder</span><span class="o">.</span><span class="na">isInvalid</span><span class="o">()</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">holder</span><span class="o">.</span><span class="na">isRemoved</span><span class="o">()</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">mAdapter</span><span class="o">.</span><span class="na">hasStableIds</span><span class="o">())</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalArgumentException</span><span class="o">(</span><span class="s">&#34;Called scrap view with an invalid view.&#34;</span>
                    <span class="o">+</span> <span class="s">&#34; Invalid views cannot be reused from scrap, they should rebound from&#34;</span>
                    <span class="o">+</span> <span class="s">&#34; recycler pool.&#34;</span> <span class="o">+</span> <span class="n">exceptionLabel</span><span class="o">());</span>
        <span class="o">}</span>
        <span class="n">holder</span><span class="o">.</span><span class="na">setScrapContainer</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>
        <span class="c1">//添加到mAttachedScrap集合中
</span><span class="c1"></span>        <span class="n">mAttachedScrap</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">holder</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">mChangedScrap</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">mChangedScrap</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">ViewHolder</span><span class="o">&gt;();</span>
        <span class="o">}</span>
        <span class="n">holder</span><span class="o">.</span><span class="na">setScrapContainer</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
        <span class="n">mChangedScrap</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">holder</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="kt">void</span> <span class="nf">clearScrap</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">mAttachedScrap</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">mChangedScrap</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">mChangedScrap</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="cm">/**
</span><span class="cm">  * Remove a previously scrapped view from the pool of eligible scrap.
</span><span class="cm">  *
</span><span class="cm">  * &lt;p&gt;This view will no longer be eligible for reuse until re-scrapped or
</span><span class="cm">  * until it is explicitly removed and recycled.&lt;/p&gt;
</span><span class="cm">  */</span>
<span class="kt">void</span> <span class="nf">unscrapView</span><span class="o">(</span><span class="n">ViewHolder</span> <span class="n">holder</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">holder</span><span class="o">.</span><span class="na">mInChangeScrap</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">mChangedScrap</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">holder</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="n">mAttachedScrap</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">holder</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="n">holder</span><span class="o">.</span><span class="na">mScrapContainer</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="n">holder</span><span class="o">.</span><span class="na">mInChangeScrap</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
    <span class="n">holder</span><span class="o">.</span><span class="na">clearReturnedFromScrapFlag</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="recycledviewpool">RecycledViewPool</h2>
<blockquote>
<p>RecycledViewPool lets you share Views between multiple RecyclerViews.</p>
</blockquote>
<p><code>RecycledViewPool</code>允许多个<code>RecyclerView</code>共享<code>View</code>.</p>
<blockquote>
<p>If you want to recycle views across RecyclerViews, create an instance of RecycledViewPool and use RecyclerView#setRecycledViewPool(RecycledViewPool).</p>
</blockquote>
<p>如果你想在不同的RecyclerViews中循环使用视图。创建一个<code>RecycledViewPool</code>的实例并传递给<code>RecyclerView#setRecycledViewPool(RecycledViewPool)</code>。</p>
<blockquote>
<p>RecyclerView automatically creates a pool for itself if you don&rsquo;t provide one.</p>
</blockquote>
<p>如果你不提供一个<code>RecycledViewPool</code>，<code>RecyclerView</code>会自动为自己创建一个。</p>
<p>默认<code>RecycledViewPool</code>在<code>Recycler</code>的<code>getRecycledViewPool</code>方法中创建。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="n">RecycledViewPool</span> <span class="nf">getRecycledViewPool</span><span class="o">()</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">mRecyclerPool</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">mRecyclerPool</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RecycledViewPool</span><span class="o">();</span>
  <span class="o">}</span>
  <span class="k">return</span> <span class="n">mRecyclerPool</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//缓存池
</span><span class="c1"></span><span class="n">SparseArray</span><span class="o">&lt;</span><span class="n">ScrapData</span><span class="o">&gt;</span> <span class="n">mScrap</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SparseArray</span><span class="o">&lt;&gt;();</span>

<span class="kd">static</span> <span class="kd">class</span> <span class="nc">ScrapData</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">ViewHolder</span><span class="o">&gt;</span> <span class="n">mScrapHeap</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
    <span class="kt">int</span> <span class="n">mMaxScrap</span> <span class="o">=</span> <span class="n">DEFAULT_MAX_SCRAP</span><span class="o">;</span>
    <span class="kt">long</span> <span class="n">mCreateRunningAverageNs</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
    <span class="kt">long</span> <span class="n">mBindRunningAverageNs</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
<span class="o">}</span>
<span class="c1">//存入缓存
</span><span class="c1"></span><span class="kd">public</span> <span class="kt">void</span> <span class="nf">putRecycledView</span><span class="o">(</span><span class="n">ViewHolder</span> <span class="n">scrap</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="kt">int</span> <span class="n">viewType</span> <span class="o">=</span> <span class="n">scrap</span><span class="o">.</span><span class="na">getItemViewType</span><span class="o">();</span>
    <span class="kd">final</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">ViewHolder</span><span class="o">&gt;</span> <span class="n">scrapHeap</span> <span class="o">=</span> <span class="n">getScrapDataForType</span><span class="o">(</span><span class="n">viewType</span><span class="o">).</span><span class="na">mScrapHeap</span><span class="o">;</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">mScrap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">viewType</span><span class="o">).</span><span class="na">mMaxScrap</span> <span class="o">&lt;=</span> <span class="n">scrapHeap</span><span class="o">.</span><span class="na">size</span><span class="o">())</span> <span class="o">{</span>
        <span class="k">return</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">DEBUG</span> <span class="o">&amp;&amp;</span> <span class="n">scrapHeap</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">scrap</span><span class="o">))</span> <span class="o">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalArgumentException</span><span class="o">(</span><span class="s">&#34;this scrap item already exists&#34;</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="n">scrap</span><span class="o">.</span><span class="na">resetInternal</span><span class="o">();</span>
    <span class="n">scrapHeap</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">scrap</span><span class="o">);</span>
<span class="o">}</span>
<span class="c1">//从缓存中获取ViewHolder
</span><span class="c1"></span><span class="cm">/**
</span><span class="cm">  * Acquire a ViewHolder of the specified type from the pool, or {@code null} if none are
</span><span class="cm">  * present.
</span><span class="cm">  *
</span><span class="cm">  * @param viewType ViewHolder type.
</span><span class="cm">  * @return ViewHolder of the specified type acquired from the pool, or {@code null} if none
</span><span class="cm">  * are present.
</span><span class="cm">  */</span>
<span class="nd">@Nullable</span>
<span class="kd">public</span> <span class="n">ViewHolder</span> <span class="nf">getRecycledView</span><span class="o">(</span><span class="kt">int</span> <span class="n">viewType</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">ScrapData</span> <span class="n">scrapData</span> <span class="o">=</span> <span class="n">mScrap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">viewType</span><span class="o">);</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">scrapData</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">scrapData</span><span class="o">.</span><span class="na">mScrapHeap</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
        <span class="kd">final</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">ViewHolder</span><span class="o">&gt;</span> <span class="n">scrapHeap</span> <span class="o">=</span> <span class="n">scrapData</span><span class="o">.</span><span class="na">mScrapHeap</span><span class="o">;</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">scrapHeap</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">-</span> <span class="n">1</span><span class="o">;</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span><span class="o">--)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(!</span><span class="n">scrapHeap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">).</span><span class="na">isAttachedToTransitionOverlay</span><span class="o">())</span> <span class="o">{</span>
                <span class="k">return</span> <span class="n">scrapHeap</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div>
    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content">malinkang</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">
        2020-09-02
        
    </span>
  </p>
  
  
</div>
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/android/">Android</a>
          <a href="/tags/recyclerview/">RecyclerView</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/recyclerview-analysis-2/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Recyclerview源码分析二</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        <a class="next" href="/post/start-activity/">
            <span class="next-text nav-default">startActivity流程分析</span>
            <span class="next-text nav-mobile">下一篇</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        <div id="disqus_thread"></div>
    <script type="text/javascript">
    (function() {
      
      
      if (window.location.hostname === 'localhost') return;

      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      var disqus_shortname = 'malinkang-cn';
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="https://twitter.com/malinkang" class="iconfont icon-twitter" title="twitter"></a>
      <a href="https://github.com/malinkang" class="iconfont icon-github" title="github"></a>
      <a href="https://weibo.com/malinkang" class="iconfont icon-weibo" title="weibo"></a>
  <a href="https://malinkang.cn/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" href="https://gohugo.io">Hugo</a> 强力驱动
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    主题 - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2017 - 
    2021
    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">malinkang</span>
  </span>
</div>
    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.d7b7ada643c9c1a983026e177f141f7363b4640d619caf01d8831a6718cd44ea.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      showProcessingMessages: false,
      messageStyle: 'none'
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"  integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>








</body>
</html>

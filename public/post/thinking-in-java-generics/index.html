<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>《Java编程思想》第15章泛型 - 人生最可悲的事情，莫过于胸怀大志，却又虚度光阴。</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="malinkang" /><meta name="description" content="一般的类和方法，只能使用具体的类型：要么是基本类型，要么是自定义的类。如果要编写可以应用于多种类型的代码，这种刻板的限制对代码的束缚就会很大" /><meta name="keywords" content="Hugo, theme, even" />






<meta name="generator" content="Hugo 0.80.0 with theme even" />


<link rel="canonical" href="https://malinkang.cn/post/thinking-in-java-generics/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.c12ac5d6e912b28ec1fcd71d47773cc8112a03296d4ff03660135b54f0923299.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="《Java编程思想》第15章泛型" />
<meta property="og:description" content="一般的类和方法，只能使用具体的类型：要么是基本类型，要么是自定义的类。如果要编写可以应用于多种类型的代码，这种刻板的限制对代码的束缚就会很大" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://malinkang.cn/post/thinking-in-java-generics/" />
<meta property="article:published_time" content="2013-06-18T13:39:36+00:00" />
<meta property="article:modified_time" content="2013-06-18T13:39:36+00:00" />
<meta itemprop="name" content="《Java编程思想》第15章泛型">
<meta itemprop="description" content="一般的类和方法，只能使用具体的类型：要么是基本类型，要么是自定义的类。如果要编写可以应用于多种类型的代码，这种刻板的限制对代码的束缚就会很大">
<meta itemprop="datePublished" content="2013-06-18T13:39:36+00:00" />
<meta itemprop="dateModified" content="2013-06-18T13:39:36+00:00" />
<meta itemprop="wordCount" content="16081">



<meta itemprop="keywords" content="Thinking in Java," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="《Java编程思想》第15章泛型"/>
<meta name="twitter:description" content="一般的类和方法，只能使用具体的类型：要么是基本类型，要么是自定义的类。如果要编写可以应用于多种类型的代码，这种刻板的限制对代码的束缚就会很大"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Malinkang&#39;s Blog</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">首页</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">归档</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">标签</li>
      </a>
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">Malinkang&#39;s Blog</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">首页</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">归档</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">标签</a>
      </li>
  </ul>
</nav>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">《Java编程思想》第15章泛型</h1>

      <div class="post-meta">
        <span class="post-time"> 2013-06-18 </span>
        
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#151-与c的比较">15.1 与C++的比较</a></li>
    <li><a href="#152-简单泛型">15.2 简单泛型</a>
      <ul>
        <li><a href="#1521-一个元组类库">15.2.1 一个元组类库</a></li>
        <li><a href="#1522-一个堆栈类">15.2.2 一个堆栈类</a></li>
        <li><a href="#1523-randomlist">15.2.3 RandomList</a></li>
      </ul>
    </li>
    <li><a href="#153-泛型接口">15.3 泛型接口</a></li>
    <li><a href="#154-泛型方法">15.4 泛型方法</a>
      <ul>
        <li><a href="#1541-杠杆利用类型参数推断">15.4.1 杠杆利用类型参数推断</a></li>
        <li><a href="#1542-可变参数与泛型方法">15.4.2 可变参数与泛型方法</a></li>
        <li><a href="#1543-用于generator的泛型方法">15.4.3 用于Generator的泛型方法</a></li>
        <li><a href="#1544-一个通用的generator">15.4.4 一个通用的Generator</a></li>
        <li><a href="#1545-简化元组的使用">15.4.5 简化元组的使用</a></li>
        <li><a href="#1546-一个set实用工具">15.4.6 一个Set实用工具</a></li>
      </ul>
    </li>
    <li><a href="#155-匿名内部类">15.5 匿名内部类</a></li>
    <li><a href="#156-构建复杂模型">15.6 构建复杂模型</a></li>
    <li><a href="#157-擦除的神秘之处">15.7 擦除的神秘之处</a>
      <ul>
        <li><a href="#1571-c的方式">15.7.1 C++的方式</a></li>
        <li><a href="#1572-迁移兼容性">15.7.2 迁移兼容性</a></li>
        <li><a href="#1573-擦除的问题">15.7.3 擦除的问题</a></li>
        <li><a href="#1574-边界处的动作">15.7.4 边界处的动作</a></li>
      </ul>
    </li>
    <li><a href="#158-擦除的补偿">15.8 擦除的补偿</a>
      <ul>
        <li><a href="#1581-创建类型实例">15.8.1 创建类型实例</a></li>
        <li><a href="#1582-泛型数组">15.8.2 泛型数组</a></li>
      </ul>
    </li>
    <li><a href="#159-边界">15.9 边界</a></li>
    <li><a href="#1510-通配符">15.10 通配符</a>
      <ul>
        <li><a href="#15101-编译器有多聪明">15.10.1 编译器有多聪明</a></li>
        <li><a href="#15102-逆变">15.10.2 逆变</a></li>
        <li><a href="#15103-无界通配符">15.10.3 无界通配符</a></li>
        <li><a href="#15104-捕获转换">15.10.4 捕获转换</a></li>
      </ul>
    </li>
    <li><a href="#1511-问题">15.11 问题</a>
      <ul>
        <li><a href="#15111任何基本类型都不能作为类型参数">15.11.1.任何基本类型都不能作为类型参数</a></li>
        <li><a href="#15112实现参数化接口">15.11.2.实现参数化接口</a></li>
        <li><a href="#15113-转型和警告">15.11.3 转型和警告</a></li>
        <li><a href="#15114-重载">15.11.4 重载</a></li>
        <li><a href="#15115-基类劫持了接口">15.11.5 基类劫持了接口</a></li>
      </ul>
    </li>
    <li><a href="#1512-自限定的类型">15.12 自限定的类型</a>
      <ul>
        <li><a href="#15121-古怪的循环泛型">15.12.1 古怪的循环泛型</a></li>
        <li><a href="#15122-自限定">15.12.2 自限定</a></li>
        <li><a href="#15123-参数协变">15.12.3 参数协变</a></li>
      </ul>
    </li>
    <li><a href="#1513-动态类型安全">15.13 动态类型安全</a></li>
    <li><a href="#1514异常">15.14异常</a></li>
    <li><a href="#1515-混型">15.15 混型</a>
      <ul>
        <li><a href="#15151-c中的混型">15.15.1 C++中的混型</a></li>
        <li><a href="#152-与接口混合">15.2 与接口混合</a></li>
        <li><a href="#153-使用装饰器模式">15.3 使用装饰器模式</a></li>
        <li><a href="#154-与动态代理混合">15.4 与动态代理混合</a></li>
      </ul>
    </li>
    <li><a href="#1516-潜在类型机制">15.16 潜在类型机制</a></li>
    <li><a href="#1517-对缺乏潜在类型机制的补偿">15.17 对缺乏潜在类型机制的补偿</a></li>
    <li><a href="#1518-将函数对象用作策略">15.18 将函数对象用作策略</a></li>
    <li><a href="#1519-总结转型真的如此之糟吗">15.19 总结：转型真的如此之糟吗？</a></li>
    <li><a href="#相关资料">相关资料</a></li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p><strong>一般的类和方法，只能使用具体的类型：要么是基本类型，要么是自定义的类。如果要编写可以应用于多种类型的代码，这种刻板的限制对代码的束缚就会很大。</strong></p>
<p>在面向对象编程语言中，多态算是一种泛化机制。例如，你可以将方法的参数类型设为基类，那么该方法就可以接受从这个基类中导出的任何类作为参数。这样的方法更加通用一些，可应用的地方也多一些。在类的内部也是如此，凡是需要说明类型的地方，如果都使用基类，确实能够具备更好的灵活性。但是，考虑到除了final类不能扩展，其他任何类都可以被扩展，所以这种灵活性大多数时候也会有一些性能损耗。</p>
<p>有时候，拘泥于单继承体系，也会使程序受限太多。如果方法的参数是一个接口，而不是一个类，这种限制就放松了许多。因为任何实现了该接口的类都能够满足该方法，这也包括暂时还不存在的类。这就给予客户端程序员的一种选择，他可以通过实现一个接口来满足类或方法。因此，接口允许我们快捷地实现类及成果，也使我们有机会创建一个新类来做到这一点。</p>
<p>可是有的时候，即便使用了接口，对程序的约束也还是太强了。因为一旦指明了接口，它就要求你的代码必须使用特定的接口。而我们希望达到的目的是编写更通用的代码，要使代码能够应用于“某种不具体的类型”，而不是一个个具体的接口或类。</p>
<p>这就是Java SE5的重大变化之一：泛型的概念。泛型实现了<code>参数化类型</code>的概念，使代码可以应用于多种类型。“泛型”这个术语的意思是：“使用于许多许多的类型”。泛型在编程语言中出现时，其最初的目的是希望类或方法具备最广泛的表达能力。如何做到这一点呢，正是通过<strong>解耦类或方法所使用的类型之间的约束</strong>。</p>
<h2 id="151-与c的比较">15.1 与C++的比较</h2>
<h2 id="152-简单泛型">15.2 简单泛型</h2>
<p>一个只能持有单个对象的类。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//: generics/Holder1.java
</span><span class="c1"></span>
<span class="kd">class</span> <span class="nc">Automobile</span> <span class="o">{}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Holder1</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">Automobile</span> <span class="n">a</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">Holder1</span><span class="o">(</span><span class="n">Automobile</span> <span class="n">a</span><span class="o">)</span> <span class="o">{</span> <span class="k">this</span><span class="o">.</span><span class="na">a</span> <span class="o">=</span> <span class="n">a</span><span class="o">;</span> <span class="o">}</span>
  <span class="n">Automobile</span> <span class="nf">get</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">a</span><span class="o">;</span> <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~
</span></code></pre></td></tr></table>
</div>
</div><p>在<code>Java SE5</code>之前，可以让这个类直接持有<code>Object</code>类型的对象。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//: generics/Holder2.java
</span><span class="c1"></span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Holder2</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">Object</span> <span class="n">a</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">Holder2</span><span class="o">(</span><span class="n">Object</span> <span class="n">a</span><span class="o">)</span> <span class="o">{</span> <span class="k">this</span><span class="o">.</span><span class="na">a</span> <span class="o">=</span> <span class="n">a</span><span class="o">;</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">set</span><span class="o">(</span><span class="n">Object</span> <span class="n">a</span><span class="o">)</span> <span class="o">{</span> <span class="k">this</span><span class="o">.</span><span class="na">a</span> <span class="o">=</span> <span class="n">a</span><span class="o">;</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="n">Object</span> <span class="nf">get</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">a</span><span class="o">;</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Holder2</span> <span class="n">h2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Holder2</span><span class="o">(</span><span class="k">new</span> <span class="n">Automobile</span><span class="o">());</span>
    <span class="n">Automobile</span> <span class="n">a</span> <span class="o">=</span> <span class="o">(</span><span class="n">Automobile</span><span class="o">)</span><span class="n">h2</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
    <span class="n">h2</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="s">&#34;Not an Automobile&#34;</span><span class="o">);</span>
    <span class="n">String</span> <span class="n">s</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span><span class="n">h2</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
    <span class="n">h2</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">1</span><span class="o">);</span> <span class="c1">// Autoboxes to Integer
</span><span class="c1"></span>    <span class="n">Integer</span> <span class="n">x</span> <span class="o">=</span> <span class="o">(</span><span class="n">Integer</span><span class="o">)</span><span class="n">h2</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~
</span></code></pre></td></tr></table>
</div>
</div><p>泛型的主要目的之一就是用来指定容器要持有什么类型的对象，而且由编译器来保证类型的正确性。因此，与其使用<code>Object</code>，我们更喜欢暂时不指定类型，而是稍后再决定具体使用说明类型。要达到这个目的，需要使用类型参数，用尖括号括住，放在类名后面。然后在使用这个类的时候，再用实际的类型替换此类型参数。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//: generics/Holder3.java
</span><span class="c1"></span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Holder3</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">T</span> <span class="n">a</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">Holder3</span><span class="o">(</span><span class="n">T</span> <span class="n">a</span><span class="o">)</span> <span class="o">{</span> <span class="k">this</span><span class="o">.</span><span class="na">a</span> <span class="o">=</span> <span class="n">a</span><span class="o">;</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">set</span><span class="o">(</span><span class="n">T</span> <span class="n">a</span><span class="o">)</span> <span class="o">{</span> <span class="k">this</span><span class="o">.</span><span class="na">a</span> <span class="o">=</span> <span class="n">a</span><span class="o">;</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="n">T</span> <span class="nf">get</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">a</span><span class="o">;</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Holder3</span><span class="o">&lt;</span><span class="n">Automobile</span><span class="o">&gt;</span> <span class="n">h3</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Holder3</span><span class="o">&lt;</span><span class="n">Automobile</span><span class="o">&gt;(</span><span class="k">new</span> <span class="n">Automobile</span><span class="o">());</span>
    <span class="n">Automobile</span> <span class="n">a</span> <span class="o">=</span> <span class="n">h3</span><span class="o">.</span><span class="na">get</span><span class="o">();</span> <span class="c1">// No cast needed
</span><span class="c1"></span>    <span class="c1">// h3.set(&#34;Not an Automobile&#34;); // Error
</span><span class="c1"></span>    <span class="c1">// h3.set(1); // Error
</span><span class="c1"></span>  <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:
</span></code></pre></td></tr></table>
</div>
</div><h3 id="1521-一个元组类库">15.2.1 一个元组类库</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//: net/mindview/util/TwoTuple.java
</span><span class="c1"></span><span class="kn">package</span> <span class="nn">net.mindview.util</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TwoTuple</span><span class="o">&lt;</span><span class="n">A</span><span class="o">,</span><span class="n">B</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">final</span> <span class="n">A</span> <span class="n">first</span><span class="o">;</span>
  <span class="kd">public</span> <span class="kd">final</span> <span class="n">B</span> <span class="n">second</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">TwoTuple</span><span class="o">(</span><span class="n">A</span> <span class="n">a</span><span class="o">,</span> <span class="n">B</span> <span class="n">b</span><span class="o">)</span> <span class="o">{</span> <span class="n">first</span> <span class="o">=</span> <span class="n">a</span><span class="o">;</span> <span class="n">second</span> <span class="o">=</span> <span class="n">b</span><span class="o">;</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="s">&#34;(&#34;</span> <span class="o">+</span> <span class="n">first</span> <span class="o">+</span> <span class="s">&#34;, &#34;</span> <span class="o">+</span> <span class="n">second</span> <span class="o">+</span> <span class="s">&#34;)&#34;</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~
</span></code></pre></td></tr></table>
</div>
</div><p>利用继承机制实现长度更长的元组。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//: net/mindview/util/ThreeTuple.java
</span><span class="c1"></span><span class="kn">package</span> <span class="nn">net.mindview.util</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ThreeTuple</span><span class="o">&lt;</span><span class="n">A</span><span class="o">,</span><span class="n">B</span><span class="o">,</span><span class="n">C</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="n">TwoTuple</span><span class="o">&lt;</span><span class="n">A</span><span class="o">,</span><span class="n">B</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">final</span> <span class="n">C</span> <span class="n">third</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">ThreeTuple</span><span class="o">(</span><span class="n">A</span> <span class="n">a</span><span class="o">,</span> <span class="n">B</span> <span class="n">b</span><span class="o">,</span> <span class="n">C</span> <span class="n">c</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">);</span>
    <span class="n">third</span> <span class="o">=</span> <span class="n">c</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="s">&#34;(&#34;</span> <span class="o">+</span> <span class="n">first</span> <span class="o">+</span> <span class="s">&#34;, &#34;</span> <span class="o">+</span> <span class="n">second</span> <span class="o">+</span> <span class="s">&#34;, &#34;</span> <span class="o">+</span> <span class="n">third</span> <span class="o">+</span><span class="s">&#34;)&#34;</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~
</span><span class="c1"></span>

<span class="c1">//: net/mindview/util/FourTuple.java
</span><span class="c1"></span><span class="kn">package</span> <span class="nn">net.mindview.util</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FourTuple</span><span class="o">&lt;</span><span class="n">A</span><span class="o">,</span><span class="n">B</span><span class="o">,</span><span class="n">C</span><span class="o">,</span><span class="n">D</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="n">ThreeTuple</span><span class="o">&lt;</span><span class="n">A</span><span class="o">,</span><span class="n">B</span><span class="o">,</span><span class="n">C</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">final</span> <span class="n">D</span> <span class="n">fourth</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">FourTuple</span><span class="o">(</span><span class="n">A</span> <span class="n">a</span><span class="o">,</span> <span class="n">B</span> <span class="n">b</span><span class="o">,</span> <span class="n">C</span> <span class="n">c</span><span class="o">,</span> <span class="n">D</span> <span class="n">d</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">,</span> <span class="n">c</span><span class="o">);</span>
    <span class="n">fourth</span> <span class="o">=</span> <span class="n">d</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="s">&#34;(&#34;</span> <span class="o">+</span> <span class="n">first</span> <span class="o">+</span> <span class="s">&#34;, &#34;</span> <span class="o">+</span> <span class="n">second</span> <span class="o">+</span> <span class="s">&#34;, &#34;</span> <span class="o">+</span>
      <span class="n">third</span> <span class="o">+</span> <span class="s">&#34;, &#34;</span> <span class="o">+</span> <span class="n">fourth</span> <span class="o">+</span> <span class="s">&#34;)&#34;</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~
</span></code></pre></td></tr></table>
</div>
</div><p>为了使用元组，你只需定义一个长度适合的元组，将其作为方法的返回值，然后在<code>return</code>语句中创建该元组，并返回即可。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//: generics/TupleTest.java
</span><span class="c1"></span><span class="kn">import</span> <span class="nn">net.mindview.util.*</span><span class="o">;</span>

<span class="kd">class</span> <span class="nc">Amphibian</span> <span class="o">{}</span>
<span class="kd">class</span> <span class="nc">Vehicle</span> <span class="o">{}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TupleTest</span> <span class="o">{</span>
  <span class="kd">static</span> <span class="n">TwoTuple</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="nf">f</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// Autoboxing converts the int to Integer:
</span><span class="c1"></span>    <span class="k">return</span> <span class="k">new</span> <span class="n">TwoTuple</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;(</span><span class="s">&#34;hi&#34;</span><span class="o">,</span> <span class="n">47</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">static</span> <span class="n">ThreeTuple</span><span class="o">&lt;</span><span class="n">Amphibian</span><span class="o">,</span><span class="n">String</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="nf">g</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">ThreeTuple</span><span class="o">&lt;</span><span class="n">Amphibian</span><span class="o">,</span> <span class="n">String</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;(</span>
      <span class="k">new</span> <span class="n">Amphibian</span><span class="o">(),</span> <span class="s">&#34;hi&#34;</span><span class="o">,</span> <span class="n">47</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">static</span> <span class="n">FourTuple</span><span class="o">&lt;</span><span class="n">Vehicle</span><span class="o">,</span><span class="n">Amphibian</span><span class="o">,</span><span class="n">String</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="nf">h</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">FourTuple</span><span class="o">&lt;</span><span class="n">Vehicle</span><span class="o">,</span><span class="n">Amphibian</span><span class="o">,</span><span class="n">String</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;(</span>
        <span class="k">new</span> <span class="n">Vehicle</span><span class="o">(),</span> <span class="k">new</span> <span class="n">Amphibian</span><span class="o">(),</span> <span class="s">&#34;hi&#34;</span><span class="o">,</span> <span class="n">47</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">static</span> <span class="n">FiveTuple</span><span class="o">&lt;</span><span class="n">Vehicle</span><span class="o">,</span><span class="n">Amphibian</span><span class="o">,</span><span class="n">String</span><span class="o">,</span><span class="n">Integer</span><span class="o">,</span><span class="n">Double</span><span class="o">&gt;</span> <span class="nf">k</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span>
      <span class="n">FiveTuple</span><span class="o">&lt;</span><span class="n">Vehicle</span><span class="o">,</span><span class="n">Amphibian</span><span class="o">,</span><span class="n">String</span><span class="o">,</span><span class="n">Integer</span><span class="o">,</span><span class="n">Double</span><span class="o">&gt;(</span>
        <span class="k">new</span> <span class="n">Vehicle</span><span class="o">(),</span> <span class="k">new</span> <span class="n">Amphibian</span><span class="o">(),</span> <span class="s">&#34;hi&#34;</span><span class="o">,</span> <span class="n">47</span><span class="o">,</span> <span class="n">11</span><span class="o">.</span><span class="na">1</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">TwoTuple</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">ttsi</span> <span class="o">=</span> <span class="n">f</span><span class="o">();</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">ttsi</span><span class="o">);</span>
    <span class="c1">// ttsi.first = &#34;there&#34;; // Compile error: final
</span><span class="c1"></span>    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">g</span><span class="o">());</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">h</span><span class="o">());</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">k</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output: (80% match)
</span><span class="cm">(hi, 47)
</span><span class="cm">(Amphibian@1f6a7b9, hi, 47)
</span><span class="cm">(Vehicle@35ce36, Amphibian@757aef, hi, 47)
</span><span class="cm">(Vehicle@9cab16, Amphibian@1a46e30, hi, 47, 11.1)
</span><span class="cm">*/</span><span class="c1">//:~
</span></code></pre></td></tr></table>
</div>
</div><h3 id="1522-一个堆栈类">15.2.2 一个堆栈类</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//: generics/LinkedStack.java
</span><span class="c1">// A stack implemented with an internal linked structure.
</span><span class="c1"></span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">LinkedStack</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="c1">//Node类
</span><span class="c1"></span>  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Node</span><span class="o">&lt;</span><span class="n">U</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="n">U</span> <span class="n">item</span><span class="o">;</span>
    <span class="n">Node</span><span class="o">&lt;</span><span class="n">U</span><span class="o">&gt;</span> <span class="n">next</span><span class="o">;</span>
    <span class="n">Node</span><span class="o">()</span> <span class="o">{</span> <span class="n">item</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span> <span class="n">next</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span> <span class="o">}</span>
    <span class="n">Node</span><span class="o">(</span><span class="n">U</span> <span class="n">item</span><span class="o">,</span> <span class="n">Node</span><span class="o">&lt;</span><span class="n">U</span><span class="o">&gt;</span> <span class="n">next</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">this</span><span class="o">.</span><span class="na">item</span> <span class="o">=</span> <span class="n">item</span><span class="o">;</span>
      <span class="k">this</span><span class="o">.</span><span class="na">next</span> <span class="o">=</span> <span class="n">next</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kt">boolean</span> <span class="nf">end</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">item</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">next</span> <span class="o">==</span> <span class="kc">null</span><span class="o">;</span> <span class="o">}</span>
  <span class="o">}</span>
  <span class="kd">private</span> <span class="n">Node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">top</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;();</span> <span class="c1">// End sentinel
</span><span class="c1"></span>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">push</span><span class="o">(</span><span class="n">T</span> <span class="n">item</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">top</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;(</span><span class="n">item</span><span class="o">,</span> <span class="n">top</span><span class="o">);</span>
  <span class="o">}</span>    
  <span class="kd">public</span> <span class="n">T</span> <span class="nf">pop</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">T</span> <span class="n">result</span> <span class="o">=</span> <span class="n">top</span><span class="o">.</span><span class="na">item</span><span class="o">;</span>
    <span class="k">if</span><span class="o">(!</span><span class="n">top</span><span class="o">.</span><span class="na">end</span><span class="o">())</span>
      <span class="n">top</span> <span class="o">=</span> <span class="n">top</span><span class="o">.</span><span class="na">next</span><span class="o">;</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">LinkedStack</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">lss</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinkedStack</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;();</span>
    <span class="k">for</span><span class="o">(</span><span class="n">String</span> <span class="n">s</span> <span class="o">:</span> <span class="s">&#34;Phasers on stun!&#34;</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">&#34; &#34;</span><span class="o">))</span>
      <span class="n">lss</span><span class="o">.</span><span class="na">push</span><span class="o">(</span><span class="n">s</span><span class="o">);</span>
    <span class="n">String</span> <span class="n">s</span><span class="o">;</span>
    <span class="k">while</span><span class="o">((</span><span class="n">s</span> <span class="o">=</span> <span class="n">lss</span><span class="o">.</span><span class="na">pop</span><span class="o">())</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">s</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output:
</span><span class="cm">stun!
</span><span class="cm">on
</span><span class="cm">Phasers
</span><span class="cm">*/</span><span class="c1">//:~
</span></code></pre></td></tr></table>
</div>
</div><h3 id="1523-randomlist">15.2.3 RandomList</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//: generics/RandomList.java
</span><span class="c1"></span><span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">RandomList</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">storage</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;();</span>
  <span class="kd">private</span> <span class="n">Random</span> <span class="n">rand</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Random</span><span class="o">(</span><span class="n">47</span><span class="o">);</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="n">T</span> <span class="n">item</span><span class="o">)</span> <span class="o">{</span> <span class="n">storage</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">item</span><span class="o">);</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="n">T</span> <span class="nf">select</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">storage</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">rand</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="n">storage</span><span class="o">.</span><span class="na">size</span><span class="o">()));</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">RandomList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">rs</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RandomList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;();</span>
    <span class="k">for</span><span class="o">(</span><span class="n">String</span> <span class="n">s</span><span class="o">:</span> <span class="o">(</span><span class="s">&#34;The quick brown fox jumped over &#34;</span> <span class="o">+</span>
        <span class="s">&#34;the lazy brown dog&#34;</span><span class="o">).</span><span class="na">split</span><span class="o">(</span><span class="s">&#34; &#34;</span><span class="o">))</span>
      <span class="n">rs</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">s</span><span class="o">);</span>
    <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">11</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">rs</span><span class="o">.</span><span class="na">select</span><span class="o">()</span> <span class="o">+</span> <span class="s">&#34; &#34;</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output:
</span><span class="cm">brown over fox quick quick dog brown The brown lazy brown
</span><span class="cm">*/</span><span class="c1">//:~
</span></code></pre></td></tr></table>
</div>
</div><h2 id="153-泛型接口">15.3 泛型接口</h2>
<p>泛型也可以应用于接口。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//: net/mindview/util/Generator.java
</span><span class="c1">// A generic interface.
</span><span class="c1"></span><span class="kn">package</span> <span class="nn">net.mindview.util</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Generator</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">{</span> <span class="n">T</span> <span class="nf">next</span><span class="o">();</span> <span class="o">}</span> <span class="c1">///:~
</span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//: generics/coffee/Coffee.java
</span><span class="c1"></span><span class="kn">package</span> <span class="nn">generics.coffee</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Coffee</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="kt">long</span> <span class="n">counter</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">id</span> <span class="o">=</span> <span class="n">counter</span><span class="o">++;</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">getClass</span><span class="o">().</span><span class="na">getSimpleName</span><span class="o">()</span> <span class="o">+</span> <span class="s">&#34; &#34;</span> <span class="o">+</span> <span class="n">id</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~
</span><span class="c1"></span>

<span class="c1">//: generics/coffee/Latte.java
</span><span class="c1"></span><span class="kn">package</span> <span class="nn">generics.coffee</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Latte</span> <span class="kd">extends</span> <span class="n">Coffee</span> <span class="o">{}</span> <span class="c1">///:~
</span><span class="c1"></span>
<span class="c1">//: generics/coffee/Mocha.java
</span><span class="c1"></span><span class="kn">package</span> <span class="nn">generics.coffee</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Mocha</span> <span class="kd">extends</span> <span class="n">Coffee</span> <span class="o">{}</span> <span class="c1">///:~
</span><span class="c1"></span>
<span class="c1">//: generics/coffee/Cappuccino.java
</span><span class="c1"></span><span class="kn">package</span> <span class="nn">generics.coffee</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Cappuccino</span> <span class="kd">extends</span> <span class="n">Coffee</span> <span class="o">{}</span> <span class="c1">///:~
</span><span class="c1"></span>
<span class="c1">//: generics/coffee/Americano.java
</span><span class="c1"></span><span class="kn">package</span> <span class="nn">generics.coffee</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Americano</span> <span class="kd">extends</span> <span class="n">Coffee</span> <span class="o">{}</span> <span class="c1">///:~
</span><span class="c1"></span>

<span class="c1">//: generics/coffee/Breve.java
</span><span class="c1"></span><span class="kn">package</span> <span class="nn">generics.coffee</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Breve</span> <span class="kd">extends</span> <span class="n">Coffee</span> <span class="o">{}</span> <span class="c1">///:~
</span></code></pre></td></tr></table>
</div>
</div><p>编写一个类，实现<code>Generator&lt;Coffee&gt;</code>接口。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//: generics/coffee/CoffeeGenerator.java
</span><span class="c1">// Generate different types of Coffee:
</span><span class="c1"></span><span class="kn">package</span> <span class="nn">generics.coffee</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">net.mindview.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CoffeeGenerator</span> <span class="kd">implements</span> <span class="n">Generator</span><span class="o">&lt;</span><span class="n">Coffee</span><span class="o">&gt;,</span> <span class="n">Iterable</span><span class="o">&lt;</span><span class="n">Coffee</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">Class</span><span class="o">[]</span> <span class="n">types</span> <span class="o">=</span> <span class="o">{</span> <span class="n">Latte</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">Mocha</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
    <span class="n">Cappuccino</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">Americano</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">Breve</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="o">};</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="n">Random</span> <span class="n">rand</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Random</span><span class="o">(</span><span class="n">47</span><span class="o">);</span>
  <span class="kd">public</span> <span class="nf">CoffeeGenerator</span><span class="o">()</span> <span class="o">{}</span>
  <span class="c1">// For iteration:
</span><span class="c1"></span>  <span class="kd">private</span> <span class="kt">int</span> <span class="n">size</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">CoffeeGenerator</span><span class="o">(</span><span class="kt">int</span> <span class="n">sz</span><span class="o">)</span> <span class="o">{</span> <span class="n">size</span> <span class="o">=</span> <span class="n">sz</span><span class="o">;</span> <span class="o">}</span>    
  <span class="kd">public</span> <span class="n">Coffee</span> <span class="nf">next</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">{</span> <span class="c1">//随机生成一种类型
</span><span class="c1"></span>      <span class="k">return</span> <span class="o">(</span><span class="n">Coffee</span><span class="o">)</span><span class="n">types</span><span class="o">[</span><span class="n">rand</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="n">types</span><span class="o">.</span><span class="na">length</span><span class="o">)].</span><span class="na">newInstance</span><span class="o">();</span>
      <span class="c1">// Report programmer errors at run time:
</span><span class="c1"></span>    <span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="n">RuntimeException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
  <span class="c1">//迭代器
</span><span class="c1"></span>  <span class="kd">class</span> <span class="nc">CoffeeIterator</span> <span class="kd">implements</span> <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">Coffee</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="n">size</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">hasNext</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="n">0</span><span class="o">;</span> <span class="o">}</span>
    <span class="kd">public</span> <span class="n">Coffee</span> <span class="nf">next</span><span class="o">()</span> <span class="o">{</span>
      <span class="n">count</span><span class="o">--;</span>
      <span class="k">return</span> <span class="n">CoffeeGenerator</span><span class="o">.</span><span class="na">this</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">remove</span><span class="o">()</span> <span class="o">{</span> <span class="c1">// Not implemented
</span><span class="c1"></span>      <span class="k">throw</span> <span class="k">new</span> <span class="n">UnsupportedOperationException</span><span class="o">();</span>
    <span class="o">}</span>
  <span class="o">};</span>    
  <span class="kd">public</span> <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">Coffee</span><span class="o">&gt;</span> <span class="nf">iterator</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">CoffeeIterator</span><span class="o">();</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">CoffeeGenerator</span> <span class="n">gen</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CoffeeGenerator</span><span class="o">();</span>
    <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">5</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">gen</span><span class="o">.</span><span class="na">next</span><span class="o">());</span>
    <span class="k">for</span><span class="o">(</span><span class="n">Coffee</span> <span class="n">c</span> <span class="o">:</span> <span class="k">new</span> <span class="n">CoffeeGenerator</span><span class="o">(</span><span class="n">5</span><span class="o">))</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output:
</span><span class="cm">Americano 0
</span><span class="cm">Latte 1
</span><span class="cm">Americano 2
</span><span class="cm">Mocha 3
</span><span class="cm">Mocha 4
</span><span class="cm">Breve 5
</span><span class="cm">Americano 6
</span><span class="cm">Latte 7
</span><span class="cm">Cappuccino 8
</span><span class="cm">Cappuccino 9
</span><span class="cm">*/</span><span class="c1">//:~
</span></code></pre></td></tr></table>
</div>
</div><p>下面的类是<code>Generator&lt;T&gt;</code>接口的另一个实现，它负责生成<code>Fibonacci</code>数列：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//: generics/Fibonacci.java
</span><span class="c1">// Generate a Fibonacci sequence.
</span><span class="c1"></span><span class="kn">import</span> <span class="nn">net.mindview.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Fibonacci</span> <span class="kd">implements</span> <span class="n">Generator</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
  <span class="kd">public</span> <span class="n">Integer</span> <span class="nf">next</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">fib</span><span class="o">(</span><span class="n">count</span><span class="o">++);</span> <span class="o">}</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="nf">fib</span><span class="o">(</span><span class="kt">int</span> <span class="n">n</span><span class="o">)</span> <span class="o">{</span> <span class="c1">//递归
</span><span class="c1"></span>    <span class="k">if</span><span class="o">(</span><span class="n">n</span> <span class="o">&lt;</span> <span class="n">2</span><span class="o">)</span> <span class="k">return</span> <span class="n">1</span><span class="o">;</span>
    <span class="k">return</span> <span class="n">fib</span><span class="o">(</span><span class="n">n</span><span class="o">-</span><span class="n">2</span><span class="o">)</span> <span class="o">+</span> <span class="n">fib</span><span class="o">(</span><span class="n">n</span><span class="o">-</span><span class="n">1</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Fibonacci</span> <span class="n">gen</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Fibonacci</span><span class="o">();</span>
    <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">18</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">gen</span><span class="o">.</span><span class="na">next</span><span class="o">()</span> <span class="o">+</span> <span class="s">&#34; &#34;</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output:
</span><span class="cm">1 1 2 3 5 8 13 21 34 55 89 144 233 377 610 987 1597 2584
</span><span class="cm">*/</span><span class="c1">//:~
</span></code></pre></td></tr></table>
</div>
</div><p>虽然我们在<code>Fibonacci</code>类使用的都是<code>int</code>类型，但是其类型参数却是<code>Integer</code>。这个例子引出了<code>Java</code>泛型的一个局限性：基本类型无法作为类型参数。不过，<code>Java SE5</code>具备了自动打包和自动拆包的功能，可以很方便地在基本类型和相应的包装类型之间进行转换。</p>
<p>通过继承来创建适配器类：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//: generics/IterableFibonacci.java
</span><span class="c1">// Adapt the Fibonacci class to make it Iterable.
</span><span class="c1"></span><span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">IterableFibonacci</span>
<span class="kd">extends</span> <span class="n">Fibonacci</span> <span class="kd">implements</span> <span class="n">Iterable</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">n</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">IterableFibonacci</span><span class="o">(</span><span class="kt">int</span> <span class="n">count</span><span class="o">)</span> <span class="o">{</span> <span class="n">n</span> <span class="o">=</span> <span class="n">count</span><span class="o">;</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="nf">iterator</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;()</span> <span class="o">{</span>
      <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">hasNext</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="n">0</span><span class="o">;</span> <span class="o">}</span>
      <span class="kd">public</span> <span class="n">Integer</span> <span class="nf">next</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">n</span><span class="o">--;</span>
        <span class="k">return</span> <span class="n">IterableFibonacci</span><span class="o">.</span><span class="na">this</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
      <span class="o">}</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">remove</span><span class="o">()</span> <span class="o">{</span> <span class="c1">// Not implemented
</span><span class="c1"></span>        <span class="k">throw</span> <span class="k">new</span> <span class="n">UnsupportedOperationException</span><span class="o">();</span>
      <span class="o">}</span>
    <span class="o">};</span>
  <span class="o">}</span>    
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">:</span> <span class="k">new</span> <span class="n">IterableFibonacci</span><span class="o">(</span><span class="n">18</span><span class="o">))</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">i</span> <span class="o">+</span> <span class="s">&#34; &#34;</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output:
</span><span class="cm">1 1 2 3 5 8 13 21 34 55 89 144 233 377 610 987 1597 2584
</span><span class="cm">*/</span><span class="c1">//:~
</span></code></pre></td></tr></table>
</div>
</div><h2 id="154-泛型方法">15.4 泛型方法</h2>
<p>到目前为止，我们看到的泛型，都是应用于整个类上。但同样可以在类中包含参数化方法，而这个方法所在的类可以是泛型类，也可以不是泛型类。</p>
<p>如果使用泛型方法可以取代将整个类泛型化，那么就应该只使用泛型方法，因为它可以使事情更清楚明白。</p>
<p>要定义泛型方法，只需将泛型参数列表置于返回值之前，就像下面这样：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//: generics/GenericMethods.java
</span><span class="c1"></span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">GenericMethods</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="kt">void</span> <span class="nf">f</span><span class="o">(</span><span class="n">T</span> <span class="n">x</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">x</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getName</span><span class="o">());</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">GenericMethods</span> <span class="n">gm</span> <span class="o">=</span> <span class="k">new</span> <span class="n">GenericMethods</span><span class="o">();</span>
    <span class="n">gm</span><span class="o">.</span><span class="na">f</span><span class="o">(</span><span class="s">&#34;&#34;</span><span class="o">);</span>
    <span class="n">gm</span><span class="o">.</span><span class="na">f</span><span class="o">(</span><span class="n">1</span><span class="o">);</span><span class="c1">//传入基本类型，自动打包机制就会介入其中，将基本类型的值包装为对应的对象。
</span><span class="c1"></span>    <span class="n">gm</span><span class="o">.</span><span class="na">f</span><span class="o">(</span><span class="n">1</span><span class="o">.</span><span class="na">0</span><span class="o">);</span>
    <span class="n">gm</span><span class="o">.</span><span class="na">f</span><span class="o">(</span><span class="n">1</span><span class="o">.</span><span class="na">0F</span><span class="o">);</span>
    <span class="n">gm</span><span class="o">.</span><span class="na">f</span><span class="o">(</span><span class="sc">&#39;c&#39;</span><span class="o">);</span>
    <span class="n">gm</span><span class="o">.</span><span class="na">f</span><span class="o">(</span><span class="n">gm</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output:
</span><span class="cm">java.lang.String
</span><span class="cm">java.lang.Integer
</span><span class="cm">java.lang.Double
</span><span class="cm">java.lang.Float
</span><span class="cm">java.lang.Character
</span><span class="cm">GenericMethods
</span><span class="cm">*/</span><span class="c1">//:~
</span></code></pre></td></tr></table>
</div>
</div><h3 id="1541-杠杆利用类型参数推断">15.4.1 杠杆利用类型参数推断</h3>
<p>创建一个持有<code>List</code>的<code>Map</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="n">Map</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">,</span><span class="n">List</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="n">Pet</span><span class="o">&gt;&gt;</span> <span class="n">petPeople</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">,</span><span class="n">List</span><span class="o">&lt;?</span> <span class="n">extendsPet</span><span class="o">&gt;&gt;();</span>
</code></pre></td></tr></table>
</div>
</div><p>编译器本来应该能够从泛型参数列表中的参数推断出另一个参数，编译器暂时还做不到（Java7能做到了）。</p>
<p>编写一个工具类，它包含各种各样的<code>static</code>方法，专门用来创建各种常用的容器对象：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//: net/mindview/util/New.java
</span><span class="c1">// Utilities to simplify generic container creation
</span><span class="c1">// by using type argument inference.
</span><span class="c1"></span><span class="kn">package</span> <span class="nn">net.mindview.util</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">New</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="nf">map</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;();</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="nf">list</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;();</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">LinkedList</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="nf">lList</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">LinkedList</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;();</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="nf">set</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">HashSet</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;();</span>
  <span class="o">}</span>    
  <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">Queue</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="nf">queue</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">LinkedList</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;();</span>
  <span class="o">}</span>
  <span class="c1">// Examples:
</span><span class="c1"></span>  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;&gt;</span> <span class="n">sls</span> <span class="o">=</span> <span class="n">New</span><span class="o">.</span><span class="na">map</span><span class="o">();</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">ls</span> <span class="o">=</span> <span class="n">New</span><span class="o">.</span><span class="na">list</span><span class="o">();</span>
    <span class="n">LinkedList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">lls</span> <span class="o">=</span> <span class="n">New</span><span class="o">.</span><span class="na">lList</span><span class="o">();</span>
    <span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">ss</span> <span class="o">=</span> <span class="n">New</span><span class="o">.</span><span class="na">set</span><span class="o">();</span>
    <span class="n">Queue</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">qs</span> <span class="o">=</span> <span class="n">New</span><span class="o">.</span><span class="na">queue</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~
</span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//: generics/SimplerPets.java
</span><span class="c1"></span><span class="kn">import</span> <span class="nn">typeinfo.pets.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">net.mindview.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SimplerPets</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Map</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">,</span> <span class="n">List</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="n">Pet</span><span class="o">&gt;&gt;</span> <span class="n">petPeople</span> <span class="o">=</span> <span class="n">New</span><span class="o">.</span><span class="na">map</span><span class="o">();</span>
    <span class="c1">// Rest of the code is the same...
</span><span class="c1"></span>  <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~
</span></code></pre></td></tr></table>
</div>
</div><p>类型推断只对赋值操作有效，其他时候并不起作用。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//: generics/LimitsOfInference.java
</span><span class="c1"></span><span class="kn">import</span> <span class="nn">typeinfo.pets.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">LimitsOfInference</span> <span class="o">{</span>
  <span class="kd">static</span> <span class="kt">void</span>
  <span class="nf">f</span><span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">,</span> <span class="n">List</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="n">Pet</span><span class="o">&gt;&gt;</span> <span class="n">petPeople</span><span class="o">)</span> <span class="o">{}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// f(New.map()); // Does not compile
</span><span class="c1"></span>  <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~
</span></code></pre></td></tr></table>
</div>
</div><h4 id="显式的类型说明">显式的类型说明</h4>
<p>在泛型方法中，可以显式地指明类型。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//: generics/ExplicitTypeSpecification.java
</span><span class="c1"></span><span class="kn">import</span> <span class="nn">typeinfo.pets.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">net.mindview.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ExplicitTypeSpecification</span> <span class="o">{</span>
  <span class="kd">static</span> <span class="kt">void</span> <span class="nf">f</span><span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Pet</span><span class="o">&gt;&gt;</span> <span class="n">petPeople</span><span class="o">)</span> <span class="o">{}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">f</span><span class="o">(</span><span class="n">New</span><span class="o">.&lt;</span><span class="n">Person</span><span class="o">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Pet</span><span class="o">&gt;&gt;</span><span class="n">map</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~
</span></code></pre></td></tr></table>
</div>
</div><h3 id="1542-可变参数与泛型方法">15.4.2 可变参数与泛型方法</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//: generics/GenericVarargs.java
</span><span class="c1"></span><span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">GenericVarargs</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="nf">makeList</span><span class="o">(</span><span class="n">T</span><span class="o">...</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;();</span>
    <span class="k">for</span><span class="o">(</span><span class="n">T</span> <span class="n">item</span> <span class="o">:</span> <span class="n">args</span><span class="o">)</span>
      <span class="n">result</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">item</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">ls</span> <span class="o">=</span> <span class="n">makeList</span><span class="o">(</span><span class="s">&#34;A&#34;</span><span class="o">);</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">ls</span><span class="o">);</span>
    <span class="n">ls</span> <span class="o">=</span> <span class="n">makeList</span><span class="o">(</span><span class="s">&#34;A&#34;</span><span class="o">,</span> <span class="s">&#34;B&#34;</span><span class="o">,</span> <span class="s">&#34;C&#34;</span><span class="o">);</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">ls</span><span class="o">);</span>
    <span class="n">ls</span> <span class="o">=</span> <span class="n">makeList</span><span class="o">(</span><span class="s">&#34;ABCDEFFHIJKLMNOPQRSTUVWXYZ&#34;</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">&#34;&#34;</span><span class="o">));</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">ls</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output:
</span><span class="cm">[A]
</span><span class="cm">[A, B, C]
</span><span class="cm">[, A, B, C, D, E, F, F, H, I, J, K, L, M, N, O, P, Q, R, S, T, U, V, W, X, Y, Z]
</span><span class="cm">*/</span><span class="c1">//:~
</span></code></pre></td></tr></table>
</div>
</div><h3 id="1543-用于generator的泛型方法">15.4.3 用于Generator的泛型方法</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//: generics/Generators.java
</span><span class="c1">// A utility to use with Generators.
</span><span class="c1"></span><span class="kn">import</span> <span class="nn">generics.coffee.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">net.mindview.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Generators</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">Collection</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="nf">fill</span><span class="o">(</span><span class="n">Collection</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">coll</span><span class="o">,</span> <span class="n">Generator</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">gen</span><span class="o">,</span> <span class="kt">int</span> <span class="n">n</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span>
      <span class="n">coll</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">gen</span><span class="o">.</span><span class="na">next</span><span class="o">());</span>
    <span class="k">return</span> <span class="n">coll</span><span class="o">;</span>
  <span class="o">}</span>    
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Collection</span><span class="o">&lt;</span><span class="n">Coffee</span><span class="o">&gt;</span> <span class="n">coffee</span> <span class="o">=</span> <span class="n">fill</span><span class="o">(</span><span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Coffee</span><span class="o">&gt;(),</span> <span class="k">new</span> <span class="n">CoffeeGenerator</span><span class="o">(),</span> <span class="n">4</span><span class="o">);</span>
    <span class="k">for</span><span class="o">(</span><span class="n">Coffee</span> <span class="n">c</span> <span class="o">:</span> <span class="n">coffee</span><span class="o">)</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
    <span class="n">Collection</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">fnumbers</span> <span class="o">=</span> <span class="n">fill</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;(),</span> <span class="k">new</span> <span class="n">Fibonacci</span><span class="o">(),</span> <span class="n">12</span><span class="o">);</span>
    <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">:</span> <span class="n">fnumbers</span><span class="o">)</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">i</span> <span class="o">+</span> <span class="s">&#34;, &#34;</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output:
</span><span class="cm">Americano 0
</span><span class="cm">Latte 1
</span><span class="cm">Americano 2
</span><span class="cm">Mocha 3
</span><span class="cm">1, 1, 2, 3, 5, 8, 13, 21, 34, 55, 89, 144,
</span><span class="cm">*/</span><span class="c1">//:~
</span></code></pre></td></tr></table>
</div>
</div><h3 id="1544-一个通用的generator">15.4.4 一个通用的Generator</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//: net/mindview/util/BasicGenerator.java
</span><span class="c1">// Automatically create a Generator, given a class
</span><span class="c1">// with a default (no-arg) constructor.
</span><span class="c1"></span><span class="kn">package</span> <span class="nn">net.mindview.util</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">BasicGenerator</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="kd">implements</span> <span class="n">Generator</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">Class</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">type</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">BasicGenerator</span><span class="o">(</span><span class="n">Class</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">type</span><span class="o">){</span> <span class="k">this</span><span class="o">.</span><span class="na">type</span> <span class="o">=</span> <span class="n">type</span><span class="o">;</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="n">T</span> <span class="nf">next</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="c1">// Assumes type is a public class:
</span><span class="c1"></span>      <span class="k">return</span> <span class="n">type</span><span class="o">.</span><span class="na">newInstance</span><span class="o">();</span> <span class="c1">//采用默认构造函数
</span><span class="c1"></span>    <span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="n">RuntimeException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
  <span class="c1">// Produce a Default generator given a type token:
</span><span class="c1"></span>  <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">Generator</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="nf">create</span><span class="o">(</span><span class="n">Class</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">type</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">BasicGenerator</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;(</span><span class="n">type</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~
</span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//: generics/CountedObject.java
</span><span class="c1"></span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CountedObject</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="kt">long</span> <span class="n">counter</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">id</span> <span class="o">=</span> <span class="n">counter</span><span class="o">++;</span>
  <span class="kd">public</span> <span class="kt">long</span> <span class="nf">id</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">id</span><span class="o">;</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="s">&#34;CountedObject &#34;</span> <span class="o">+</span> <span class="n">id</span><span class="o">;}</span>
<span class="o">}</span> <span class="c1">///:~
</span></code></pre></td></tr></table>
</div>
</div><p>使用<code>BasicGenerator</code>，可以很容易地位<code>CountedObject</code>创建一个<code>Generator</code>：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//: generics/BasicGeneratorDemo.java
</span><span class="c1"></span><span class="kn">import</span> <span class="nn">net.mindview.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">BasicGeneratorDemo</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Generator</span><span class="o">&lt;</span><span class="n">CountedObject</span><span class="o">&gt;</span> <span class="n">gen</span> <span class="o">=</span>
      <span class="n">BasicGenerator</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">CountedObject</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">5</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">gen</span><span class="o">.</span><span class="na">next</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output:
</span><span class="cm">CountedObject 0
</span><span class="cm">CountedObject 1
</span><span class="cm">CountedObject 2
</span><span class="cm">CountedObject 3
</span><span class="cm">CountedObject 4
</span><span class="cm">*/</span><span class="c1">//:~
</span></code></pre></td></tr></table>
</div>
</div><h3 id="1545-简化元组的使用">15.4.5 简化元组的使用</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//: net/mindview/util/Tuple.java
</span><span class="c1">// Tuple library using type argument inference.
</span><span class="c1"></span><span class="kn">package</span> <span class="nn">net.mindview.util</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Tuple</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="n">A</span><span class="o">,</span><span class="n">B</span><span class="o">&gt;</span> <span class="n">TwoTuple</span><span class="o">&lt;</span><span class="n">A</span><span class="o">,</span><span class="n">B</span><span class="o">&gt;</span> <span class="nf">tuple</span><span class="o">(</span><span class="n">A</span> <span class="n">a</span><span class="o">,</span> <span class="n">B</span> <span class="n">b</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">TwoTuple</span><span class="o">&lt;</span><span class="n">A</span><span class="o">,</span><span class="n">B</span><span class="o">&gt;(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="n">A</span><span class="o">,</span><span class="n">B</span><span class="o">,</span><span class="n">C</span><span class="o">&gt;</span> <span class="n">ThreeTuple</span><span class="o">&lt;</span><span class="n">A</span><span class="o">,</span><span class="n">B</span><span class="o">,</span><span class="n">C</span><span class="o">&gt;</span> <span class="nf">tuple</span><span class="o">(</span><span class="n">A</span> <span class="n">a</span><span class="o">,</span> <span class="n">B</span> <span class="n">b</span><span class="o">,</span> <span class="n">C</span> <span class="n">c</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">ThreeTuple</span><span class="o">&lt;</span><span class="n">A</span><span class="o">,</span><span class="n">B</span><span class="o">,</span><span class="n">C</span><span class="o">&gt;(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">,</span> <span class="n">c</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="n">A</span><span class="o">,</span><span class="n">B</span><span class="o">,</span><span class="n">C</span><span class="o">,</span><span class="n">D</span><span class="o">&gt;</span> <span class="n">FourTuple</span><span class="o">&lt;</span><span class="n">A</span><span class="o">,</span><span class="n">B</span><span class="o">,</span><span class="n">C</span><span class="o">,</span><span class="n">D</span><span class="o">&gt;</span> <span class="nf">tuple</span><span class="o">(</span><span class="n">A</span> <span class="n">a</span><span class="o">,</span> <span class="n">B</span> <span class="n">b</span><span class="o">,</span> <span class="n">C</span> <span class="n">c</span><span class="o">,</span> <span class="n">D</span> <span class="n">d</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">FourTuple</span><span class="o">&lt;</span><span class="n">A</span><span class="o">,</span><span class="n">B</span><span class="o">,</span><span class="n">C</span><span class="o">,</span><span class="n">D</span><span class="o">&gt;(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">,</span> <span class="n">c</span><span class="o">,</span> <span class="n">d</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="n">A</span><span class="o">,</span><span class="n">B</span><span class="o">,</span><span class="n">C</span><span class="o">,</span><span class="n">D</span><span class="o">,</span><span class="n">E</span><span class="o">&gt;</span> <span class="n">FiveTuple</span><span class="o">&lt;</span><span class="n">A</span><span class="o">,</span><span class="n">B</span><span class="o">,</span><span class="n">C</span><span class="o">,</span><span class="n">D</span><span class="o">,</span><span class="n">E</span><span class="o">&gt;</span> <span class="nf">tuple</span><span class="o">(</span><span class="n">A</span> <span class="n">a</span><span class="o">,</span> <span class="n">B</span> <span class="n">b</span><span class="o">,</span> <span class="n">C</span> <span class="n">c</span><span class="o">,</span> <span class="n">D</span> <span class="n">d</span><span class="o">,</span> <span class="n">E</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">FiveTuple</span><span class="o">&lt;</span><span class="n">A</span><span class="o">,</span><span class="n">B</span><span class="o">,</span><span class="n">C</span><span class="o">,</span><span class="n">D</span><span class="o">,</span><span class="n">E</span><span class="o">&gt;(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">,</span> <span class="n">c</span><span class="o">,</span> <span class="n">d</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~
</span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//: generics/TupleTest2.java
</span><span class="c1"></span><span class="kn">import</span> <span class="nn">net.mindview.util.*</span><span class="o">;</span>
<span class="kn">import static</span> <span class="nn">net.mindview.util.Tuple.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TupleTest2</span> <span class="o">{</span>
  <span class="kd">static</span> <span class="n">TwoTuple</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="nf">f</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">tuple</span><span class="o">(</span><span class="s">&#34;hi&#34;</span><span class="o">,</span> <span class="n">47</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">static</span> <span class="n">TwoTuple</span> <span class="nf">f2</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">tuple</span><span class="o">(</span><span class="s">&#34;hi&#34;</span><span class="o">,</span> <span class="n">47</span><span class="o">);</span> <span class="o">}</span>
  <span class="kd">static</span> <span class="n">ThreeTuple</span><span class="o">&lt;</span><span class="n">Amphibian</span><span class="o">,</span><span class="n">String</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="nf">g</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">tuple</span><span class="o">(</span><span class="k">new</span> <span class="n">Amphibian</span><span class="o">(),</span> <span class="s">&#34;hi&#34;</span><span class="o">,</span> <span class="n">47</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">static</span> <span class="n">FourTuple</span><span class="o">&lt;</span><span class="n">Vehicle</span><span class="o">,</span><span class="n">Amphibian</span><span class="o">,</span><span class="n">String</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="nf">h</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">tuple</span><span class="o">(</span><span class="k">new</span> <span class="n">Vehicle</span><span class="o">(),</span> <span class="k">new</span> <span class="n">Amphibian</span><span class="o">(),</span> <span class="s">&#34;hi&#34;</span><span class="o">,</span> <span class="n">47</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">static</span> <span class="n">FiveTuple</span><span class="o">&lt;</span><span class="n">Vehicle</span><span class="o">,</span><span class="n">Amphibian</span><span class="o">,</span><span class="n">String</span><span class="o">,</span><span class="n">Integer</span><span class="o">,</span><span class="n">Double</span><span class="o">&gt;</span> <span class="nf">k</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">tuple</span><span class="o">(</span><span class="k">new</span> <span class="n">Vehicle</span><span class="o">(),</span> <span class="k">new</span> <span class="n">Amphibian</span><span class="o">(),</span>
      <span class="s">&#34;hi&#34;</span><span class="o">,</span> <span class="n">47</span><span class="o">,</span> <span class="n">11</span><span class="o">.</span><span class="na">1</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">TwoTuple</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">ttsi</span> <span class="o">=</span> <span class="n">f</span><span class="o">();</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">ttsi</span><span class="o">);</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">f2</span><span class="o">());</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">g</span><span class="o">());</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">h</span><span class="o">());</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">k</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output: (80% match)
</span><span class="cm">(hi, 47)
</span><span class="cm">(hi, 47)
</span><span class="cm">(Amphibian@7d772e, hi, 47)
</span><span class="cm">(Vehicle@757aef, Amphibian@d9f9c3, hi, 47)
</span><span class="cm">(Vehicle@1a46e30, Amphibian@3e25a5, hi, 47, 11.1)
</span><span class="cm">*/</span><span class="c1">//:~
</span></code></pre></td></tr></table>
</div>
</div><h3 id="1546-一个set实用工具">15.4.6 一个Set实用工具</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//: net/mindview/util/Sets.java
</span><span class="c1"></span><span class="kn">package</span> <span class="nn">net.mindview.util</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Sets</span> <span class="o">{</span>
    <span class="c1">//两个集合合并
</span><span class="c1"></span>  <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="nf">union</span><span class="o">(</span><span class="n">Set</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">a</span><span class="o">,</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">b</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Set</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashSet</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;(</span><span class="n">a</span><span class="o">);</span>
    <span class="n">result</span><span class="o">.</span><span class="na">addAll</span><span class="o">(</span><span class="n">b</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
  <span class="o">}</span><span class="c1">//共有部分
</span><span class="c1"></span>  <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="nf">intersection</span><span class="o">(</span><span class="n">Set</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">a</span><span class="o">,</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">b</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Set</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashSet</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;(</span><span class="n">a</span><span class="o">);</span>
    <span class="n">result</span><span class="o">.</span><span class="na">retainAll</span><span class="o">(</span><span class="n">b</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
  <span class="o">}</span>    
  <span class="c1">//移除subset中的元素
</span><span class="c1"></span>  <span class="c1">// Subtract subset from superset:
</span><span class="c1"></span>  <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="nf">difference</span><span class="o">(</span><span class="n">Set</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">superset</span><span class="o">,</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">subset</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Set</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashSet</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;(</span><span class="n">superset</span><span class="o">);</span>
    <span class="n">result</span><span class="o">.</span><span class="na">removeAll</span><span class="o">(</span><span class="n">subset</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="c1">// Reflexive--everything not in the intersection:
</span><span class="c1"></span>  <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="nf">complement</span><span class="o">(</span><span class="n">Set</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">a</span><span class="o">,</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">b</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">difference</span><span class="o">(</span><span class="n">union</span><span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">),</span> <span class="n">intersection</span><span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">));</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~
</span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//: generics/watercolors/Watercolors.java
</span><span class="c1"></span><span class="kn">package</span> <span class="nn">generics.watercolors</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">enum</span> <span class="n">Watercolors</span> <span class="o">{</span>
  <span class="n">ZINC</span><span class="o">,</span> <span class="n">LEMON_YELLOW</span><span class="o">,</span> <span class="n">MEDIUM_YELLOW</span><span class="o">,</span> <span class="n">DEEP_YELLOW</span><span class="o">,</span> <span class="n">ORANGE</span><span class="o">,</span>
  <span class="n">BRILLIANT_RED</span><span class="o">,</span> <span class="n">CRIMSON</span><span class="o">,</span> <span class="n">MAGENTA</span><span class="o">,</span> <span class="n">ROSE_MADDER</span><span class="o">,</span> <span class="n">VIOLET</span><span class="o">,</span>
  <span class="n">CERULEAN_BLUE_HUE</span><span class="o">,</span> <span class="n">PHTHALO_BLUE</span><span class="o">,</span> <span class="n">ULTRAMARINE</span><span class="o">,</span>
  <span class="n">COBALT_BLUE_HUE</span><span class="o">,</span> <span class="n">PERMANENT_GREEN</span><span class="o">,</span> <span class="n">VIRIDIAN_HUE</span><span class="o">,</span>
  <span class="n">SAP_GREEN</span><span class="o">,</span> <span class="n">YELLOW_OCHRE</span><span class="o">,</span> <span class="n">BURNT_SIENNA</span><span class="o">,</span> <span class="n">RAW_UMBER</span><span class="o">,</span>
  <span class="n">BURNT_UMBER</span><span class="o">,</span> <span class="n">PAYNES_GRAY</span><span class="o">,</span> <span class="n">IVORY_BLACK</span>
<span class="o">}</span> <span class="c1">///:~
</span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//: generics/WatercolorSets.java
</span><span class="c1"></span><span class="kn">import</span> <span class="nn">generics.watercolors.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kn">import static</span> <span class="nn">net.mindview.util.Print.*</span><span class="o">;</span>
<span class="kn">import static</span> <span class="nn">net.mindview.util.Sets.*</span><span class="o">;</span>
<span class="kn">import static</span> <span class="nn">generics.watercolors.Watercolors.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">WatercolorSets</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Set</span><span class="o">&lt;</span><span class="n">Watercolors</span><span class="o">&gt;</span> <span class="n">set1</span> <span class="o">=</span>
      <span class="n">EnumSet</span><span class="o">.</span><span class="na">range</span><span class="o">(</span><span class="n">BRILLIANT_RED</span><span class="o">,</span> <span class="n">VIRIDIAN_HUE</span><span class="o">);</span>
    <span class="n">Set</span><span class="o">&lt;</span><span class="n">Watercolors</span><span class="o">&gt;</span> <span class="n">set2</span> <span class="o">=</span>
      <span class="n">EnumSet</span><span class="o">.</span><span class="na">range</span><span class="o">(</span><span class="n">CERULEAN_BLUE_HUE</span><span class="o">,</span> <span class="n">BURNT_UMBER</span><span class="o">);</span>
    <span class="n">print</span><span class="o">(</span><span class="s">&#34;set1: &#34;</span> <span class="o">+</span> <span class="n">set1</span><span class="o">);</span>
    <span class="n">print</span><span class="o">(</span><span class="s">&#34;set2: &#34;</span> <span class="o">+</span> <span class="n">set2</span><span class="o">);</span>
    <span class="n">print</span><span class="o">(</span><span class="s">&#34;union(set1, set2): &#34;</span> <span class="o">+</span> <span class="n">union</span><span class="o">(</span><span class="n">set1</span><span class="o">,</span> <span class="n">set2</span><span class="o">));</span>
    <span class="n">Set</span><span class="o">&lt;</span><span class="n">Watercolors</span><span class="o">&gt;</span> <span class="n">subset</span> <span class="o">=</span> <span class="n">intersection</span><span class="o">(</span><span class="n">set1</span><span class="o">,</span> <span class="n">set2</span><span class="o">);</span>
    <span class="n">print</span><span class="o">(</span><span class="s">&#34;intersection(set1, set2): &#34;</span> <span class="o">+</span> <span class="n">subset</span><span class="o">);</span>
    <span class="n">print</span><span class="o">(</span><span class="s">&#34;difference(set1, subset): &#34;</span> <span class="o">+</span> <span class="n">difference</span><span class="o">(</span><span class="n">set1</span><span class="o">,</span> <span class="n">subset</span><span class="o">));</span>    
    <span class="n">print</span><span class="o">(</span><span class="s">&#34;difference(set2, subset): &#34;</span> <span class="o">+</span> <span class="n">difference</span><span class="o">(</span><span class="n">set2</span><span class="o">,</span> <span class="n">subset</span><span class="o">));</span>
    <span class="n">print</span><span class="o">(</span><span class="s">&#34;complement(set1, set2): &#34;</span> <span class="o">+</span> <span class="n">complement</span><span class="o">(</span><span class="n">set1</span><span class="o">,</span> <span class="n">set2</span><span class="o">));</span>
  <span class="o">}</span>    
<span class="o">}</span> <span class="cm">/* Output: (Sample)
</span><span class="cm">set1: [BRILLIANT_RED, CRIMSON, MAGENTA, ROSE_MADDER, VIOLET, CERULEAN_BLUE_HUE, PHTHALO_BLUE, ULTRAMARINE, COBALT_BLUE_HUE, PERMANENT_GREEN, VIRIDIAN_HUE]
</span><span class="cm">set2: [CERULEAN_BLUE_HUE, PHTHALO_BLUE, ULTRAMARINE, COBALT_BLUE_HUE, PERMANENT_GREEN, VIRIDIAN_HUE, SAP_GREEN, YELLOW_OCHRE, BURNT_SIENNA, RAW_UMBER, BURNT_UMBER]
</span><span class="cm">union(set1, set2): [SAP_GREEN, ROSE_MADDER, YELLOW_OCHRE, PERMANENT_GREEN, BURNT_UMBER, COBALT_BLUE_HUE, VIOLET, BRILLIANT_RED, RAW_UMBER, ULTRAMARINE, BURNT_SIENNA, CRIMSON, CERULEAN_BLUE_HUE, PHTHALO_BLUE, MAGENTA, VIRIDIAN_HUE]
</span><span class="cm">intersection(set1, set2): [ULTRAMARINE, PERMANENT_GREEN, COBALT_BLUE_HUE, PHTHALO_BLUE, CERULEAN_BLUE_HUE, VIRIDIAN_HUE]
</span><span class="cm">difference(set1, subset): [ROSE_MADDER, CRIMSON, VIOLET, MAGENTA, BRILLIANT_RED]
</span><span class="cm">difference(set2, subset): [RAW_UMBER, SAP_GREEN, YELLOW_OCHRE, BURNT_SIENNA, BURNT_UMBER]
</span><span class="cm">complement(set1, set2): [SAP_GREEN, ROSE_MADDER, YELLOW_OCHRE, BURNT_UMBER, VIOLET, BRILLIANT_RED, RAW_UMBER, BURNT_SIENNA, CRIMSON, MAGENTA]
</span><span class="cm">*/</span><span class="c1">//:~
</span></code></pre></td></tr></table>
</div>
</div><h2 id="155-匿名内部类">15.5 匿名内部类</h2>
<p>泛型还可以应用于内部类以及匿名内部类。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//: generics/BankTeller.java
</span><span class="c1">// A very simple bank teller simulation.
</span><span class="c1"></span><span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">net.mindview.util.*</span><span class="o">;</span>

<span class="kd">class</span> <span class="nc">Customer</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="kt">long</span> <span class="n">counter</span> <span class="o">=</span> <span class="n">1</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">id</span> <span class="o">=</span> <span class="n">counter</span><span class="o">++;</span>
  <span class="kd">private</span> <span class="nf">Customer</span><span class="o">()</span> <span class="o">{}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="s">&#34;Customer &#34;</span> <span class="o">+</span> <span class="n">id</span><span class="o">;</span> <span class="o">}</span>
  <span class="c1">// A method to produce Generator objects:
</span><span class="c1"></span>  <span class="kd">public</span> <span class="kd">static</span> <span class="n">Generator</span><span class="o">&lt;</span><span class="n">Customer</span><span class="o">&gt;</span> <span class="nf">generator</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">Generator</span><span class="o">&lt;</span><span class="n">Customer</span><span class="o">&gt;()</span> <span class="o">{</span> <span class="c1">//匿名内部类
</span><span class="c1"></span>      <span class="kd">public</span> <span class="n">Customer</span> <span class="nf">next</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="k">new</span> <span class="n">Customer</span><span class="o">();</span> <span class="o">}</span>
    <span class="o">};</span>
  <span class="o">}</span>
<span class="o">}</span>    

<span class="kd">class</span> <span class="nc">Teller</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="kt">long</span> <span class="n">counter</span> <span class="o">=</span> <span class="n">1</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">id</span> <span class="o">=</span> <span class="n">counter</span><span class="o">++;</span>
  <span class="kd">private</span> <span class="nf">Teller</span><span class="o">()</span> <span class="o">{}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="s">&#34;Teller &#34;</span> <span class="o">+</span> <span class="n">id</span><span class="o">;</span> <span class="o">}</span>
  <span class="c1">// A single Generator object:
</span><span class="c1"></span>  <span class="kd">public</span> <span class="kd">static</span> <span class="n">Generator</span><span class="o">&lt;</span><span class="n">Teller</span><span class="o">&gt;</span> <span class="n">generator</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Generator</span><span class="o">&lt;</span><span class="n">Teller</span><span class="o">&gt;()</span> <span class="o">{</span>
      <span class="kd">public</span> <span class="n">Teller</span> <span class="nf">next</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="k">new</span> <span class="n">Teller</span><span class="o">();</span> <span class="o">}</span>
    <span class="o">};</span>
<span class="o">}</span>    

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">BankTeller</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">serve</span><span class="o">(</span><span class="n">Teller</span> <span class="n">t</span><span class="o">,</span> <span class="n">Customer</span> <span class="n">c</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">t</span> <span class="o">+</span> <span class="s">&#34; serves &#34;</span> <span class="o">+</span> <span class="n">c</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Random</span> <span class="n">rand</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Random</span><span class="o">(</span><span class="n">47</span><span class="o">);</span>
    <span class="n">Queue</span><span class="o">&lt;</span><span class="n">Customer</span><span class="o">&gt;</span> <span class="n">line</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinkedList</span><span class="o">&lt;</span><span class="n">Customer</span><span class="o">&gt;();</span>
    <span class="n">Generators</span><span class="o">.</span><span class="na">fill</span><span class="o">(</span><span class="n">line</span><span class="o">,</span> <span class="n">Customer</span><span class="o">.</span><span class="na">generator</span><span class="o">(),</span> <span class="n">15</span><span class="o">);</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">Teller</span><span class="o">&gt;</span> <span class="n">tellers</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Teller</span><span class="o">&gt;();</span>
    <span class="n">Generators</span><span class="o">.</span><span class="na">fill</span><span class="o">(</span><span class="n">tellers</span><span class="o">,</span> <span class="n">Teller</span><span class="o">.</span><span class="na">generator</span><span class="o">,</span> <span class="n">4</span><span class="o">);</span>
    <span class="k">for</span><span class="o">(</span><span class="n">Customer</span> <span class="n">c</span> <span class="o">:</span> <span class="n">line</span><span class="o">)</span>
      <span class="n">serve</span><span class="o">(</span><span class="n">tellers</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">rand</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="n">tellers</span><span class="o">.</span><span class="na">size</span><span class="o">())),</span> <span class="n">c</span><span class="o">);</span>
  <span class="o">}</span>    
<span class="o">}</span> <span class="cm">/* Output:
</span><span class="cm">Teller 3 serves Customer 1
</span><span class="cm">Teller 2 serves Customer 2
</span><span class="cm">Teller 3 serves Customer 3
</span><span class="cm">Teller 1 serves Customer 4
</span><span class="cm">Teller 1 serves Customer 5
</span><span class="cm">Teller 3 serves Customer 6
</span><span class="cm">Teller 1 serves Customer 7
</span><span class="cm">Teller 2 serves Customer 8
</span><span class="cm">Teller 3 serves Customer 9
</span><span class="cm">Teller 3 serves Customer 10
</span><span class="cm">Teller 2 serves Customer 11
</span><span class="cm">Teller 4 serves Customer 12
</span><span class="cm">Teller 2 serves Customer 13
</span><span class="cm">Teller 1 serves Customer 14
</span><span class="cm">Teller 1 serves Customer 15
</span><span class="cm">*/</span><span class="c1">//:~
</span></code></pre></td></tr></table>
</div>
</div><h2 id="156-构建复杂模型">15.6 构建复杂模型</h2>
<p>泛型的一个重要好处是能够简单而安全地创建复杂的模型。例如，我们可以很容易地创建<code>List</code>元组。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//: generics/TupleList.java
</span><span class="c1">// Combining generic types to make complex generic types.
</span><span class="c1"></span><span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">net.mindview.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TupleList</span><span class="o">&lt;</span><span class="n">A</span><span class="o">,</span><span class="n">B</span><span class="o">,</span><span class="n">C</span><span class="o">,</span><span class="n">D</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">FourTuple</span><span class="o">&lt;</span><span class="n">A</span><span class="o">,</span><span class="n">B</span><span class="o">,</span><span class="n">C</span><span class="o">,</span><span class="n">D</span><span class="o">&gt;&gt;</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">TupleList</span><span class="o">&lt;</span><span class="n">Vehicle</span><span class="o">,</span> <span class="n">Amphibian</span><span class="o">,</span> <span class="n">String</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;</span> <span class="n">tl</span> <span class="o">=</span>
      <span class="k">new</span> <span class="n">TupleList</span><span class="o">&lt;</span><span class="n">Vehicle</span><span class="o">,</span> <span class="n">Amphibian</span><span class="o">,</span> <span class="n">String</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;();</span>
    <span class="n">tl</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">TupleTest</span><span class="o">.</span><span class="na">h</span><span class="o">());</span>
    <span class="n">tl</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">TupleTest</span><span class="o">.</span><span class="na">h</span><span class="o">());</span>
    <span class="k">for</span><span class="o">(</span><span class="n">FourTuple</span><span class="o">&lt;</span><span class="n">Vehicle</span><span class="o">,</span><span class="n">Amphibian</span><span class="o">,</span><span class="n">String</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">i</span><span class="o">:</span> <span class="n">tl</span><span class="o">)</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output: (75% match)
</span><span class="cm">(Vehicle@11b86e7, Amphibian@35ce36, hi, 47)
</span><span class="cm">(Vehicle@757aef, Amphibian@d9f9c3, hi, 47)
</span><span class="cm">*/</span><span class="c1">//:~
</span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//: generics/Store.java
</span><span class="c1">// Building up a complex model using generic containers.
</span><span class="c1"></span><span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">net.mindview.util.*</span><span class="o">;</span>
<span class="c1">//商品
</span><span class="c1"></span><span class="kd">class</span> <span class="nc">Product</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">id</span><span class="o">;</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">description</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kt">double</span> <span class="n">price</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">Product</span><span class="o">(</span><span class="kt">int</span> <span class="n">IDnumber</span><span class="o">,</span> <span class="n">String</span> <span class="n">descr</span><span class="o">,</span> <span class="kt">double</span> <span class="n">price</span><span class="o">){</span>
    <span class="n">id</span> <span class="o">=</span> <span class="n">IDnumber</span><span class="o">;</span>
    <span class="n">description</span> <span class="o">=</span> <span class="n">descr</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">price</span> <span class="o">=</span> <span class="n">price</span><span class="o">;</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">toString</span><span class="o">());</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">id</span> <span class="o">+</span> <span class="s">&#34;: &#34;</span> <span class="o">+</span> <span class="n">description</span> <span class="o">+</span> <span class="s">&#34;, price: $&#34;</span> <span class="o">+</span> <span class="n">price</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">priceChange</span><span class="o">(</span><span class="kt">double</span> <span class="n">change</span><span class="o">)</span> <span class="o">{</span><span class="c1">//更改价格
</span><span class="c1"></span>    <span class="n">price</span> <span class="o">+=</span> <span class="n">change</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="n">Generator</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="n">generator</span> <span class="o">=</span>
    <span class="k">new</span> <span class="n">Generator</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;()</span> <span class="o">{</span>
      <span class="kd">private</span> <span class="n">Random</span> <span class="n">rand</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Random</span><span class="o">(</span><span class="n">47</span><span class="o">);</span>
      <span class="kd">public</span> <span class="n">Product</span> <span class="nf">next</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">Product</span><span class="o">(</span><span class="n">rand</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="n">1000</span><span class="o">),</span> <span class="s">&#34;Test&#34;</span><span class="o">,</span>
          <span class="n">Math</span><span class="o">.</span><span class="na">round</span><span class="o">(</span><span class="n">rand</span><span class="o">.</span><span class="na">nextDouble</span><span class="o">()</span> <span class="o">*</span> <span class="n">1000</span><span class="o">.</span><span class="na">0</span><span class="o">)</span> <span class="o">+</span> <span class="n">0</span><span class="o">.</span><span class="na">99</span><span class="o">);</span> <span class="c1">//商品生成器
</span><span class="c1"></span>      <span class="o">}</span>
    <span class="o">};</span>
<span class="o">}</span>
<span class="c1">//货架
</span><span class="c1"></span><span class="kd">class</span> <span class="nc">Shelf</span> <span class="kd">extends</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="nf">Shelf</span><span class="o">(</span><span class="kt">int</span> <span class="n">nProducts</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Generators</span><span class="o">.</span><span class="na">fill</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">Product</span><span class="o">.</span><span class="na">generator</span><span class="o">,</span> <span class="n">nProducts</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>    
<span class="c1">//走廊 
</span><span class="c1"></span><span class="kd">class</span> <span class="nc">Aisle</span> <span class="kd">extends</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Shelf</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="nf">Aisle</span><span class="o">(</span><span class="kt">int</span> <span class="n">nShelves</span><span class="o">,</span> <span class="kt">int</span> <span class="n">nProducts</span><span class="o">)</span> <span class="o">{</span><span class="c1">//走廊摆放货架
</span><span class="c1"></span>    <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">nShelves</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span>
      <span class="n">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Shelf</span><span class="o">(</span><span class="n">nProducts</span><span class="o">));</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">CheckoutStand</span> <span class="o">{}</span>
<span class="kd">class</span> <span class="nc">Office</span> <span class="o">{}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Store</span> <span class="kd">extends</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Aisle</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">CheckoutStand</span><span class="o">&gt;</span> <span class="n">checkouts</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">CheckoutStand</span><span class="o">&gt;();</span>
  <span class="kd">private</span> <span class="n">Office</span> <span class="n">office</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Office</span><span class="o">();</span>
  <span class="kd">public</span> <span class="nf">Store</span><span class="o">(</span><span class="kt">int</span> <span class="n">nAisles</span><span class="o">,</span> <span class="kt">int</span> <span class="n">nShelves</span><span class="o">,</span> <span class="kt">int</span> <span class="n">nProducts</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">nAisles</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span>
      <span class="n">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Aisle</span><span class="o">(</span><span class="n">nShelves</span><span class="o">,</span> <span class="n">nProducts</span><span class="o">));</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">StringBuilder</span> <span class="n">result</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringBuilder</span><span class="o">();</span>
    <span class="k">for</span><span class="o">(</span><span class="n">Aisle</span> <span class="n">a</span> <span class="o">:</span> <span class="k">this</span><span class="o">)</span>
      <span class="k">for</span><span class="o">(</span><span class="n">Shelf</span> <span class="n">s</span> <span class="o">:</span> <span class="n">a</span><span class="o">)</span>
        <span class="k">for</span><span class="o">(</span><span class="n">Product</span> <span class="n">p</span> <span class="o">:</span> <span class="n">s</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">result</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">p</span><span class="o">);</span>
          <span class="n">result</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">&#34;\n&#34;</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="k">new</span> <span class="n">Store</span><span class="o">(</span><span class="n">14</span><span class="o">,</span> <span class="n">5</span><span class="o">,</span> <span class="n">10</span><span class="o">));</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output:
</span><span class="cm">258: Test, price: $400.99
</span><span class="cm">861: Test, price: $160.99
</span><span class="cm">868: Test, price: $417.99
</span><span class="cm">207: Test, price: $268.99
</span><span class="cm">551: Test, price: $114.99
</span><span class="cm">278: Test, price: $804.99
</span><span class="cm">520: Test, price: $554.99
</span><span class="cm">140: Test, price: $530.99
</span><span class="cm">...
</span><span class="cm">*/</span><span class="c1">//:~
</span></code></pre></td></tr></table>
</div>
</div><h2 id="157-擦除的神秘之处">15.7 擦除的神秘之处</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//: generics/ErasedTypeEquivalence.java
</span><span class="c1"></span><span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ErasedTypeEquivalence</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Class</span> <span class="n">c1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;().</span><span class="na">getClass</span><span class="o">();</span>
    <span class="n">Class</span> <span class="n">c2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;().</span><span class="na">getClass</span><span class="o">();</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">c1</span> <span class="o">==</span> <span class="n">c2</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output:
</span><span class="cm">true
</span><span class="cm">*/</span><span class="c1">//:~
</span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//: generics/LostInformation.java
</span><span class="c1"></span><span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">class</span> <span class="nc">Frob</span> <span class="o">{}</span>
<span class="kd">class</span> <span class="nc">Fnorkle</span> <span class="o">{}</span>
<span class="kd">class</span> <span class="nc">Quark</span><span class="o">&lt;</span><span class="n">Q</span><span class="o">&gt;</span> <span class="o">{}</span>
<span class="kd">class</span> <span class="nc">Particle</span><span class="o">&lt;</span><span class="n">POSITION</span><span class="o">,</span><span class="n">MOMENTUM</span><span class="o">&gt;</span> <span class="o">{}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">LostInformation</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">Frob</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Frob</span><span class="o">&gt;();</span>
    <span class="n">Map</span><span class="o">&lt;</span><span class="n">Frob</span><span class="o">,</span><span class="n">Fnorkle</span><span class="o">&gt;</span> <span class="n">map</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">Frob</span><span class="o">,</span><span class="n">Fnorkle</span><span class="o">&gt;();</span>
    <span class="n">Quark</span><span class="o">&lt;</span><span class="n">Fnorkle</span><span class="o">&gt;</span> <span class="n">quark</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Quark</span><span class="o">&lt;</span><span class="n">Fnorkle</span><span class="o">&gt;();</span>
    <span class="n">Particle</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">,</span><span class="n">Double</span><span class="o">&gt;</span> <span class="n">p</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Particle</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">,</span><span class="n">Double</span><span class="o">&gt;();</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">Arrays</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span>
      <span class="n">list</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getTypeParameters</span><span class="o">()));</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">Arrays</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span>
      <span class="n">map</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getTypeParameters</span><span class="o">()));</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">Arrays</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span>
      <span class="n">quark</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getTypeParameters</span><span class="o">()));</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">Arrays</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span>
      <span class="n">p</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getTypeParameters</span><span class="o">()));</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output:
</span><span class="cm">[E]
</span><span class="cm">[K, V]
</span><span class="cm">[Q]
</span><span class="cm">[POSITION, MOMENTUM]
</span><span class="cm">*/</span><span class="c1">//:~
</span></code></pre></td></tr></table>
</div>
</div><p><code>Class.getTypeParameters()</code>将返回一个<code>TypeVariable</code>对象数组，表示有泛型声明所声明的类型参数。但是，正如你从输出中看到的，你能够发现的只是用作参数占位符的标识符，这并非有用的信息。</p>
<p><strong>在泛型代码内部，无法获得任何有关反省参数类型的信息。</strong></p>
<h3 id="1571-c的方式">15.7.1 C++的方式</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="c1">//: generics/Templates.cpp
</span><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span><span class="cp"></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">T</span><span class="o">&gt;</span> <span class="k">class</span> <span class="nc">Manipulator</span> <span class="p">{</span>
  <span class="n">T</span> <span class="n">obj</span><span class="p">;</span>
<span class="k">public</span><span class="o">:</span>
  <span class="n">Manipulator</span><span class="p">(</span><span class="n">T</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span> <span class="p">}</span>
  <span class="kt">void</span> <span class="nf">manipulate</span><span class="p">()</span> <span class="p">{</span> <span class="n">obj</span><span class="p">.</span><span class="n">f</span><span class="p">();</span> <span class="p">}</span>
<span class="p">};</span>

<span class="k">class</span> <span class="nc">HasF</span> <span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="kt">void</span> <span class="n">f</span><span class="p">()</span> <span class="p">{</span> <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;HasF::f()&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span> <span class="p">}</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">HasF</span> <span class="n">hf</span><span class="p">;</span>
  <span class="n">Manipulator</span><span class="o">&lt;</span><span class="n">HasF</span><span class="o">&gt;</span> <span class="n">manipulator</span><span class="p">(</span><span class="n">hf</span><span class="p">);</span>
  <span class="n">manipulator</span><span class="p">.</span><span class="n">manipulate</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>当实例化这个模版时，C++编译器将进行检查，因此在<code>Manipulator&lt;HasF&gt;</code>被实例化的这一刻，它看到<code>HasF</code>拥有一个方法<code>f()</code>。如果情况并非如此，就会得到一个编译期错误，这样类型安全就得到了保障。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">HasF</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">f</span><span class="o">()</span> <span class="o">{</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;HasF.f()&#34;</span><span class="o">);</span> <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//: generics/Manipulation.java
</span><span class="c1">// {CompileTimeError} (Won&#39;t compile)
</span><span class="c1"></span>
<span class="kd">class</span> <span class="nc">Manipulator</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">T</span> <span class="n">obj</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">Manipulator</span><span class="o">(</span><span class="n">T</span> <span class="n">x</span><span class="o">)</span> <span class="o">{</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">x</span><span class="o">;</span> <span class="o">}</span>
  <span class="c1">// Error: cannot find symbol: method f():
</span><span class="c1"></span>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">manipulate</span><span class="o">()</span> <span class="o">{</span> <span class="n">obj</span><span class="o">.</span><span class="na">f</span><span class="o">();</span> <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Manipulation</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">HasF</span> <span class="n">hf</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HasF</span><span class="o">();</span>
    <span class="n">Manipulator</span><span class="o">&lt;</span><span class="n">HasF</span><span class="o">&gt;</span> <span class="n">manipulator</span> <span class="o">=</span>
      <span class="k">new</span> <span class="n">Manipulator</span><span class="o">&lt;</span><span class="n">HasF</span><span class="o">&gt;(</span><span class="n">hf</span><span class="o">);</span>
    <span class="n">manipulator</span><span class="o">.</span><span class="na">manipulate</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~
</span></code></pre></td></tr></table>
</div>
</div><p>由于有了擦除，<code>Java</code>编译器无法将<code>manipulate()</code>必须能够在<code>obj</code>上调用<code>f()</code>这一需求映射到<code>HasF</code>拥有<code>f()</code>这一事实上。为了调用<code>f()</code>，我们必须协助泛型类，给定泛型类的边界，以此告知编译器只能接受遵循这个边界的类型。这里重用了<code>extends</code>关键字。由于有了边界，便面的代码就可以编译了：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//: generics/Manipulator2.java
</span><span class="c1"></span>
<span class="kd">class</span> <span class="nc">Manipulator2</span><span class="o">&lt;</span><span class="n">T</span> <span class="kd">extends</span> <span class="n">HasF</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">T</span> <span class="n">obj</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">Manipulator2</span><span class="o">(</span><span class="n">T</span> <span class="n">x</span><span class="o">)</span> <span class="o">{</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">x</span><span class="o">;</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">manipulate</span><span class="o">()</span> <span class="o">{</span> <span class="n">obj</span><span class="o">.</span><span class="na">f</span><span class="o">();</span> <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~
</span></code></pre></td></tr></table>
</div>
</div><p>我们说泛型类型参数将<code>擦除到它的第一个边界</code>，我们还提到了<code>类型参数的擦除</code>。编译器实际上会把类型参数替换为它的擦除，就像上面的示例一样。<code>T</code>擦除到了<code>HasF</code>，就好像在类的声明中用<code>HasF</code>替换了<code>T</code>一样。</p>
<p>自己执行擦除，创建出没有泛型的类：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//: generics/Manipulator3.java
</span><span class="c1"></span>
<span class="kd">class</span> <span class="nc">Manipulator3</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">HasF</span> <span class="n">obj</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">Manipulator3</span><span class="o">(</span><span class="n">HasF</span> <span class="n">x</span><span class="o">)</span> <span class="o">{</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">x</span><span class="o">;</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">manipulate</span><span class="o">()</span> <span class="o">{</span> <span class="n">obj</span><span class="o">.</span><span class="na">f</span><span class="o">();</span> <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~
</span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//: generics/ReturnGenericType.java
</span><span class="c1"></span>
<span class="kd">class</span> <span class="nc">ReturnGenericType</span><span class="o">&lt;</span><span class="n">T</span> <span class="kd">extends</span> <span class="n">HasF</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">T</span> <span class="n">obj</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">ReturnGenericType</span><span class="o">(</span><span class="n">T</span> <span class="n">x</span><span class="o">)</span> <span class="o">{</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">x</span><span class="o">;</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="n">T</span> <span class="nf">get</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">obj</span><span class="o">;</span> <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~
</span></code></pre></td></tr></table>
</div>
</div><h3 id="1572-迁移兼容性">15.7.2 迁移兼容性</h3>
<p>擦除不是一个语言特性。它是<code>Java</code>泛型实现中的一种折中，因为泛型不是<code>Java</code>语言出现时就有的组成部分，所以这种折中是必须的。</p>
<p>如果泛型在Java 1.0中就已经是其一部分了，那么这个特性将不会使用擦除来实现。它将使用具体化，使类型参数保持为第一类实体，因此你就能够在类型参数上执行基于类型的语言操作和反射操作。擦除减少了泛型的泛化性。泛型在Java中仍旧是有用的，只是不如它们本来设想的那么有用，而原因就是擦除。</p>
<p>在基于擦除的实现中，泛型类型被当做第二类型处理，即不能在某些重要的上下文环境中使用类型。泛型类型只有在静态类型检查期间才出现，在此之后，程序中的所有泛型类型都将被擦除，替换为它们的非泛型上界。例如，诸如<code>List&lt;T&gt;</code>这样的类型注解将被擦除为<code>List</code>，而普通的类型变量在未指定边界的情况下将被擦除为<code>Object</code>。</p>
<p>擦除的核心动机是它使得泛化的客户端可以用非泛化的类库来使用，反之亦然，这经常被称为“迁移兼容性”。在理想情况下，当所有事物都可以同时被泛化时，我们就可以专注于此。在现实中，即使程序员只编写泛型代码，他们也必须处理在Java SE5之前编写的非泛型类库。那些类库的作者可能从没有想过要泛化他们的代码，或者可能刚刚开始接触泛型。</p>
<p>因此Java泛型不仅必须支持向后兼容性，即现有的代码和类文件仍旧合法，并且继续保持之前的含义；而且还要支持迁移兼容性，使得类库按照它们自己的步调变成泛型的，并且当某个类库变为泛型时，不会破坏依赖于他的代码和应用程序。在决定这就是目标之后，Java设计者们和从事此问题相关工作的各个团队决策认为擦除是唯一可行的解决方法。通过允许非泛型代码与泛型代码啊共存，擦除使得这种向着泛型的迁移成为可能。</p>
<h3 id="1573-擦除的问题">15.7.3 擦除的问题</h3>
<p>擦除的代价是显著的。泛型不能用于显式地引用运行时类型的操作之中，例如<code>转型</code>、<code>instanceof</code>和<code>new表达式</code>。</p>
<p>另外，擦除和迁移兼容性意味着，使用泛型并不是强制的。</p>
<h3 id="1574-边界处的动作">15.7.4 边界处的动作</h3>
<p>正是因为有了擦除，我发现泛型最令人困惑的方面源自这样一个事实，即可以表示没有任何意义的事物。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//: generics/ArrayMaker.java
</span><span class="c1"></span><span class="kn">import</span> <span class="nn">java.lang.reflect.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ArrayMaker</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">Class</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">kind</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">ArrayMaker</span><span class="o">(</span><span class="n">Class</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">kind</span><span class="o">)</span> <span class="o">{</span> <span class="k">this</span><span class="o">.</span><span class="na">kind</span> <span class="o">=</span> <span class="n">kind</span><span class="o">;</span> <span class="o">}</span>
  <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">&#34;unchecked&#34;</span><span class="o">)</span>
  <span class="n">T</span><span class="o">[]</span> <span class="nf">create</span><span class="o">(</span><span class="kt">int</span> <span class="n">size</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="o">(</span><span class="n">T</span><span class="o">[])</span><span class="n">Array</span><span class="o">.</span><span class="na">newInstance</span><span class="o">(</span><span class="n">kind</span><span class="o">,</span> <span class="n">size</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">ArrayMaker</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">stringMaker</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayMaker</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="n">String</span><span class="o">[]</span> <span class="n">stringArray</span> <span class="o">=</span> <span class="n">stringMaker</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">9</span><span class="o">);</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">Arrays</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">stringArray</span><span class="o">));</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output:
</span><span class="cm">[null, null, null, null, null, null, null, null, null]
</span><span class="cm">*/</span><span class="c1">//:~
</span></code></pre></td></tr></table>
</div>
</div><p>即使<code>kind</code>被存储为<code>Class&lt;T&gt;</code>，擦除也意味着它实际将被存储为<code>Class</code>，没有任何参数。因此，当你在使用它时，例如在创建数组时，<code>Array.newInstance()</code>实际上并未拥有<code>kind</code>所蕴含的类型信息，因此这不会产生具体的结果，所以必须转型，这将产生一条令你无法满意的警告。</p>
<p>注意，对于在泛型中创建数组，使用<code>Array.newInstance()</code>是推荐的方式。</p>
<p>如果我们要创建一个容器而不是数组，情况就有些不同了：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//: generics/ListMaker.java
</span><span class="c1"></span><span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ListMaker</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="n">List</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="nf">create</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;();</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">ListMaker</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">stringMaker</span><span class="o">=</span> <span class="k">new</span> <span class="n">ListMaker</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;();</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">stringList</span> <span class="o">=</span> <span class="n">stringMaker</span><span class="o">.</span><span class="na">create</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~
</span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//: generics/FilledListMaker.java
</span><span class="c1"></span><span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FilledListMaker</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="n">List</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="nf">create</span><span class="o">(</span><span class="n">T</span> <span class="n">t</span><span class="o">,</span> <span class="kt">int</span> <span class="n">n</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;();</span>
    <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span>
      <span class="n">result</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">t</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">FilledListMaker</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">stringMaker</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FilledListMaker</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;();</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="n">stringMaker</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">&#34;Hello&#34;</span><span class="o">,</span> <span class="n">4</span><span class="o">);</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">list</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output:
</span><span class="cm">[Hello, Hello, Hello, Hello]
</span><span class="cm">*/</span><span class="c1">//:~
</span></code></pre></td></tr></table>
</div>
</div><p>即使编译器无法知道有关<code>create()</code>中的<code>T</code>的任何信息，但是它仍旧可以在编译期确保你放置到<code>result</code>中的对象具有<code>T</code>类型，使其适合<code>ArrayList&lt;T&gt;</code>。因此，即使擦除在方法或类内部移除了有关实际类型的信息，编译器仍旧可以确保在方法或类中使用的类型的内部一致性。</p>
<p><strong>因为擦除在方法体中移除了类型信息，所以在运行时的问题就是</strong><code>边界</code><strong>：即对象进入和离开方法的地点。这些正是编译器在编译期执行类型检查并插入转型代码的地点。</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//: generics/SimpleHolder.java
</span><span class="c1"></span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SimpleHolder</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">Object</span> <span class="n">obj</span><span class="o">;</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">set</span><span class="o">(</span><span class="n">Object</span> <span class="n">obj</span><span class="o">)</span> <span class="o">{</span> <span class="k">this</span><span class="o">.</span><span class="na">obj</span> <span class="o">=</span> <span class="n">obj</span><span class="o">;</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="n">Object</span> <span class="nf">get</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">obj</span><span class="o">;</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">SimpleHolder</span> <span class="n">holder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimpleHolder</span><span class="o">();</span>
    <span class="n">holder</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="s">&#34;Item&#34;</span><span class="o">);</span>
    <span class="n">String</span> <span class="n">s</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span><span class="n">holder</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~
</span></code></pre></td></tr></table>
</div>
</div><p>用<code>javap -c SimpleHolder</code>反编译这个类：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">typeinfo</span><span class="o">.</span><span class="na">SimpleHolder</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="n">typeinfo</span><span class="o">.</span><span class="na">SimpleHolder</span><span class="o">();</span>
    <span class="n">Code</span><span class="o">:</span>
       <span class="n">0</span><span class="o">:</span> <span class="n">aload_0</span>
       <span class="n">1</span><span class="o">:</span> <span class="n">invokespecial</span> <span class="err">#</span><span class="n">1</span>                  <span class="c1">// Method java/lang/Object.&#34;&lt;init&gt;&#34;:()V
</span><span class="c1"></span>       <span class="n">4</span><span class="o">:</span> <span class="k">return</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">set</span><span class="o">(</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Object</span><span class="o">);</span>
    <span class="n">Code</span><span class="o">:</span>
       <span class="n">0</span><span class="o">:</span> <span class="n">aload_0</span>
       <span class="n">1</span><span class="o">:</span> <span class="n">aload_1</span>
       <span class="n">2</span><span class="o">:</span> <span class="n">putfield</span>      <span class="err">#</span><span class="n">2</span>                  <span class="c1">// Field obj:Ljava/lang/Object;
</span><span class="c1"></span>       <span class="n">5</span><span class="o">:</span> <span class="k">return</span>

  <span class="kd">public</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Object</span> <span class="nf">get</span><span class="o">();</span>
    <span class="n">Code</span><span class="o">:</span>
       <span class="n">0</span><span class="o">:</span> <span class="n">aload_0</span>
       <span class="n">1</span><span class="o">:</span> <span class="n">getfield</span>      <span class="err">#</span><span class="n">2</span>                  <span class="c1">// Field obj:Ljava/lang/Object;
</span><span class="c1"></span>       <span class="n">4</span><span class="o">:</span> <span class="n">areturn</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span><span class="o">[]);</span>
    <span class="n">Code</span><span class="o">:</span>
       <span class="n">0</span><span class="o">:</span> <span class="k">new</span>           <span class="err">#</span><span class="n">3</span>                  <span class="c1">// class typeinfo/SimpleHolder
</span><span class="c1"></span>       <span class="n">3</span><span class="o">:</span> <span class="n">dup</span>
       <span class="n">4</span><span class="o">:</span> <span class="n">invokespecial</span> <span class="err">#</span><span class="n">4</span>                  <span class="c1">// Method &#34;&lt;init&gt;&#34;:()V
</span><span class="c1"></span>       <span class="n">7</span><span class="o">:</span> <span class="n">astore_1</span>
       <span class="n">8</span><span class="o">:</span> <span class="n">aload_1</span>
       <span class="n">9</span><span class="o">:</span> <span class="n">ldc</span>           <span class="err">#</span><span class="n">5</span>                  <span class="c1">// String Item
</span><span class="c1"></span>      <span class="n">11</span><span class="o">:</span> <span class="n">invokevirtual</span> <span class="err">#</span><span class="n">6</span>                  <span class="c1">// Method set:(Ljava/lang/Object;)V
</span><span class="c1"></span>      <span class="n">14</span><span class="o">:</span> <span class="n">aload_1</span>
      <span class="n">15</span><span class="o">:</span> <span class="n">invokevirtual</span> <span class="err">#</span><span class="n">7</span>                  <span class="c1">// Method get:()Ljava/lang/Object;
</span><span class="c1"></span>      <span class="n">18</span><span class="o">:</span> <span class="n">checkcast</span>     <span class="err">#</span><span class="n">8</span>                  <span class="c1">// class java/lang/String
</span><span class="c1"></span>      <span class="n">21</span><span class="o">:</span> <span class="n">astore_2</span>
      <span class="n">22</span><span class="o">:</span> <span class="k">return</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p><code>set()</code>和<code>get()</code>方法将直接存储和产生值，而转型是在调用<code>get()</code>的时候接受检查的。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//: generics/GenericHolder.java
</span><span class="c1"></span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">GenericHolder</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">T</span> <span class="n">obj</span><span class="o">;</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">set</span><span class="o">(</span><span class="n">T</span> <span class="n">obj</span><span class="o">)</span> <span class="o">{</span> <span class="k">this</span><span class="o">.</span><span class="na">obj</span> <span class="o">=</span> <span class="n">obj</span><span class="o">;</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="n">T</span> <span class="nf">get</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">obj</span><span class="o">;</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">GenericHolder</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">holder</span> <span class="o">=</span>
      <span class="k">new</span> <span class="n">GenericHolder</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;();</span>
    <span class="n">holder</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="s">&#34;Item&#34;</span><span class="o">);</span>
    <span class="n">String</span> <span class="n">s</span> <span class="o">=</span> <span class="n">holder</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~
</span></code></pre></td></tr></table>
</div>
</div><p>反编译：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">typeinfo</span><span class="o">.</span><span class="na">GenericHolder</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="n">typeinfo</span><span class="o">.</span><span class="na">GenericHolder</span><span class="o">();</span>
    <span class="n">Code</span><span class="o">:</span>
       <span class="n">0</span><span class="o">:</span> <span class="n">aload_0</span>
       <span class="n">1</span><span class="o">:</span> <span class="n">invokespecial</span> <span class="err">#</span><span class="n">1</span>                  <span class="c1">// Method java/lang/Object.&#34;&lt;init&gt;&#34;:()V
</span><span class="c1"></span>       <span class="n">4</span><span class="o">:</span> <span class="k">return</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">set</span><span class="o">(</span><span class="n">T</span><span class="o">);</span>
    <span class="n">Code</span><span class="o">:</span>
       <span class="n">0</span><span class="o">:</span> <span class="n">aload_0</span>
       <span class="n">1</span><span class="o">:</span> <span class="n">aload_1</span>
       <span class="n">2</span><span class="o">:</span> <span class="n">putfield</span>      <span class="err">#</span><span class="n">2</span>                  <span class="c1">// Field obj:Ljava/lang/Object;
</span><span class="c1"></span>       <span class="n">5</span><span class="o">:</span> <span class="k">return</span>

  <span class="kd">public</span> <span class="n">T</span> <span class="nf">get</span><span class="o">();</span>
    <span class="n">Code</span><span class="o">:</span>
       <span class="n">0</span><span class="o">:</span> <span class="n">aload_0</span>
       <span class="n">1</span><span class="o">:</span> <span class="n">getfield</span>      <span class="err">#</span><span class="n">2</span>                  <span class="c1">// Field obj:Ljava/lang/Object;
</span><span class="c1"></span>       <span class="n">4</span><span class="o">:</span> <span class="n">areturn</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span><span class="o">[]);</span>
    <span class="n">Code</span><span class="o">:</span>
       <span class="n">0</span><span class="o">:</span> <span class="k">new</span>           <span class="err">#</span><span class="n">3</span>                  <span class="c1">// class typeinfo/GenericHolder
</span><span class="c1"></span>       <span class="n">3</span><span class="o">:</span> <span class="n">dup</span>
       <span class="n">4</span><span class="o">:</span> <span class="n">invokespecial</span> <span class="err">#</span><span class="n">4</span>                  <span class="c1">// Method &#34;&lt;init&gt;&#34;:()V
</span><span class="c1"></span>       <span class="n">7</span><span class="o">:</span> <span class="n">astore_1</span>
       <span class="n">8</span><span class="o">:</span> <span class="n">aload_1</span>
       <span class="n">9</span><span class="o">:</span> <span class="n">ldc</span>           <span class="err">#</span><span class="n">5</span>                  <span class="c1">// String Item
</span><span class="c1"></span>      <span class="n">11</span><span class="o">:</span> <span class="n">invokevirtual</span> <span class="err">#</span><span class="n">6</span>                  <span class="c1">// Method set:(Ljava/lang/Object;)V
</span><span class="c1"></span>      <span class="n">14</span><span class="o">:</span> <span class="n">aload_1</span>
      <span class="n">15</span><span class="o">:</span> <span class="n">invokevirtual</span> <span class="err">#</span><span class="n">7</span>                  <span class="c1">// Method get:()Ljava/lang/Object;
</span><span class="c1"></span>      <span class="n">18</span><span class="o">:</span> <span class="n">checkcast</span>     <span class="err">#</span><span class="n">8</span>                  <span class="c1">// class java/lang/String
</span><span class="c1"></span>      <span class="n">21</span><span class="o">:</span> <span class="n">astore_2</span>
      <span class="n">22</span><span class="o">:</span> <span class="k">return</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>所产生的字节码是相同的。对进入<code>set()</code>的类型进行检查是不需要的，因为这将由编译器执行。而对从<code>get()</code>返回的值进行转型仍旧是需要的，但这与你自己必须执行的操作是一样的，此处它将由编译器自动插入。</p>
<p>由于所产生的<code>get()</code>和<code>set()</code>的字节码相同，所以在泛型中的所有动作都发生在边界处：对传递进来的值进行额外的编译器检查，并插入对传递出去的值的转型。</p>
<h2 id="158-擦除的补偿">15.8 擦除的补偿</h2>
<p>擦除丢失了在泛型代码中执行某些操作的能力。任何在运行时需要知道确切类型信息的操作都将无法工作：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//: generics/Erased.java
</span><span class="c1">// {CompileTimeError} (Won&#39;t compile)
</span><span class="c1"></span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Erased</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">SIZE</span> <span class="o">=</span> <span class="n">100</span><span class="o">;</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">f</span><span class="o">(</span><span class="n">Object</span> <span class="n">arg</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span><span class="o">(</span><span class="n">arg</span> <span class="k">instanceof</span> <span class="n">T</span><span class="o">)</span> <span class="o">{}</span>          <span class="c1">// Error
</span><span class="c1"></span>    <span class="n">T</span> <span class="n">var</span> <span class="o">=</span> <span class="k">new</span> <span class="n">T</span><span class="o">();</span>                 <span class="c1">// Error
</span><span class="c1"></span>    <span class="n">T</span><span class="o">[]</span> <span class="n">array</span> <span class="o">=</span> <span class="k">new</span> <span class="n">T</span><span class="o">[</span><span class="n">SIZE</span><span class="o">];</span>         <span class="c1">// Error
</span><span class="c1"></span>    <span class="n">T</span><span class="o">[]</span> <span class="n">array</span> <span class="o">=</span> <span class="o">(</span><span class="n">T</span><span class="o">)</span><span class="k">new</span> <span class="n">Object</span><span class="o">[</span><span class="n">SIZE</span><span class="o">];</span> <span class="c1">// Unchecked warning
</span><span class="c1"></span>  <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~
</span></code></pre></td></tr></table>
</div>
</div><p>偶尔可以绕过这些问题来编程，但是有时必须通过引入类型标签来对擦除进行补偿。这意味着你需要显式地传递你的类型的<code>Class</code>对象，以便你可以在类型表达式中使用它。</p>
<p>例如，在前面示例中对使用<code>instanceof</code>的尝试最终失败了，因为其类型信息已经被擦除了。如果引入类型标签，就可以转而使用动态的<code>isInstance()</code>：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//: generics/ClassTypeCapture.java
</span><span class="c1"></span>
<span class="kd">class</span> <span class="nc">Building</span> <span class="o">{}</span>
<span class="kd">class</span> <span class="nc">House</span> <span class="kd">extends</span> <span class="n">Building</span> <span class="o">{}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ClassTypeCapture</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="n">Class</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">kind</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">ClassTypeCapture</span><span class="o">(</span><span class="n">Class</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">kind</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">kind</span> <span class="o">=</span> <span class="n">kind</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">f</span><span class="o">(</span><span class="n">Object</span> <span class="n">arg</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">kind</span><span class="o">.</span><span class="na">isInstance</span><span class="o">(</span><span class="n">arg</span><span class="o">);</span>
  <span class="o">}</span>    
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">ClassTypeCapture</span><span class="o">&lt;</span><span class="n">Building</span><span class="o">&gt;</span> <span class="n">ctt1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ClassTypeCapture</span><span class="o">&lt;</span><span class="n">Building</span><span class="o">&gt;(</span><span class="n">Building</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">ctt1</span><span class="o">.</span><span class="na">f</span><span class="o">(</span><span class="k">new</span> <span class="n">Building</span><span class="o">()));</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">ctt1</span><span class="o">.</span><span class="na">f</span><span class="o">(</span><span class="k">new</span> <span class="n">House</span><span class="o">()));</span>
    <span class="n">ClassTypeCapture</span><span class="o">&lt;</span><span class="n">House</span><span class="o">&gt;</span> <span class="n">ctt2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ClassTypeCapture</span><span class="o">&lt;</span><span class="n">House</span><span class="o">&gt;(</span><span class="n">House</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">ctt2</span><span class="o">.</span><span class="na">f</span><span class="o">(</span><span class="k">new</span> <span class="n">Building</span><span class="o">()));</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">ctt2</span><span class="o">.</span><span class="na">f</span><span class="o">(</span><span class="k">new</span> <span class="n">House</span><span class="o">()));</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output:
</span><span class="cm">true
</span><span class="cm">true
</span><span class="cm">false
</span><span class="cm">true
</span><span class="cm">*/</span><span class="c1">//:~
</span></code></pre></td></tr></table>
</div>
</div><h3 id="1581-创建类型实例">15.8.1 创建类型实例</h3>
<p>在<code>Erased.java</code>中对创建一个<code>new T()</code>的尝试将无法实现，部分原因是因为擦除，而另一部分原因是因为编译器不能验证<code>T</code>具有默认构造器。但是在<code>C++</code>中，这种操作很自然，很直观，并且很安全：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="c1">//: generics/InstantiateGenericType.cpp
</span><span class="c1">// C++, not Java!
</span><span class="c1"></span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">T</span><span class="o">&gt;</span> <span class="k">class</span> <span class="nc">Foo</span> <span class="p">{</span>
  <span class="n">T</span> <span class="n">x</span><span class="p">;</span> <span class="c1">// Create a field of type T
</span><span class="c1"></span>  <span class="n">T</span><span class="o">*</span> <span class="n">y</span><span class="p">;</span> <span class="c1">// Pointer to T
</span><span class="c1"></span><span class="k">public</span><span class="o">:</span>
  <span class="c1">// Initialize the pointer:
</span><span class="c1"></span>  <span class="n">Foo</span><span class="p">()</span> <span class="p">{</span> <span class="n">y</span> <span class="o">=</span> <span class="k">new</span> <span class="n">T</span><span class="p">();</span> <span class="p">}</span>
<span class="p">};</span>

<span class="k">class</span> <span class="nc">Bar</span> <span class="p">{};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">Foo</span><span class="o">&lt;</span><span class="n">Bar</span><span class="o">&gt;</span> <span class="n">fb</span><span class="p">;</span>
  <span class="n">Foo</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">fi</span><span class="p">;</span> <span class="c1">// ... and it works with primitives
</span><span class="c1"></span><span class="p">}</span> <span class="c1">///:~
</span></code></pre></td></tr></table>
</div>
</div><p><code>Java</code>中的解决方案是传递一个工厂对象，并使用它来创建新的实例。最便利的工厂对象就是<code>Class</code>对象，因此如果使用类型标签，那么你就可以使用<code>newInstance()</code>来创建这个类型的新对象。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//: generics/InstantiateGenericType.java
</span><span class="c1"></span><span class="kn">import static</span> <span class="nn">net.mindview.util.Print.*</span><span class="o">;</span>

<span class="kd">class</span> <span class="nc">ClassAsFactory</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="n">T</span> <span class="n">x</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">ClassAsFactory</span><span class="o">(</span><span class="n">Class</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">kind</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">x</span> <span class="o">=</span> <span class="n">kind</span><span class="o">.</span><span class="na">newInstance</span><span class="o">();</span>
    <span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="n">RuntimeException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Employee</span> <span class="o">{}</span>    

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">InstantiateGenericType</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">ClassAsFactory</span><span class="o">&lt;</span><span class="n">Employee</span><span class="o">&gt;</span> <span class="n">fe</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ClassAsFactory</span><span class="o">&lt;</span><span class="n">Employee</span><span class="o">&gt;(</span><span class="n">Employee</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="n">print</span><span class="o">(</span><span class="s">&#34;ClassAsFactory&lt;Employee&gt; succeeded&#34;</span><span class="o">);</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">ClassAsFactory</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">fi</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ClassAsFactory</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;(</span><span class="n">Integer</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">print</span><span class="o">(</span><span class="s">&#34;ClassAsFactory&lt;Integer&gt; failed&#34;</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output:
</span><span class="cm">ClassAsFactory&lt;Employee&gt; succeeded
</span><span class="cm">ClassAsFactory&lt;Integer&gt; failed
</span><span class="cm">*/</span><span class="c1">//:~
</span></code></pre></td></tr></table>
</div>
</div><p>这可以编译，但是会因<code>ClassAsFactory&lt;Integer&gt;</code>而失败，因为<code>Integer</code>没有任何默认的构造器。因为这个错误不是在编译期捕获的，所以<code>Sun</code>的伙计们对这种方式并不赞成，他们建议使用显式的工厂，并将限制其类型，使得只能接受实现了这个工厂的类：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//: generics/FactoryConstraint.java
</span><span class="c1"></span>
<span class="kd">interface</span> <span class="nc">FactoryI</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="n">T</span> <span class="nf">create</span><span class="o">();</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Foo2</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">T</span> <span class="n">x</span><span class="o">;</span>
  <span class="kd">public</span> <span class="o">&lt;</span><span class="n">F</span> <span class="kd">extends</span> <span class="n">FactoryI</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span> <span class="nf">Foo2</span><span class="o">(</span><span class="n">F</span> <span class="n">factory</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="na">create</span><span class="o">();</span>
  <span class="o">}</span>
  <span class="c1">// ...
</span><span class="c1"></span><span class="o">}</span>

<span class="kd">class</span> <span class="nc">IntegerFactory</span> <span class="kd">implements</span> <span class="n">FactoryI</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="n">Integer</span> <span class="nf">create</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">Integer</span><span class="o">(</span><span class="n">0</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>    

<span class="kd">class</span> <span class="nc">Widget</span> <span class="o">{</span><span class="c1">//内部类
</span><span class="c1"></span>  <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Factory</span> <span class="kd">implements</span> <span class="n">FactoryI</span><span class="o">&lt;</span><span class="n">Widget</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="n">Widget</span> <span class="nf">create</span><span class="o">()</span> <span class="o">{</span>
      <span class="k">return</span> <span class="k">new</span> <span class="n">Widget</span><span class="o">();</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FactoryConstraint</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">new</span> <span class="n">Foo2</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;(</span><span class="k">new</span> <span class="n">IntegerFactory</span><span class="o">());</span>
    <span class="k">new</span> <span class="n">Foo2</span><span class="o">&lt;</span><span class="n">Widget</span><span class="o">&gt;(</span><span class="k">new</span> <span class="n">Widget</span><span class="o">.</span><span class="na">Factory</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~
</span></code></pre></td></tr></table>
</div>
</div><p>另一种方式是<code>模版方法</code>设计模式。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//: generics/CreatorGeneric.java
</span><span class="c1"></span>
<span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">GenericWithCreate</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kd">final</span> <span class="n">T</span> <span class="n">element</span><span class="o">;</span>
  <span class="n">GenericWithCreate</span><span class="o">()</span> <span class="o">{</span> <span class="n">element</span> <span class="o">=</span> <span class="n">create</span><span class="o">();</span> <span class="o">}</span>
  <span class="kd">abstract</span> <span class="n">T</span> <span class="nf">create</span><span class="o">();</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">X</span> <span class="o">{}</span>

<span class="kd">class</span> <span class="nc">Creator</span> <span class="kd">extends</span> <span class="n">GenericWithCreate</span><span class="o">&lt;</span><span class="n">X</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="n">X</span> <span class="nf">create</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="k">new</span> <span class="n">X</span><span class="o">();</span> <span class="o">}</span>
  <span class="kt">void</span> <span class="nf">f</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">element</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getSimpleName</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span>    

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CreatorGeneric</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Creator</span> <span class="n">c</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Creator</span><span class="o">();</span>
    <span class="n">c</span><span class="o">.</span><span class="na">f</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output:
</span><span class="cm">X
</span><span class="cm">*/</span><span class="c1">//:~
</span></code></pre></td></tr></table>
</div>
</div><h3 id="1582-泛型数组">15.8.2 泛型数组</h3>
<p>正如你在<code>Erased.java</code>中所见，不能创建泛型数组。一般的解决方案是在任何想要创建泛型数组的地方都使用<code>ArrayList</code>：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//: generics/ListOfGenerics.java
</span><span class="c1"></span><span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ListOfGenerics</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">array</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;();</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="n">T</span> <span class="n">item</span><span class="o">)</span> <span class="o">{</span> <span class="n">array</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">item</span><span class="o">);</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="n">T</span> <span class="nf">get</span><span class="o">(</span><span class="kt">int</span> <span class="n">index</span><span class="o">)</span> <span class="o">{</span> <span class="k">return</span> <span class="n">array</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">index</span><span class="o">);</span> <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~
</span></code></pre></td></tr></table>
</div>
</div><p>有趣的是，可以按照编译器喜欢的方式来定义一个引用：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//: generics/ArrayOfGenericReference.java
</span><span class="c1"></span>
<span class="kd">class</span> <span class="nc">Generic</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">{}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ArrayOfGenericReference</span> <span class="o">{</span>
  <span class="kd">static</span> <span class="n">Generic</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;[]</span> <span class="n">gia</span><span class="o">;</span>
<span class="o">}</span> <span class="c1">///:~
</span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//: generics/ArrayOfGeneric.java
</span><span class="c1"></span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ArrayOfGeneric</span> <span class="o">{</span>
  <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">SIZE</span> <span class="o">=</span> <span class="n">100</span><span class="o">;</span>
  <span class="kd">static</span> <span class="n">Generic</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;[]</span> <span class="n">gia</span><span class="o">;</span>
  <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">&#34;unchecked&#34;</span><span class="o">)</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">// 可以将子类转换为父类，但不能讲父类转换为子类 所以这里创建Object数组也是不可以的
</span><span class="c1"></span>    <span class="c1">// Compiles; produces ClassCastException:
</span><span class="c1"></span>    <span class="c1">//! gia = (Generic&lt;Integer&gt;[])new Object[SIZE];
</span><span class="c1"></span>    <span class="c1">// Runtime type is the raw (erased) type:
</span><span class="c1"></span>    <span class="n">gia</span> <span class="o">=</span> <span class="o">(</span><span class="n">Generic</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;[])</span><span class="k">new</span> <span class="n">Generic</span><span class="o">[</span><span class="n">SIZE</span><span class="o">];</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">gia</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getSimpleName</span><span class="o">());</span>
    <span class="n">gia</span><span class="o">[</span><span class="n">0</span><span class="o">]</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Generic</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;();</span>
    <span class="c1">//! gia[1] = new Object(); // Compile-time error
</span><span class="c1"></span>    <span class="c1">// Discovers type mismatch at compile time:
</span><span class="c1"></span>    <span class="c1">//! gia[2] = new Generic&lt;Double&gt;();
</span><span class="c1"></span>  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output:
</span><span class="cm">Generic[]
</span><span class="cm">*/</span><span class="c1">//:~
</span></code></pre></td></tr></table>
</div>
</div><p><code>gia</code>已经被转型为<code>Generic&lt;Integer&gt;[]</code>，但是这个信息只存在于编译期（并且如果没有@Suppress Warnings注解，你将得到有关这个转型的警告）。在运行时，它仍旧是<code>Object</code>数组，而这将引发问题。<strong>成功创建泛型数组的唯一方式就是创建一个被擦除类型的新数组，然后对其转型。</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//: generics/GenericArray.java
</span><span class="c1"></span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">GenericArray</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">T</span><span class="o">[]</span> <span class="n">array</span><span class="o">;</span>
  <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">&#34;unchecked&#34;</span><span class="o">)</span>
  <span class="kd">public</span> <span class="nf">GenericArray</span><span class="o">(</span><span class="kt">int</span> <span class="n">sz</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">array</span> <span class="o">=</span> <span class="o">(</span><span class="n">T</span><span class="o">[])</span><span class="k">new</span> <span class="n">Object</span><span class="o">[</span><span class="n">sz</span><span class="o">];</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">put</span><span class="o">(</span><span class="kt">int</span> <span class="n">index</span><span class="o">,</span> <span class="n">T</span> <span class="n">item</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">array</span><span class="o">[</span><span class="n">index</span><span class="o">]</span> <span class="o">=</span> <span class="n">item</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">T</span> <span class="nf">get</span><span class="o">(</span><span class="kt">int</span> <span class="n">index</span><span class="o">)</span> <span class="o">{</span> <span class="k">return</span> <span class="n">array</span><span class="o">[</span><span class="n">index</span><span class="o">];</span> <span class="o">}</span>
  <span class="c1">// Method that exposes the underlying representation:
</span><span class="c1"></span>  <span class="kd">public</span> <span class="n">T</span><span class="o">[]</span> <span class="nf">rep</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">array</span><span class="o">;</span> <span class="o">}</span>    
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">GenericArray</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">gai</span> <span class="o">=</span> <span class="k">new</span> <span class="n">GenericArray</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;(</span><span class="n">10</span><span class="o">);</span>
    <span class="c1">// This causes a ClassCastException:
</span><span class="c1"></span>    <span class="c1">//! Integer[] ia = gai.rep();
</span><span class="c1"></span>    <span class="c1">// This is OK:
</span><span class="c1"></span>    <span class="n">Object</span><span class="o">[]</span> <span class="n">oa</span> <span class="o">=</span> <span class="n">gai</span><span class="o">.</span><span class="na">rep</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~
</span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//: generics/GenericArray2.java
</span><span class="c1"></span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">GenericArray2</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">Object</span><span class="o">[]</span> <span class="n">array</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">GenericArray2</span><span class="o">(</span><span class="kt">int</span> <span class="n">sz</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">array</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Object</span><span class="o">[</span><span class="n">sz</span><span class="o">];</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">put</span><span class="o">(</span><span class="kt">int</span> <span class="n">index</span><span class="o">,</span> <span class="n">T</span> <span class="n">item</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">array</span><span class="o">[</span><span class="n">index</span><span class="o">]</span> <span class="o">=</span> <span class="n">item</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">&#34;unchecked&#34;</span><span class="o">)</span>
  <span class="kd">public</span> <span class="n">T</span> <span class="nf">get</span><span class="o">(</span><span class="kt">int</span> <span class="n">index</span><span class="o">)</span> <span class="o">{</span> <span class="k">return</span> <span class="o">(</span><span class="n">T</span><span class="o">)</span><span class="n">array</span><span class="o">[</span><span class="n">index</span><span class="o">];</span> <span class="o">}</span>
  <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">&#34;unchecked&#34;</span><span class="o">)</span>
  <span class="kd">public</span> <span class="n">T</span><span class="o">[]</span> <span class="nf">rep</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="o">(</span><span class="n">T</span><span class="o">[])</span><span class="n">array</span><span class="o">;</span> <span class="c1">// Warning: unchecked cast
</span><span class="c1"></span>  <span class="o">}</span>    
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">GenericArray2</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">gai</span> <span class="o">=</span>  <span class="k">new</span> <span class="n">GenericArray2</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;(</span><span class="n">10</span><span class="o">);</span>
    <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">10</span><span class="o">;</span> <span class="n">i</span> <span class="o">++)</span>
      <span class="n">gai</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">i</span><span class="o">,</span> <span class="n">i</span><span class="o">);</span>
    <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">10</span><span class="o">;</span> <span class="n">i</span> <span class="o">++)</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">gai</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">)</span> <span class="o">+</span> <span class="s">&#34; &#34;</span><span class="o">);</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">();</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">Integer</span><span class="o">[]</span> <span class="n">ia</span> <span class="o">=</span> <span class="n">gai</span><span class="o">.</span><span class="na">rep</span><span class="o">();</span>
    <span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">e</span><span class="o">);</span> <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output: (Sample)
</span><span class="cm">0 1 2 3 4 5 6 7 8 9
</span><span class="cm">java.lang.ClassCastException: [Ljava.lang.Object; cannot be cast to [Ljava.lang.Integer;
</span><span class="cm">*/</span><span class="c1">//:~
</span></code></pre></td></tr></table>
</div>
</div><p>不能声明<code>T[] array = new T[sz]</code>，因此我们创建了一个对象数组，然后将其转型。</p>
<p><code>rep()</code>方法将返回<code>T[]</code>，它在<code>main()</code>中将用于<code>gai</code>，因此应该是<code>Integer[]</code>，但是如果调用它，并尝试着将结果作为<code>Integer[]</code>引用来捕获，就会得到<code>ClassCastException</code>。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//: generics/GenericArrayWithTypeToken.java
</span><span class="c1"></span><span class="kn">import</span> <span class="nn">java.lang.reflect.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">GenericArrayWithTypeToken</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">T</span><span class="o">[]</span> <span class="n">array</span><span class="o">;</span>
  <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">&#34;unchecked&#34;</span><span class="o">)</span>
  <span class="kd">public</span> <span class="nf">GenericArrayWithTypeToken</span><span class="o">(</span><span class="n">Class</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">type</span><span class="o">,</span> <span class="kt">int</span> <span class="n">sz</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">array</span> <span class="o">=</span> <span class="o">(</span><span class="n">T</span><span class="o">[])</span><span class="n">Array</span><span class="o">.</span><span class="na">newInstance</span><span class="o">(</span><span class="n">type</span><span class="o">,</span> <span class="n">sz</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">put</span><span class="o">(</span><span class="kt">int</span> <span class="n">index</span><span class="o">,</span> <span class="n">T</span> <span class="n">item</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">array</span><span class="o">[</span><span class="n">index</span><span class="o">]</span> <span class="o">=</span> <span class="n">item</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">T</span> <span class="nf">get</span><span class="o">(</span><span class="kt">int</span> <span class="n">index</span><span class="o">)</span> <span class="o">{</span> <span class="k">return</span> <span class="n">array</span><span class="o">[</span><span class="n">index</span><span class="o">];</span> <span class="o">}</span>
  <span class="c1">// Expose the underlying representation:
</span><span class="c1"></span>  <span class="kd">public</span> <span class="n">T</span><span class="o">[]</span> <span class="nf">rep</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">array</span><span class="o">;</span> <span class="o">}</span>    
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">GenericArrayWithTypeToken</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">gai</span> <span class="o">=</span> <span class="k">new</span> <span class="n">GenericArrayWithTypeToken</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;(</span><span class="n">Integer</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">10</span><span class="o">);</span>
    <span class="c1">// This now works:
</span><span class="c1"></span>    <span class="n">Integer</span><span class="o">[]</span> <span class="n">ia</span> <span class="o">=</span> <span class="n">gai</span><span class="o">.</span><span class="na">rep</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~
</span></code></pre></td></tr></table>
</div>
</div><h2 id="159-边界">15.9 边界</h2>
<p>因为擦除移除了类型信息，所以，无界泛型参数调用的方法只是那些可以用<code>Object</code>调用的方法。但是，如果能够将这个参数限制为某个类型自己，那么就可以用这些类型子集来调用方法。为了执行这种限制，<code>Java</code>泛型重用了<code>extends</code>关键字。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//: generics/BasicBounds.java
</span><span class="c1"></span>
<span class="kd">interface</span> <span class="nc">HasColor</span> <span class="o">{</span> <span class="n">java</span><span class="o">.</span><span class="na">awt</span><span class="o">.</span><span class="na">Color</span> <span class="nf">getColor</span><span class="o">();</span> <span class="o">}</span>

<span class="kd">class</span> <span class="nc">Colored</span><span class="o">&lt;</span><span class="n">T</span> <span class="kd">extends</span> <span class="n">HasColor</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="n">T</span> <span class="n">item</span><span class="o">;</span>
  <span class="n">Colored</span><span class="o">(</span><span class="n">T</span> <span class="n">item</span><span class="o">)</span> <span class="o">{</span> <span class="k">this</span><span class="o">.</span><span class="na">item</span> <span class="o">=</span> <span class="n">item</span><span class="o">;</span> <span class="o">}</span>
  <span class="n">T</span> <span class="nf">getItem</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">item</span><span class="o">;</span> <span class="o">}</span>
  <span class="c1">// The bound allows you to call a method:
</span><span class="c1"></span>  <span class="n">java</span><span class="o">.</span><span class="na">awt</span><span class="o">.</span><span class="na">Color</span> <span class="nf">color</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">item</span><span class="o">.</span><span class="na">getColor</span><span class="o">();</span> <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Dimension</span> <span class="o">{</span> <span class="kd">public</span> <span class="kt">int</span> <span class="n">x</span><span class="o">,</span> <span class="n">y</span><span class="o">,</span> <span class="n">z</span><span class="o">;</span> <span class="o">}</span>

<span class="c1">//类必须在前
</span><span class="c1">// This won&#39;t work -- class must be first, then interfaces:
</span><span class="c1">// class ColoredDimension&lt;T extends HasColor &amp; Dimension&gt; {
</span><span class="c1"></span>
<span class="c1">// Multiple bounds:
</span><span class="c1"></span><span class="kd">class</span> <span class="nc">ColoredDimension</span><span class="o">&lt;</span><span class="n">T</span> <span class="kd">extends</span> <span class="n">Dimension</span> <span class="o">&amp;</span> <span class="n">HasColor</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="n">T</span> <span class="n">item</span><span class="o">;</span>
  <span class="n">ColoredDimension</span><span class="o">(</span><span class="n">T</span> <span class="n">item</span><span class="o">)</span> <span class="o">{</span> <span class="k">this</span><span class="o">.</span><span class="na">item</span> <span class="o">=</span> <span class="n">item</span><span class="o">;</span> <span class="o">}</span>
  <span class="n">T</span> <span class="nf">getItem</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">item</span><span class="o">;</span> <span class="o">}</span>
  <span class="n">java</span><span class="o">.</span><span class="na">awt</span><span class="o">.</span><span class="na">Color</span> <span class="nf">color</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">item</span><span class="o">.</span><span class="na">getColor</span><span class="o">();</span> <span class="o">}</span>
  <span class="kt">int</span> <span class="nf">getX</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">item</span><span class="o">.</span><span class="na">x</span><span class="o">;</span> <span class="o">}</span>
  <span class="kt">int</span> <span class="nf">getY</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">item</span><span class="o">.</span><span class="na">y</span><span class="o">;</span> <span class="o">}</span>
  <span class="kt">int</span> <span class="nf">getZ</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">item</span><span class="o">.</span><span class="na">z</span><span class="o">;</span> <span class="o">}</span>
<span class="o">}</span>

<span class="kd">interface</span> <span class="nc">Weight</span> <span class="o">{</span> <span class="kt">int</span> <span class="nf">weight</span><span class="o">();</span> <span class="o">}</span>    

<span class="c1">// As with inheritance, you can have only one
</span><span class="c1">// concrete class but multiple interfaces:
</span><span class="c1"></span><span class="kd">class</span> <span class="nc">Solid</span><span class="o">&lt;</span><span class="n">T</span> <span class="kd">extends</span> <span class="n">Dimension</span> <span class="o">&amp;</span> <span class="n">HasColor</span> <span class="o">&amp;</span> <span class="n">Weight</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="n">T</span> <span class="n">item</span><span class="o">;</span>
  <span class="n">Solid</span><span class="o">(</span><span class="n">T</span> <span class="n">item</span><span class="o">)</span> <span class="o">{</span> <span class="k">this</span><span class="o">.</span><span class="na">item</span> <span class="o">=</span> <span class="n">item</span><span class="o">;</span> <span class="o">}</span>
  <span class="n">T</span> <span class="nf">getItem</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">item</span><span class="o">;</span> <span class="o">}</span>
  <span class="n">java</span><span class="o">.</span><span class="na">awt</span><span class="o">.</span><span class="na">Color</span> <span class="nf">color</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">item</span><span class="o">.</span><span class="na">getColor</span><span class="o">();</span> <span class="o">}</span>
  <span class="kt">int</span> <span class="nf">getX</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">item</span><span class="o">.</span><span class="na">x</span><span class="o">;</span> <span class="o">}</span>
  <span class="kt">int</span> <span class="nf">getY</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">item</span><span class="o">.</span><span class="na">y</span><span class="o">;</span> <span class="o">}</span>
  <span class="kt">int</span> <span class="nf">getZ</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">item</span><span class="o">.</span><span class="na">z</span><span class="o">;</span> <span class="o">}</span>
  <span class="kt">int</span> <span class="nf">weight</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">item</span><span class="o">.</span><span class="na">weight</span><span class="o">();</span> <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Bounded</span> <span class="kd">extends</span> <span class="n">Dimension</span> <span class="kd">implements</span> <span class="n">HasColor</span><span class="o">,</span> <span class="n">Weight</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="n">java</span><span class="o">.</span><span class="na">awt</span><span class="o">.</span><span class="na">Color</span> <span class="nf">getColor</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="kc">null</span><span class="o">;</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">weight</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">0</span><span class="o">;</span> <span class="o">}</span>
<span class="o">}</span>    

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">BasicBounds</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Solid</span><span class="o">&lt;</span><span class="n">Bounded</span><span class="o">&gt;</span> <span class="n">solid</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Solid</span><span class="o">&lt;</span><span class="n">Bounded</span><span class="o">&gt;(</span><span class="k">new</span> <span class="n">Bounded</span><span class="o">());</span>
    <span class="n">solid</span><span class="o">.</span><span class="na">color</span><span class="o">();</span>
    <span class="n">solid</span><span class="o">.</span><span class="na">getY</span><span class="o">();</span>
    <span class="n">solid</span><span class="o">.</span><span class="na">weight</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~
</span></code></pre></td></tr></table>
</div>
</div><p>继承的每个层次上添加边界限制：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//: generics/InheritBounds.java
</span><span class="c1"></span>
<span class="kd">class</span> <span class="nc">HoldItem</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="n">T</span> <span class="n">item</span><span class="o">;</span>
  <span class="n">HoldItem</span><span class="o">(</span><span class="n">T</span> <span class="n">item</span><span class="o">)</span> <span class="o">{</span> <span class="k">this</span><span class="o">.</span><span class="na">item</span> <span class="o">=</span> <span class="n">item</span><span class="o">;</span> <span class="o">}</span>
  <span class="n">T</span> <span class="nf">getItem</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">item</span><span class="o">;</span> <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Colored2</span><span class="o">&lt;</span><span class="n">T</span> <span class="kd">extends</span> <span class="n">HasColor</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="n">HoldItem</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="n">Colored2</span><span class="o">(</span><span class="n">T</span> <span class="n">item</span><span class="o">)</span> <span class="o">{</span> <span class="kd">super</span><span class="o">(</span><span class="n">item</span><span class="o">);</span> <span class="o">}</span>
  <span class="n">java</span><span class="o">.</span><span class="na">awt</span><span class="o">.</span><span class="na">Color</span> <span class="nf">color</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">item</span><span class="o">.</span><span class="na">getColor</span><span class="o">();</span> <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">ColoredDimension2</span><span class="o">&lt;</span><span class="n">T</span> <span class="kd">extends</span> <span class="n">Dimension</span> <span class="o">&amp;</span> <span class="n">HasColor</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="n">Colored2</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="n">ColoredDimension2</span><span class="o">(</span><span class="n">T</span> <span class="n">item</span><span class="o">)</span> <span class="o">{</span>  <span class="kd">super</span><span class="o">(</span><span class="n">item</span><span class="o">);</span> <span class="o">}</span>
  <span class="kt">int</span> <span class="nf">getX</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">item</span><span class="o">.</span><span class="na">x</span><span class="o">;</span> <span class="o">}</span>
  <span class="kt">int</span> <span class="nf">getY</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">item</span><span class="o">.</span><span class="na">y</span><span class="o">;</span> <span class="o">}</span>
  <span class="kt">int</span> <span class="nf">getZ</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">item</span><span class="o">.</span><span class="na">z</span><span class="o">;</span> <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Solid2</span><span class="o">&lt;</span><span class="n">T</span> <span class="kd">extends</span> <span class="n">Dimension</span> <span class="o">&amp;</span> <span class="n">HasColor</span> <span class="o">&amp;</span> <span class="n">Weight</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="n">ColoredDimension2</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="n">Solid2</span><span class="o">(</span><span class="n">T</span> <span class="n">item</span><span class="o">)</span> <span class="o">{</span>  <span class="kd">super</span><span class="o">(</span><span class="n">item</span><span class="o">);</span> <span class="o">}</span>
  <span class="kt">int</span> <span class="nf">weight</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">item</span><span class="o">.</span><span class="na">weight</span><span class="o">();</span> <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">InheritBounds</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Solid2</span><span class="o">&lt;</span><span class="n">Bounded</span><span class="o">&gt;</span> <span class="n">solid2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Solid2</span><span class="o">&lt;</span><span class="n">Bounded</span><span class="o">&gt;(</span><span class="k">new</span> <span class="n">Bounded</span><span class="o">());</span>
    <span class="n">solid2</span><span class="o">.</span><span class="na">color</span><span class="o">();</span>
    <span class="n">solid2</span><span class="o">.</span><span class="na">getY</span><span class="o">();</span>
    <span class="n">solid2</span><span class="o">.</span><span class="na">weight</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~
</span></code></pre></td></tr></table>
</div>
</div><p>具有更多层次的示例：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//: generics/EpicBattle.java
</span><span class="c1">// Demonstrating bounds in Java generics.
</span><span class="c1"></span><span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">interface</span> <span class="nc">SuperPower</span> <span class="o">{}</span>
<span class="kd">interface</span> <span class="nc">XRayVision</span> <span class="kd">extends</span> <span class="n">SuperPower</span> <span class="o">{</span>
  <span class="kt">void</span> <span class="nf">seeThroughWalls</span><span class="o">();</span>
<span class="o">}</span>
<span class="kd">interface</span> <span class="nc">SuperHearing</span> <span class="kd">extends</span> <span class="n">SuperPower</span> <span class="o">{</span>
  <span class="kt">void</span> <span class="nf">hearSubtleNoises</span><span class="o">();</span>
<span class="o">}</span>
<span class="kd">interface</span> <span class="nc">SuperSmell</span> <span class="kd">extends</span> <span class="n">SuperPower</span> <span class="o">{</span>
  <span class="kt">void</span> <span class="nf">trackBySmell</span><span class="o">();</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">SuperHero</span><span class="o">&lt;</span><span class="n">POWER</span> <span class="kd">extends</span> <span class="n">SuperPower</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="n">POWER</span> <span class="n">power</span><span class="o">;</span>
  <span class="n">SuperHero</span><span class="o">(</span><span class="n">POWER</span> <span class="n">power</span><span class="o">)</span> <span class="o">{</span> <span class="k">this</span><span class="o">.</span><span class="na">power</span> <span class="o">=</span> <span class="n">power</span><span class="o">;</span> <span class="o">}</span>
  <span class="n">POWER</span> <span class="nf">getPower</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">power</span><span class="o">;</span> <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">SuperSleuth</span><span class="o">&lt;</span><span class="n">POWER</span> <span class="kd">extends</span> <span class="n">XRayVision</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="n">SuperHero</span><span class="o">&lt;</span><span class="n">POWER</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="n">SuperSleuth</span><span class="o">(</span><span class="n">POWER</span> <span class="n">power</span><span class="o">)</span> <span class="o">{</span> <span class="kd">super</span><span class="o">(</span><span class="n">power</span><span class="o">);</span> <span class="o">}</span>
  <span class="kt">void</span> <span class="nf">see</span><span class="o">()</span> <span class="o">{</span> <span class="n">power</span><span class="o">.</span><span class="na">seeThroughWalls</span><span class="o">();</span> <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">CanineHero</span><span class="o">&lt;</span><span class="n">POWER</span> <span class="kd">extends</span> <span class="n">SuperHearing</span> <span class="o">&amp;</span> <span class="n">SuperSmell</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="n">SuperHero</span><span class="o">&lt;</span><span class="n">POWER</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="n">CanineHero</span><span class="o">(</span><span class="n">POWER</span> <span class="n">power</span><span class="o">)</span> <span class="o">{</span> <span class="kd">super</span><span class="o">(</span><span class="n">power</span><span class="o">);</span> <span class="o">}</span>
  <span class="kt">void</span> <span class="nf">hear</span><span class="o">()</span> <span class="o">{</span> <span class="n">power</span><span class="o">.</span><span class="na">hearSubtleNoises</span><span class="o">();</span> <span class="o">}</span>
  <span class="kt">void</span> <span class="nf">smell</span><span class="o">()</span> <span class="o">{</span> <span class="n">power</span><span class="o">.</span><span class="na">trackBySmell</span><span class="o">();</span> <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">SuperHearSmell</span> <span class="kd">implements</span> <span class="n">SuperHearing</span><span class="o">,</span> <span class="n">SuperSmell</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">hearSubtleNoises</span><span class="o">()</span> <span class="o">{}</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">trackBySmell</span><span class="o">()</span> <span class="o">{}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">DogBoy</span> <span class="kd">extends</span> <span class="n">CanineHero</span><span class="o">&lt;</span><span class="n">SuperHearSmell</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="n">DogBoy</span><span class="o">()</span> <span class="o">{</span> <span class="kd">super</span><span class="o">(</span><span class="k">new</span> <span class="n">SuperHearSmell</span><span class="o">());</span> <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">EpicBattle</span> <span class="o">{</span>
  <span class="c1">// Bounds in generic methods:
</span><span class="c1"></span>  <span class="kd">static</span> <span class="o">&lt;</span><span class="n">POWER</span> <span class="kd">extends</span> <span class="n">SuperHearing</span><span class="o">&gt;</span> <span class="kt">void</span> <span class="nf">useSuperHearing</span><span class="o">(</span><span class="n">SuperHero</span><span class="o">&lt;</span><span class="n">POWER</span><span class="o">&gt;</span> <span class="n">hero</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">hero</span><span class="o">.</span><span class="na">getPower</span><span class="o">().</span><span class="na">hearSubtleNoises</span><span class="o">();</span>
  <span class="o">}</span>
  <span class="kd">static</span> <span class="o">&lt;</span><span class="n">POWER</span> <span class="kd">extends</span> <span class="n">SuperHearing</span> <span class="o">&amp;</span> <span class="n">SuperSmell</span><span class="o">&gt;</span> <span class="kt">void</span> <span class="nf">superFind</span><span class="o">(</span><span class="n">SuperHero</span><span class="o">&lt;</span><span class="n">POWER</span><span class="o">&gt;</span> <span class="n">hero</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">hero</span><span class="o">.</span><span class="na">getPower</span><span class="o">().</span><span class="na">hearSubtleNoises</span><span class="o">();</span>
    <span class="n">hero</span><span class="o">.</span><span class="na">getPower</span><span class="o">().</span><span class="na">trackBySmell</span><span class="o">();</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">DogBoy</span> <span class="n">dogBoy</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DogBoy</span><span class="o">();</span>
    <span class="n">useSuperHearing</span><span class="o">(</span><span class="n">dogBoy</span><span class="o">);</span>
    <span class="n">superFind</span><span class="o">(</span><span class="n">dogBoy</span><span class="o">);</span>
    <span class="c1">// You can do this:
</span><span class="c1"></span>    <span class="n">List</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="n">SuperHearing</span><span class="o">&gt;</span> <span class="n">audioBoys</span><span class="o">;</span>
    <span class="c1">// But you can&#39;t do this:
</span><span class="c1"></span>    <span class="c1">// List&lt;? extends SuperHearing &amp; SuperSmell&gt; dogBoys;
</span><span class="c1"></span>  <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~
</span></code></pre></td></tr></table>
</div>
</div><h2 id="1510-通配符">15.10 通配符</h2>
<p>可以向导出类型的数组赋予基类型的数组引用：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//: generics/CovariantArrays.java
</span><span class="c1"></span>
<span class="kd">class</span> <span class="nc">Fruit</span> <span class="o">{}</span>
<span class="kd">class</span> <span class="nc">Apple</span> <span class="kd">extends</span> <span class="n">Fruit</span> <span class="o">{}</span>
<span class="kd">class</span> <span class="nc">Jonathan</span> <span class="kd">extends</span> <span class="n">Apple</span> <span class="o">{}</span>
<span class="kd">class</span> <span class="nc">Orange</span> <span class="kd">extends</span> <span class="n">Fruit</span> <span class="o">{}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CovariantArrays</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Fruit</span><span class="o">[]</span> <span class="n">fruit</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Apple</span><span class="o">[</span><span class="n">10</span><span class="o">];</span>
    <span class="n">fruit</span><span class="o">[</span><span class="n">0</span><span class="o">]</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Apple</span><span class="o">();</span> <span class="c1">// OK
</span><span class="c1"></span>    <span class="n">fruit</span><span class="o">[</span><span class="n">1</span><span class="o">]</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Jonathan</span><span class="o">();</span> <span class="c1">// OK
</span><span class="c1"></span>    <span class="c1">// Runtime type is Apple[], not Fruit[] or Orange[]:
</span><span class="c1"></span>    <span class="k">try</span> <span class="o">{</span>
      <span class="c1">// Compiler allows you to add Fruit:
</span><span class="c1"></span>      <span class="n">fruit</span><span class="o">[</span><span class="n">0</span><span class="o">]</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Fruit</span><span class="o">();</span> <span class="c1">// ArrayStoreException
</span><span class="c1"></span>    <span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">e</span><span class="o">);</span> <span class="o">}</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="c1">// Compiler allows you to add Oranges:
</span><span class="c1"></span>      <span class="n">fruit</span><span class="o">[</span><span class="n">0</span><span class="o">]</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Orange</span><span class="o">();</span> <span class="c1">// ArrayStoreException
</span><span class="c1"></span>    <span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">e</span><span class="o">);</span> <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output:
</span><span class="cm">java.lang.ArrayStoreException: Fruit
</span><span class="cm">java.lang.ArrayStoreException: Orange
</span><span class="cm">*/</span><span class="c1">//:~
</span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//: generics/NonCovariantGenerics.java
</span><span class="c1">// {CompileTimeError} (Won&#39;t compile)
</span><span class="c1"></span><span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">NonCovariantGenerics</span> <span class="o">{</span>
  <span class="c1">// Compile Error: incompatible types:
</span><span class="c1"></span>  <span class="n">List</span><span class="o">&lt;</span><span class="n">Fruit</span><span class="o">&gt;</span> <span class="n">flist</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Apple</span><span class="o">&gt;();</span>
<span class="o">}</span> <span class="c1">///:~
</span></code></pre></td></tr></table>
</div>
</div><p>有时你想要在两个类之间建立某种类型的向上转型关系，这正是通配符所允许的：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//: generics/GenericsAndCovariance.java
</span><span class="c1"></span><span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">GenericsAndCovariance</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// Wildcards allow covariance:
</span><span class="c1"></span>    <span class="n">List</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="n">Fruit</span><span class="o">&gt;</span> <span class="n">flist</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Apple</span><span class="o">&gt;();</span>
    <span class="c1">// Compile Error: can&#39;t add any type of object:
</span><span class="c1"></span>    <span class="c1">// flist.add(new Apple());
</span><span class="c1"></span>    <span class="c1">// flist.add(new Fruit());
</span><span class="c1"></span>    <span class="c1">// flist.add(new Object());
</span><span class="c1"></span>    <span class="n">flist</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span> <span class="c1">// Legal but uninteresting
</span><span class="c1"></span>    <span class="c1">// We know that it returns at least Fruit:
</span><span class="c1"></span>    <span class="n">Fruit</span> <span class="n">f</span> <span class="o">=</span> <span class="n">flist</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">0</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~
</span></code></pre></td></tr></table>
</div>
</div><h3 id="15101-编译器有多聪明">15.10.1 编译器有多聪明</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//: generics/CompilerIntelligence.java
</span><span class="c1"></span><span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CompilerIntelligence</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">List</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="n">Fruit</span><span class="o">&gt;</span> <span class="n">flist</span> <span class="o">=</span>
      <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="k">new</span> <span class="n">Apple</span><span class="o">());</span>
    <span class="n">Apple</span> <span class="n">a</span> <span class="o">=</span> <span class="o">(</span><span class="n">Apple</span><span class="o">)</span><span class="n">flist</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">0</span><span class="o">);</span> <span class="c1">// No warning
</span><span class="c1"></span>    <span class="n">flist</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="k">new</span> <span class="n">Apple</span><span class="o">());</span> <span class="c1">// Argument is &#39;Object&#39;
</span><span class="c1"></span>    <span class="n">flist</span><span class="o">.</span><span class="na">indexOf</span><span class="o">(</span><span class="k">new</span> <span class="n">Apple</span><span class="o">());</span> <span class="c1">// Argument is &#39;Object&#39;
</span><span class="c1"></span>  <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~
</span></code></pre></td></tr></table>
</div>
</div><p>当你指定一个<code>ArrayList&lt;? extends Fruit&gt;</code>时，<code>add()</code>的参数就变成了“? extends Fruit”。从这个描述中，编译器并不能了解这里需要<code>Fruit</code>的哪个具体子类型，因此它不会接受任何类型的<code>Fruit</code>。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//: generics/Holder.java
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Holder</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">T</span> <span class="n">value</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">Holder</span><span class="o">()</span> <span class="o">{}</span>
  <span class="kd">public</span> <span class="nf">Holder</span><span class="o">(</span><span class="n">T</span> <span class="n">val</span><span class="o">)</span> <span class="o">{</span> <span class="n">value</span> <span class="o">=</span> <span class="n">val</span><span class="o">;</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">set</span><span class="o">(</span><span class="n">T</span> <span class="n">val</span><span class="o">)</span> <span class="o">{</span> <span class="n">value</span> <span class="o">=</span> <span class="n">val</span><span class="o">;</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="n">T</span> <span class="nf">get</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">value</span><span class="o">;</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="n">Object</span> <span class="n">obj</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">obj</span><span class="o">);</span>
  <span class="o">}</span>    
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Holder</span><span class="o">&lt;</span><span class="n">Apple</span><span class="o">&gt;</span> <span class="n">Apple</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Holder</span><span class="o">&lt;</span><span class="n">Apple</span><span class="o">&gt;(</span><span class="k">new</span> <span class="n">Apple</span><span class="o">());</span>
    <span class="n">Apple</span> <span class="n">d</span> <span class="o">=</span> <span class="n">Apple</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
    <span class="n">Apple</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">d</span><span class="o">);</span>
    <span class="c1">// Holder&lt;Fruit&gt; Fruit = Apple; // Cannot upcast
</span><span class="c1"></span>    <span class="n">Holder</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="n">Fruit</span><span class="o">&gt;</span> <span class="n">fruit</span> <span class="o">=</span> <span class="n">Apple</span><span class="o">;</span> <span class="c1">// OK
</span><span class="c1"></span>    <span class="n">Fruit</span> <span class="n">p</span> <span class="o">=</span> <span class="n">fruit</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
    <span class="n">d</span> <span class="o">=</span> <span class="o">(</span><span class="n">Apple</span><span class="o">)</span><span class="n">fruit</span><span class="o">.</span><span class="na">get</span><span class="o">();</span> <span class="c1">// Returns &#39;Object&#39;
</span><span class="c1"></span>    <span class="k">try</span> <span class="o">{</span>
      <span class="n">Orange</span> <span class="n">c</span> <span class="o">=</span> <span class="o">(</span><span class="n">Orange</span><span class="o">)</span><span class="n">fruit</span><span class="o">.</span><span class="na">get</span><span class="o">();</span> <span class="c1">// No warning
</span><span class="c1"></span>    <span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">e</span><span class="o">);</span> <span class="o">}</span>
    <span class="c1">// fruit.set(new Apple()); // Cannot call set()
</span><span class="c1"></span>    <span class="c1">// fruit.set(new Fruit()); // Cannot call set()
</span><span class="c1"></span>    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">fruit</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">d</span><span class="o">));</span> <span class="c1">// OK
</span><span class="c1"></span>  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output: (Sample)
</span><span class="cm">java.lang.ClassCastException: Apple cannot be cast to Orange
</span><span class="cm">true
</span><span class="cm">*/</span><span class="c1">//:~
</span></code></pre></td></tr></table>
</div>
</div><h3 id="15102-逆变">15.10.2 逆变</h3>
<p>还可以走另外一条路，即使用<code>超类型通配符</code>。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//: generics/SuperTypeWildcards.java
</span><span class="c1"></span><span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SuperTypeWildcards</span> <span class="o">{</span>
  <span class="kd">static</span> <span class="kt">void</span> <span class="nf">writeTo</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;?</span> <span class="kd">super</span> <span class="n">Apple</span><span class="o">&gt;</span> <span class="n">apples</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">apples</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Apple</span><span class="o">());</span>
    <span class="n">apples</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Jonathan</span><span class="o">());</span>
    <span class="c1">// apples.add(new Fruit()); // Error
</span><span class="c1"></span>  <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~
</span></code></pre></td></tr></table>
</div>
</div><p>List&lt;? super Apple&gt;是Apple的某种基类型的List，这样你就知道向其中添加Apple或Apple的子类型是安全的。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//: generics/GenericWriting.java
</span><span class="c1"></span><span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">GenericWriting</span> <span class="o">{</span>
  <span class="kd">static</span> <span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="kt">void</span> <span class="nf">writeExact</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">,</span> <span class="n">T</span> <span class="n">item</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">item</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">static</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Apple</span><span class="o">&gt;</span> <span class="n">apples</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Apple</span><span class="o">&gt;();</span>
  <span class="kd">static</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Fruit</span><span class="o">&gt;</span> <span class="n">fruit</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Fruit</span><span class="o">&gt;();</span>
  <span class="kd">static</span> <span class="kt">void</span> <span class="nf">f1</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">writeExact</span><span class="o">(</span><span class="n">apples</span><span class="o">,</span> <span class="k">new</span> <span class="n">Apple</span><span class="o">());</span>
    <span class="c1">// writeExact(fruit, new Apple()); // Error:
</span><span class="c1"></span>    <span class="c1">// Incompatible types: found Fruit, required Apple
</span><span class="c1"></span>  <span class="o">}</span>
  <span class="kd">static</span> <span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="kt">void</span> <span class="nf">writeWithWildcard</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;?</span> <span class="kd">super</span> <span class="n">T</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">,</span> <span class="n">T</span> <span class="n">item</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">item</span><span class="o">);</span>
  <span class="o">}</span>    
  <span class="kd">static</span> <span class="kt">void</span> <span class="nf">f2</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">writeWithWildcard</span><span class="o">(</span><span class="n">apples</span><span class="o">,</span> <span class="k">new</span> <span class="n">Apple</span><span class="o">());</span>
    <span class="n">writeWithWildcard</span><span class="o">(</span><span class="n">fruit</span><span class="o">,</span> <span class="k">new</span> <span class="n">Apple</span><span class="o">());</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span> <span class="n">f1</span><span class="o">();</span> <span class="n">f2</span><span class="o">();</span> <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~
</span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//: generics/GenericReading.java
</span><span class="c1"></span><span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">GenericReading</span> <span class="o">{</span>
  <span class="kd">static</span> <span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">T</span> <span class="nf">readExact</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">list</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">0</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">static</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Apple</span><span class="o">&gt;</span> <span class="n">apples</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="k">new</span> <span class="n">Apple</span><span class="o">());</span>
  <span class="kd">static</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Fruit</span><span class="o">&gt;</span> <span class="n">fruit</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="k">new</span> <span class="n">Fruit</span><span class="o">());</span>
  <span class="c1">// A static method adapts to each call:
</span><span class="c1"></span>  <span class="kd">static</span> <span class="kt">void</span> <span class="nf">f1</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">Apple</span> <span class="n">a</span> <span class="o">=</span> <span class="n">readExact</span><span class="o">(</span><span class="n">apples</span><span class="o">);</span>
    <span class="n">Fruit</span> <span class="n">f</span> <span class="o">=</span> <span class="n">readExact</span><span class="o">(</span><span class="n">fruit</span><span class="o">);</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">readExact</span><span class="o">(</span><span class="n">apples</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="c1">// If, however, you have a class, then its type is
</span><span class="c1"></span>  <span class="c1">// established when the class is instantiated:
</span><span class="c1"></span>  <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Reader</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="n">T</span> <span class="nf">readExact</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">)</span> <span class="o">{</span> <span class="k">return</span> <span class="n">list</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">0</span><span class="o">);</span> <span class="o">}</span>
  <span class="o">}</span>    
  <span class="kd">static</span> <span class="kt">void</span> <span class="nf">f2</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">Reader</span><span class="o">&lt;</span><span class="n">Fruit</span><span class="o">&gt;</span> <span class="n">fruitReader</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Reader</span><span class="o">&lt;</span><span class="n">Fruit</span><span class="o">&gt;();</span>
    <span class="n">Fruit</span> <span class="n">f</span> <span class="o">=</span> <span class="n">fruitReader</span><span class="o">.</span><span class="na">readExact</span><span class="o">(</span><span class="n">fruit</span><span class="o">);</span>
    <span class="c1">// Fruit a = fruitReader.readExact(apples); // Error:
</span><span class="c1"></span>    <span class="c1">// readExact(List&lt;Fruit&gt;) cannot be
</span><span class="c1"></span>    <span class="c1">// applied to (List&lt;Apple&gt;).
</span><span class="c1"></span>  <span class="o">}</span>
  <span class="kd">static</span> <span class="kd">class</span> <span class="nc">CovariantReader</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="n">T</span> <span class="nf">readCovariant</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="n">T</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">return</span> <span class="n">list</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">0</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
  <span class="kd">static</span> <span class="kt">void</span> <span class="nf">f3</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">CovariantReader</span><span class="o">&lt;</span><span class="n">Fruit</span><span class="o">&gt;</span> <span class="n">fruitReader</span> <span class="o">=</span>
      <span class="k">new</span> <span class="n">CovariantReader</span><span class="o">&lt;</span><span class="n">Fruit</span><span class="o">&gt;();</span>
    <span class="n">Fruit</span> <span class="n">f</span> <span class="o">=</span> <span class="n">fruitReader</span><span class="o">.</span><span class="na">readCovariant</span><span class="o">(</span><span class="n">fruit</span><span class="o">);</span>
    <span class="n">Fruit</span> <span class="n">a</span> <span class="o">=</span> <span class="n">fruitReader</span><span class="o">.</span><span class="na">readCovariant</span><span class="o">(</span><span class="n">apples</span><span class="o">);</span>
  <span class="o">}</span>    
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">f1</span><span class="o">();</span> <span class="n">f2</span><span class="o">();</span> <span class="n">f3</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~
</span></code></pre></td></tr></table>
</div>
</div><h3 id="15103-无界通配符">15.10.3 无界通配符</h3>
<p><code>无界通配符&lt;?&gt;</code>看起来意味着“任何事物”，因此使用无界通配符好像等价于使用原生类型。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//: generics/UnboundedWildcards1.java
</span><span class="c1"></span><span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UnboundedWildcards1</span> <span class="o">{</span>
  <span class="kd">static</span> <span class="n">List</span> <span class="n">list1</span><span class="o">;</span>
  <span class="kd">static</span> <span class="n">List</span><span class="o">&lt;?&gt;</span> <span class="n">list2</span><span class="o">;</span>
  <span class="kd">static</span> <span class="n">List</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">list3</span><span class="o">;</span>
  <span class="kd">static</span> <span class="kt">void</span> <span class="nf">assign1</span><span class="o">(</span><span class="n">List</span> <span class="n">list</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">list1</span> <span class="o">=</span> <span class="n">list</span><span class="o">;</span>
    <span class="n">list2</span> <span class="o">=</span> <span class="n">list</span><span class="o">;</span>
    <span class="c1">// list3 = list; // Warning: unchecked conversion
</span><span class="c1"></span>    <span class="c1">// Found: List, Required: List&lt;? extends Object&gt;
</span><span class="c1"></span>  <span class="o">}</span>
  <span class="kd">static</span> <span class="kt">void</span> <span class="nf">assign2</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;?&gt;</span> <span class="n">list</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">list1</span> <span class="o">=</span> <span class="n">list</span><span class="o">;</span>
    <span class="n">list2</span> <span class="o">=</span> <span class="n">list</span><span class="o">;</span>
    <span class="n">list3</span> <span class="o">=</span> <span class="n">list</span><span class="o">;</span>
  <span class="o">}</span>    
  <span class="kd">static</span> <span class="kt">void</span> <span class="nf">assign3</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">list1</span> <span class="o">=</span> <span class="n">list</span><span class="o">;</span>
    <span class="n">list2</span> <span class="o">=</span> <span class="n">list</span><span class="o">;</span>
    <span class="n">list3</span> <span class="o">=</span> <span class="n">list</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">assign1</span><span class="o">(</span><span class="k">new</span> <span class="n">ArrayList</span><span class="o">());</span>
    <span class="n">assign2</span><span class="o">(</span><span class="k">new</span> <span class="n">ArrayList</span><span class="o">());</span>
    <span class="c1">// assign3(new ArrayList()); // Warning:
</span><span class="c1"></span>    <span class="c1">// Unchecked conversion. Found: ArrayList
</span><span class="c1"></span>    <span class="c1">// Required: List&lt;? extends Object&gt;
</span><span class="c1"></span>    <span class="n">assign1</span><span class="o">(</span><span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;());</span>
    <span class="n">assign2</span><span class="o">(</span><span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;());</span>
    <span class="n">assign3</span><span class="o">(</span><span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;());</span>
    <span class="c1">// Both forms are acceptable as List&lt;?&gt;:
</span><span class="c1"></span>    <span class="n">List</span><span class="o">&lt;?&gt;</span> <span class="n">wildList</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">();</span>
    <span class="n">wildList</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;();</span>
    <span class="n">assign1</span><span class="o">(</span><span class="n">wildList</span><span class="o">);</span>
    <span class="n">assign2</span><span class="o">(</span><span class="n">wildList</span><span class="o">);</span>
    <span class="n">assign3</span><span class="o">(</span><span class="n">wildList</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~
</span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//: generics/UnboundedWildcards2.java
</span><span class="c1"></span><span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UnboundedWildcards2</span> <span class="o">{</span>
  <span class="kd">static</span> <span class="n">Map</span> <span class="n">map1</span><span class="o">;</span>
  <span class="kd">static</span> <span class="n">Map</span><span class="o">&lt;?,?&gt;</span> <span class="n">map2</span><span class="o">;</span>
  <span class="kd">static</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,?&gt;</span> <span class="n">map3</span><span class="o">;</span>
  <span class="kd">static</span> <span class="kt">void</span> <span class="nf">assign1</span><span class="o">(</span><span class="n">Map</span> <span class="n">map</span><span class="o">)</span> <span class="o">{</span> <span class="n">map1</span> <span class="o">=</span> <span class="n">map</span><span class="o">;</span> <span class="o">}</span>
  <span class="kd">static</span> <span class="kt">void</span> <span class="nf">assign2</span><span class="o">(</span><span class="n">Map</span><span class="o">&lt;?,?&gt;</span> <span class="n">map</span><span class="o">)</span> <span class="o">{</span> <span class="n">map2</span> <span class="o">=</span> <span class="n">map</span><span class="o">;</span> <span class="o">}</span>
  <span class="kd">static</span> <span class="kt">void</span> <span class="nf">assign3</span><span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,?&gt;</span> <span class="n">map</span><span class="o">)</span> <span class="o">{</span> <span class="n">map3</span> <span class="o">=</span> <span class="n">map</span><span class="o">;</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">assign1</span><span class="o">(</span><span class="k">new</span> <span class="n">HashMap</span><span class="o">());</span>
    <span class="n">assign2</span><span class="o">(</span><span class="k">new</span> <span class="n">HashMap</span><span class="o">());</span>
    <span class="c1">// assign3(new HashMap()); // Warning:
</span><span class="c1"></span>    <span class="c1">// Unchecked conversion. Found: HashMap
</span><span class="c1"></span>    <span class="c1">// Required: Map&lt;String,?&gt;
</span><span class="c1"></span>    <span class="n">assign1</span><span class="o">(</span><span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;());</span>
    <span class="n">assign2</span><span class="o">(</span><span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;());</span>
    <span class="n">assign3</span><span class="o">(</span><span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;());</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~
</span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//: generics/Wildcards.java
</span><span class="c1">// Exploring the meaning of wildcards.
</span><span class="c1"></span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Wildcards</span> <span class="o">{</span>
   <span class="c1">// Raw argument:
</span><span class="c1"></span>  <span class="kd">static</span> <span class="kt">void</span> <span class="nf">rawArgs</span><span class="o">(</span><span class="n">Holder</span> <span class="n">holder</span><span class="o">,</span> <span class="n">Object</span> <span class="n">arg</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// holder.set(arg); // Warning:
</span><span class="c1"></span>    <span class="c1">//   Unchecked call to set(T) as a
</span><span class="c1"></span>    <span class="c1">//   member of the raw type Holder
</span><span class="c1"></span>    <span class="c1">// holder.set(new Wildcards()); // Same warning
</span><span class="c1"></span>
    <span class="c1">// Can&#39;t do this; don&#39;t have any &#39;T&#39;:
</span><span class="c1"></span>    <span class="c1">// T t = holder.get();
</span><span class="c1"></span>
    <span class="c1">// OK, but type information has been lost:
</span><span class="c1"></span>    <span class="n">Object</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">holder</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
  <span class="o">}</span>    
  <span class="c1">// Similar to rawArgs(), but errors instead of warnings:
</span><span class="c1"></span>  <span class="kd">static</span> <span class="kt">void</span> <span class="nf">unboundedArg</span><span class="o">(</span><span class="n">Holder</span><span class="o">&lt;?&gt;</span> <span class="n">holder</span><span class="o">,</span> <span class="n">Object</span> <span class="n">arg</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// holder.set(arg); // Error:
</span><span class="c1"></span>    <span class="c1">//   set(capture of ?) in Holder&lt;capture of ?&gt;
</span><span class="c1"></span>    <span class="c1">//   cannot be applied to (Object)
</span><span class="c1"></span>    <span class="c1">// holder.set(new Wildcards()); // Same error
</span><span class="c1"></span>
    <span class="c1">// Can&#39;t do this; don&#39;t have any &#39;T&#39;:
</span><span class="c1"></span>    <span class="c1">// T t = holder.get();
</span><span class="c1"></span>
    <span class="c1">// OK, but type information has been lost:
</span><span class="c1"></span>    <span class="n">Object</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">holder</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
  <span class="o">}</span>    
  <span class="kd">static</span> <span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">T</span> <span class="nf">exact1</span><span class="o">(</span><span class="n">Holder</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">holder</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">T</span> <span class="n">t</span> <span class="o">=</span> <span class="n">holder</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
    <span class="k">return</span> <span class="n">t</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">static</span> <span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">T</span> <span class="nf">exact2</span><span class="o">(</span><span class="n">Holder</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">holder</span><span class="o">,</span> <span class="n">T</span> <span class="n">arg</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">holder</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">arg</span><span class="o">);</span>
    <span class="n">T</span> <span class="n">t</span> <span class="o">=</span> <span class="n">holder</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
    <span class="k">return</span> <span class="n">t</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">static</span> <span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">T</span> <span class="nf">wildSubtype</span><span class="o">(</span><span class="n">Holder</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="n">T</span><span class="o">&gt;</span> <span class="n">holder</span><span class="o">,</span> <span class="n">T</span> <span class="n">arg</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// holder.set(arg); // Error:
</span><span class="c1"></span>    <span class="c1">//   set(capture of ? extends T) in
</span><span class="c1"></span>    <span class="c1">//   Holder&lt;capture of ? extends T&gt;
</span><span class="c1"></span>    <span class="c1">//   cannot be applied to (T)
</span><span class="c1"></span>    <span class="n">T</span> <span class="n">t</span> <span class="o">=</span> <span class="n">holder</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
    <span class="k">return</span> <span class="n">t</span><span class="o">;</span>
  <span class="o">}</span>    
  <span class="kd">static</span> <span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="kt">void</span> <span class="nf">wildSupertype</span><span class="o">(</span><span class="n">Holder</span><span class="o">&lt;?</span> <span class="kd">super</span> <span class="n">T</span><span class="o">&gt;</span> <span class="n">holder</span><span class="o">,</span> <span class="n">T</span> <span class="n">arg</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">holder</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">arg</span><span class="o">);</span>
    <span class="c1">// T t = holder.get();  // Error:
</span><span class="c1"></span>    <span class="c1">//   Incompatible types: found Object, required T
</span><span class="c1"></span>
    <span class="c1">// OK, but type information has been lost:
</span><span class="c1"></span>    <span class="n">Object</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">holder</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Holder</span> <span class="n">raw</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Holder</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;();</span>
    <span class="c1">// Or:
</span><span class="c1"></span>    <span class="n">raw</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Holder</span><span class="o">();</span>
    <span class="n">Holder</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;</span> <span class="n">qualified</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Holder</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;();</span>
    <span class="n">Holder</span><span class="o">&lt;?&gt;</span> <span class="n">unbounded</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Holder</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;();</span>
    <span class="n">Holder</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="n">Long</span><span class="o">&gt;</span> <span class="n">bounded</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Holder</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;();</span>
    <span class="n">Long</span> <span class="n">lng</span> <span class="o">=</span> <span class="n">1L</span><span class="o">;</span>

    <span class="n">rawArgs</span><span class="o">(</span><span class="n">raw</span><span class="o">,</span> <span class="n">lng</span><span class="o">);</span>
    <span class="n">rawArgs</span><span class="o">(</span><span class="n">qualified</span><span class="o">,</span> <span class="n">lng</span><span class="o">);</span>
    <span class="n">rawArgs</span><span class="o">(</span><span class="n">unbounded</span><span class="o">,</span> <span class="n">lng</span><span class="o">);</span>
    <span class="n">rawArgs</span><span class="o">(</span><span class="n">bounded</span><span class="o">,</span> <span class="n">lng</span><span class="o">);</span>

    <span class="n">unboundedArg</span><span class="o">(</span><span class="n">raw</span><span class="o">,</span> <span class="n">lng</span><span class="o">);</span>
    <span class="n">unboundedArg</span><span class="o">(</span><span class="n">qualified</span><span class="o">,</span> <span class="n">lng</span><span class="o">);</span>
    <span class="n">unboundedArg</span><span class="o">(</span><span class="n">unbounded</span><span class="o">,</span> <span class="n">lng</span><span class="o">);</span>
    <span class="n">unboundedArg</span><span class="o">(</span><span class="n">bounded</span><span class="o">,</span> <span class="n">lng</span><span class="o">);</span>

    <span class="c1">// Object r1 = exact1(raw); // Warnings:
</span><span class="c1"></span>    <span class="c1">//   Unchecked conversion from Holder to Holder&lt;T&gt;
</span><span class="c1"></span>    <span class="c1">//   Unchecked method invocation: exact1(Holder&lt;T&gt;)
</span><span class="c1"></span>    <span class="c1">//   is applied to (Holder)
</span><span class="c1"></span>    <span class="n">Long</span> <span class="n">r2</span> <span class="o">=</span> <span class="n">exact1</span><span class="o">(</span><span class="n">qualified</span><span class="o">);</span>
    <span class="n">Object</span> <span class="n">r3</span> <span class="o">=</span> <span class="n">exact1</span><span class="o">(</span><span class="n">unbounded</span><span class="o">);</span> <span class="c1">// Must return Object
</span><span class="c1"></span>    <span class="n">Long</span> <span class="n">r4</span> <span class="o">=</span> <span class="n">exact1</span><span class="o">(</span><span class="n">bounded</span><span class="o">);</span>

    <span class="c1">// Long r5 = exact2(raw, lng); // Warnings:
</span><span class="c1"></span>    <span class="c1">//   Unchecked conversion from Holder to Holder&lt;Long&gt;
</span><span class="c1"></span>    <span class="c1">//   Unchecked method invocation: exact2(Holder&lt;T&gt;,T)
</span><span class="c1"></span>    <span class="c1">//   is applied to (Holder,Long)
</span><span class="c1"></span>    <span class="n">Long</span> <span class="n">r6</span> <span class="o">=</span> <span class="n">exact2</span><span class="o">(</span><span class="n">qualified</span><span class="o">,</span> <span class="n">lng</span><span class="o">);</span>
    <span class="c1">// Long r7 = exact2(unbounded, lng); // Error:
</span><span class="c1"></span>    <span class="c1">//   exact2(Holder&lt;T&gt;,T) cannot be applied to
</span><span class="c1"></span>    <span class="c1">//   (Holder&lt;capture of ?&gt;,Long)
</span><span class="c1"></span>    <span class="c1">// Long r8 = exact2(bounded, lng); // Error:
</span><span class="c1"></span>    <span class="c1">//   exact2(Holder&lt;T&gt;,T) cannot be applied
</span><span class="c1"></span>    <span class="c1">//   to (Holder&lt;capture of ? extends Long&gt;,Long)
</span><span class="c1"></span>
    <span class="c1">// Long r9 = wildSubtype(raw, lng); // Warnings:
</span><span class="c1"></span>    <span class="c1">//   Unchecked conversion from Holder
</span><span class="c1"></span>    <span class="c1">//   to Holder&lt;? extends Long&gt;
</span><span class="c1"></span>    <span class="c1">//   Unchecked method invocation:
</span><span class="c1"></span>    <span class="c1">//   wildSubtype(Holder&lt;? extends T&gt;,T) is
</span><span class="c1"></span>    <span class="c1">//   applied to (Holder,Long)
</span><span class="c1"></span>    <span class="n">Long</span> <span class="n">r10</span> <span class="o">=</span> <span class="n">wildSubtype</span><span class="o">(</span><span class="n">qualified</span><span class="o">,</span> <span class="n">lng</span><span class="o">);</span>
    <span class="c1">// OK, but can only return Object:
</span><span class="c1"></span>    <span class="n">Object</span> <span class="n">r11</span> <span class="o">=</span> <span class="n">wildSubtype</span><span class="o">(</span><span class="n">unbounded</span><span class="o">,</span> <span class="n">lng</span><span class="o">);</span>
    <span class="n">Long</span> <span class="n">r12</span> <span class="o">=</span> <span class="n">wildSubtype</span><span class="o">(</span><span class="n">bounded</span><span class="o">,</span> <span class="n">lng</span><span class="o">);</span>

    <span class="c1">// wildSupertype(raw, lng); // Warnings:
</span><span class="c1"></span>    <span class="c1">//   Unchecked conversion from Holder
</span><span class="c1"></span>    <span class="c1">//   to Holder&lt;? super Long&gt;
</span><span class="c1"></span>    <span class="c1">//   Unchecked method invocation:
</span><span class="c1"></span>    <span class="c1">//   wildSupertype(Holder&lt;? super T&gt;,T)
</span><span class="c1"></span>    <span class="c1">//   is applied to (Holder,Long)
</span><span class="c1"></span>    <span class="n">wildSupertype</span><span class="o">(</span><span class="n">qualified</span><span class="o">,</span> <span class="n">lng</span><span class="o">);</span>
    <span class="c1">// wildSupertype(unbounded, lng); // Error:
</span><span class="c1"></span>    <span class="c1">//   wildSupertype(Holder&lt;? super T&gt;,T) cannot be
</span><span class="c1"></span>    <span class="c1">//   applied to (Holder&lt;capture of ?&gt;,Long)
</span><span class="c1"></span>    <span class="c1">// wildSupertype(bounded, lng); // Error:
</span><span class="c1"></span>    <span class="c1">//   wildSupertype(Holder&lt;? super T&gt;,T) cannot be
</span><span class="c1"></span>    <span class="c1">//  applied to (Holder&lt;capture of ? extends Long&gt;,Long)
</span><span class="c1"></span>  <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~
</span></code></pre></td></tr></table>
</div>
</div><p>在<code>rawArgs()</code>中，编译器知道Holder是一个泛型雷兴国，因此即使它在这里被表示成功一个原生类型，编译器仍旧知道向<code>set()</code>传递一个Object是不安全的。由于它是原生类型，你可以将任何类型的对象传递给<code>set()</code>，而这个对象将被向上转型为Object。因此，无论何时，只要使用了原生类型，都会放弃编译期检查。对get()的调用说明了相同的问题：没有任何T类型的对象，因此结果只能是一个Object。</p>
<p>人们很自然地会开始考虑原生Holder与Holder&lt;?&gt;是大致相同的事物。但是unboundedArg()强调tamen</p>
<h3 id="15104-捕获转换">15.10.4 捕获转换</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//: generics/CaptureConversion.java
</span><span class="c1"></span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CaptureConversion</span> <span class="o">{</span>
  <span class="kd">static</span> <span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="kt">void</span> <span class="nf">f1</span><span class="o">(</span><span class="n">Holder</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">holder</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">T</span> <span class="n">t</span> <span class="o">=</span> <span class="n">holder</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">t</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getSimpleName</span><span class="o">());</span>
  <span class="o">}</span>
  <span class="kd">static</span> <span class="kt">void</span> <span class="nf">f2</span><span class="o">(</span><span class="n">Holder</span><span class="o">&lt;?&gt;</span> <span class="n">holder</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">f1</span><span class="o">(</span><span class="n">holder</span><span class="o">);</span> <span class="c1">// Call with captured type
</span><span class="c1"></span>  <span class="o">}</span>    
  <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">&#34;unchecked&#34;</span><span class="o">)</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Holder</span> <span class="n">raw</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Holder</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;(</span><span class="n">1</span><span class="o">);</span>
    <span class="c1">// f1(raw); // Produces warnings
</span><span class="c1"></span>    <span class="n">f2</span><span class="o">(</span><span class="n">raw</span><span class="o">);</span> <span class="c1">// No warnings
</span><span class="c1"></span>    <span class="n">Holder</span> <span class="n">rawBasic</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Holder</span><span class="o">();</span>
    <span class="n">rawBasic</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="k">new</span> <span class="n">Object</span><span class="o">());</span> <span class="c1">// Warning
</span><span class="c1"></span>    <span class="n">f2</span><span class="o">(</span><span class="n">rawBasic</span><span class="o">);</span> <span class="c1">// No warnings
</span><span class="c1"></span>    <span class="c1">// Upcast to Holder&lt;?&gt;, still figures it out:
</span><span class="c1"></span>    <span class="n">Holder</span><span class="o">&lt;?&gt;</span> <span class="n">wildcarded</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Holder</span><span class="o">&lt;</span><span class="n">Double</span><span class="o">&gt;(</span><span class="n">1</span><span class="o">.</span><span class="na">0</span><span class="o">);</span>
    <span class="n">f2</span><span class="o">(</span><span class="n">wildcarded</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output:
</span><span class="cm">Integer
</span><span class="cm">Object
</span><span class="cm">Double
</span><span class="cm">*/</span><span class="c1">//:~
</span></code></pre></td></tr></table>
</div>
</div><h2 id="1511-问题">15.11 问题</h2>
<h3 id="15111任何基本类型都不能作为类型参数">15.11.1.任何基本类型都不能作为类型参数</h3>
<h3 id="15112实现参数化接口">15.11.2.实现参数化接口</h3>
<h3 id="15113-转型和警告">15.11.3 转型和警告</h3>
<h3 id="15114-重载">15.11.4 重载</h3>
<h3 id="15115-基类劫持了接口">15.11.5 基类劫持了接口</h3>
<h2 id="1512-自限定的类型">15.12 自限定的类型</h2>
<h3 id="15121-古怪的循环泛型">15.12.1 古怪的循环泛型</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//: generics/CuriouslyRecurringGeneric.java
</span><span class="c1"></span>
<span class="kd">class</span> <span class="nc">GenericType</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">{}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CuriouslyRecurringGeneric</span>
  <span class="kd">extends</span> <span class="n">GenericType</span><span class="o">&lt;</span><span class="n">CuriouslyRecurringGeneric</span><span class="o">&gt;</span> <span class="o">{}</span> <span class="c1">///:~
</span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//: generics/BasicHolder.java
</span><span class="c1"></span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">BasicHolder</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="n">T</span> <span class="n">element</span><span class="o">;</span>
  <span class="kt">void</span> <span class="nf">set</span><span class="o">(</span><span class="n">T</span> <span class="n">arg</span><span class="o">)</span> <span class="o">{</span> <span class="n">element</span> <span class="o">=</span> <span class="n">arg</span><span class="o">;</span> <span class="o">}</span>
  <span class="n">T</span> <span class="nf">get</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">element</span><span class="o">;</span> <span class="o">}</span>
  <span class="kt">void</span> <span class="nf">f</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">element</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getSimpleName</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~
</span></code></pre></td></tr></table>
</div>
</div><p>我们可以在一个古怪的循环泛型中使用<code>BasicHolder</code>。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//: generics/CRGWithBasicHolder.java
</span><span class="c1"></span>
<span class="kd">class</span> <span class="nc">Subtype</span> <span class="kd">extends</span> <span class="n">BasicHolder</span><span class="o">&lt;</span><span class="n">Subtype</span><span class="o">&gt;</span> <span class="o">{}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CRGWithBasicHolder</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Subtype</span> <span class="n">st1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Subtype</span><span class="o">(),</span> <span class="n">st2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Subtype</span><span class="o">();</span>
    <span class="n">st1</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">st2</span><span class="o">);</span>
    <span class="n">Subtype</span> <span class="n">st3</span> <span class="o">=</span> <span class="n">st1</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
    <span class="n">st1</span><span class="o">.</span><span class="na">f</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output:
</span><span class="cm">Subtype
</span><span class="cm">*/</span><span class="c1">//:~
</span></code></pre></td></tr></table>
</div>
</div><p>新类<code>Subtype</code>接受的参数和返回的值具有<code>Subtype</code>类型而不仅仅是基类<code>BasicHolder</code>类型。这就是<code>CRG</code>的本质：基类用到处类替代其参数。这意味着泛型基类变成了一种其所有到处类的公共功能的模版，但是这些功能对于其所有参数和返回值，将使用导出类型。也就是说，在所产生的类中将使用确切类型而不是基类型。因此，在<code>Subtype</code>中，传递给<code>set()</code>的参数和<code>get()</code>返回的类型都是确切的<code>Subtype</code>。</p>
<h3 id="15122-自限定">15.12.2 自限定</h3>
<p><code>BasicHolder</code>可以使用任何类型作为其泛型参数，就像下面看到的那样：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//: generics/Unconstrained.java
</span><span class="c1"></span>
<span class="kd">class</span> <span class="nc">Other</span> <span class="o">{}</span>
<span class="kd">class</span> <span class="nc">BasicOther</span> <span class="kd">extends</span> <span class="n">BasicHolder</span><span class="o">&lt;</span><span class="n">Other</span><span class="o">&gt;</span> <span class="o">{}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Unconstrained</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">BasicOther</span> <span class="n">b</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BasicOther</span><span class="o">(),</span> <span class="n">b2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BasicOther</span><span class="o">();</span>
    <span class="n">b</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="k">new</span> <span class="n">Other</span><span class="o">());</span>
    <span class="n">Other</span> <span class="n">other</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
    <span class="n">b</span><span class="o">.</span><span class="na">f</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output:
</span><span class="cm">Other
</span><span class="cm">*/</span><span class="c1">//:~
</span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//: generics/SelfBounding.java
</span><span class="c1"></span>
<span class="kd">class</span> <span class="nc">SelfBounded</span><span class="o">&lt;</span><span class="n">T</span> <span class="kd">extends</span> <span class="n">SelfBounded</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span> <span class="o">{</span>
  <span class="n">T</span> <span class="n">element</span><span class="o">;</span>
  <span class="n">SelfBounded</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="nf">set</span><span class="o">(</span><span class="n">T</span> <span class="n">arg</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">element</span> <span class="o">=</span> <span class="n">arg</span><span class="o">;</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="n">T</span> <span class="nf">get</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">element</span><span class="o">;</span> <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">A</span> <span class="kd">extends</span> <span class="n">SelfBounded</span><span class="o">&lt;</span><span class="n">A</span><span class="o">&gt;</span> <span class="o">{}</span>
<span class="kd">class</span> <span class="nc">B</span> <span class="kd">extends</span> <span class="n">SelfBounded</span><span class="o">&lt;</span><span class="n">A</span><span class="o">&gt;</span> <span class="o">{}</span> <span class="c1">// Also OK
</span><span class="c1"></span>
<span class="kd">class</span> <span class="nc">C</span> <span class="kd">extends</span> <span class="n">SelfBounded</span><span class="o">&lt;</span><span class="n">C</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="n">C</span> <span class="nf">setAndGet</span><span class="o">(</span><span class="n">C</span> <span class="n">arg</span><span class="o">)</span> <span class="o">{</span> <span class="n">set</span><span class="o">(</span><span class="n">arg</span><span class="o">);</span> <span class="k">return</span> <span class="n">get</span><span class="o">();</span> <span class="o">}</span>
<span class="o">}</span>    

<span class="kd">class</span> <span class="nc">D</span> <span class="o">{}</span>
<span class="c1">// Can&#39;t do this:
</span><span class="c1">// class E extends SelfBounded&lt;D&gt; {}
</span><span class="c1">// Compile error: Type parameter D is not within its bound
</span><span class="c1"></span>
<span class="c1">// Alas, you can do this, so you can&#39;t force the idiom:
</span><span class="c1"></span><span class="kd">class</span> <span class="nc">F</span> <span class="kd">extends</span> <span class="n">SelfBounded</span> <span class="o">{}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SelfBounding</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">A</span> <span class="n">a</span> <span class="o">=</span> <span class="k">new</span> <span class="n">A</span><span class="o">();</span>
    <span class="n">a</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="k">new</span> <span class="n">A</span><span class="o">());</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="k">new</span> <span class="n">A</span><span class="o">()).</span><span class="na">get</span><span class="o">();</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
    <span class="n">C</span> <span class="n">c</span> <span class="o">=</span> <span class="k">new</span> <span class="n">C</span><span class="o">();</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="na">setAndGet</span><span class="o">(</span><span class="k">new</span> <span class="n">C</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~
</span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//: generics/NotSelfBounded.java
</span><span class="c1"></span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">NotSelfBounded</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="n">T</span> <span class="n">element</span><span class="o">;</span>
  <span class="n">NotSelfBounded</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="nf">set</span><span class="o">(</span><span class="n">T</span> <span class="n">arg</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">element</span> <span class="o">=</span> <span class="n">arg</span><span class="o">;</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="n">T</span> <span class="nf">get</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">element</span><span class="o">;</span> <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">A2</span> <span class="kd">extends</span> <span class="n">NotSelfBounded</span><span class="o">&lt;</span><span class="n">A2</span><span class="o">&gt;</span> <span class="o">{}</span>
<span class="kd">class</span> <span class="nc">B2</span> <span class="kd">extends</span> <span class="n">NotSelfBounded</span><span class="o">&lt;</span><span class="n">A2</span><span class="o">&gt;</span> <span class="o">{}</span>

<span class="kd">class</span> <span class="nc">C2</span> <span class="kd">extends</span> <span class="n">NotSelfBounded</span><span class="o">&lt;</span><span class="n">C2</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="n">C2</span> <span class="nf">setAndGet</span><span class="o">(</span><span class="n">C2</span> <span class="n">arg</span><span class="o">)</span> <span class="o">{</span> <span class="n">set</span><span class="o">(</span><span class="n">arg</span><span class="o">);</span> <span class="k">return</span> <span class="n">get</span><span class="o">();</span> <span class="o">}</span>
<span class="o">}</span>    

<span class="kd">class</span> <span class="nc">D2</span> <span class="o">{}</span>
<span class="c1">// Now this is OK:
</span><span class="c1"></span><span class="kd">class</span> <span class="nc">E2</span> <span class="kd">extends</span> <span class="n">NotSelfBounded</span><span class="o">&lt;</span><span class="n">D2</span><span class="o">&gt;</span> <span class="o">{}</span> <span class="c1">///:~
</span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//: generics/SelfBoundingMethods.java
</span><span class="c1"></span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SelfBoundingMethods</span> <span class="o">{</span>
  <span class="kd">static</span> <span class="o">&lt;</span><span class="n">T</span> <span class="kd">extends</span> <span class="n">SelfBounded</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span> <span class="n">T</span> <span class="nf">f</span><span class="o">(</span><span class="n">T</span> <span class="n">arg</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">arg</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">arg</span><span class="o">).</span><span class="na">get</span><span class="o">();</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">A</span> <span class="n">a</span> <span class="o">=</span> <span class="n">f</span><span class="o">(</span><span class="k">new</span> <span class="n">A</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~
</span></code></pre></td></tr></table>
</div>
</div><h3 id="15123-参数协变">15.12.3 参数协变</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//: generics/CovariantReturnTypes.java
</span><span class="c1"></span>
<span class="kd">class</span> <span class="nc">Base</span> <span class="o">{}</span>
<span class="kd">class</span> <span class="nc">Derived</span> <span class="kd">extends</span> <span class="n">Base</span> <span class="o">{}</span>

<span class="kd">interface</span> <span class="nc">OrdinaryGetter</span> <span class="o">{</span>
  <span class="n">Base</span> <span class="nf">get</span><span class="o">();</span>
<span class="o">}</span>

<span class="kd">interface</span> <span class="nc">DerivedGetter</span> <span class="kd">extends</span> <span class="n">OrdinaryGetter</span> <span class="o">{</span>
  <span class="c1">// Return type of overridden method is allowed to vary:
</span><span class="c1"></span>  <span class="n">Derived</span> <span class="nf">get</span><span class="o">();</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CovariantReturnTypes</span> <span class="o">{</span>
  <span class="kt">void</span> <span class="nf">test</span><span class="o">(</span><span class="n">DerivedGetter</span> <span class="n">d</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Derived</span> <span class="n">d2</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~
</span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//: generics/GenericsAndReturnTypes.java
</span><span class="c1"></span>
<span class="kd">interface</span> <span class="nc">GenericGetter</span><span class="o">&lt;</span><span class="n">T</span> <span class="kd">extends</span> <span class="n">GenericGetter</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span> <span class="o">{</span>
  <span class="n">T</span> <span class="nf">get</span><span class="o">();</span>
<span class="o">}</span>

<span class="kd">interface</span> <span class="nc">Getter</span> <span class="kd">extends</span> <span class="n">GenericGetter</span><span class="o">&lt;</span><span class="n">Getter</span><span class="o">&gt;</span> <span class="o">{}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">GenericsAndReturnTypes</span> <span class="o">{</span>
  <span class="kt">void</span> <span class="nf">test</span><span class="o">(</span><span class="n">Getter</span> <span class="n">g</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Getter</span> <span class="n">result</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
    <span class="n">GenericGetter</span> <span class="n">gg</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="na">get</span><span class="o">();</span> <span class="c1">// Also the base type
</span><span class="c1"></span>  <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~
</span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//: generics/OrdinaryArguments.java
</span><span class="c1"></span>
<span class="kd">class</span> <span class="nc">OrdinarySetter</span> <span class="o">{</span>
  <span class="kt">void</span> <span class="nf">set</span><span class="o">(</span><span class="n">Base</span> <span class="n">base</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;OrdinarySetter.set(Base)&#34;</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">DerivedSetter</span> <span class="kd">extends</span> <span class="n">OrdinarySetter</span> <span class="o">{</span>
  <span class="kt">void</span> <span class="nf">set</span><span class="o">(</span><span class="n">Derived</span> <span class="n">derived</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;DerivedSetter.set(Derived)&#34;</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>    

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">OrdinaryArguments</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Base</span> <span class="n">base</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Base</span><span class="o">();</span>
    <span class="n">Derived</span> <span class="n">derived</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Derived</span><span class="o">();</span>
    <span class="n">DerivedSetter</span> <span class="n">ds</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DerivedSetter</span><span class="o">();</span>
    <span class="n">ds</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">derived</span><span class="o">);</span>
    <span class="n">ds</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">base</span><span class="o">);</span> <span class="c1">// Compiles: overloaded, not overridden!
</span><span class="c1"></span>  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output:
</span><span class="cm">DerivedSetter.set(Derived)
</span><span class="cm">OrdinarySetter.set(Base)
</span><span class="cm">*/</span><span class="c1">//:~
</span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//: generics/SelfBoundingAndCovariantArguments.java
</span><span class="c1"></span>
<span class="kd">interface</span> <span class="nc">SelfBoundSetter</span><span class="o">&lt;</span><span class="n">T</span> <span class="kd">extends</span> <span class="n">SelfBoundSetter</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span> <span class="o">{</span>
  <span class="kt">void</span> <span class="nf">set</span><span class="o">(</span><span class="n">T</span> <span class="n">arg</span><span class="o">);</span>
<span class="o">}</span>

<span class="kd">interface</span> <span class="nc">Setter</span> <span class="kd">extends</span> <span class="n">SelfBoundSetter</span><span class="o">&lt;</span><span class="n">Setter</span><span class="o">&gt;</span> <span class="o">{}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SelfBoundingAndCovariantArguments</span> <span class="o">{</span>
  <span class="kt">void</span> <span class="nf">testA</span><span class="o">(</span><span class="n">Setter</span> <span class="n">s1</span><span class="o">,</span> <span class="n">Setter</span> <span class="n">s2</span><span class="o">,</span> <span class="n">SelfBoundSetter</span> <span class="n">sbs</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">s1</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">s2</span><span class="o">);</span>
    <span class="c1">// s1.set(sbs); // Error:
</span><span class="c1"></span>    <span class="c1">// set(Setter) in SelfBoundSetter&lt;Setter&gt;
</span><span class="c1"></span>    <span class="c1">// cannot be applied to (SelfBoundSetter)
</span><span class="c1"></span>  <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~
</span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//: generics/PlainGenericInheritance.java
</span><span class="c1"></span>
<span class="kd">class</span> <span class="nc">GenericSetter</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">{</span> <span class="c1">// Not self-bounded
</span><span class="c1"></span>  <span class="kt">void</span> <span class="nf">set</span><span class="o">(</span><span class="n">T</span> <span class="n">arg</span><span class="o">){</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;GenericSetter.set(Base)&#34;</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">DerivedGS</span> <span class="kd">extends</span> <span class="n">GenericSetter</span><span class="o">&lt;</span><span class="n">Base</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kt">void</span> <span class="nf">set</span><span class="o">(</span><span class="n">Derived</span> <span class="n">derived</span><span class="o">){</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;DerivedGS.set(Derived)&#34;</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>    

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PlainGenericInheritance</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Base</span> <span class="n">base</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Base</span><span class="o">();</span>
    <span class="n">Derived</span> <span class="n">derived</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Derived</span><span class="o">();</span>
    <span class="n">DerivedGS</span> <span class="n">dgs</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DerivedGS</span><span class="o">();</span>
    <span class="n">dgs</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">derived</span><span class="o">);</span>
    <span class="n">dgs</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">base</span><span class="o">);</span> <span class="c1">// Compiles: overloaded, not overridden!
</span><span class="c1"></span>  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output:
</span><span class="cm">DerivedGS.set(Derived)
</span><span class="cm">GenericSetter.set(Base)
</span><span class="cm">*/</span><span class="c1">//:~
</span></code></pre></td></tr></table>
</div>
</div><h2 id="1513-动态类型安全">15.13 动态类型安全</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//: generics/CheckedList.java
</span><span class="c1">// Using Collection.checkedList().
</span><span class="c1"></span><span class="kn">import</span> <span class="nn">typeinfo.pets.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CheckedList</span> <span class="o">{</span>
  <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">&#34;unchecked&#34;</span><span class="o">)</span>
  <span class="kd">static</span> <span class="kt">void</span> <span class="nf">oldStyleMethod</span><span class="o">(</span><span class="n">List</span> <span class="n">probablyDogs</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">probablyDogs</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Cat</span><span class="o">());</span>
  <span class="o">}</span>    
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">Dog</span><span class="o">&gt;</span> <span class="n">dogs1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Dog</span><span class="o">&gt;();</span>
    <span class="n">oldStyleMethod</span><span class="o">(</span><span class="n">dogs1</span><span class="o">);</span> <span class="c1">// Quietly accepts a Cat
</span><span class="c1"></span>    <span class="n">List</span><span class="o">&lt;</span><span class="n">Dog</span><span class="o">&gt;</span> <span class="n">dogs2</span> <span class="o">=</span> <span class="n">Collections</span><span class="o">.</span><span class="na">checkedList</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Dog</span><span class="o">&gt;(),</span> <span class="n">Dog</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">oldStyleMethod</span><span class="o">(</span><span class="n">dogs2</span><span class="o">);</span> <span class="c1">// Throws an exception
</span><span class="c1"></span>    <span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="c1">// Derived types work fine:
</span><span class="c1"></span>    <span class="n">List</span><span class="o">&lt;</span><span class="n">Pet</span><span class="o">&gt;</span> <span class="n">pets</span> <span class="o">=</span> <span class="n">Collections</span><span class="o">.</span><span class="na">checkedList</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Pet</span><span class="o">&gt;(),</span> <span class="n">Pet</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="n">pets</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Dog</span><span class="o">());</span>
    <span class="n">pets</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Cat</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output:
</span><span class="cm">java.lang.ClassCastException: Attempt to insert class typeinfo.pets.Cat element into collection with element type class typeinfo.pets.Dog
</span><span class="cm">*/</span><span class="c1">//:~
</span></code></pre></td></tr></table>
</div>
</div><h2 id="1514异常">15.14异常</h2>
<h2 id="1515-混型">15.15 混型</h2>
<h3 id="15151-c中的混型">15.15.1 C++中的混型</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="c1">//: generics/Mixins.cpp
</span><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;ctime&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span><span class="cp"></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">T</span><span class="o">&gt;</span> <span class="k">class</span> <span class="nc">TimeStamped</span> <span class="o">:</span> <span class="k">public</span> <span class="n">T</span> <span class="p">{</span>
  <span class="kt">long</span> <span class="n">timeStamp</span><span class="p">;</span>
<span class="k">public</span><span class="o">:</span>
  <span class="n">TimeStamped</span><span class="p">()</span> <span class="p">{</span> <span class="n">timeStamp</span> <span class="o">=</span> <span class="n">time</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span> <span class="p">}</span>
  <span class="kt">long</span> <span class="nf">getStamp</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="n">timeStamp</span><span class="p">;</span> <span class="p">}</span>
<span class="p">};</span>

<span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">T</span><span class="o">&gt;</span> <span class="k">class</span> <span class="nc">SerialNumbered</span> <span class="o">:</span> <span class="k">public</span> <span class="n">T</span> <span class="p">{</span>
  <span class="kt">long</span> <span class="n">serialNumber</span><span class="p">;</span>
  <span class="k">static</span> <span class="kt">long</span> <span class="n">counter</span><span class="p">;</span>
<span class="k">public</span><span class="o">:</span>
  <span class="n">SerialNumbered</span><span class="p">()</span> <span class="p">{</span> <span class="n">serialNumber</span> <span class="o">=</span> <span class="n">counter</span><span class="o">++</span><span class="p">;</span> <span class="p">}</span>
  <span class="kt">long</span> <span class="nf">getSerialNumber</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="n">serialNumber</span><span class="p">;</span> <span class="p">}</span>
<span class="p">};</span>

<span class="c1">// Define and initialize the static storage:
</span><span class="c1"></span><span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">T</span><span class="o">&gt;</span> <span class="kt">long</span> <span class="n">SerialNumbered</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">counter</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Basic</span> <span class="p">{</span>
  <span class="n">string</span> <span class="n">value</span><span class="p">;</span>
<span class="k">public</span><span class="o">:</span>
  <span class="kt">void</span> <span class="n">set</span><span class="p">(</span><span class="n">string</span> <span class="n">val</span><span class="p">)</span> <span class="p">{</span> <span class="n">value</span> <span class="o">=</span> <span class="n">val</span><span class="p">;</span> <span class="p">}</span>
  <span class="n">string</span> <span class="nf">get</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="n">value</span><span class="p">;</span> <span class="p">}</span>
<span class="p">};</span>    

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">TimeStamped</span><span class="o">&lt;</span><span class="n">SerialNumbered</span><span class="o">&lt;</span><span class="n">Basic</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">mixin1</span><span class="p">,</span> <span class="n">mixin2</span><span class="p">;</span>
  <span class="n">mixin1</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="s">&#34;test string 1&#34;</span><span class="p">);</span>
  <span class="n">mixin2</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="s">&#34;test string 2&#34;</span><span class="p">);</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">mixin1</span><span class="p">.</span><span class="n">get</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">mixin1</span><span class="p">.</span><span class="n">getStamp</span><span class="p">()</span> <span class="o">&lt;&lt;</span>
    <span class="s">&#34; &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">mixin1</span><span class="p">.</span><span class="n">getSerialNumber</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">mixin2</span><span class="p">.</span><span class="n">get</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">mixin2</span><span class="p">.</span><span class="n">getStamp</span><span class="p">()</span> <span class="o">&lt;&lt;</span>
    <span class="s">&#34; &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">mixin2</span><span class="p">.</span><span class="n">getSerialNumber</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="p">}</span> <span class="cm">/* Output: (Sample)
</span><span class="cm">test string 1 1129840250 1
</span><span class="cm">test string 2 1129840250 2
</span><span class="cm">*/</span><span class="c1">//:~
</span></code></pre></td></tr></table>
</div>
</div><h3 id="152-与接口混合">15.2 与接口混合</h3>
<p>一种更常见的推荐解决方案是使用接口来产生混型效果，就像下面这样：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//: generics/Mixins.java
</span><span class="c1"></span><span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">interface</span> <span class="nc">TimeStamped</span> <span class="o">{</span> <span class="kt">long</span> <span class="nf">getStamp</span><span class="o">();</span> <span class="o">}</span>

<span class="kd">class</span> <span class="nc">TimeStampedImp</span> <span class="kd">implements</span> <span class="n">TimeStamped</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">timeStamp</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">TimeStampedImp</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">timeStamp</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Date</span><span class="o">().</span><span class="na">getTime</span><span class="o">();</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">long</span> <span class="nf">getStamp</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">timeStamp</span><span class="o">;</span> <span class="o">}</span>
<span class="o">}</span>

<span class="kd">interface</span> <span class="nc">SerialNumbered</span> <span class="o">{</span> <span class="kt">long</span> <span class="nf">getSerialNumber</span><span class="o">();</span> <span class="o">}</span>

<span class="kd">class</span> <span class="nc">SerialNumberedImp</span> <span class="kd">implements</span> <span class="n">SerialNumbered</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="kt">long</span> <span class="n">counter</span> <span class="o">=</span> <span class="n">1</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialNumber</span> <span class="o">=</span> <span class="n">counter</span><span class="o">++;</span>
  <span class="kd">public</span> <span class="kt">long</span> <span class="nf">getSerialNumber</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">serialNumber</span><span class="o">;</span> <span class="o">}</span>
<span class="o">}</span>

<span class="kd">interface</span> <span class="nc">Basic</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">set</span><span class="o">(</span><span class="n">String</span> <span class="n">val</span><span class="o">);</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">get</span><span class="o">();</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">BasicImp</span> <span class="kd">implements</span> <span class="n">Basic</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">value</span><span class="o">;</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">set</span><span class="o">(</span><span class="n">String</span> <span class="n">val</span><span class="o">)</span> <span class="o">{</span> <span class="n">value</span> <span class="o">=</span> <span class="n">val</span><span class="o">;</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">get</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">value</span><span class="o">;</span> <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Mixin</span> <span class="kd">extends</span> <span class="n">BasicImp</span> <span class="kd">implements</span> <span class="n">TimeStamped</span><span class="o">,</span> <span class="n">SerialNumbered</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">TimeStamped</span> <span class="n">timeStamp</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TimeStampedImp</span><span class="o">();</span>
  <span class="kd">private</span> <span class="n">SerialNumbered</span> <span class="n">serialNumber</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SerialNumberedImp</span><span class="o">();</span>
  <span class="kd">public</span> <span class="kt">long</span> <span class="nf">getStamp</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">timeStamp</span><span class="o">.</span><span class="na">getStamp</span><span class="o">();</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">long</span> <span class="nf">getSerialNumber</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">serialNumber</span><span class="o">.</span><span class="na">getSerialNumber</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Mixins</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Mixin</span> <span class="n">mixin1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Mixin</span><span class="o">(),</span> <span class="n">mixin2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Mixin</span><span class="o">();</span>
    <span class="n">mixin1</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="s">&#34;test string 1&#34;</span><span class="o">);</span>
    <span class="n">mixin2</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="s">&#34;test string 2&#34;</span><span class="o">);</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">mixin1</span><span class="o">.</span><span class="na">get</span><span class="o">()</span> <span class="o">+</span> <span class="s">&#34; &#34;</span> <span class="o">+</span>
      <span class="n">mixin1</span><span class="o">.</span><span class="na">getStamp</span><span class="o">()</span> <span class="o">+</span>  <span class="s">&#34; &#34;</span> <span class="o">+</span> <span class="n">mixin1</span><span class="o">.</span><span class="na">getSerialNumber</span><span class="o">());</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">mixin2</span><span class="o">.</span><span class="na">get</span><span class="o">()</span> <span class="o">+</span> <span class="s">&#34; &#34;</span> <span class="o">+</span>
      <span class="n">mixin2</span><span class="o">.</span><span class="na">getStamp</span><span class="o">()</span> <span class="o">+</span>  <span class="s">&#34; &#34;</span> <span class="o">+</span> <span class="n">mixin2</span><span class="o">.</span><span class="na">getSerialNumber</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output: (Sample)
</span><span class="cm">test string 1 1132437151359 1
</span><span class="cm">test string 2 1132437151359 2
</span><span class="cm">*/</span><span class="c1">//:~
</span></code></pre></td></tr></table>
</div>
</div><h3 id="153-使用装饰器模式">15.3 使用装饰器模式</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//: generics/decorator/Decoration.java
</span><span class="c1"></span><span class="kn">package</span> <span class="nn">generics.decorator</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">class</span> <span class="nc">Basic</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">value</span><span class="o">;</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">set</span><span class="o">(</span><span class="n">String</span> <span class="n">val</span><span class="o">)</span> <span class="o">{</span> <span class="n">value</span> <span class="o">=</span> <span class="n">val</span><span class="o">;</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">get</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">value</span><span class="o">;</span> <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Decorator</span> <span class="kd">extends</span> <span class="n">Basic</span> <span class="o">{</span>
  <span class="kd">protected</span> <span class="n">Basic</span> <span class="n">basic</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">Decorator</span><span class="o">(</span><span class="n">Basic</span> <span class="n">basic</span><span class="o">)</span> <span class="o">{</span> <span class="k">this</span><span class="o">.</span><span class="na">basic</span> <span class="o">=</span> <span class="n">basic</span><span class="o">;</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">set</span><span class="o">(</span><span class="n">String</span> <span class="n">val</span><span class="o">)</span> <span class="o">{</span> <span class="n">basic</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">val</span><span class="o">);</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">get</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">basic</span><span class="o">.</span><span class="na">get</span><span class="o">();</span> <span class="o">}</span>
<span class="o">}</span>    

<span class="kd">class</span> <span class="nc">TimeStamped</span> <span class="kd">extends</span> <span class="n">Decorator</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">timeStamp</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">TimeStamped</span><span class="o">(</span><span class="n">Basic</span> <span class="n">basic</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">(</span><span class="n">basic</span><span class="o">);</span>
    <span class="n">timeStamp</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Date</span><span class="o">().</span><span class="na">getTime</span><span class="o">();</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">long</span> <span class="nf">getStamp</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">timeStamp</span><span class="o">;</span> <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">SerialNumbered</span> <span class="kd">extends</span> <span class="n">Decorator</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="kt">long</span> <span class="n">counter</span> <span class="o">=</span> <span class="n">1</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialNumber</span> <span class="o">=</span> <span class="n">counter</span><span class="o">++;</span>
  <span class="kd">public</span> <span class="nf">SerialNumbered</span><span class="o">(</span><span class="n">Basic</span> <span class="n">basic</span><span class="o">)</span> <span class="o">{</span> <span class="kd">super</span><span class="o">(</span><span class="n">basic</span><span class="o">);</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">long</span> <span class="nf">getSerialNumber</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">serialNumber</span><span class="o">;</span> <span class="o">}</span>
<span class="o">}</span>    

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Decoration</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">TimeStamped</span> <span class="n">t</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TimeStamped</span><span class="o">(</span><span class="k">new</span> <span class="n">Basic</span><span class="o">());</span>
    <span class="n">TimeStamped</span> <span class="n">t2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TimeStamped</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">SerialNumbered</span><span class="o">(</span><span class="k">new</span> <span class="n">Basic</span><span class="o">()));</span>
    <span class="c1">//! t2.getSerialNumber(); // Not available
</span><span class="c1"></span>    <span class="n">SerialNumbered</span> <span class="n">s</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SerialNumbered</span><span class="o">(</span><span class="k">new</span> <span class="n">Basic</span><span class="o">());</span>
    <span class="n">SerialNumbered</span> <span class="n">s2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SerialNumbered</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">TimeStamped</span><span class="o">(</span><span class="k">new</span> <span class="n">Basic</span><span class="o">()));</span>
    <span class="c1">//! s2.getStamp(); // Not available
</span><span class="c1"></span>  <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~
</span></code></pre></td></tr></table>
</div>
</div><h3 id="154-与动态代理混合">15.4 与动态代理混合</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//: generics/DynamicProxyMixin.java
</span><span class="c1"></span><span class="kn">import</span> <span class="nn">java.lang.reflect.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">net.mindview.util.*</span><span class="o">;</span>
<span class="kn">import static</span> <span class="nn">net.mindview.util.Tuple.*</span><span class="o">;</span>

<span class="kd">class</span> <span class="nc">MixinProxy</span> <span class="kd">implements</span> <span class="n">InvocationHandler</span> <span class="o">{</span>
  <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Object</span><span class="o">&gt;</span> <span class="n">delegatesByMethod</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">MixinProxy</span><span class="o">(</span><span class="n">TwoTuple</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">,</span><span class="n">Class</span><span class="o">&lt;?&gt;&gt;...</span> <span class="n">pairs</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">delegatesByMethod</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Object</span><span class="o">&gt;();</span>
    <span class="k">for</span><span class="o">(</span><span class="n">TwoTuple</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">,</span><span class="n">Class</span><span class="o">&lt;?&gt;&gt;</span> <span class="n">pair</span> <span class="o">:</span> <span class="n">pairs</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">for</span><span class="o">(</span><span class="n">Method</span> <span class="n">method</span> <span class="o">:</span> <span class="n">pair</span><span class="o">.</span><span class="na">second</span><span class="o">.</span><span class="na">getMethods</span><span class="o">())</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">methodName</span> <span class="o">=</span> <span class="n">method</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>
        <span class="c1">// The first interface in the map
</span><span class="c1"></span>        <span class="c1">// implements the method.
</span><span class="c1"></span>        <span class="k">if</span> <span class="o">(!</span><span class="n">delegatesByMethod</span><span class="o">.</span><span class="na">containsKey</span><span class="o">(</span><span class="n">methodName</span><span class="o">))</span>
          <span class="n">delegatesByMethod</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">methodName</span><span class="o">,</span> <span class="n">pair</span><span class="o">.</span><span class="na">first</span><span class="o">);</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>    
  <span class="kd">public</span> <span class="n">Object</span> <span class="nf">invoke</span><span class="o">(</span><span class="n">Object</span> <span class="n">proxy</span><span class="o">,</span> <span class="n">Method</span> <span class="n">method</span><span class="o">,</span>
    <span class="n">Object</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Throwable</span> <span class="o">{</span>
    <span class="n">String</span> <span class="n">methodName</span> <span class="o">=</span> <span class="n">method</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>
    <span class="n">Object</span> <span class="n">delegate</span> <span class="o">=</span> <span class="n">delegatesByMethod</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">methodName</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">method</span><span class="o">.</span><span class="na">invoke</span><span class="o">(</span><span class="n">delegate</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">&#34;unchecked&#34;</span><span class="o">)</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="n">Object</span> <span class="nf">newInstance</span><span class="o">(</span><span class="n">TwoTuple</span><span class="o">...</span> <span class="n">pairs</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Class</span><span class="o">[]</span> <span class="n">interfaces</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Class</span><span class="o">[</span><span class="n">pairs</span><span class="o">.</span><span class="na">length</span><span class="o">];</span>
    <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">pairs</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
      <span class="n">interfaces</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="o">(</span><span class="n">Class</span><span class="o">)</span><span class="n">pairs</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">second</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="n">ClassLoader</span> <span class="n">cl</span> <span class="o">=</span> <span class="n">pairs</span><span class="o">[</span><span class="n">0</span><span class="o">].</span><span class="na">first</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getClassLoader</span><span class="o">();</span>
    <span class="k">return</span> <span class="n">Proxy</span><span class="o">.</span><span class="na">newProxyInstance</span><span class="o">(</span>
      <span class="n">cl</span><span class="o">,</span> <span class="n">interfaces</span><span class="o">,</span> <span class="k">new</span> <span class="n">MixinProxy</span><span class="o">(</span><span class="n">pairs</span><span class="o">));</span>
  <span class="o">}</span>
<span class="o">}</span>    

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DynamicProxyMixin</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Object</span> <span class="n">mixin</span> <span class="o">=</span> <span class="n">MixinProxy</span><span class="o">.</span><span class="na">newInstance</span><span class="o">(</span>
      <span class="n">tuple</span><span class="o">(</span><span class="k">new</span> <span class="n">BasicImp</span><span class="o">(),</span> <span class="n">Basic</span><span class="o">.</span><span class="na">class</span><span class="o">),</span>
      <span class="n">tuple</span><span class="o">(</span><span class="k">new</span> <span class="n">TimeStampedImp</span><span class="o">(),</span> <span class="n">TimeStamped</span><span class="o">.</span><span class="na">class</span><span class="o">),</span>
      <span class="n">tuple</span><span class="o">(</span><span class="k">new</span> <span class="n">SerialNumberedImp</span><span class="o">(),</span><span class="n">SerialNumbered</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>
    <span class="n">Basic</span> <span class="n">b</span> <span class="o">=</span> <span class="o">(</span><span class="n">Basic</span><span class="o">)</span><span class="n">mixin</span><span class="o">;</span>
    <span class="n">TimeStamped</span> <span class="n">t</span> <span class="o">=</span> <span class="o">(</span><span class="n">TimeStamped</span><span class="o">)</span><span class="n">mixin</span><span class="o">;</span>
    <span class="n">SerialNumbered</span> <span class="n">s</span> <span class="o">=</span> <span class="o">(</span><span class="n">SerialNumbered</span><span class="o">)</span><span class="n">mixin</span><span class="o">;</span>
    <span class="n">b</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="s">&#34;Hello&#34;</span><span class="o">);</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">b</span><span class="o">.</span><span class="na">get</span><span class="o">());</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">t</span><span class="o">.</span><span class="na">getStamp</span><span class="o">());</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">s</span><span class="o">.</span><span class="na">getSerialNumber</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output: (Sample)
</span><span class="cm">Hello
</span><span class="cm">1132519137015
</span><span class="cm">1
</span><span class="cm">*/</span><span class="c1">//:~
</span></code></pre></td></tr></table>
</div>
</div><h2 id="1516-潜在类型机制">15.16 潜在类型机制</h2>
<h2 id="1517-对缺乏潜在类型机制的补偿">15.17 对缺乏潜在类型机制的补偿</h2>
<h2 id="1518-将函数对象用作策略">15.18 将函数对象用作策略</h2>
<h2 id="1519-总结转型真的如此之糟吗">15.19 总结：转型真的如此之糟吗？</h2>
<h2 id="相关资料">相关资料</h2>
<ul>
<li><a href="http://java.sun.com/j2se/1.5/pdf/generics-tutorial.pdf">Java Generics Tutorial</a></li>
<li><a href="https://book.douban.com/subject/2303830/">Java Generics and Collections</a></li>
<li><a href="http://www.angelikalanger.com/GenericsFAQ/JavaGenericsFAQ.html">Java Generics FAQs</a></li>
<li><a href="https://www.zhihu.com/question/20400700">Java 泛型 &lt;? super T&gt; 中 super 怎么 理解？与 extends 有何不同？</a></li>
</ul>

    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content">malinkang</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">
        2013-06-18
        
    </span>
  </p>
  
  
</div>
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/thinking-in-java/">Thinking in Java</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/thinking-in-java-arrays/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">《Java编程思想》第16章数组</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        <a class="next" href="/post/thinking-in-java-type-information/">
            <span class="next-text nav-default">《Java编程思想》第14章类型信息</span>
            <span class="next-text nav-mobile">下一篇</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        <div id="disqus_thread"></div>
    <script type="text/javascript">
    (function() {
      
      
      if (window.location.hostname === 'localhost') return;

      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      var disqus_shortname = 'malinkang-cn';
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="https://twitter.com/malinkang" class="iconfont icon-twitter" title="twitter"></a>
      <a href="https://github.com/malinkang" class="iconfont icon-github" title="github"></a>
      <a href="https://weibo.com/malinkang" class="iconfont icon-weibo" title="weibo"></a>
  <a href="https://malinkang.cn/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" href="https://gohugo.io">Hugo</a> 强力驱动
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    主题 - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2017 - 
    2021
    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">malinkang</span>
  </span>
</div>
    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.d7b7ada643c9c1a983026e177f141f7363b4640d619caf01d8831a6718cd44ea.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      showProcessingMessages: false,
      messageStyle: 'none'
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"  integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>








</body>
</html>

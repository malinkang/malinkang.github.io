<!DOCTYPE html>
<html><head>
<title>Dagger2在Android中的使用</title>

<meta charset="utf-8">
<meta name="X-UA-Compatible" content="IE=edge">
<meta name="google-site-verification" content="">
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
<meta content="telephone=no" name="format-detection">
<meta name="description" content="">
<meta name="renderer" content="webkit">
<meta name="theme-color" content="#ffffff">




<script src="/vendor/js/jquery.min.js" ></script>
<script src="/vendor/js/popper.min.js" ></script>
<script src="/vendor/js/bootstrap.min.js" ></script>
<script src="/vendor/js/smooth-scroll.polyfills.min.js" ></script>
<link type="text/css" rel="stylesheet" href="/vendor/css/bootstrap.min.css">
<script src="/vendor/js/vue.min.js" ></script>




<link rel="stylesheet" href="https://malinkang.cn/scss/journal.min.56b67b8b01d7cd1015ed14414fd2fc33ebfb2e8413dcbc47c5cd734544c92cd7.css" integrity="sha256-VrZ7iwHXzRAV7RRBT9L8M&#43;v7LoQT3LxHxc1zRUTJLNc=" media="screen">



<link rel="stylesheet" href="https://malinkang.cn/scss/dark-mode.min.5a2bbd1758c83affd639a91fbfd5cc681b1a5574df99442825c444dd40504b13.css" integrity="sha256-Wiu9F1jIOv/WOakfv9XMaBsaVXTfmUQoJcRE3UBQSxM=" media="screen">


<script src="https://malinkang.cn//js/loadCSS.js"></script>
<script>
  loadCSS("https://fonts.googleapis.com/css?family=Lora|Montserrat|Fira+Mono|Noto+Serif+SC|Material+Icons");
</script>

<script src="https://malinkang.cn//js/table.js"></script>




<script src="https://malinkang.cn//js/toc.js"></script>



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
<script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
<script src="/vendor/js/md5.min.js"></script>
<script>
  var gitalk = new Gitalk({
  clientID: 'd84786eae9edb9e6521b',
  clientSecret: 'a30a17b679a15e85b8f257eec4231d5b286e1b58',
  repo: 'malinkang.github.io',
  owner: 'malinkang',
  admin: ['malinkang'],
  id: md5(location.pathname),
  distractionFreeMode: 'false'
  });
  window.onload = function () {
        gitalk.render('gitalk-container')
  }
</script>






</head><body>
    	<div id="app"><div ref="sideContainer" class="side-container">
    
    <a class="a-block nav-head false" href="https://malinkang.cn/">
    
        <div class="nav-title">
            Malinkang‘s Blog
        </div>
        
        <div class="nav-subtitle">
            人生最可悲的事情，莫过于胸怀大志，却又虚度光阴。
        </div>
        
    </a>

    <div class="nav-link-list">
        
        
            
            
            
                
            
            
            
            <a class="a-block nav-link-item active" href="/posts">
                Archive
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="https://android.malinkang.cn">
                Android笔记
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="https://kotlin.malinkang.cn">
                Kotlin笔记
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/index.xml">
                RSS Feed
            </a>
            
        
    </div>

    

    <div class="nav-footer">
        
Hugo Theme <a href="https://github.com/amazingrise/hugo-theme-diary">Diary</a> by <a href="https://amazingrise.net">Rise</a>
<br>
Ported from <a href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a>'s <a href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> <br>
<br>

&copy;
	
	This is a customized copyright.
	
    </div>
    
</div><div ref="extraContainer" class="extra-container">
    
    
    <div class="toc animated-visibility" :class="{ invisible: scrollY <= 140 }">


	<div class="toc-content">
	
		
		
		
		<center>- CATALOG -</center>
			
				
				
					
						
						
							<ul>
						
							<ul>
						
							<ul>
						
						
								<li>
				 					<a href="#%e6%b3%a8%e5%85%a5activity%e5%af%b9%e8%b1%a1" v-on:click="closeDrawer" id="注入activity对象-nav">
										 注入Activity对象
									</a>
								</li>
						
							</ul>
						
							</ul>
						
							</ul>
						
					
				
			
				
				
					
						
						
							<ul>
						
							<ul>
						
							<ul>
						
							<ul>
						
						
								<li>
				 					<a href="#%e5%a6%82%e4%bd%95%e5%b7%a5%e4%bd%9c" v-on:click="closeDrawer" id="如何工作-nav">
										 如何工作
									</a>
								</li>
						
							</ul>
						
							</ul>
						
							</ul>
						
							</ul>
						
					
				
			
				
				
					
						
						
							<ul>
						
							<ul>
						
							<ul>
						
						
								<li>
				 					<a href="#%e6%b3%a8%e5%85%a5fragment%e5%af%b9%e8%b1%a1" v-on:click="closeDrawer" id="注入fragment对象-nav">
										 注入Fragment对象
									</a>
								</li>
						
							</ul>
						
							</ul>
						
							</ul>
						
					
				
			
				
				
					
						
						
							<ul>
						
							<ul>
						
							<ul>
						
						
								<li>
				 					<a href="#%e5%9f%ba%e6%9c%ac%e6%a1%86%e6%9e%b6%e7%b1%bb%e5%9e%8b" v-on:click="closeDrawer" id="基本框架类型-nav">
										 基本框架类型
									</a>
								</li>
						
							</ul>
						
							</ul>
						
							</ul>
						
					
				
			
				
				
					
						
						
							<ul>
						
							<ul>
						
							<ul>
						
						
								<li>
				 					<a href="#%e6%94%af%e6%8c%81%e5%ba%93" v-on:click="closeDrawer" id="支持库-nav">
										 支持库
									</a>
								</li>
						
							</ul>
						
							</ul>
						
							</ul>
						
					
				
			
				
				
					
						
						
							<ul>
						
							<ul>
						
							<ul>
						
						
								<li>
				 					<a href="#%e5%a6%82%e4%bd%95%e8%8e%b7%e5%8f%96%e5%ae%83" v-on:click="closeDrawer" id="如何获取它-nav">
										 如何获取它
									</a>
								</li>
						
							</ul>
						
							</ul>
						
							</ul>
						
					
				
			
				
				
					
						
						
							<ul>
						
							<ul>
						
							<ul>
						
						
								<li>
				 					<a href="#%e4%bd%95%e6%97%b6%e6%b3%a8%e5%85%a5" v-on:click="closeDrawer" id="何时注入-nav">
										 何时注入
									</a>
								</li>
						
							</ul>
						
							</ul>
						
							</ul>
						
					
				
			
				
				
					
						
						
							<ul>
						
							<ul>
						
							<ul>
						
						
								<li>
				 					<a href="#%e5%b8%b8%e8%a7%81%e9%97%ae%e9%a2%98" v-on:click="closeDrawer" id="常见问题-nav">
										 常见问题
									</a>
								</li>
						
							</ul>
						
							</ul>
						
							</ul>
						
					
				
			
				
				
					
						
						
							<ul>
						
							<ul>
						
							<ul>
						
						
								<li>
				 					<a href="#%e6%9c%89%e7%94%a8%e9%93%be%e6%8e%a5" v-on:click="closeDrawer" id="有用链接-nav">
										 有用链接
									</a>
								</li>
						
							</ul>
						
							</ul>
						
							</ul>
						
					
				
			
	</div>

</div>
    
    <div class="pagination">
        <a id="globalBackToTop" class="pagination-action animated-visibility" href="#top" :class="{ invisible: scrollY == 0 }">
            <i class="material-icons pagination-action-icon">
                keyboard_arrow_up
            </i>
        </a>
        
        <a class="pagination-action" v-on:click="toggleDarkMode">
            <i class="material-icons pagination-action-icon" v-if="isDarkMode">
                brightness_4
            </i>
            <i class="material-icons pagination-action-icon" v-else="isDarkMode">
                brightness_7
            </i>
        </a>
        
        
    </div>
</div><div class="single-column-drawer-container" ref="drawer"
     v-bind:class="{ 'single-column-drawer-container-active': isDrawerOpen }">
    <div class="drawer-content">
        <div class="drawer-menu">
            
            
            
                
                
                
                    
                
                
                
                <a class="a-block drawer-menu-item active" href="/posts">
                    Archive
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="https://android.malinkang.cn">
                    Android笔记
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="https://kotlin.malinkang.cn">
                    Kotlin笔记
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/index.xml">
                    RSS Feed
                </a>
                
            
            
            <div class="toc">


	<div class="toc-content">
	
		
		
		
		<center>- CATALOG -</center>
			
				
				
					
						
						
							<ul>
						
							<ul>
						
							<ul>
						
						
								<li>
				 					<a href="#%e6%b3%a8%e5%85%a5activity%e5%af%b9%e8%b1%a1" v-on:click="closeDrawer" id="注入activity对象-nav">
										 注入Activity对象
									</a>
								</li>
						
							</ul>
						
							</ul>
						
							</ul>
						
					
				
			
				
				
					
						
						
							<ul>
						
							<ul>
						
							<ul>
						
							<ul>
						
						
								<li>
				 					<a href="#%e5%a6%82%e4%bd%95%e5%b7%a5%e4%bd%9c" v-on:click="closeDrawer" id="如何工作-nav">
										 如何工作
									</a>
								</li>
						
							</ul>
						
							</ul>
						
							</ul>
						
							</ul>
						
					
				
			
				
				
					
						
						
							<ul>
						
							<ul>
						
							<ul>
						
						
								<li>
				 					<a href="#%e6%b3%a8%e5%85%a5fragment%e5%af%b9%e8%b1%a1" v-on:click="closeDrawer" id="注入fragment对象-nav">
										 注入Fragment对象
									</a>
								</li>
						
							</ul>
						
							</ul>
						
							</ul>
						
					
				
			
				
				
					
						
						
							<ul>
						
							<ul>
						
							<ul>
						
						
								<li>
				 					<a href="#%e5%9f%ba%e6%9c%ac%e6%a1%86%e6%9e%b6%e7%b1%bb%e5%9e%8b" v-on:click="closeDrawer" id="基本框架类型-nav">
										 基本框架类型
									</a>
								</li>
						
							</ul>
						
							</ul>
						
							</ul>
						
					
				
			
				
				
					
						
						
							<ul>
						
							<ul>
						
							<ul>
						
						
								<li>
				 					<a href="#%e6%94%af%e6%8c%81%e5%ba%93" v-on:click="closeDrawer" id="支持库-nav">
										 支持库
									</a>
								</li>
						
							</ul>
						
							</ul>
						
							</ul>
						
					
				
			
				
				
					
						
						
							<ul>
						
							<ul>
						
							<ul>
						
						
								<li>
				 					<a href="#%e5%a6%82%e4%bd%95%e8%8e%b7%e5%8f%96%e5%ae%83" v-on:click="closeDrawer" id="如何获取它-nav">
										 如何获取它
									</a>
								</li>
						
							</ul>
						
							</ul>
						
							</ul>
						
					
				
			
				
				
					
						
						
							<ul>
						
							<ul>
						
							<ul>
						
						
								<li>
				 					<a href="#%e4%bd%95%e6%97%b6%e6%b3%a8%e5%85%a5" v-on:click="closeDrawer" id="何时注入-nav">
										 何时注入
									</a>
								</li>
						
							</ul>
						
							</ul>
						
							</ul>
						
					
				
			
				
				
					
						
						
							<ul>
						
							<ul>
						
							<ul>
						
						
								<li>
				 					<a href="#%e5%b8%b8%e8%a7%81%e9%97%ae%e9%a2%98" v-on:click="closeDrawer" id="常见问题-nav">
										 常见问题
									</a>
								</li>
						
							</ul>
						
							</ul>
						
							</ul>
						
					
				
			
				
				
					
						
						
							<ul>
						
							<ul>
						
							<ul>
						
						
								<li>
				 					<a href="#%e6%9c%89%e7%94%a8%e9%93%be%e6%8e%a5" v-on:click="closeDrawer" id="有用链接-nav">
										 有用链接
									</a>
								</li>
						
							</ul>
						
							</ul>
						
							</ul>
						
					
				
			
	</div>

</div>
            
        </div>
    </div>
</div>
<transition name="fade">
    <div v-bind:class="{ 'single-column-drawer-mask': mounted }" v-if="isDrawerOpen" v-on:click="toggleDrawer"></div>
</transition>
<nav ref="navBar" class="navbar sticky-top navbar-light single-column-nav-container">
    <div ref="navBackground" class="nav-background"></div>
    <div class="container container-narrow nav-content">
        <button id="nav_dropdown_btn" class="nav-dropdown-toggle" type="button" v-on:click="toggleDrawer">
            <i class="material-icons">
                menu
            </i>
        </button>
        <a ref="navTitle" class="navbar-brand" href="https://malinkang.cn/">
            Malinkang‘s Blog
        </a>
        
        <button type="button" class="nav-darkmode-toggle" v-on:click="toggleDarkMode">
            <i class="material-icons" v-if="isDarkMode">
                brightness_4
            </i>
            <i class="material-icons" v-else="isDarkMode">
                brightness_7
            </i>
        </button>
        
    </div>
</nav>
<div class="single-column-header-container" ref="pageHead"
     v-bind:style="{ transform: 'translateZ(0px) translateY('+.3*scrollY+'px)', opacity: 1-navOpacity }">
    <a href="https://malinkang.cn/">
        <div class="single-column-header-title">Malinkang‘s Blog</div>
        
        <div class="single-column-header-subtitle">人生最可悲的事情，莫过于胸怀大志，却又虚度光阴。</div>
        

    </a>
</div>
            <div id="content">
<div ref="streamContainer" class="stream-container">
    <div class="post-list-container post-list-container-shadow">
        <div class="post">
            
            
            

            <div class="post-head-wrapper-text-only"
                
            >
                <div class="post-title">
                    Dagger2在Android中的使用
                    
                    <div class="post-meta">
                        
                        <time itemprop="datePublished">
                            2018-07-25 11:56
                        </time>
                        

                        

                        
                        
                    </div>
                </div>
            </div>
            
            <div class="post-body-wrapper">
                <div class="post-body">
                    <p>与其他大多数依赖注入框架相比，<code>Dagger2</code>的主要优点之一是其严格生成的实现（无反射）意味着它可以在<code>Android</code>应用程序中使用。但是，在<code>Android</code>应用程序中使用<code>Dagger</code>时仍有一些注意事项。</p>
<p>原文：https://google.github.io/dagger/android</p>
<p>使用<code>Dagger</code>编写<code>Android</code>应用程序的主要困难之一是很多<code>Android</code>框架类都是由操作系统本身实例化的，例如<code>Activity</code>和<code>Fragment</code>，但是如果<code>Dagger</code>可以创建所有注入的对象，则<code>Dagger</code>的效果最好。相反，您必须在生命周期方法中执行成员注入。这意味着许多类最终看起来像：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">FrombulationActivity</span> extends Activity {
  <span style="color:#960050;background-color:#1e0010">@</span>Inject Frombulator frombulator;

  <span style="color:#960050;background-color:#1e0010">@</span>Override
  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> onCreate(Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);
    <span style="color:#75715e">// DO THIS FIRST. Otherwise frombulator might be null!
</span><span style="color:#75715e"></span>    ((SomeApplicationBaseType) getContext().getApplicationContext())
        .getApplicationComponent()
        .newActivityComponentBuilder()
        .activity(<span style="color:#66d9ef">this</span>)
        .build()
        .inject(<span style="color:#66d9ef">this</span>);
    <span style="color:#75715e">// ... now you can write the exciting code
</span><span style="color:#75715e"></span>  }
}
</code></pre></div><h3 id="注入activity对象">注入Activity对象</h3>
<ol>
<li>在您的应用程序组件中安装<code>AndroidInjectionModule</code>以确保这些基本类型所需的所有绑定都可用。</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Singleton</span>
<span style="color:#a6e22e">@Component</span><span style="color:#f92672">(</span>
    modules <span style="color:#f92672">=</span> <span style="color:#f92672">[</span>
        AndroidInjectionModule<span style="color:#f92672">::</span>class<span style="color:#f92672">,</span> <span style="color:#75715e">//安装AndroidInjectionModule
</span><span style="color:#75715e"></span>        AppModule<span style="color:#f92672">::</span>class<span style="color:#f92672">,</span>
        MainActivityModule<span style="color:#f92672">::</span>class<span style="color:#f92672">]</span>
<span style="color:#f92672">)</span>
<span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">AppComponent</span> <span style="color:#f92672">{</span>
    <span style="color:#a6e22e">@Component.Builder</span>
    <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">Builder</span> <span style="color:#f92672">{</span>
        <span style="color:#a6e22e">@BindsInstance</span>
        fun <span style="color:#a6e22e">application</span><span style="color:#f92672">(</span>application<span style="color:#f92672">:</span> Application<span style="color:#f92672">):</span> Builder

        fun <span style="color:#a6e22e">build</span><span style="color:#f92672">():</span> AppComponent
    <span style="color:#f92672">}</span>
    <span style="color:#75715e">//注入App
</span><span style="color:#75715e"></span>    fun <span style="color:#a6e22e">inject</span><span style="color:#f92672">(</span>githubApp<span style="color:#f92672">:</span> GithubApp<span style="color:#f92672">)</span>
<span style="color:#f92672">}</span>
</code></pre></div><ol start="2">
<li>首先编写一个实现<code>AndroidInjector&lt;YourActivity&gt;</code>的<code>@Subcomponent</code>和一个继承<code>AndroidInjector.Builder&lt;YourActivity&gt;</code>的<code>@Subcomponent.Builder</code>。</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Subcomponent</span><span style="color:#f92672">(</span>modules <span style="color:#f92672">=</span> <span style="color:#f92672">...)</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">YourActivitySubcomponent</span> <span style="color:#66d9ef">extends</span> AndroidInjector<span style="color:#f92672">&lt;</span>YourActivity<span style="color:#f92672">&gt;</span> <span style="color:#f92672">{</span>
  <span style="color:#a6e22e">@Subcomponent.Builder</span>
  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">abstract</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Builder</span> <span style="color:#66d9ef">extends</span> AndroidInjector<span style="color:#f92672">.</span><span style="color:#a6e22e">Builder</span><span style="color:#f92672">&lt;</span>YourActivity<span style="color:#f92672">&gt;</span> <span style="color:#f92672">{}</span>
<span style="color:#f92672">}</span>
</code></pre></div><ol start="3">
<li>定义子组件后，通过定义一个绑定子组件层次结构并将其添加到注入应用程序的组件的模块，将其添加到组件层次结构中。</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Module</span><span style="color:#f92672">(</span>subcomponents <span style="color:#f92672">=</span> YourActivitySubcomponent<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">abstract</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">YourActivityModule</span> <span style="color:#f92672">{</span>
  <span style="color:#a6e22e">@Binds</span>
  <span style="color:#a6e22e">@IntoMap</span>
  <span style="color:#a6e22e">@ActivityKey</span><span style="color:#f92672">(</span>YourActivity<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">)</span>
  <span style="color:#66d9ef">abstract</span> AndroidInjector<span style="color:#f92672">.</span><span style="color:#a6e22e">Factory</span><span style="color:#f92672">&lt;?</span> <span style="color:#66d9ef">extends</span> Activity<span style="color:#f92672">&gt;</span>
      <span style="color:#a6e22e">bindYourActivityInjectorFactory</span><span style="color:#f92672">(</span>YourActivitySubcomponent<span style="color:#f92672">.</span><span style="color:#a6e22e">Builder</span> builder<span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>

<span style="color:#a6e22e">@Component</span><span style="color:#f92672">(</span>modules <span style="color:#f92672">=</span> <span style="color:#f92672">{...,</span> YourActivityModule<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">})</span>
<span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">YourApplicationComponent</span> <span style="color:#f92672">{}</span>
</code></pre></div><p>专业提示：如果您的子组件及其构建器没有第2步中提到的其他方法或超类型，您可以使用<code>@ContributesAndroidInjector</code>为您生成它们。添加一个抽象模块方法，该方法返回您的活动，使用@ContributesAndroidInjector对其进行注释，并指定要安装到子组件中的模块，而不是步骤2和3。如果子组件需要作用域，则也可以将范围注释应用于该方法。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@ActivityScope</span>
<span style="color:#a6e22e">@ContributesAndroidInjector</span><span style="color:#f92672">(</span>modules <span style="color:#f92672">=</span> <span style="color:#f92672">{</span> <span style="color:#75715e">/* modules to install into the subcomponent */</span> <span style="color:#f92672">})</span>
<span style="color:#66d9ef">abstract</span> YourActivity <span style="color:#a6e22e">contributeYourActivityInjector</span><span style="color:#f92672">();</span>
</code></pre></div><ol start="4">
<li>接下来，让您的<code>Application</code>实现<code>HasActivityInjector</code>并且<code>@Inject</code>一个从<code>activityInjector()</code>方法返回的<code>DispatchingAndroidInjector&lt;Activity&gt;</code>。</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">YourApplication</span> <span style="color:#66d9ef">extends</span> Application <span style="color:#66d9ef">implements</span> HasActivityInjector <span style="color:#f92672">{</span>
  <span style="color:#a6e22e">@Inject</span> DispatchingAndroidInjector<span style="color:#f92672">&lt;</span>Activity<span style="color:#f92672">&gt;</span> dispatchingActivityInjector<span style="color:#f92672">;</span>

  <span style="color:#a6e22e">@Override</span>
  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">onCreate</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">super</span><span style="color:#f92672">.</span><span style="color:#a6e22e">onCreate</span><span style="color:#f92672">();</span>
    DaggerYourApplicationComponent<span style="color:#f92672">.</span><span style="color:#a6e22e">create</span><span style="color:#f92672">()</span>
        <span style="color:#f92672">.</span><span style="color:#a6e22e">inject</span><span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">);</span>
  <span style="color:#f92672">}</span>

  <span style="color:#a6e22e">@Override</span>
  <span style="color:#66d9ef">public</span> AndroidInjector<span style="color:#f92672">&lt;</span>Activity<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">activityInjector</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">return</span> dispatchingActivityInjector<span style="color:#f92672">;</span>
  <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><ol start="5">
<li>最终，在你的<code>Activity.onCreate()</code>方法中，在调用<code>super.onCreate();</code>之前调用<code>AndroidInjection.inject(this)</code>。</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">YourActivity</span> <span style="color:#66d9ef">extends</span> Activity <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">onCreate</span><span style="color:#f92672">(</span>Bundle savedInstanceState<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    AndroidInjection<span style="color:#f92672">.</span><span style="color:#a6e22e">inject</span><span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">);</span>
    <span style="color:#66d9ef">super</span><span style="color:#f92672">.</span><span style="color:#a6e22e">onCreate</span><span style="color:#f92672">(</span>savedInstanceState<span style="color:#f92672">);</span>
  <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><h4 id="如何工作">如何工作</h4>
<p><code>AndroidInjection.inject()</code>从<code>Application</code>中获取一个<code>DispatchingAndroidInjector&lt;Activity&gt;</code>并且传递你的<code>activity</code>到<code>inject(this)</code>。<code>DispatchingAndroidInjector</code>为您的Activity类（它是YourActivitySubcomponent.Builder）查找<code>AndroidInjector.Factory</code>，创建<code>AndroidInjector（它是YourActivitySubcomponent）</code>，并将您的Activity传递给<code>inject（YourActivity）</code>。</p>
<p><code>AndroidInjection</code>的<code>inject</code>方法</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">/**
</span><span style="color:#75715e"> * Injects {@code activity} if an associated {@link AndroidInjector} implementation can be found,
</span><span style="color:#75715e"> * otherwise throws an {@link IllegalArgumentException}.
</span><span style="color:#75715e"> *
</span><span style="color:#75715e"> * @throws RuntimeException if the {@link Application} doesn&#39;t implement {@link
</span><span style="color:#75715e"> *     HasActivityInjector}.
</span><span style="color:#75715e"> */</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">inject</span><span style="color:#f92672">(</span>Activity activity<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
  checkNotNull<span style="color:#f92672">(</span>activity<span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;activity&#34;</span><span style="color:#f92672">);</span>
  Application application <span style="color:#f92672">=</span> activity<span style="color:#f92672">.</span><span style="color:#a6e22e">getApplication</span><span style="color:#f92672">();</span>
  <span style="color:#66d9ef">if</span> <span style="color:#f92672">(!(</span>application <span style="color:#66d9ef">instanceof</span> HasActivityInjector<span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> RuntimeException<span style="color:#f92672">(</span>
        String<span style="color:#f92672">.</span><span style="color:#a6e22e">format</span><span style="color:#f92672">(</span>
            <span style="color:#e6db74">&#34;%s does not implement %s&#34;</span><span style="color:#f92672">,</span>
            application<span style="color:#f92672">.</span><span style="color:#a6e22e">getClass</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getCanonicalName</span><span style="color:#f92672">(),</span>
            HasActivityInjector<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getCanonicalName</span><span style="color:#f92672">()));</span>
  <span style="color:#f92672">}</span>
<span style="color:#75715e">//
</span><span style="color:#75715e"></span>  AndroidInjector<span style="color:#f92672">&lt;</span>Activity<span style="color:#f92672">&gt;</span> activityInjector <span style="color:#f92672">=</span>
      <span style="color:#f92672">((</span>HasActivityInjector<span style="color:#f92672">)</span> application<span style="color:#f92672">).</span><span style="color:#a6e22e">activityInjector</span><span style="color:#f92672">();</span>
  checkNotNull<span style="color:#f92672">(</span>activityInjector<span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;%s.activityInjector() returned null&#34;</span><span style="color:#f92672">,</span> application<span style="color:#f92672">.</span><span style="color:#a6e22e">getClass</span><span style="color:#f92672">());</span>

  activityInjector<span style="color:#f92672">.</span><span style="color:#a6e22e">inject</span><span style="color:#f92672">(</span>activity<span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>

</code></pre></div><h3 id="注入fragment对象">注入Fragment对象</h3>
<blockquote>
<p>Injecting a Fragment is just as simple as injecting an Activity. Define your subcomponent in the same way, replacing Activity type parameters with Fragment, @ActivityKey with @FragmentKey, and HasActivityInjector with HasFragmentInjector.</p>
</blockquote>
<p>注入一个<code>Fragment</code>像注入一个<code>Activity</code>一样简单。以相同的方式定义你的<code>subcomponent</code>，使用<code>Fragment</code>替换<code>Activity</code>，<code>@FragmentKey</code>替换<code>@ActivityKey</code>,<code>HasFragmentInjector</code>替换<code>HasActivityInjector</code>。</p>
<blockquote>
<p>Instead of injecting in onCreate() as is done for Activity types, inject Fragments to in onAttach().</p>
</blockquote>
<p>不像在<code>Activity</code>类型中那样在<code>onCreate()</code>中注入，而是在<code>onAttach()</code>中注入<code>Fragment</code>。</p>
<blockquote>
<p>Unlike the modules defined for Activitys, you have a choice of where to install modules for Fragments. You can make your Fragment component a subcomponent of another Fragment component, an Activity component, or the Application component — it all depends on which other bindings your Fragment requires. After deciding on the component location, make the corresponding type implement HasFragmentInjector. For example, if your Fragment needs bindings from YourActivitySubcomponent, your code will look something like this:</p>
</blockquote>
<p>与为<code>Activity</code>定义的模块不同，您可以选择在哪里为<code>Fragments</code>安装模块。你可以让你的<code>Fragment</code>组件成为另一个<code>Fragment</code>子组件，<code>Activity</code>组件或<code>Application</code>组件的一个子组件 - 这一切都取决于你的<code>Fragment</code>需要的其他绑定。确定组件位置后，使相应的类型实现<code>HasFragmentInjector</code>。例如，如果您的<code>Fragment</code>需要来自<code>YourActivitySubcomponent</code>的绑定，那么您的代码将如下所示：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">YourActivity</span> <span style="color:#66d9ef">extends</span> Activity
    <span style="color:#66d9ef">implements</span> HasFragmentInjector <span style="color:#f92672">{</span>
  <span style="color:#a6e22e">@Inject</span> DispatchingAndroidInjector<span style="color:#f92672">&lt;</span>Fragment<span style="color:#f92672">&gt;</span> fragmentInjector<span style="color:#f92672">;</span>

  <span style="color:#a6e22e">@Override</span>
  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">onCreate</span><span style="color:#f92672">(</span>Bundle savedInstanceState<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    AndroidInjection<span style="color:#f92672">.</span><span style="color:#a6e22e">inject</span><span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">);</span>
    <span style="color:#66d9ef">super</span><span style="color:#f92672">.</span><span style="color:#a6e22e">onCreate</span><span style="color:#f92672">(</span>savedInstanceState<span style="color:#f92672">);</span>
    <span style="color:#75715e">// ...
</span><span style="color:#75715e"></span>  <span style="color:#f92672">}</span>

  <span style="color:#a6e22e">@Override</span>
  <span style="color:#66d9ef">public</span> AndroidInjector<span style="color:#f92672">&lt;</span>Fragment<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">fragmentInjector</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">return</span> fragmentInjector<span style="color:#f92672">;</span>
  <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">YourFragment</span> <span style="color:#66d9ef">extends</span> Fragment <span style="color:#f92672">{</span>
  <span style="color:#a6e22e">@Inject</span> SomeDependency someDep<span style="color:#f92672">;</span>

  <span style="color:#a6e22e">@Override</span>
  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">onAttach</span><span style="color:#f92672">(</span>Activity activity<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    AndroidInjection<span style="color:#f92672">.</span><span style="color:#a6e22e">inject</span><span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">);</span>
    <span style="color:#66d9ef">super</span><span style="color:#f92672">.</span><span style="color:#a6e22e">onAttach</span><span style="color:#f92672">(</span>activity<span style="color:#f92672">);</span>
    <span style="color:#75715e">// ...
</span><span style="color:#75715e"></span>  <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>

<span style="color:#a6e22e">@Subcomponent</span><span style="color:#f92672">(</span>modules <span style="color:#f92672">=</span> <span style="color:#f92672">...)</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">YourFragmentSubcomponent</span> <span style="color:#66d9ef">extends</span> AndroidInjector<span style="color:#f92672">&lt;</span>YourFragment<span style="color:#f92672">&gt;</span> <span style="color:#f92672">{</span>
  <span style="color:#a6e22e">@Subcomponent.Builder</span>
  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">abstract</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Builder</span> <span style="color:#66d9ef">extends</span> AndroidInjector<span style="color:#f92672">.</span><span style="color:#a6e22e">Builder</span><span style="color:#f92672">&lt;</span>YourFragment<span style="color:#f92672">&gt;</span> <span style="color:#f92672">{}</span>
<span style="color:#f92672">}</span>

<span style="color:#a6e22e">@Module</span><span style="color:#f92672">(</span>subcomponents <span style="color:#f92672">=</span> YourFragmentSubcomponent<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">abstract</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">YourFragmentModule</span> <span style="color:#f92672">{</span>
  <span style="color:#a6e22e">@Binds</span>
  <span style="color:#a6e22e">@IntoMap</span>
  <span style="color:#a6e22e">@FragmentKey</span><span style="color:#f92672">(</span>YourFragment<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">)</span>
  <span style="color:#66d9ef">abstract</span> AndroidInjector<span style="color:#f92672">.</span><span style="color:#a6e22e">Factory</span><span style="color:#f92672">&lt;?</span> <span style="color:#66d9ef">extends</span> Fragment<span style="color:#f92672">&gt;</span>
      <span style="color:#a6e22e">bindYourFragmentInjectorFactory</span><span style="color:#f92672">(</span>YourFragmentSubcomponent<span style="color:#f92672">.</span><span style="color:#a6e22e">Builder</span> builder<span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>

<span style="color:#a6e22e">@Subcomponent</span><span style="color:#f92672">(</span>modules <span style="color:#f92672">=</span> <span style="color:#f92672">{</span> YourFragmentModule<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">,</span> <span style="color:#f92672">...</span> <span style="color:#f92672">}</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">YourActivityOrYourApplicationComponent</span> <span style="color:#f92672">{</span> <span style="color:#f92672">...</span> <span style="color:#f92672">}</span>

</code></pre></div><h3 id="基本框架类型">基本框架类型</h3>
<blockquote>
<p>Because DispatchingAndroidInjector looks up the appropriate AndroidInjector.Factory by the class at runtime, a base class can implement HasActivityInjector/HasFragmentInjector/etc as well as call AndroidInjection.inject(). All each subclass needs to do is bind a corresponding @Subcomponent. Dagger provides a few base types that do this, such as DaggerActivity and DaggerFragment, if you don’t have a complicated class hierarchy. Dagger also provides a DaggerApplication for the same purpose — all you need to do is to extend it and override the applicationInjector() method to return the component that should inject the Application.</p>
</blockquote>
<p>因为<code>DispatchingAndroidInjector</code>在运行时按类查找适当的<code>AndroidInjector.Factory</code>，所以基类可以实现<code>HasActivityInjector</code>、<code>HasFragmentInjectoretc</code>等等以及调用<code>AndroidInjection.inject()</code>。每个子类都需要做的就是绑定一个对应的<code>@Subcomponent</code>。如果您没有复杂的类层次结构，<code>Dagger</code>会提供一些基本类型，例如<code>DaggerActivity</code>和<code>DaggerFragment</code>。Dagger还为同样的目的提供了一个DaggerApplication你需要做的就是扩展它并覆盖applicationInjector()方法来返回应该注入应用程序的组件。</p>
<p>以下类型也包括在内：</p>
<ul>
<li>DaggerService和DaggerIntentService</li>
<li>DaggerBroadcastReceiver</li>
<li>DaggerContentProvider</li>
</ul>
<blockquote>
<p>Note: DaggerBroadcastReceiver should only be used when the BroadcastReceiver is registered in the AndroidManifest.xml. When the BroadcastReceiver is created in your own code, prefer constructor injection instead.</p>
</blockquote>
<p>注意：DaggerBroadcastReceiver只能在AndroidManifest.xml中注册BroadcastReceiver时使用。在您自己的代码中创建BroadcastReceiver时，请改为使用构造函数注入。</p>
<h3 id="支持库">支持库</h3>
<blockquote>
<p>For users of the Android support library, parallel types exist in the dagger.android.support package. Note that while support Fragment users have to bind AndroidInjector.Factory&lt;? extends android.support.v4.app.Fragment&gt;, AppCompat users should continue to implement AndroidInjector.Factory&lt;? extends Activity&gt; and not &lt;? extends AppCompatActivity&gt; (or FragmentActivity).</p>
</blockquote>
<p>对于Android支持库的用户，<code>dagger.android.support</code>包中存在并行类型。请注意，尽管支持<code>Fragment</code>的用户必须绑定<code>AndroidInjector.Factory &lt;？extends android.support.v4.app.Fragment&gt;</code>，<code>AppCompat</code>用户应该继续实现<code>AndroidInjector.Factory &lt;？extends Activity&gt;</code>而不是<code>&lt;？extends AppCompatActivity&gt;</code>（或FragmentActivity）。</p>
<h3 id="如何获取它">如何获取它</h3>
<p>将以下内容添加到您的build.gradle中：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-groovy" data-lang="groovy">dependencies <span style="color:#f92672">{</span>
  compile <span style="color:#e6db74">&#39;com.google.dagger:dagger-android:2.x&#39;</span>
  compile <span style="color:#e6db74">&#39;com.google.dagger:dagger-android-support:2.x&#39;</span> <span style="color:#75715e">// if you use the support libraries
</span><span style="color:#75715e"></span>  annotationProcessor <span style="color:#e6db74">&#39;com.google.dagger:dagger-android-processor:2.x&#39;</span>
<span style="color:#f92672">}</span>
</code></pre></div><h3 id="何时注入">何时注入</h3>
<blockquote>
<p>Constructor injection is preferred whenever possible because javac will ensure that no field is referenced before it has been set, which helps avoid NullPointerExceptions. When members injection is required (as discussed above), prefer to inject as early as possible. For this reason, DaggerActivity calls AndroidInjection.inject() immediately in onCreate(), before calling super.onCreate(), and DaggerFragment does the same in onAttach(), which also prevents inconsistencies if the Fragment is reattached.</p>
</blockquote>
<p>只要有可能，构造函数注入是首选，因为javac将确保没有字段在被设置之前被引用，这有助于避免NullPointerException。 当需要成员注射（如上所述）时，倾向于尽早注射。 出于这个原因，DaggerActivity在调用<code>super.onCreate()</code>之前立即在<code>onCreate()</code>中调用AndroidInjection.inject()，并且DaggerFragment在onAttach()中也是这样做的，这也可以防止在重新连接片段时出现不一致。</p>
<blockquote>
<p>It is crucial to call AndroidInjection.inject() before super.onCreate() in an Activity, since the call to super attaches Fragments from the previous activity instance during configuration change, which in turn injects the Fragments. In order for the Fragment injection to succeed, the Activity must already be injected. For users of ErrorProne, it is a compiler error to call AndroidInjection.inject() after super.onCreate().</p>
</blockquote>
<p>在Activity中的super.onCreate()之前调用AndroidInjection.inject()是非常重要的，因为超级调用在配置更改期间将前一个活动实例的碎片连接到Fragments，而这又会导致碎片。 为了使片段注入成功，该活动必须已经被注入。 对于ErrorProne的用户，在super.onCreate()之后调用AndroidInjection.inject()是一个编译器错误。</p>
<h3 id="常见问题">常见问题</h3>
<blockquote>
<p>AndroidInjector.Factory is intended to be a stateless interface so that implementors don’t have to worry about managing state related to the object which will be injected. When DispatchingAndroidInjector requests a AndroidInjector.Factory, it does so through a Provider so that it doesn’t explicitly retain any instances of the factory. Because the AndroidInjector.Builder implementation that is generated by Dagger does retain an instance of the Activity/Fragment/etc that is being injected, it is a compile-time error to apply a scope to the methods which provide them. If you are positive that your AndroidInjector.Factory does not retain an instance to the injected object, you may suppress this error by applying @SuppressWarnings(&ldquo;dagger.android.ScopedInjectoryFactory&rdquo;) to your module method.</p>
</blockquote>
<p>AndroidInjector.Factory旨在成为无状态接口，以便实现者不必担心管理与将被注入的对象相关的状态。 当DispatchingAndroidInjector请求一个AndroidInjector.Factory时，它通过一个Provider来这样做，以便它不明确地保留工厂的任何实例。 由于由Dagger生成的AndroidInjector.Builder实现确实保留了正在被注入的Activity / Fragment /等的实例，因此将范围应用于提供它们的方法时发生编译时错误。 如果你肯定你的AndroidInjector.Factory没有为注入对象保留一个实例，你可以通过在模块方法中应用@SuppressWarnings（“dagger.android.ScopedInjectoryFactory”）来消除这个错误。</p>
<h3 id="有用链接">有用链接</h3>
<ul>
<li><a href="https://medium.com/@iammert/new-android-injector-with-dagger-2-part-1-8baa60152abe">New Android Injector with Dagger 2 — part 1</a></li>
</ul>
                    
                    <HR width="100%" id="EOF">
                    <p style="color:#777;">Last modified on 2018-07-25</p>
                    
                </div>
            </div>
            
            
            <nav class="post-pagination">

                
                <a class="newer-posts" href="https://malinkang.cn/posts/paging-library-overview/">
                    Next<br>Paging 库概述
                </a>
                
                
                
                <a class="older-posts" href="https://malinkang.cn/posts/navigation-implementing/">
                    Previous<br>实现navigation
                </a>
                
            </nav>
            <div class="post-comment-wrapper">
                


<div id="gitalk-container"></div>





            </div>
        </div>
    </div>
</div>

            </div><div id="single-column-footer">
Hugo Theme <a href="https://github.com/amazingrise/hugo-theme-diary">Diary</a> by <a href="https://amazingrise.net">Rise</a>
<br>
Ported from <a href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a>'s <a href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> <br>
<br>

&copy;
	
	This is a customized copyright.
	</div>
    	</div>
    <script src="https://malinkang.cn//js/journal.js"></script>
    </body>
</html>

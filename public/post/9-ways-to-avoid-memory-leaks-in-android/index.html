<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>【译】避免Android中内存泄漏的9种方法 - 人生最可悲的事情，莫过于胸怀大志，却又虚度光阴。</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="malinkang" /><meta name="description" content="原文，本文介绍了，引发内存泄露的常见情况，并给出了对应的修复方法。 I have been an android developer for quite some time now. And I realised（意识到） that most of that time, I tend to spend on adding" /><meta name="keywords" content="Hugo, theme, even" />






<meta name="generator" content="Hugo 0.71.0 with theme even" />


<link rel="canonical" href="https://malinkang.cn/post/9-ways-to-avoid-memory-leaks-in-android/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.ab6ed46f161bdba676da3f071e37b038123f44e7125e330d80fc66955b18aaa5.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="【译】避免Android中内存泄漏的9种方法" />
<meta property="og:description" content="原文，本文介绍了，引发内存泄露的常见情况，并给出了对应的修复方法。 I have been an android developer for quite some time now. And I realised（意识到） that most of that time, I tend to spend on adding" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://malinkang.cn/post/9-ways-to-avoid-memory-leaks-in-android/" />
<meta property="article:published_time" content="2019-06-10T14:33:57+08:00" />
<meta property="article:modified_time" content="2019-06-10T14:33:57+08:00" />
<meta itemprop="name" content="【译】避免Android中内存泄漏的9种方法">
<meta itemprop="description" content="原文，本文介绍了，引发内存泄露的常见情况，并给出了对应的修复方法。 I have been an android developer for quite some time now. And I realised（意识到） that most of that time, I tend to spend on adding">
<meta itemprop="datePublished" content="2019-06-10T14:33:57&#43;08:00" />
<meta itemprop="dateModified" content="2019-06-10T14:33:57&#43;08:00" />
<meta itemprop="wordCount" content="6049">



<meta itemprop="keywords" content="Android," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="【译】避免Android中内存泄漏的9种方法"/>
<meta name="twitter:description" content="原文，本文介绍了，引发内存泄露的常见情况，并给出了对应的修复方法。 I have been an android developer for quite some time now. And I realised（意识到） that most of that time, I tend to spend on adding"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Malinkang&#39;s Blog</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">首页</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">归档</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">标签</li>
      </a>
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">Malinkang&#39;s Blog</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">首页</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">归档</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">标签</a>
      </li>
  </ul>
</nav>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">【译】避免Android中内存泄漏的9种方法</h1>

      <div class="post-meta">
        <span class="post-time"> 2019-06-10 </span>
        
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#什么是内存泄露-what-are-memory-leaks">什么是内存泄露？ （What are memory leaks?）</a></li>
    <li><a href="#那么如何检查我的应用是否泄露so-how-do-i-check-if-my-app-is-leaking">那么，如何检查我的应用是否泄露？(So how do I check if my app is leaking?)</a></li>
    <li><a href="#那么导致内存泄露的常见错误有哪些呢so-what-are-some-of-the-common-mistakes-that-lead-to-memory-leaks">那么，导致内存泄露的常见错误有哪些呢？(So what are some of the common mistakes that lead to memory leaks?)</a>
      <ul>
        <li><a href="#1广播接受者broadcast-receivers">1.广播接受者（Broadcast Receivers:）</a></li>
        <li><a href="#2静态activity或者静态view引用2-static-activity-or-view-reference">2.静态Activity或者静态View引用（2. Static Activity or View Reference:）</a></li>
        <li><a href="#3单例类引用3-singleton-class-reference">3.单例类引用（3. Singleton Class Reference:）</a></li>
        <li><a href="#4内部类引用4-inner-class-reference">4.内部类引用（4. Inner Class Reference:）</a></li>
        <li><a href="#5匿名内部类引用5-anonymous-class-reference">5.匿名内部类引用（5. Anonymous Class Reference:）</a></li>
        <li><a href="#6asynctask引用6-asynctask-reference">6.AsyncTask引用（6. AsyncTask Reference:）</a></li>
        <li><a href="#7handler引用7-handler-reference">7.Handler引用（7. Handler Reference:）</a></li>
        <li><a href="#8线程引用8-threads-reference">8.线程引用（8. Threads Reference:）</a></li>
      </ul>
    </li>
    <li><a href="#9timetask引用9-timertask-reference">9.TimeTask引用（9. TimerTask Reference:）</a></li>
    <li><a href="#更多资料">更多资料</a></li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p><a href="https://android.jlelse.eu/9-ways-to-avoid-memory-leaks-in-android-b6d81648e35e">原文</a>，本文介绍了，引发内存泄露的常见情况，并给出了对应的修复方法。</p>
<blockquote>
<p>I have been an android developer for quite some time now. And I <strong>realised（意识到）</strong> that most of that time, I tend to spend on adding new features to an app or working on visually enhancements of the app, rather than focusing on the core issues like performance and quality.</p>
</blockquote>
<p>我做安卓开发者已经有一段时间了。我意识到，大部分的时间，我倾向于花在为应用添加新功能，或者在应用的视觉增强上，而不是关注性能和质量等核心问题。</p>
<blockquote>
<p>This was me a while back when I would be asked to optimise or refactor code</p>
</blockquote>
<p>这是我前段时间被要求优化或重构代码时的情景</p>
<p><img src="/images/9-ways-to-avoid-memory-leaks-in-android-1.gif" alt=""></p>
<blockquote>
<p>But these things have a way of catching up to you and I spent a long time wishing I had not ignored the important stuff. So in this article, I thought I would focus on one of the most important optimisation techniques in android: Memory leaks.</p>
</blockquote>
<p>但是这些东西有办法让你追上，我花了很长时间希望自己没有忽略重要的东西。所以在这篇文章中，我想我会关注<code>android</code>中最重要的优化技术之一：内存泄漏。</p>
<blockquote>
<p>There are a lot of articles on memory leaks and how to fix them. But when I was learning myself, I found that none of them were in one place and it was hard to keep track of it all. So I thought I would collectively post an article on it so that it might help people in the future.</p>
</blockquote>
<p>关于内存泄漏以及如何解决内存泄漏的文章很多。但是我自己在学习的时候，发现这些文章都不在一个地方，很难全部记录下来。所以我想，我就集体发一篇文章，这样可能会对以后的人有所帮助。</p>
<blockquote>
<p>So let’s begin.</p>
</blockquote>
<p>那么我们开始吧。</p>
<h2 id="什么是内存泄露-what-are-memory-leaks">什么是内存泄露？ （What are memory leaks?）</h2>
<blockquote>
<p>A memory leak happens when memory is allocated but never freed. This means the garbage collector is not able to take out the trash once we are done with the takeout. Initially, this might not be a problem. But imagine if you don’t take the trash out for 2 weeks! The house starts to smell right?</p>
</blockquote>
<p>当内存被分配但从未被释放时，就会发生内存泄漏。这意味着一旦我们吃完了外卖，垃圾回收器就无法回收垃圾。最初，这可能不是一个问题。但试想一下，如果你2个星期都不倒垃圾的话! 家里就开始有味道了吧?</p>
<blockquote>
<p>Similarly, as the user keeps on using our app, the memory also keeps on increasing and if the memory leaks are not plugged, then the unused memory cannot be freed up by the Garbage Collection. So the memory of our app will constantly increase until no more memory can be allocated to our app, leading to OutOfMemoryError which ultimately crashes the app.</p>
</blockquote>
<p>同样，随着用户不断的使用我们的app，内存也会不断的增加，如果不堵住内存泄漏的地方，那么未使用的内存就无法被垃圾回收释放出来。所以我们的应用的内存会不断的增加，直到不能再给我们的应用分配更多的内存，导致<code>OutOfMemoryError</code>，最终导致应用崩溃。</p>
<h2 id="那么如何检查我的应用是否泄露so-how-do-i-check-if-my-app-is-leaking">那么，如何检查我的应用是否泄露？(So how do I check if my app is leaking?)</h2>
<blockquote>
<p>I am sure everyone on the planet is aware of it but just in case, there is an awesome library called LeakyCanary that is great for finding out the leaks in our app along with the stack trace.</p>
</blockquote>
<p>我相信地球上的每个人都知道它，但为了以防万一，有一个很棒的库叫<a href="https://github.com/square/leakcanary">LeakyCanary</a>，它可以很好地找出我们应用程序中的泄漏以及堆栈跟踪。</p>
<h2 id="那么导致内存泄露的常见错误有哪些呢so-what-are-some-of-the-common-mistakes-that-lead-to-memory-leaks">那么，导致内存泄露的常见错误有哪些呢？(So what are some of the common mistakes that lead to memory leaks?)</h2>
<h3 id="1广播接受者broadcast-receivers">1.广播接受者（Broadcast Receivers:）</h3>
<blockquote>
<p>Consider this scenario - you need to register a local broadcast receiver in your activity. If you don’t unregister the broadcast receiver, then it still holds a reference to the activity, even if you close the activity.</p>
</blockquote>
<p>考虑这种情况&ndash;你需要在你的活动中注册一个本地广播接收器。如果你不取消注册广播接收器，那么即使你关闭了<code>activity</code>，它仍然持有对<code>activity</code>的引用。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">BroadcastReceiverLeakActivity</span> <span class="kd">extends</span> <span class="n">AppCompatActivity</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="n">BroadcastReceiver</span> <span class="n">broadcastReceiver</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="nd">@Nullable</span> <span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
        <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_first</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">registerBroadCastReceiver</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">broadcastReceiver</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BroadcastReceiver</span><span class="o">()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onReceive</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">,</span> <span class="n">Intent</span> <span class="n">intent</span><span class="o">)</span> <span class="o">{</span>
                <span class="c1">//your receiver code goes here!
</span><span class="c1"></span>            <span class="o">}</span>
        <span class="o">};</span>
        <span class="n">registerReceiver</span><span class="o">(</span><span class="n">broadcastReceiver</span><span class="o">,</span> <span class="k">new</span> <span class="n">IntentFilter</span><span class="o">(</span><span class="s">&#34;SmsMessage.intent.MAIN&#34;</span><span class="o">));</span>
    <span class="o">}</span>
    
    
    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onStart</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onStart</span><span class="o">();</span>
        <span class="n">registerBroadCastReceiver</span><span class="o">();</span>
    <span class="o">}</span>    


    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onStop</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onStop</span><span class="o">();</span>

        <span class="cm">/*
</span><span class="cm">         * Uncomment this line in order to avoid memory leak.
</span><span class="cm">         * You need to unregister the broadcast receiver since the broadcast receiver keeps a reference of the activity.
</span><span class="cm">         * Now when its time for your Activity to die, the Android framework will call onDestroy() on it
</span><span class="cm">         * but the garbage collector will not be able to remove the instance from memory because the broadcastReceiver
</span><span class="cm">         * is still holding a strong reference to it.
</span><span class="cm">         * */</span>

        <span class="k">if</span><span class="o">(</span><span class="n">broadcastReceiver</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">unregisterReceiver</span><span class="o">(</span><span class="n">broadcastReceiver</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>How to solve this? Always remember to call unregister receiver in onStop() of the activity.</p>
</blockquote>
<p>如何解决这个问题？一定要记得在活动的<code>onStop()</code>中调用<code>unregisterReceiver</code>。</p>
<blockquote>
<p>Note: As Artem Demyanov pointed out, if the broadcast Receiver is registered in onCreate(), then when the app goes into the background and resumed again, the receiver will not be registered again. So it is always good to register the broadcastReceiver in onStart() or onResume() of the activity and unregister in onStop().</p>
</blockquote>
<p>注意：正如Artem Demyanov所指出的，如果广播接收器是在<code>onCreate()</code>中注册的，那么当应用程序进入后台并再次恢复时，接收器将不会被再次注册。所以最好在<code>activity</code>的<code>onStart()</code>或<code>onResume()</code>中注册广播接收器，并在<code>onStop()</code>中取消注册。</p>
<h3 id="2静态activity或者静态view引用2-static-activity-or-view-reference">2.静态Activity或者静态View引用（2. Static Activity or View Reference:）</h3>
<blockquote>
<p>Consider the below example — You are declaring a TextView as static (for whatever reason). If you reference an activity or view directly or indirectly from a static reference, the activity would not be garbage collected after it is destroyed.</p>
</blockquote>
<p>考虑下面的例子&ndash;你正在将一个<code>TextView</code>声明为静态（无论出于什么原因）。如果你直接或间接地从静态引用中引用一个<code>activity</code>或<code>view</code>，该<code>activity</code>在被销毁后不会被垃圾回收。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">StaticReferenceLeakActivity</span> <span class="kd">extends</span> <span class="n">AppCompatActivity</span> <span class="o">{</span>

    <span class="cm">/*  
</span><span class="cm">     * This is a bad idea! 
</span><span class="cm">     */</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="n">TextView</span> <span class="n">textView</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="n">Activity</span> <span class="n">activity</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="nd">@Nullable</span> <span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
        <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_first</span><span class="o">);</span>
        
        
        <span class="n">textView</span> <span class="o">=</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">activity_text</span><span class="o">);</span>
        <span class="n">textView</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="s">&#34;Bad Idea!&#34;</span><span class="o">);</span>
           
        <span class="n">activity</span> <span class="o">=</span> <span class="k">this</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>How to solve this? Always remember to NEVER use static variables for views or activities or contexts.</p>
</blockquote>
<p>如何解决这个问题？永远记住，千万不要使用<code>view</code>或<code>activity</code>或<code>context</code>静态变量。</p>
<h3 id="3单例类引用3-singleton-class-reference">3.单例类引用（3. Singleton Class Reference:）</h3>
<blockquote>
<p>Consider the below example — you have defined a Singleton class as displayed below and you need to pass the context in order to fetch some files from the local storage.</p>
</blockquote>
<p>考虑下面的例子&ndash;你已经定义了一个<code>Singleton</code>类，如下图所示，你需要传递上下文，以便从本地存储中获取一些文件。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SingletonLeakExampleActivity</span> <span class="kd">extends</span> <span class="n">AppCompatActivity</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="n">SingletonSampleClass</span> <span class="n">singletonSampleClass</span><span class="o">;</span>
    
    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="nd">@Nullable</span> <span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
        
    <span class="cm">/* 
</span><span class="cm">     * Option 1: Do not pass activity context to the Singleton class. Instead pass application Context
</span><span class="cm">     */</span>      
        <span class="n">singletonSampleClass</span> <span class="o">=</span> <span class="n">SingletonSampleClass</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
    <span class="o">}</span>
  
    
   <span class="nd">@Override</span>
   <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onDestroy</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onDestroy</span><span class="o">();</span>

    <span class="cm">/* 
</span><span class="cm">     * Option 2: Unregister the singleton class here i.e. if you pass activity context to the Singleton class, 
</span><span class="cm">     * then ensure that when the activity is destroyed, the context in the singleton class is set to null.
</span><span class="cm">     */</span>
     <span class="n">singletonSampleClass</span><span class="o">.</span><span class="na">onDestroy</span><span class="o">();</span>
   <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p><code>SingletonSampleClass.java</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SingletonSampleClass</span> <span class="o">{</span>
  
    <span class="kd">private</span> <span class="n">Context</span> <span class="n">context</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="n">SingletonSampleClass</span> <span class="n">instance</span><span class="o">;</span>
  
    <span class="kd">private</span> <span class="nf">SingletonSampleClass</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">context</span> <span class="o">=</span> <span class="n">context</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">synchronized</span> <span class="kd">static</span> <span class="n">SingletonSampleClass</span> <span class="nf">getInstance</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">instance</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="n">instance</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SingletonSampleClass</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">instance</span><span class="o">;</span>
    <span class="o">}</span>
  
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onDestroy</span><span class="o">()</span> <span class="o">{</span>
       <span class="k">if</span><span class="o">(</span><span class="n">context</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">context</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span> 
       <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>How to solve this?
Option 1: Instead of passing activity context i.e. this to the singleton class, you can pass applicationContext().
Option 2: If you really have to use activity context, then when the activity is destroyed, ensure that the context you passed to the singleton class is set to null.</p>
</blockquote>
<p>如何解决这个问题？</p>
<p>选项一：</p>
<p>如何解决这个问题？</p>
<ul>
<li>方案1：可以不传递活动上下文即这个给单子类，而是传递<code>applicationContext()</code>。</li>
<li>方案2：如果你真的要使用<code>activity</code>上下文，那么当<code>activity</code>被销毁时，确保你传递给单例类的上下文被设置为<code>null</code>。</li>
</ul>
<h3 id="4内部类引用4-inner-class-reference">4.内部类引用（4. Inner Class Reference:）</h3>
<blockquote>
<p>Consider the below example — you have defined a inner class called LeakyClass.java as displayed below and you need to pass the activity in order to redirect to a new activity.</p>
</blockquote>
<p>考虑下面的例子&ndash;你定义了一个名为<code>LeakyClass.java</code>的内部类，如下所示，你需要传递<code>activity</code>来跳转到一个新的<code>activity</code>。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">InnerClassReferenceLeakActivity</span> <span class="kd">extends</span> <span class="n">AppCompatActivity</span> <span class="o">{</span>

  <span class="cm">/* 
</span><span class="cm">   * Mistake Number 1: 
</span><span class="cm">   * Never create a static variable of an inner class
</span><span class="cm">   * Fix I:
</span><span class="cm">   * private LeakyClass leakyClass;
</span><span class="cm">   */</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="n">LeakyClass</span> <span class="n">leakyClass</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="nd">@Nullable</span> <span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
        <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_first</span><span class="o">);</span>
        
        <span class="k">new</span> <span class="n">LeakyClass</span><span class="o">(</span><span class="k">this</span><span class="o">).</span><span class="na">redirectToSecondScreen</span><span class="o">();</span>

        <span class="cm">/*
</span><span class="cm">         * Inner class is defined here
</span><span class="cm">         * */</span>
         <span class="n">leakyClass</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LeakyClass</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
         <span class="n">leakyClass</span><span class="o">.</span><span class="na">redirectToSecondScreen</span><span class="o">();</span>
    <span class="o">}</span>
    
  <span class="cm">/* 
</span><span class="cm">   * Mistake Number 2: 
</span><span class="cm">   * 1. Never create a inner variable of an inner class
</span><span class="cm">   * 2. Never pass an instance of the activity to the inner class
</span><span class="cm">   */</span>       
    <span class="kd">private</span> <span class="kd">class</span> <span class="nc">LeakyClass</span> <span class="o">{</span>
        
        <span class="kd">private</span> <span class="n">Activity</span> <span class="n">activity</span><span class="o">;</span>
        <span class="kd">public</span> <span class="nf">LeakyClass</span><span class="o">(</span><span class="n">Activity</span> <span class="n">activity</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">this</span><span class="o">.</span><span class="na">activity</span> <span class="o">=</span> <span class="n">activity</span><span class="o">;</span>
        <span class="o">}</span>
        
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">redirectToSecondScreen</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">this</span><span class="o">.</span><span class="na">activity</span><span class="o">.</span><span class="na">startActivity</span><span class="o">(</span><span class="k">new</span> <span class="n">Intent</span><span class="o">(</span><span class="n">activity</span><span class="o">,</span> <span class="n">SecondActivity</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>How to solve this?
Option 1: As mentioned before never create a static variable of an inner class.
Option 2: The class should be set to static. Instances of anonymous classes do not hold an implicit reference to their outer class when they are “static”.
Option 3: Use a weakReference of any view/activity. Garbage collector can collect an object if only weak references are pointing towards it.</p>
</blockquote>
<p>如何解决这个问题？</p>
<ul>
<li>方案1：如前所述，千万不要创建一个内类的静态变量。</li>
<li>方案2：应该将类设置为静态。匿名类的实例在 &ldquo;静态 &ldquo;时不会对其外类持有隐式引用。</li>
<li>选项3：使用任何视图/活动的弱引用。如果只有弱引用指向一个对象，垃圾收集器可以收集这个对象。</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">InnerClassReferenceLeakActivity</span> <span class="kd">extends</span> <span class="n">AppCompatActivity</span> <span class="o">{</span>

  <span class="cm">/* 
</span><span class="cm">   * Mistake Number 1: 
</span><span class="cm">   * Never create a static variable of an inner class
</span><span class="cm">   * Fix I:
</span><span class="cm">   */</span>
  <span class="kd">private</span> <span class="n">LeakyClass</span> <span class="n">leakyClass</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="nd">@Nullable</span> <span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
        <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_first</span><span class="o">);</span>
        
        <span class="k">new</span> <span class="n">LeakyClass</span><span class="o">(</span><span class="k">this</span><span class="o">).</span><span class="na">redirectToSecondScreen</span><span class="o">();</span>

        <span class="cm">/*
</span><span class="cm">         * Inner class is defined here
</span><span class="cm">         * */</span>
         <span class="n">leakyClass</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LeakyClass</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
         <span class="n">leakyClass</span><span class="o">.</span><span class="na">redirectToSecondScreen</span><span class="o">();</span>
    <span class="o">}</span>
  
  
    <span class="cm">/*  
</span><span class="cm">     * How to fix the above class:
</span><span class="cm">     * Fix memory leaks:
</span><span class="cm">     * Option 1: The class should be set to static
</span><span class="cm">     * Explanation: Instances of anonymous classes do not hold an implicit reference to their outer class 
</span><span class="cm">     * when they are &#34;static&#34;.
</span><span class="cm">     *
</span><span class="cm">     * Option 2: Use a weakReference of the textview or any view/activity for that matter
</span><span class="cm">     * Explanation: Weak References: Garbage collector can collect an object if only weak references 
</span><span class="cm">     * are pointing towards it.
</span><span class="cm">     * */</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">LeakyClass</span> <span class="o">{</span>
        
        <span class="kd">private</span> <span class="kd">final</span> <span class="n">WeakReference</span><span class="o">&lt;</span><span class="n">Activity</span><span class="o">&gt;</span> <span class="n">messageViewReference</span><span class="o">;</span>
        <span class="kd">public</span> <span class="nf">LeakyClass</span><span class="o">(</span><span class="n">Activity</span> <span class="n">activity</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">this</span><span class="o">.</span><span class="na">activity</span> <span class="o">=</span> <span class="k">new</span> <span class="n">WeakReference</span><span class="o">&lt;&gt;(</span><span class="n">activity</span><span class="o">);</span>
        <span class="o">}</span>
        
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">redirectToSecondScreen</span><span class="o">()</span> <span class="o">{</span>
            <span class="n">Activity</span> <span class="n">activity</span> <span class="o">=</span> <span class="n">messageViewReference</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
            <span class="k">if</span><span class="o">(</span><span class="n">activity</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
               <span class="n">activity</span><span class="o">.</span><span class="na">startActivity</span><span class="o">(</span><span class="k">new</span> <span class="n">Intent</span><span class="o">(</span><span class="n">activity</span><span class="o">,</span> <span class="n">SecondActivity</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>  
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="5匿名内部类引用5-anonymous-class-reference">5.匿名内部类引用（5. Anonymous Class Reference:）</h3>
<blockquote>
<p>This follows the same theory as above. Sample implementation for fixing memory leak is given below:</p>
</blockquote>
<p>这与上面的理论相同。下面给出了修复内存泄漏的实现示例。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">AnonymousClassReferenceLeakActivity</span> <span class="kd">extends</span> <span class="n">AppCompatActivity</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="n">TextView</span> <span class="n">textView</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="nd">@Nullable</span> <span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
        <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_first</span><span class="o">);</span>


        <span class="n">textView</span> <span class="o">=</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">activity_text</span><span class="o">);</span>
        <span class="n">textView</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="n">getString</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">string</span><span class="o">.</span><span class="na">text_inner_class_1</span><span class="o">));</span>
        <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">activity_dialog_btn</span><span class="o">).</span><span class="na">setVisibility</span><span class="o">(</span><span class="n">View</span><span class="o">.</span><span class="na">INVISIBLE</span><span class="o">);</span>

        <span class="cm">/*
</span><span class="cm">         * Runnable class is defined here
</span><span class="cm">         * */</span>
         <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="k">new</span> <span class="n">LeakyRunnable</span><span class="o">(</span><span class="n">textView</span><span class="o">)).</span><span class="na">start</span><span class="o">();</span>
    <span class="o">}</span>



    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">LeakyRunnable</span> <span class="kd">implements</span> <span class="n">Runnable</span> <span class="o">{</span>

        <span class="kd">private</span> <span class="kd">final</span> <span class="n">WeakReference</span><span class="o">&lt;</span><span class="n">TextView</span><span class="o">&gt;</span> <span class="n">messageViewReference</span><span class="o">;</span>
        <span class="kd">private</span> <span class="nf">LeakyRunnable</span><span class="o">(</span><span class="n">TextView</span> <span class="n">textView</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">this</span><span class="o">.</span><span class="na">messageViewReference</span> <span class="o">=</span> <span class="k">new</span> <span class="n">WeakReference</span><span class="o">&lt;&gt;(</span><span class="n">textView</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">5000</span><span class="o">);</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="o">}</span>
            <span class="n">TextView</span> <span class="n">textView</span> <span class="o">=</span> <span class="n">messageViewReference</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
            <span class="k">if</span><span class="o">(</span><span class="n">textView</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">textView</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="s">&#34;Runnable class has completed its work&#34;</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="6asynctask引用6-asynctask-reference">6.AsyncTask引用（6. AsyncTask Reference:）</h3>
<blockquote>
<p>Consider the following example — You are using an asyncTask to get a string value which is used to update the textView in OnPostExecute().</p>
</blockquote>
<p>考虑下面的例子&ndash;你正在使用<code>AsyncTask</code>来获取一个字符串值，这个字符串值在<code>OnPostExecute()</code>中用来更新<code>textView</code>。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">AsyncTaskReferenceLeakActivity</span> <span class="kd">extends</span> <span class="n">AppCompatActivity</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="n">TextView</span> <span class="n">textView</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">BackgroundTask</span> <span class="n">backgroundTask</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="nd">@Nullable</span> <span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
        <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_first</span><span class="o">);</span>

        <span class="cm">/*
</span><span class="cm">         * Executing AsyncTask here!
</span><span class="cm">         * */</span>
        <span class="n">backgroundTask</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BackgroundTask</span><span class="o">(</span><span class="n">textView</span><span class="o">);</span>
        <span class="n">backgroundTask</span><span class="o">.</span><span class="na">execute</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="cm">/*
</span><span class="cm">     * Couple of things we should NEVER do here:
</span><span class="cm">     * Mistake number 1. NEVER reference a class inside the activity. If we definitely need to, we should set the class as static as static inner classes don’t hold
</span><span class="cm">     *    any implicit reference to its parent activity class
</span><span class="cm">     * Mistake number 2. We should always cancel the asyncTask when activity is destroyed. This is because the asyncTask will still be executing even if the activity
</span><span class="cm">     *    is destroyed.
</span><span class="cm">     * Mistake number 3. Never use a direct reference of a view from acitivty inside an asynctask.
</span><span class="cm">     * */</span>
 <span class="kd">private</span> <span class="kd">class</span> <span class="nc">BackgroundTask</span> <span class="kd">extends</span> <span class="n">AsyncTask</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">,</span> <span class="n">Void</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="o">{</span>    
        <span class="nd">@Override</span>
        <span class="kd">protected</span> <span class="n">String</span> <span class="nf">doInBackground</span><span class="o">(</span><span class="n">Void</span><span class="o">...</span> <span class="n">voids</span><span class="o">)</span> <span class="o">{</span>

            <span class="k">try</span> <span class="o">{</span>
                <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">1000</span><span class="o">);</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="o">}</span>
            <span class="k">return</span> <span class="s">&#34;The task is completed!&#34;</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onPostExecute</span><span class="o">(</span><span class="n">String</span> <span class="n">s</span><span class="o">)</span> <span class="o">{</span>
            <span class="kd">super</span><span class="o">.</span><span class="na">onPostExecute</span><span class="o">(</span><span class="n">s</span><span class="o">);</span>
            <span class="n">textView</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="n">s</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>How to solve this?
Option 1: We should always cancel the asyncTask when activity is destroyed. This is because the asyncTask will still be executing even if the activity is destroyed.
Option 2: NEVER reference a class inside the activity. If we definitely need to, we should set the class as static as static inner classes don’t hold any implicit reference to its parent activity class.
Option 3: Use a weakReference of the textview.</p>
</blockquote>
<p>如何解决这个问题？</p>
<ul>
<li>方案1：当activity被销毁时，我们应该总是取消asyncTask。因为即使activity被销毁，asyncTask仍然会执行。</li>
<li>方案2：永远不要在activity内部引用类。如果我们一定要这样做，我们应该把类设置为静态的，因为静态的内部类不会对它的父<code>activity</code>类持有任何隐式引用。</li>
<li>方案3：使用textview的弱引用。</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">AsyncTaskReferenceLeakActivity</span> <span class="kd">extends</span> <span class="n">AppCompatActivity</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="n">TextView</span> <span class="n">textView</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">BackgroundTask</span> <span class="n">backgroundTask</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="nd">@Nullable</span> <span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
        <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_first</span><span class="o">);</span>

        <span class="cm">/*
</span><span class="cm">         * Executing AsyncTask here!
</span><span class="cm">         * */</span>
        <span class="n">backgroundTask</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BackgroundTask</span><span class="o">(</span><span class="n">textView</span><span class="o">);</span>
        <span class="n">backgroundTask</span><span class="o">.</span><span class="na">execute</span><span class="o">();</span>
    <span class="o">}</span>


    <span class="cm">/*
</span><span class="cm">     * Fix number 1
</span><span class="cm">     * */</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">BackgroundTask</span> <span class="kd">extends</span> <span class="n">AsyncTask</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">,</span> <span class="n">Void</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="o">{</span>

        <span class="kd">private</span> <span class="kd">final</span> <span class="n">WeakReference</span><span class="o">&lt;</span><span class="n">TextView</span><span class="o">&gt;</span> <span class="n">messageViewReference</span><span class="o">;</span>
        <span class="kd">private</span> <span class="nf">BackgroundTask</span><span class="o">(</span><span class="n">TextView</span> <span class="n">textView</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">this</span><span class="o">.</span><span class="na">messageViewReference</span> <span class="o">=</span> <span class="k">new</span> <span class="n">WeakReference</span><span class="o">&lt;&gt;(</span><span class="n">textView</span><span class="o">);</span>
        <span class="o">}</span>


        <span class="nd">@Override</span>
        <span class="kd">protected</span> <span class="n">String</span> <span class="nf">doInBackground</span><span class="o">(</span><span class="n">Void</span><span class="o">...</span> <span class="n">voids</span><span class="o">)</span> <span class="o">{</span>

            <span class="k">try</span> <span class="o">{</span>
                <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">1000</span><span class="o">);</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="o">}</span>
            <span class="k">return</span> <span class="s">&#34;The task is completed!&#34;</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onPostExecute</span><span class="o">(</span><span class="n">String</span> <span class="n">s</span><span class="o">)</span> <span class="o">{</span>
            <span class="kd">super</span><span class="o">.</span><span class="na">onPostExecute</span><span class="o">(</span><span class="n">s</span><span class="o">);</span>
          <span class="cm">/*
</span><span class="cm">           * Fix number 3
</span><span class="cm">           * */</span>          
            <span class="n">TextView</span> <span class="n">textView</span> <span class="o">=</span> <span class="n">messageViewReference</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
            <span class="k">if</span><span class="o">(</span><span class="n">textView</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">textView</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="n">s</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onDestroy</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onDestroy</span><span class="o">();</span>

        <span class="cm">/*
</span><span class="cm">         * Fix number 2
</span><span class="cm">         * */</span>
        <span class="k">if</span><span class="o">(</span><span class="n">backgroundTask</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">backgroundTask</span><span class="o">.</span><span class="na">cancel</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="7handler引用7-handler-reference">7.Handler引用（7. Handler Reference:）</h3>
<blockquote>
<p>Consider the following example — You are using a Handler to redirect to a new screen after 5 seconds.</p>
</blockquote>
<p>考虑以下例子&ndash;你正在使用一个处理程序在5秒后跳转到一个新的界面。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">HandlersReferenceLeakActivity</span> <span class="kd">extends</span> <span class="n">AppCompatActivity</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="n">TextView</span> <span class="n">textView</span><span class="o">;</span>

    <span class="cm">/*
</span><span class="cm">     * Mistake Number 1
</span><span class="cm">     * */</span>
     <span class="kd">private</span> <span class="n">Handler</span> <span class="n">leakyHandler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Handler</span><span class="o">();</span>


    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="nd">@Nullable</span> <span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
        <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_first</span><span class="o">);</span>

        <span class="cm">/*
</span><span class="cm">         * Mistake Number 2
</span><span class="cm">         * */</span>
        <span class="n">leakyHandler</span><span class="o">.</span><span class="na">postDelayed</span><span class="o">(</span><span class="k">new</span> <span class="n">Runnable</span><span class="o">()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
                <span class="n">textView</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="n">getString</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">string</span><span class="o">.</span><span class="na">text_handler_1</span><span class="o">));</span>
            <span class="o">}</span>
        <span class="o">},</span> <span class="n">5000</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>How to solve this?
Option 1: NEVER reference a class inside the activity. If we definitely need to, we should set the class as static. This is because when a Handler is instantiated on the main thread, it is associated with the Looper’s message queue. Messages posted to the message queue will hold a reference to the Handler so that the framework can call Handler#handleMessage(Message) when the Looper eventually processes the message.
Option 2: Use a weakReference of the Activity.</p>
</blockquote>
<p>如何解决这个问题？</p>
<ul>
<li>方案一：永远不要在活动里面引用类。如果一定要引用，我们应该将类设置为静态。这是因为当在主线程上实例化一个Handler时，它会与Looper的消息队列相关联。发布到消息队列中的消息将持有对Handler的引用，这样当Looper最终处理消息时，框架可以调用Handler#handleMessage(Message)。</li>
<li>方案2：使用Activity的弱引用。</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">HandlersReferenceLeakActivity</span> <span class="kd">extends</span> <span class="n">AppCompatActivity</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="n">TextView</span> <span class="n">textView</span><span class="o">;</span>

    <span class="cm">/*
</span><span class="cm">     * Fix number I
</span><span class="cm">     * */</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">LeakyHandler</span> <span class="n">leakyHandler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LeakyHandler</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="nd">@Nullable</span> <span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
        <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_first</span><span class="o">);</span>

        <span class="n">leakyHandler</span><span class="o">.</span><span class="na">postDelayed</span><span class="o">(</span><span class="n">leakyRunnable</span><span class="o">,</span> <span class="n">5000</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="cm">/*
</span><span class="cm">     * Fix number II - define as static
</span><span class="cm">     * */</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">LeakyHandler</span> <span class="kd">extends</span> <span class="n">Handler</span> <span class="o">{</span>
      
    <span class="cm">/*
</span><span class="cm">     * Fix number III - Use WeakReferences
</span><span class="cm">     * */</span>      
        <span class="kd">private</span> <span class="n">WeakReference</span><span class="o">&lt;</span><span class="n">HandlersReferenceLeakActivity</span><span class="o">&gt;</span> <span class="n">weakReference</span><span class="o">;</span>
        <span class="kd">public</span> <span class="nf">LeakyHandler</span><span class="o">(</span><span class="n">HandlersReferenceLeakActivity</span> <span class="n">activity</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">weakReference</span> <span class="o">=</span> <span class="k">new</span> <span class="n">WeakReference</span><span class="o">&lt;&gt;(</span><span class="n">activity</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">handleMessage</span><span class="o">(</span><span class="n">Message</span> <span class="n">msg</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">HandlersReferenceLeakActivity</span> <span class="n">activity</span> <span class="o">=</span> <span class="n">weakReference</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">activity</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">activity</span><span class="o">.</span><span class="na">textView</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="n">activity</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">string</span><span class="o">.</span><span class="na">text_handler_2</span><span class="o">));</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Runnable</span> <span class="n">leakyRunnable</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Runnable</span><span class="o">()</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span> <span class="cm">/* ... */</span> <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="8线程引用8-threads-reference">8.线程引用（8. Threads Reference:）</h3>
<blockquote>
<p>We can repeat this same mistake again with both the Thread and TimerTask classes.</p>
</blockquote>
<p>我们可以在Thread和TimerTask两个类中再次重复这个错误。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ThreadReferenceLeakActivity</span> <span class="kd">extends</span> <span class="n">AppCompatActivity</span> <span class="o">{</span>

    <span class="cm">/*  
</span><span class="cm">     * Mistake Number 1: Do not use static variables
</span><span class="cm">     * */</span>    
    <span class="kd">private</span> <span class="kd">static</span> <span class="n">LeakyThread</span> <span class="n">thread</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="nd">@Nullable</span> <span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
        <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_first</span><span class="o">);</span>

        <span class="n">createThread</span><span class="o">();</span>
        <span class="n">redirectToNewScreen</span><span class="o">();</span>
    <span class="o">}</span>


    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">createThread</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">thread</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LeakyThread</span><span class="o">();</span>
        <span class="n">thread</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">redirectToNewScreen</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">startActivity</span><span class="o">(</span><span class="k">new</span> <span class="n">Intent</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">SecondActivity</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>
    <span class="o">}</span>


    <span class="cm">/*
</span><span class="cm">     * Mistake Number 2: Non-static anonymous classes hold an 
</span><span class="cm">     * implicit reference to their enclosing class.
</span><span class="cm">     * */</span>
    <span class="kd">private</span> <span class="kd">class</span> <span class="nc">LeakyThread</span> <span class="kd">extends</span> <span class="n">Thread</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>How to solve this?
Option 1: Non-static anonymous classes hold an implicit reference to their enclosing class.
Option 2: Close thread in activity onDestroy() to avoid thread leak.</p>
</blockquote>
<p>如何解决这个问题？</p>
<ul>
<li>方案1：非静态匿名类对其包围类持有一个隐式引用。</li>
<li>方案2：在onDestroy()活动中关闭线程，避免线程泄漏。</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ThreadReferenceLeakActivity</span> <span class="kd">extends</span> <span class="n">AppCompatActivity</span> <span class="o">{</span>

    <span class="cm">/*
</span><span class="cm">     * FIX I: make variable non static
</span><span class="cm">     * */</span>
    <span class="kd">private</span> <span class="n">LeakyThread</span> <span class="n">leakyThread</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LeakyThread</span><span class="o">();</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="nd">@Nullable</span> <span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
        <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_first</span><span class="o">);</span>

        <span class="n">createThread</span><span class="o">();</span>
        <span class="n">redirectToNewScreen</span><span class="o">();</span>
    <span class="o">}</span>


    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">createThread</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">leakyThread</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">redirectToNewScreen</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">startActivity</span><span class="o">(</span><span class="k">new</span> <span class="n">Intent</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">SecondActivity</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onDestroy</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onDestroy</span><span class="o">();</span>
        <span class="c1">// FIX II: kill the thread
</span><span class="c1"></span>        <span class="n">leakyThread</span><span class="o">.</span><span class="na">interrupt</span><span class="o">();</span>
    <span class="o">}</span>


    <span class="cm">/*
</span><span class="cm">     * Fix III: Make thread static
</span><span class="cm">     * */</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">LeakyThread</span> <span class="kd">extends</span> <span class="n">Thread</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">while</span> <span class="o">(!</span><span class="n">isInterrupted</span><span class="o">())</span> <span class="o">{</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="9timetask引用9-timertask-reference">9.TimeTask引用（9. TimerTask Reference:）</h2>
<blockquote>
<p>The same principle is as Threads can be followed for TimerTask as well. Sample implementation for fixing memory leak is given below:</p>
</blockquote>
<p>TimerTask也可以遵循与Threads相同的原理。下面给出了修复内存泄漏的实现示例。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TimerTaskReferenceLeakActivity</span> <span class="kd">extends</span> <span class="n">Activity</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="n">CountDownTimer</span> <span class="n">countDownTimer</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="nd">@Nullable</span> <span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
        <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_first</span><span class="o">);</span>

        <span class="n">startTimer</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="cm">/*  
</span><span class="cm">     * Mistake 1: Cancel Timer is never called 
</span><span class="cm">     * even though activity might be completed
</span><span class="cm">     * */</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">cancelTimer</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">if</span><span class="o">(</span><span class="n">countDownTimer</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="n">countDownTimer</span><span class="o">.</span><span class="na">cancel</span><span class="o">();</span>
    <span class="o">}</span>

    
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">startTimer</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">countDownTimer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CountDownTimer</span><span class="o">(</span><span class="n">1000</span><span class="o">,</span> <span class="n">1000</span><span class="o">)</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onTick</span><span class="o">(</span><span class="kt">long</span> <span class="n">millisUntilFinished</span><span class="o">)</span> <span class="o">{</span>
                <span class="kd">final</span> <span class="kt">int</span> <span class="n">secondsRemaining</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="o">(</span><span class="n">millisUntilFinished</span> <span class="o">/</span> <span class="n">1000</span><span class="o">);</span>
                <span class="c1">//update UI
</span><span class="c1"></span>            <span class="o">}</span>

            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onFinish</span><span class="o">()</span> <span class="o">{</span>
                <span class="c1">//handle onFinish
</span><span class="c1"></span>            <span class="o">}</span>
        <span class="o">};</span>
        <span class="n">countDownTimer</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>How to solve this?
Option 1: Cancel timer in activity onDestroy() to avoid memory leak.</p>
</blockquote>
<p>如何解决这个问题？
方案1：在<code>activity</code>的<code>onDestroy()</code>中取消定时器，避免内存泄漏。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TimerTaskReferenceLeakActivity</span> <span class="kd">extends</span> <span class="n">Activity</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="n">CountDownTimer</span> <span class="n">countDownTimer</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="nd">@Nullable</span> <span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
        <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_first</span><span class="o">);</span>

        <span class="n">startTimer</span><span class="o">();</span>
    <span class="o">}</span>


    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">cancelTimer</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">if</span><span class="o">(</span><span class="n">countDownTimer</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="n">countDownTimer</span><span class="o">.</span><span class="na">cancel</span><span class="o">();</span>
    <span class="o">}</span>


    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">startTimer</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">countDownTimer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CountDownTimer</span><span class="o">(</span><span class="n">1000</span><span class="o">,</span> <span class="n">1000</span><span class="o">)</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onTick</span><span class="o">(</span><span class="kt">long</span> <span class="n">millisUntilFinished</span><span class="o">)</span> <span class="o">{</span>
                <span class="kd">final</span> <span class="kt">int</span> <span class="n">secondsRemaining</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="o">(</span><span class="n">millisUntilFinished</span> <span class="o">/</span> <span class="n">1000</span><span class="o">);</span>
                <span class="c1">//update UI
</span><span class="c1"></span>            <span class="o">}</span>

            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onFinish</span><span class="o">()</span> <span class="o">{</span>
                <span class="c1">//handle onFinish
</span><span class="c1"></span>            <span class="o">}</span>
        <span class="o">};</span>
        <span class="n">countDownTimer</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
    <span class="o">}</span>
  
  
    <span class="cm">/*
</span><span class="cm">     * Fix 1: Cancel Timer when 
</span><span class="cm">     * activity might be completed
</span><span class="cm">     * */</span>  
   <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onDestroy</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onDestroy</span><span class="o">();</span>
        <span class="n">cancelTimer</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>So basically to summarise:</p>
</blockquote>
<ol>
<li>Use applicationContext() instead of activity context when possible. If you really have to use activity context, then when the activity is destroyed, ensure that the context you passed to the class is set to null.</li>
<li>Never use static variables to declare views or activity context.</li>
<li>Never reference a class inside the activity. If we need to, we should declare it as static, whether it is a thread or a handler or a timer or an asyncTask.</li>
<li>Always make sure to unregister broadcastReceivers or timers inside the activity. Cancel any asyncTasks or Threads inside onDestroy().</li>
<li>Always use a weakReference of the activity or view when needed.</li>
</ol>
<p>所以基本上要总结一下。</p>
<ol>
<li>尽可能使用applicationContext()来代替活动上下文。如果你真的要使用活动上下文，那么当活动被销毁时，确保你传递给类的上下文被设置为null。</li>
<li>千万不要使用静态变量来声明view或activity上下文。</li>
<li>千万不要在活动内部引用类。如果需要，我们应该将其声明为静态，不管它是线程还是处理程序，还是定时器或asyncTask。</li>
<li>一定要确保在activity里面取消注册broadcastReceivers或定时器。在onDestroy()里面取消任何asyncTask或Threads。</li>
<li>在需要的时候，一定要使用活动或视图的弱引用。</li>
</ol>
<blockquote>
<p>And that’s it folks! Thanks for reading! I hope you enjoyed this article and found it useful, if so please hit the Clap button. Let me know your thoughts in the comments section.
Happy coding!</p>
</blockquote>
<p>就这样了，朋友们! 谢谢大家的阅读! 我希望你喜欢这篇文章，并发现它是有用的，如果是这样，请点击拍手按钮。在评论区告诉我你的想法。
祝你编码愉快。</p>
<h2 id="更多资料">更多资料</h2>
<ul>
<li><a href="https://www.youtube.com/watch?v=BkbHeFHn8JY">DO NOT LEAK VIEWS (Android Performance Patterns Season 3 ep6)</a></li>
</ul>

    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content">malinkang</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">
        2019-06-10
        
    </span>
  </p>
  
  
</div>
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/android/">Android</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/android-activity-launch-process/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Activity的启动流程</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        <a class="next" href="/post/android-handler/">
            <span class="next-text nav-default">Handler的使用和原理分析</span>
            <span class="next-text nav-mobile">下一篇</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        <div id="disqus_thread"></div>
    <script type="text/javascript">
    (function() {
      
      
      if (window.location.hostname === 'localhost') return;

      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      var disqus_shortname = 'malinkang-cn';
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="https://twitter.com/malinkang" class="iconfont icon-twitter" title="twitter"></a>
      <a href="https://github.com/malinkang" class="iconfont icon-github" title="github"></a>
      <a href="https://weibo.com/malinkang" class="iconfont icon-weibo" title="weibo"></a>
  <a href="https://malinkang.cn/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" href="https://gohugo.io">Hugo</a> 强力驱动
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    主题 - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2017 - 
    2020
    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">malinkang</span>
  </span>
</div>
    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.d7b7ada643c9c1a983026e177f141f7363b4640d619caf01d8831a6718cd44ea.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      showProcessingMessages: false,
      messageStyle: 'none'
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"  integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>








</body>
</html>

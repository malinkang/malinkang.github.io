<!DOCTYPE html>
<html><head>
<title>ButterKnife源码分析</title>

<meta charset="utf-8">
<meta name="X-UA-Compatible" content="IE=edge">
<meta name="google-site-verification" content="">
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
<meta content="telephone=no" name="format-detection">
<meta name="description" content="">
<meta name="renderer" content="webkit">
<meta name="theme-color" content="#ffffff">




<script src="/vendor/js/jquery.min.js" ></script>
<script src="/vendor/js/popper.min.js" ></script>
<script src="/vendor/js/bootstrap.min.js" ></script>
<script src="/vendor/js/smooth-scroll.polyfills.min.js" ></script>
<link type="text/css" rel="stylesheet" href="/vendor/css/bootstrap.min.css">
<script src="/vendor/js/vue.min.js" ></script>




<link rel="stylesheet" href="https://malinkang.cn/scss/journal.min.56b67b8b01d7cd1015ed14414fd2fc33ebfb2e8413dcbc47c5cd734544c92cd7.css" integrity="sha256-VrZ7iwHXzRAV7RRBT9L8M&#43;v7LoQT3LxHxc1zRUTJLNc=" media="screen">



<link rel="stylesheet" href="https://malinkang.cn/scss/dark-mode.min.5a2bbd1758c83affd639a91fbfd5cc681b1a5574df99442825c444dd40504b13.css" integrity="sha256-Wiu9F1jIOv/WOakfv9XMaBsaVXTfmUQoJcRE3UBQSxM=" media="screen">


<script src="https://malinkang.cn//js/loadCSS.js"></script>
<script>
  loadCSS("https://fonts.googleapis.com/css?family=Lora|Montserrat|Fira+Mono|Noto+Serif+SC|Material+Icons");
</script>

<script src="https://malinkang.cn//js/table.js"></script>




<script src="https://malinkang.cn//js/toc.js"></script>



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
<script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
<script src="/vendor/js/md5.min.js"></script>
<script>
  var gitalk = new Gitalk({
  clientID: 'd84786eae9edb9e6521b',
  clientSecret: 'a30a17b679a15e85b8f257eec4231d5b286e1b58',
  repo: 'malinkang.github.io',
  owner: 'malinkang',
  admin: ['malinkang'],
  id: md5(location.pathname),
  distractionFreeMode: 'false'
  });
  window.onload = function () {
        gitalk.render('gitalk-container')
  }
</script>






</head><body>
    	<div id="app"><div ref="sideContainer" class="side-container">
    
    <a class="a-block nav-head false" href="https://malinkang.cn/">
    
        <div class="nav-title">
            Malinkang‘s Blog
        </div>
        
        <div class="nav-subtitle">
            人生最可悲的事情，莫过于胸怀大志，却又虚度光阴。
        </div>
        
    </a>

    <div class="nav-link-list">
        
        
            
            
            
                
            
            
            
            <a class="a-block nav-link-item active" href="/posts">
                Archive
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="https://android.malinkang.cn">
                Android笔记
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="https://kotlin.malinkang.cn">
                Kotlin笔记
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/index.xml">
                RSS Feed
            </a>
            
        
    </div>

    

    <div class="nav-footer">
        
Hugo Theme <a href="https://github.com/amazingrise/hugo-theme-diary">Diary</a> by <a href="https://amazingrise.net">Rise</a>
<br>
Ported from <a href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a>'s <a href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> <br>
<br>

&copy;
	
	This is a customized copyright.
	
    </div>
    
</div><div ref="extraContainer" class="extra-container">
    
    
    <div class="toc animated-visibility" :class="{ invisible: scrollY <= 140 }">


	<div class="toc-content">
	
		
		
		
		<center>- CATALOG -</center>
			
				
				
					
						
						
							<ul>
						
							<ul>
						
							<ul>
						
						
								<li>
				 					<a href="#%e5%8a%9f%e8%83%bd%e4%bb%8b%e7%bb%8d" v-on:click="closeDrawer" id="功能介绍-nav">
										 功能介绍
									</a>
								</li>
						
							</ul>
						
							</ul>
						
							</ul>
						
					
				
			
				
				
					
						
						
							<ul>
						
							<ul>
						
							<ul>
						
						
								<li>
				 					<a href="#%e5%9f%ba%e6%9c%ac%e4%bd%bf%e7%94%a8" v-on:click="closeDrawer" id="基本使用-nav">
										 基本使用
									</a>
								</li>
						
							</ul>
						
							</ul>
						
							</ul>
						
					
				
			
				
				
					
						
						
							<ul>
						
							<ul>
						
							<ul>
						
						
								<li>
				 					<a href="#%e5%9f%ba%e6%9c%ac%e5%8e%9f%e7%90%86" v-on:click="closeDrawer" id="基本原理-nav">
										 基本原理
									</a>
								</li>
						
							</ul>
						
							</ul>
						
							</ul>
						
					
				
			
				
				
					
						
						
							<ul>
						
							<ul>
						
							<ul>
						
						
								<li>
				 					<a href="#%e8%8e%b7%e5%8f%96%e6%b3%a8%e8%a7%a3%e4%bf%a1%e6%81%af" v-on:click="closeDrawer" id="获取注解信息-nav">
										 获取注解信息
									</a>
								</li>
						
							</ul>
						
							</ul>
						
							</ul>
						
					
				
			
				
				
					
						
						
							<ul>
						
							<ul>
						
							<ul>
						
						
								<li>
				 					<a href="#%e7%94%9f%e6%88%90%e4%bb%a3%e7%a0%81" v-on:click="closeDrawer" id="生成代码-nav">
										 生成代码
									</a>
								</li>
						
							</ul>
						
							</ul>
						
							</ul>
						
					
				
			
				
				
					
						
						
							<ul>
						
							<ul>
						
							<ul>
						
						
								<li>
				 					<a href="#butterknife%e7%9a%84bind%e6%96%b9%e6%b3%95" v-on:click="closeDrawer" id="butterknife的bind方法-nav">
										 ButterKnife的bind方法
									</a>
								</li>
						
							</ul>
						
							</ul>
						
							</ul>
						
					
				
			
	</div>

</div>
    
    <div class="pagination">
        <a id="globalBackToTop" class="pagination-action animated-visibility" href="#top" :class="{ invisible: scrollY == 0 }">
            <i class="material-icons pagination-action-icon">
                keyboard_arrow_up
            </i>
        </a>
        
        <a class="pagination-action" v-on:click="toggleDarkMode">
            <i class="material-icons pagination-action-icon" v-if="isDarkMode">
                brightness_4
            </i>
            <i class="material-icons pagination-action-icon" v-else="isDarkMode">
                brightness_7
            </i>
        </a>
        
        
    </div>
</div><div class="single-column-drawer-container" ref="drawer"
     v-bind:class="{ 'single-column-drawer-container-active': isDrawerOpen }">
    <div class="drawer-content">
        <div class="drawer-menu">
            
            
            
                
                
                
                    
                
                
                
                <a class="a-block drawer-menu-item active" href="/posts">
                    Archive
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="https://android.malinkang.cn">
                    Android笔记
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="https://kotlin.malinkang.cn">
                    Kotlin笔记
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/index.xml">
                    RSS Feed
                </a>
                
            
            
            <div class="toc">


	<div class="toc-content">
	
		
		
		
		<center>- CATALOG -</center>
			
				
				
					
						
						
							<ul>
						
							<ul>
						
							<ul>
						
						
								<li>
				 					<a href="#%e5%8a%9f%e8%83%bd%e4%bb%8b%e7%bb%8d" v-on:click="closeDrawer" id="功能介绍-nav">
										 功能介绍
									</a>
								</li>
						
							</ul>
						
							</ul>
						
							</ul>
						
					
				
			
				
				
					
						
						
							<ul>
						
							<ul>
						
							<ul>
						
						
								<li>
				 					<a href="#%e5%9f%ba%e6%9c%ac%e4%bd%bf%e7%94%a8" v-on:click="closeDrawer" id="基本使用-nav">
										 基本使用
									</a>
								</li>
						
							</ul>
						
							</ul>
						
							</ul>
						
					
				
			
				
				
					
						
						
							<ul>
						
							<ul>
						
							<ul>
						
						
								<li>
				 					<a href="#%e5%9f%ba%e6%9c%ac%e5%8e%9f%e7%90%86" v-on:click="closeDrawer" id="基本原理-nav">
										 基本原理
									</a>
								</li>
						
							</ul>
						
							</ul>
						
							</ul>
						
					
				
			
				
				
					
						
						
							<ul>
						
							<ul>
						
							<ul>
						
						
								<li>
				 					<a href="#%e8%8e%b7%e5%8f%96%e6%b3%a8%e8%a7%a3%e4%bf%a1%e6%81%af" v-on:click="closeDrawer" id="获取注解信息-nav">
										 获取注解信息
									</a>
								</li>
						
							</ul>
						
							</ul>
						
							</ul>
						
					
				
			
				
				
					
						
						
							<ul>
						
							<ul>
						
							<ul>
						
						
								<li>
				 					<a href="#%e7%94%9f%e6%88%90%e4%bb%a3%e7%a0%81" v-on:click="closeDrawer" id="生成代码-nav">
										 生成代码
									</a>
								</li>
						
							</ul>
						
							</ul>
						
							</ul>
						
					
				
			
				
				
					
						
						
							<ul>
						
							<ul>
						
							<ul>
						
						
								<li>
				 					<a href="#butterknife%e7%9a%84bind%e6%96%b9%e6%b3%95" v-on:click="closeDrawer" id="butterknife的bind方法-nav">
										 ButterKnife的bind方法
									</a>
								</li>
						
							</ul>
						
							</ul>
						
							</ul>
						
					
				
			
	</div>

</div>
            
        </div>
    </div>
</div>
<transition name="fade">
    <div v-bind:class="{ 'single-column-drawer-mask': mounted }" v-if="isDrawerOpen" v-on:click="toggleDrawer"></div>
</transition>
<nav ref="navBar" class="navbar sticky-top navbar-light single-column-nav-container">
    <div ref="navBackground" class="nav-background"></div>
    <div class="container container-narrow nav-content">
        <button id="nav_dropdown_btn" class="nav-dropdown-toggle" type="button" v-on:click="toggleDrawer">
            <i class="material-icons">
                menu
            </i>
        </button>
        <a ref="navTitle" class="navbar-brand" href="https://malinkang.cn/">
            Malinkang‘s Blog
        </a>
        
        <button type="button" class="nav-darkmode-toggle" v-on:click="toggleDarkMode">
            <i class="material-icons" v-if="isDarkMode">
                brightness_4
            </i>
            <i class="material-icons" v-else="isDarkMode">
                brightness_7
            </i>
        </button>
        
    </div>
</nav>
<div class="single-column-header-container" ref="pageHead"
     v-bind:style="{ transform: 'translateZ(0px) translateY('+.3*scrollY+'px)', opacity: 1-navOpacity }">
    <a href="https://malinkang.cn/">
        <div class="single-column-header-title">Malinkang‘s Blog</div>
        
        <div class="single-column-header-subtitle">人生最可悲的事情，莫过于胸怀大志，却又虚度光阴。</div>
        

    </a>
</div>
            <div id="content">
<div ref="streamContainer" class="stream-container">
    <div class="post-list-container post-list-container-shadow">
        <div class="post">
            
            
            

            <div class="post-head-wrapper-text-only"
                
            >
                <div class="post-title">
                    ButterKnife源码分析
                    
                    <div class="post-meta">
                        
                        <time itemprop="datePublished">
                            2015-04-19 10:40
                        </time>
                        

                        

                        
                        
                    </div>
                </div>
            </div>
            
            <div class="post-body-wrapper">
                <div class="post-body">
                    <h3 id="功能介绍">功能介绍</h3>
<p>在Android中，我们从布局文件中获取一个view一般通过findViewById方法来操作，当一个界面里view过多的时候，我们需要花费大量的时间来写这些样板代码。ButterKnife用于来简化这个操作的，只需要在相应的View上加一个注解，框架就会注入这些字段。</p>
<h3 id="基本使用">基本使用</h3>
<p>在Activity中使用</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ExampleActivity</span> <span style="color:#66d9ef">extends</span> Activity <span style="color:#f92672">{</span>
  <span style="color:#a6e22e">@Bind</span><span style="color:#f92672">(</span>R<span style="color:#f92672">.</span><span style="color:#a6e22e">id</span><span style="color:#f92672">.</span><span style="color:#a6e22e">title</span><span style="color:#f92672">)</span> TextView title<span style="color:#f92672">;</span>
  <span style="color:#a6e22e">@Bind</span><span style="color:#f92672">(</span>R<span style="color:#f92672">.</span><span style="color:#a6e22e">id</span><span style="color:#f92672">.</span><span style="color:#a6e22e">subtitle</span><span style="color:#f92672">)</span> TextView subtitle<span style="color:#f92672">;</span>
  <span style="color:#a6e22e">@Bind</span><span style="color:#f92672">(</span>R<span style="color:#f92672">.</span><span style="color:#a6e22e">id</span><span style="color:#f92672">.</span><span style="color:#a6e22e">footer</span><span style="color:#f92672">)</span> TextView footer<span style="color:#f92672">;</span>

  <span style="color:#a6e22e">@Override</span> <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">onCreate</span><span style="color:#f92672">(</span>Bundle savedInstanceState<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">super</span><span style="color:#f92672">.</span><span style="color:#a6e22e">onCreate</span><span style="color:#f92672">(</span>savedInstanceState<span style="color:#f92672">);</span>
    setContentView<span style="color:#f92672">(</span>R<span style="color:#f92672">.</span><span style="color:#a6e22e">layout</span><span style="color:#f92672">.</span><span style="color:#a6e22e">simple_activity</span><span style="color:#f92672">);</span>
    ButterKnife<span style="color:#f92672">.</span><span style="color:#a6e22e">bind</span><span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">);</span>
    <span style="color:#75715e">// TODO Use fields...
</span><span style="color:#75715e"></span>  <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>在Fragment中使用</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">FancyFragment</span> <span style="color:#66d9ef">extends</span> Fragment <span style="color:#f92672">{</span>
  <span style="color:#a6e22e">@Bind</span><span style="color:#f92672">(</span>R<span style="color:#f92672">.</span><span style="color:#a6e22e">id</span><span style="color:#f92672">.</span><span style="color:#a6e22e">button1</span><span style="color:#f92672">)</span> Button button1<span style="color:#f92672">;</span>
  <span style="color:#a6e22e">@Bind</span><span style="color:#f92672">(</span>R<span style="color:#f92672">.</span><span style="color:#a6e22e">id</span><span style="color:#f92672">.</span><span style="color:#a6e22e">button2</span><span style="color:#f92672">)</span> Button button2<span style="color:#f92672">;</span>

  <span style="color:#a6e22e">@Override</span> <span style="color:#66d9ef">public</span> View <span style="color:#a6e22e">onCreateView</span><span style="color:#f92672">(</span>LayoutInflater inflater<span style="color:#f92672">,</span> ViewGroup container<span style="color:#f92672">,</span> Bundle savedInstanceState<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    View view <span style="color:#f92672">=</span> inflater<span style="color:#f92672">.</span><span style="color:#a6e22e">inflate</span><span style="color:#f92672">(</span>R<span style="color:#f92672">.</span><span style="color:#a6e22e">layout</span><span style="color:#f92672">.</span><span style="color:#a6e22e">fancy_fragment</span><span style="color:#f92672">,</span> container<span style="color:#f92672">,</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">);</span>
    ButterKnife<span style="color:#f92672">.</span><span style="color:#a6e22e">bind</span><span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">,</span> view<span style="color:#f92672">);</span>
    <span style="color:#75715e">// TODO Use fields...
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">return</span> view<span style="color:#f92672">;</span>
  <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>Adapter中使用</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MyAdapter</span> <span style="color:#66d9ef">extends</span> BaseAdapter <span style="color:#f92672">{</span>
  <span style="color:#a6e22e">@Override</span> <span style="color:#66d9ef">public</span> View <span style="color:#a6e22e">getView</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> position<span style="color:#f92672">,</span> View view<span style="color:#f92672">,</span> ViewGroup parent<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    ViewHolder holder<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>view <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
      holder <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>ViewHolder<span style="color:#f92672">)</span> view<span style="color:#f92672">.</span><span style="color:#a6e22e">getTag</span><span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
      view <span style="color:#f92672">=</span> inflater<span style="color:#f92672">.</span><span style="color:#a6e22e">inflate</span><span style="color:#f92672">(</span>R<span style="color:#f92672">.</span><span style="color:#a6e22e">layout</span><span style="color:#f92672">.</span><span style="color:#a6e22e">whatever</span><span style="color:#f92672">,</span> parent<span style="color:#f92672">,</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">);</span>
      holder <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ViewHolder<span style="color:#f92672">(</span>view<span style="color:#f92672">);</span>
      view<span style="color:#f92672">.</span><span style="color:#a6e22e">setTag</span><span style="color:#f92672">(</span>holder<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>

    holder<span style="color:#f92672">.</span><span style="color:#a6e22e">name</span><span style="color:#f92672">.</span><span style="color:#a6e22e">setText</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;John Doe&#34;</span><span style="color:#f92672">);</span>
    <span style="color:#75715e">// etc...
</span><span style="color:#75715e"></span>
    <span style="color:#66d9ef">return</span> view<span style="color:#f92672">;</span>
  <span style="color:#f92672">}</span>

  <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ViewHolder</span> <span style="color:#f92672">{</span>
    <span style="color:#a6e22e">@Bind</span><span style="color:#f92672">(</span>R<span style="color:#f92672">.</span><span style="color:#a6e22e">id</span><span style="color:#f92672">.</span><span style="color:#a6e22e">title</span><span style="color:#f92672">)</span> TextView name<span style="color:#f92672">;</span>
    <span style="color:#a6e22e">@Bind</span><span style="color:#f92672">(</span>R<span style="color:#f92672">.</span><span style="color:#a6e22e">id</span><span style="color:#f92672">.</span><span style="color:#a6e22e">job_title</span><span style="color:#f92672">)</span> TextView jobTitle<span style="color:#f92672">;</span>

    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">ViewHolder</span><span style="color:#f92672">(</span>View view<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
      ButterKnife<span style="color:#f92672">.</span><span style="color:#a6e22e">bind</span><span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">,</span> view<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
  <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>多个View具有相同的操作我们可以使用@Bind注解一个View集合。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Bind</span><span style="color:#f92672">({</span> R<span style="color:#f92672">.</span><span style="color:#a6e22e">id</span><span style="color:#f92672">.</span><span style="color:#a6e22e">first_name</span><span style="color:#f92672">,</span> R<span style="color:#f92672">.</span><span style="color:#a6e22e">id</span><span style="color:#f92672">.</span><span style="color:#a6e22e">middle_name</span><span style="color:#f92672">,</span> R<span style="color:#f92672">.</span><span style="color:#a6e22e">id</span><span style="color:#f92672">.</span><span style="color:#a6e22e">last_name</span> <span style="color:#f92672">})</span>
List<span style="color:#f92672">&lt;</span>EditText<span style="color:#f92672">&gt;</span> nameViews<span style="color:#f92672">;</span>
</code></pre></div><p>Action和Setter接口用来设置操作</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> Action<span style="color:#f92672">&lt;</span>View<span style="color:#f92672">&gt;</span> DISABLE <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Action<span style="color:#f92672">&lt;&gt;()</span> <span style="color:#f92672">{</span>
  <span style="color:#a6e22e">@Override</span> <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">apply</span><span style="color:#f92672">(</span>View view<span style="color:#f92672">,</span> <span style="color:#66d9ef">int</span> index<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    view<span style="color:#f92672">.</span><span style="color:#a6e22e">setEnabled</span><span style="color:#f92672">(</span><span style="color:#66d9ef">false</span><span style="color:#f92672">);</span>
  <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> Setter<span style="color:#f92672">&lt;</span>View<span style="color:#f92672">,</span> Boolean<span style="color:#f92672">&gt;</span> ENABLED <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Setter<span style="color:#f92672">&lt;&gt;()</span> <span style="color:#f92672">{</span>
  <span style="color:#a6e22e">@Override</span> <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">set</span><span style="color:#f92672">(</span>View view<span style="color:#f92672">,</span> Boolean value<span style="color:#f92672">,</span> <span style="color:#66d9ef">int</span> index<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    view<span style="color:#f92672">.</span><span style="color:#a6e22e">setEnabled</span><span style="color:#f92672">(</span>value<span style="color:#f92672">);</span>
  <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>调用apply方法传入view集合和操作。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">ButterKnife<span style="color:#f92672">.</span><span style="color:#a6e22e">apply</span><span style="color:#f92672">(</span>nameViews<span style="color:#f92672">,</span> DISABLE<span style="color:#f92672">);</span>
ButterKnife<span style="color:#f92672">.</span><span style="color:#a6e22e">apply</span><span style="color:#f92672">(</span>nameViews<span style="color:#f92672">,</span> ENABLED<span style="color:#f92672">,</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">);</span>
</code></pre></div><h3 id="基本原理">基本原理</h3>
<p>ButterKnife在编译时刻利用APT将为所有使用ButterKnife的注解的类生成一个辅助的类，这个辅助类实现ViewBinder接口的bind方法，所有findViewById的操作都在bind方法中完成，在类中调用ButterKnife的bind方法其实是调用辅助类的bind方法。BtterKnife实现依赖注入的开销仅仅是在编译时刻做的注解处理，程序运行时的开销几乎可以忽略不计。
例如我们在SimpleActivity中使用ButterKnife</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SimpleActivity</span> <span style="color:#66d9ef">extends</span> Activity <span style="color:#f92672">{</span>
  <span style="color:#a6e22e">@Bind</span><span style="color:#f92672">(</span>R<span style="color:#f92672">.</span><span style="color:#a6e22e">id</span><span style="color:#f92672">.</span><span style="color:#a6e22e">title</span><span style="color:#f92672">)</span> TextView title<span style="color:#f92672">;</span>
  <span style="color:#a6e22e">@Unbinder</span> ViewUnbinder unbinder<span style="color:#f92672">;</span>
  <span style="color:#a6e22e">@Override</span> <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">onCreate</span><span style="color:#f92672">(</span>Bundle savedInstanceState<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">super</span><span style="color:#f92672">.</span><span style="color:#a6e22e">onCreate</span><span style="color:#f92672">(</span>savedInstanceState<span style="color:#f92672">);</span>
    setContentView<span style="color:#f92672">(</span>R<span style="color:#f92672">.</span><span style="color:#a6e22e">layout</span><span style="color:#f92672">.</span><span style="color:#a6e22e">simple_activity</span><span style="color:#f92672">);</span>
    ButterKnife<span style="color:#f92672">.</span><span style="color:#a6e22e">bind</span><span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">);</span>
    title<span style="color:#f92672">.</span><span style="color:#a6e22e">setText</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Butter Knife&#34;</span><span style="color:#f92672">);</span>
  <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>ButterKnife为我们生成了辅助类SimpleActivity$$ViewBinder</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SimpleActivity$$ViewBinder</span><span style="color:#f92672">&lt;</span>T <span style="color:#66d9ef">extends</span> SimpleActivity<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">implements</span> ViewBinder<span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span> <span style="color:#f92672">{</span>
  <span style="color:#a6e22e">@Override</span>
  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">bind</span><span style="color:#f92672">(</span><span style="color:#66d9ef">final</span> Finder finder<span style="color:#f92672">,</span> <span style="color:#66d9ef">final</span> T target<span style="color:#f92672">,</span> Object source<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    Unbinder unbinder <span style="color:#f92672">=</span> createUnbinder<span style="color:#f92672">(</span>target<span style="color:#f92672">);</span>
    View view<span style="color:#f92672">;</span>
    view <span style="color:#f92672">=</span> finder<span style="color:#f92672">.</span><span style="color:#a6e22e">findRequiredView</span><span style="color:#f92672">(</span>source<span style="color:#f92672">,</span> 2130968576<span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;field &#39;title&#39;&#34;</span><span style="color:#f92672">);</span>
    target<span style="color:#f92672">.</span><span style="color:#a6e22e">title</span> <span style="color:#f92672">=</span> finder<span style="color:#f92672">.</span><span style="color:#a6e22e">castView</span><span style="color:#f92672">(</span>view<span style="color:#f92672">,</span> 2130968576<span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;field &#39;title&#39;&#34;</span><span style="color:#f92672">);</span>
    target<span style="color:#f92672">.</span><span style="color:#a6e22e">unbinder</span> <span style="color:#f92672">=</span> unbinder<span style="color:#f92672">;</span>
  <span style="color:#f92672">}</span>

  <span style="color:#a6e22e">@SuppressWarnings</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;unchecked&#34;</span><span style="color:#f92672">)</span>
  <span style="color:#66d9ef">protected</span> <span style="color:#f92672">&lt;</span>U <span style="color:#66d9ef">extends</span> Unbinder<span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;&gt;</span> U <span style="color:#a6e22e">createUnbinder</span><span style="color:#f92672">(</span>T target<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">return</span> <span style="color:#f92672">(</span>U<span style="color:#f92672">)</span> <span style="color:#66d9ef">new</span> Unbinder<span style="color:#f92672">(</span>target<span style="color:#f92672">);</span>
  <span style="color:#f92672">}</span>

  <span style="color:#a6e22e">@SuppressWarnings</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;unchecked&#34;</span><span style="color:#f92672">)</span>
  <span style="color:#66d9ef">protected</span> <span style="color:#f92672">&lt;</span>U <span style="color:#66d9ef">extends</span> Unbinder<span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;&gt;</span> U <span style="color:#a6e22e">accessUnbinder</span><span style="color:#f92672">(</span>T target<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">return</span> <span style="color:#f92672">(</span>U<span style="color:#f92672">)</span> target<span style="color:#f92672">.</span><span style="color:#a6e22e">unbinder</span><span style="color:#f92672">;</span>
  <span style="color:#f92672">}</span>

  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Unbinder</span><span style="color:#f92672">&lt;</span>T <span style="color:#66d9ef">extends</span> SimpleActivity<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">implements</span> ButterKnife<span style="color:#f92672">.</span><span style="color:#a6e22e">ViewUnbinder</span><span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">private</span> T target<span style="color:#f92672">;</span>

    <span style="color:#66d9ef">protected</span> <span style="color:#a6e22e">Unbinder</span><span style="color:#f92672">(</span>T target<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
      <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">target</span> <span style="color:#f92672">=</span> target<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">unbind</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
      <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>target <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> IllegalStateException<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Bindings already cleared.&#34;</span><span style="color:#f92672">);</span>
      unbind<span style="color:#f92672">(</span>target<span style="color:#f92672">);</span>
      target <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">unbind</span><span style="color:#f92672">(</span>T target<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
      target<span style="color:#f92672">.</span><span style="color:#a6e22e">title</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
      target<span style="color:#f92672">.</span><span style="color:#a6e22e">unbinder</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
  <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><h3 id="获取注解信息">获取注解信息</h3>
<p>了解了基本原理之后，下面就看下ButterKnife如何获取这些信息，然后生成相应的类。获取信息的操作由<code>ButterKnifeProcessor</code>类完成，获取完成将注解类的信息封装成BindingClass对象。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">process</span><span style="color:#f92672">(</span>Set<span style="color:#f92672">&lt;?</span> <span style="color:#66d9ef">extends</span> TypeElement<span style="color:#f92672">&gt;</span> elements<span style="color:#f92672">,</span> RoundEnvironment env<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#75715e">//调用findAndParseTargets获取所有的BindingClass
</span><span style="color:#75715e"></span>        Map<span style="color:#f92672">&lt;</span>TypeElement<span style="color:#f92672">,</span> BindingClass<span style="color:#f92672">&gt;</span> targetClassMap <span style="color:#f92672">=</span> findAndParseTargets<span style="color:#f92672">(</span>env<span style="color:#f92672">);</span>
        <span style="color:#75715e">//遍历
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>Map<span style="color:#f92672">.</span><span style="color:#a6e22e">Entry</span><span style="color:#f92672">&lt;</span>TypeElement<span style="color:#f92672">,</span> BindingClass<span style="color:#f92672">&gt;</span> entry <span style="color:#f92672">:</span> targetClassMap<span style="color:#f92672">.</span><span style="color:#a6e22e">entrySet</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
            TypeElement typeElement <span style="color:#f92672">=</span> entry<span style="color:#f92672">.</span><span style="color:#a6e22e">getKey</span><span style="color:#f92672">();</span>
            BindingClass bindingClass <span style="color:#f92672">=</span> entry<span style="color:#f92672">.</span><span style="color:#a6e22e">getValue</span><span style="color:#f92672">();</span>

            <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span><span style="color:#75715e">//生成代码
</span><span style="color:#75715e"></span>                bindingClass<span style="color:#f92672">.</span><span style="color:#a6e22e">brewJava</span><span style="color:#f92672">().</span><span style="color:#a6e22e">writeTo</span><span style="color:#f92672">(</span>filer<span style="color:#f92672">);</span>
            <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>IOException e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                error<span style="color:#f92672">(</span>typeElement<span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;Unable to write view binder for type %s: %s&#34;</span><span style="color:#f92672">,</span> typeElement<span style="color:#f92672">,</span>
                        e<span style="color:#f92672">.</span><span style="color:#a6e22e">getMessage</span><span style="color:#f92672">());</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>

        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"> <span style="color:#66d9ef">private</span> Map<span style="color:#f92672">&lt;</span>TypeElement<span style="color:#f92672">,</span> BindingClass<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">findAndParseTargets</span><span style="color:#f92672">(</span>RoundEnvironment env<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        Map<span style="color:#f92672">&lt;</span>TypeElement<span style="color:#f92672">,</span> BindingClass<span style="color:#f92672">&gt;</span> targetClassMap <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> LinkedHashMap<span style="color:#f92672">&lt;&gt;();</span>
        Set<span style="color:#f92672">&lt;</span>TypeElement<span style="color:#f92672">&gt;</span> erasedTargetNames <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> LinkedHashSet<span style="color:#f92672">&lt;&gt;();</span>
        <span style="color:#75715e">// Process each @Bind element.
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>Element element <span style="color:#f92672">:</span> env<span style="color:#f92672">.</span><span style="color:#a6e22e">getElementsAnnotatedWith</span><span style="color:#f92672">(</span>Bind<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
            <span style="color:#75715e">//验证element
</span><span style="color:#75715e"></span>            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(!</span>SuperficialValidation<span style="color:#f92672">.</span><span style="color:#a6e22e">validateElement</span><span style="color:#f92672">(</span>element<span style="color:#f92672">))</span> <span style="color:#66d9ef">continue</span><span style="color:#f92672">;</span>
            <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
                parseBind<span style="color:#f92672">(</span>element<span style="color:#f92672">,</span> targetClassMap<span style="color:#f92672">,</span> erasedTargetNames<span style="color:#f92672">);</span>
            <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                logParsingError<span style="color:#f92672">(</span>element<span style="color:#f92672">,</span> Bind<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">,</span> e<span style="color:#f92672">);</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>

        <span style="color:#75715e">// Process each annotation that corresponds to a listener.
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>Class<span style="color:#f92672">&lt;?</span> <span style="color:#66d9ef">extends</span> Annotation<span style="color:#f92672">&gt;</span> listener <span style="color:#f92672">:</span> LISTENERS<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            findAndParseListener<span style="color:#f92672">(</span>env<span style="color:#f92672">,</span> listener<span style="color:#f92672">,</span> targetClassMap<span style="color:#f92672">,</span> erasedTargetNames<span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span>

        <span style="color:#75715e">//...
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// Try to find a parent binder for each.
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>Map<span style="color:#f92672">.</span><span style="color:#a6e22e">Entry</span><span style="color:#f92672">&lt;</span>TypeElement<span style="color:#f92672">,</span> BindingClass<span style="color:#f92672">&gt;</span> entry <span style="color:#f92672">:</span> targetClassMap<span style="color:#f92672">.</span><span style="color:#a6e22e">entrySet</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
            TypeElement parentType <span style="color:#f92672">=</span> findParentType<span style="color:#f92672">(</span>entry<span style="color:#f92672">.</span><span style="color:#a6e22e">getKey</span><span style="color:#f92672">(),</span> erasedTargetNames<span style="color:#f92672">);</span>
            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>parentType <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                String parentClassFqcn <span style="color:#f92672">=</span> getFqcn<span style="color:#f92672">(</span>parentType<span style="color:#f92672">);</span>
                BindingClass bindingClass <span style="color:#f92672">=</span> entry<span style="color:#f92672">.</span><span style="color:#a6e22e">getValue</span><span style="color:#f92672">();</span>
                bindingClass<span style="color:#f92672">.</span><span style="color:#a6e22e">setParentViewBinder</span><span style="color:#f92672">(</span>parentClassFqcn <span style="color:#f92672">+</span> BINDING_CLASS_SUFFIX<span style="color:#f92672">);</span>
                <span style="color:#75715e">// Check if parent requested an unbinder.
</span><span style="color:#75715e"></span>                <span style="color:#75715e">//判断父类使用使用@Bind进行注解
</span><span style="color:#75715e"></span>                BindingClass parentBindingClass <span style="color:#f92672">=</span> targetClassMap<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>parentType<span style="color:#f92672">);</span>
                <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>parentBindingClass<span style="color:#f92672">.</span><span style="color:#a6e22e">hasUnbinder</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
                    <span style="color:#75715e">// Even if the child doesn&#39;t request an unbinder explicitly, we need to generate one.
</span><span style="color:#75715e"></span>                    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(!</span>bindingClass<span style="color:#f92672">.</span><span style="color:#a6e22e">hasUnbinder</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
                        bindingClass<span style="color:#f92672">.</span><span style="color:#a6e22e">requiresUnbinder</span><span style="color:#f92672">(</span><span style="color:#66d9ef">null</span><span style="color:#f92672">);</span>
                    <span style="color:#f92672">}</span>
                    <span style="color:#75715e">// Check if the parent has a parent unbinder.
</span><span style="color:#75715e"></span>                    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>parentBindingClass<span style="color:#f92672">.</span><span style="color:#a6e22e">getParentUnbinder</span><span style="color:#f92672">()</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                        bindingClass<span style="color:#f92672">.</span><span style="color:#a6e22e">setParentUnbinder</span><span style="color:#f92672">(</span>parentBindingClass<span style="color:#f92672">.</span><span style="color:#a6e22e">getParentUnbinder</span><span style="color:#f92672">());</span>
                    <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
                        bindingClass<span style="color:#f92672">.</span><span style="color:#a6e22e">setParentUnbinder</span><span style="color:#f92672">(</span>parentClassFqcn <span style="color:#f92672">+</span> BINDING_CLASS_SUFFIX <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;.&#34;</span>
                                <span style="color:#f92672">+</span> UnbinderBinding<span style="color:#f92672">.</span><span style="color:#a6e22e">UNBINDER_SIMPLE_NAME</span><span style="color:#f92672">);</span>
                    <span style="color:#f92672">}</span>
                <span style="color:#f92672">}</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>

        <span style="color:#66d9ef">return</span> targetClassMap<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

</code></pre></div><p>parseBind方法用来解析被@Bind注解的类。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">parseBind</span><span style="color:#f92672">(</span>Element element<span style="color:#f92672">,</span> Map<span style="color:#f92672">&lt;</span>TypeElement<span style="color:#f92672">,</span> BindingClass<span style="color:#f92672">&gt;</span> targetClassMap<span style="color:#f92672">,</span>
                           Set<span style="color:#f92672">&lt;</span>TypeElement<span style="color:#f92672">&gt;</span> erasedTargetNames<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#75715e">// Verify common generated code restrictions.
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>isInaccessibleViaGeneratedCode<span style="color:#f92672">(</span>Bind<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;fields&#34;</span><span style="color:#f92672">,</span> element<span style="color:#f92672">)</span>
                <span style="color:#f92672">||</span> isBindingInWrongPackage<span style="color:#f92672">(</span>Bind<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">,</span> element<span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">return</span><span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>
        TypeMirror elementType <span style="color:#f92672">=</span> element<span style="color:#f92672">.</span><span style="color:#a6e22e">asType</span><span style="color:#f92672">();</span>

        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>elementType<span style="color:#f92672">.</span><span style="color:#a6e22e">getKind</span><span style="color:#f92672">()</span> <span style="color:#f92672">==</span> TypeKind<span style="color:#f92672">.</span><span style="color:#a6e22e">ARRAY</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>        <span style="color:#75715e">//类型是集合
</span><span style="color:#75715e"></span>            parseBindMany<span style="color:#f92672">(</span>element<span style="color:#f92672">,</span> targetClassMap<span style="color:#f92672">,</span> erasedTargetNames<span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>LIST_TYPE<span style="color:#f92672">.</span><span style="color:#a6e22e">equals</span><span style="color:#f92672">(</span>doubleErasure<span style="color:#f92672">(</span>elementType<span style="color:#f92672">)))</span> <span style="color:#f92672">{</span> <span style="color:#75715e">//类型是数组
</span><span style="color:#75715e"></span>            parseBindMany<span style="color:#f92672">(</span>element<span style="color:#f92672">,</span> targetClassMap<span style="color:#f92672">,</span> erasedTargetNames<span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>isSubtypeOfType<span style="color:#f92672">(</span>elementType<span style="color:#f92672">,</span> ITERABLE_TYPE<span style="color:#f92672">))</span> <span style="color:#f92672">{</span><span style="color:#75715e">// 其他可迭代的集合
</span><span style="color:#75715e"></span>            error<span style="color:#f92672">(</span>element<span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;@%s must be a List or array. (%s.%s)&#34;</span><span style="color:#f92672">,</span> Bind<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getSimpleName</span><span style="color:#f92672">(),</span>
                    <span style="color:#f92672">((</span>TypeElement<span style="color:#f92672">)</span> element<span style="color:#f92672">.</span><span style="color:#a6e22e">getEnclosingElement</span><span style="color:#f92672">()).</span><span style="color:#a6e22e">getQualifiedName</span><span style="color:#f92672">(),</span>
                    element<span style="color:#f92672">.</span><span style="color:#a6e22e">getSimpleName</span><span style="color:#f92672">());</span>
        <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
            <span style="color:#75715e">//error(element,&#34;parse one&#34;);
</span><span style="color:#75715e"></span>            parseBindOne<span style="color:#f92672">(</span>element<span style="color:#f92672">,</span> targetClassMap<span style="color:#f92672">,</span> erasedTargetNames<span style="color:#f92672">);</span> <span style="color:#75715e">//解析单个
</span><span style="color:#75715e"></span>        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>

</code></pre></div><p>parseBindMany用来解析被@Bind注解的数组或者集合</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">parseBindMany</span><span style="color:#f92672">(</span>Element element<span style="color:#f92672">,</span> Map<span style="color:#f92672">&lt;</span>TypeElement<span style="color:#f92672">,</span> BindingClass<span style="color:#f92672">&gt;</span> targetClassMap<span style="color:#f92672">,</span> Set<span style="color:#f92672">&lt;</span>TypeElement<span style="color:#f92672">&gt;</span> erasedTargetNames<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">boolean</span> hasError <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">;</span>
        TypeElement enclosingElement <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>TypeElement<span style="color:#f92672">)</span> element<span style="color:#f92672">.</span><span style="color:#a6e22e">getEnclosingElement</span><span style="color:#f92672">();</span>        <span style="color:#75715e">//获取 enclosingElement
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// Verify that the type is a List or an array.
</span><span style="color:#75715e"></span>        TypeMirror elementType <span style="color:#f92672">=</span> element<span style="color:#f92672">.</span><span style="color:#a6e22e">asType</span><span style="color:#f92672">();</span>
        String erasedType <span style="color:#f92672">=</span> doubleErasure<span style="color:#f92672">(</span>elementType<span style="color:#f92672">);</span><span style="color:#75715e">//擦除被@Bind注解的集合的泛型
</span><span style="color:#75715e"></span>        TypeMirror viewType <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span><span style="color:#75715e">//
</span><span style="color:#75715e"></span>        FieldCollectionViewBinding<span style="color:#f92672">.</span><span style="color:#a6e22e">Kind</span> kind<span style="color:#f92672">;</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>elementType<span style="color:#f92672">.</span><span style="color:#a6e22e">getKind</span><span style="color:#f92672">()</span> <span style="color:#f92672">==</span> TypeKind<span style="color:#f92672">.</span><span style="color:#a6e22e">ARRAY</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            ArrayType arrayType <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>ArrayType<span style="color:#f92672">)</span> elementType<span style="color:#f92672">;</span><span style="color:#75715e">//强转为数组类型
</span><span style="color:#75715e"></span>            viewType <span style="color:#f92672">=</span> arrayType<span style="color:#f92672">.</span><span style="color:#a6e22e">getComponentType</span><span style="color:#f92672">();</span> <span style="color:#75715e">//获取数组元素类型
</span><span style="color:#75715e"></span>            kind <span style="color:#f92672">=</span> FieldCollectionViewBinding<span style="color:#f92672">.</span><span style="color:#a6e22e">Kind</span><span style="color:#f92672">.</span><span style="color:#a6e22e">ARRAY</span><span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>LIST_TYPE<span style="color:#f92672">.</span><span style="color:#a6e22e">equals</span><span style="color:#f92672">(</span>erasedType<span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
            DeclaredType declaredType <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>DeclaredType<span style="color:#f92672">)</span> elementType<span style="color:#f92672">;</span>
            <span style="color:#75715e">//获取真实的类型 declaredType:List&lt;View&gt; -&gt; 真实类型List
</span><span style="color:#75715e"></span>            List<span style="color:#f92672">&lt;?</span> <span style="color:#66d9ef">extends</span> TypeMirror<span style="color:#f92672">&gt;</span> typeArguments <span style="color:#f92672">=</span> declaredType<span style="color:#f92672">.</span><span style="color:#a6e22e">getTypeArguments</span><span style="color:#f92672">();</span>
            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>typeArguments<span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">()</span> <span style="color:#f92672">!=</span> 1<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                error<span style="color:#f92672">(</span>element<span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;@%s List must have a generic component. (%s.%s)&#34;</span><span style="color:#f92672">,</span>
                        Bind<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getSimpleName</span><span style="color:#f92672">(),</span> enclosingElement<span style="color:#f92672">.</span><span style="color:#a6e22e">getQualifiedName</span><span style="color:#f92672">(),</span>
                        element<span style="color:#f92672">.</span><span style="color:#a6e22e">getSimpleName</span><span style="color:#f92672">());</span>
                hasError <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">;</span>
            <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
                viewType <span style="color:#f92672">=</span> typeArguments<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>0<span style="color:#f92672">);</span>
            <span style="color:#f92672">}</span>
            kind <span style="color:#f92672">=</span> FieldCollectionViewBinding<span style="color:#f92672">.</span><span style="color:#a6e22e">Kind</span><span style="color:#f92672">.</span><span style="color:#a6e22e">LIST</span><span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> AssertionError<span style="color:#f92672">();</span>
        <span style="color:#f92672">}</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>viewType <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">&amp;&amp;</span> viewType<span style="color:#f92672">.</span><span style="color:#a6e22e">getKind</span><span style="color:#f92672">()</span> <span style="color:#f92672">==</span> TypeKind<span style="color:#f92672">.</span><span style="color:#a6e22e">TYPEVAR</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            TypeVariable typeVariable <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>TypeVariable<span style="color:#f92672">)</span> viewType<span style="color:#f92672">;</span>
            viewType <span style="color:#f92672">=</span> typeVariable<span style="color:#f92672">.</span><span style="color:#a6e22e">getUpperBound</span><span style="color:#f92672">();</span> <span style="color:#75715e">//
</span><span style="color:#75715e"></span>        <span style="color:#f92672">}</span>

        <span style="color:#75715e">// Verify that the target type extends from View.
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>viewType <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#f92672">!</span>isSubtypeOfType<span style="color:#f92672">(</span>viewType<span style="color:#f92672">,</span> VIEW_TYPE<span style="color:#f92672">)</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#f92672">!</span>isInterface<span style="color:#f92672">(</span>viewType<span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
            error<span style="color:#f92672">(</span>element<span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;@%s List or array type must extend from View or be an interface. (%s.%s)&#34;</span><span style="color:#f92672">,</span>
                    Bind<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getSimpleName</span><span style="color:#f92672">(),</span> enclosingElement<span style="color:#f92672">.</span><span style="color:#a6e22e">getQualifiedName</span><span style="color:#f92672">(),</span> element<span style="color:#f92672">.</span><span style="color:#a6e22e">getSimpleName</span><span style="color:#f92672">());</span>
            hasError <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>

        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>hasError<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">return</span><span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>

        <span style="color:#75715e">// Assemble information on the field.
</span><span style="color:#75715e"></span>        String name <span style="color:#f92672">=</span> element<span style="color:#f92672">.</span><span style="color:#a6e22e">getSimpleName</span><span style="color:#f92672">().</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">();</span>
        <span style="color:#66d9ef">int</span><span style="color:#f92672">[]</span> ids <span style="color:#f92672">=</span> element<span style="color:#f92672">.</span><span style="color:#a6e22e">getAnnotation</span><span style="color:#f92672">(</span>Bind<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">).</span><span style="color:#a6e22e">value</span><span style="color:#f92672">();</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>ids<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span> <span style="color:#f92672">==</span> 0<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            error<span style="color:#f92672">(</span>element<span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;@%s must specify at least one ID. (%s.%s)&#34;</span><span style="color:#f92672">,</span> Bind<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getSimpleName</span><span style="color:#f92672">(),</span>
                    enclosingElement<span style="color:#f92672">.</span><span style="color:#a6e22e">getQualifiedName</span><span style="color:#f92672">(),</span> element<span style="color:#f92672">.</span><span style="color:#a6e22e">getSimpleName</span><span style="color:#f92672">());</span>
            <span style="color:#66d9ef">return</span><span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>
        <span style="color:#75715e">//获取重复的id
</span><span style="color:#75715e"></span>        Integer duplicateId <span style="color:#f92672">=</span> findDuplicate<span style="color:#f92672">(</span>ids<span style="color:#f92672">);</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>duplicateId <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            error<span style="color:#f92672">(</span>element<span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;@%s annotation contains duplicate ID %d. (%s.%s)&#34;</span><span style="color:#f92672">,</span> Bind<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getSimpleName</span><span style="color:#f92672">(),</span>
                    duplicateId<span style="color:#f92672">,</span> enclosingElement<span style="color:#f92672">.</span><span style="color:#a6e22e">getQualifiedName</span><span style="color:#f92672">(),</span> element<span style="color:#f92672">.</span><span style="color:#a6e22e">getSimpleName</span><span style="color:#f92672">());</span>
        <span style="color:#f92672">}</span>

        <span style="color:#66d9ef">assert</span> viewType <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span> <span style="color:#75715e">// Always false as hasError would have been true.
</span><span style="color:#75715e"></span>        TypeName type <span style="color:#f92672">=</span> TypeName<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>viewType<span style="color:#f92672">);</span>
        <span style="color:#66d9ef">boolean</span> required <span style="color:#f92672">=</span> isFieldRequired<span style="color:#f92672">(</span>element<span style="color:#f92672">);</span>
        <span style="color:#75715e">//创建BindingClass类
</span><span style="color:#75715e"></span>        BindingClass bindingClass <span style="color:#f92672">=</span> getOrCreateTargetClass<span style="color:#f92672">(</span>targetClassMap<span style="color:#f92672">,</span> enclosingElement<span style="color:#f92672">);</span>
        <span style="color:#75715e">//FieldCollectionViewBinding封装了@Bind注解的集合或数组的信息
</span><span style="color:#75715e"></span>        FieldCollectionViewBinding binding <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> FieldCollectionViewBinding<span style="color:#f92672">(</span>name<span style="color:#f92672">,</span> type<span style="color:#f92672">,</span> kind<span style="color:#f92672">,</span> required<span style="color:#f92672">);</span>
        bindingClass<span style="color:#f92672">.</span><span style="color:#a6e22e">addFieldCollection</span><span style="color:#f92672">(</span>ids<span style="color:#f92672">,</span> binding<span style="color:#f92672">);</span>

        erasedTargetNames<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>enclosingElement<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
</code></pre></div><p>其他的parse操作大同小异，所以这里就不给出代码分析。</p>
<h3 id="生成代码">生成代码</h3>
<p>BindingClass的brewJava()方法构建一个JavaFile对象。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">  JavaFile <span style="color:#a6e22e">brewJava</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
    <span style="color:#75715e">//添加泛型&lt;T extends targetClass&gt;
</span><span style="color:#75715e"></span>    TypeSpec<span style="color:#f92672">.</span><span style="color:#a6e22e">Builder</span> result <span style="color:#f92672">=</span> TypeSpec<span style="color:#f92672">.</span><span style="color:#a6e22e">classBuilder</span><span style="color:#f92672">(</span>className<span style="color:#f92672">)</span>
        <span style="color:#f92672">.</span><span style="color:#a6e22e">addModifiers</span><span style="color:#f92672">(</span>PUBLIC<span style="color:#f92672">)</span>
        <span style="color:#f92672">.</span><span style="color:#a6e22e">addTypeVariable</span><span style="color:#f92672">(</span>TypeVariableName<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;T&#34;</span><span style="color:#f92672">,</span> ClassName<span style="color:#f92672">.</span><span style="color:#a6e22e">bestGuess</span><span style="color:#f92672">(</span>targetClass<span style="color:#f92672">)));</span>
    <span style="color:#75715e">//
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>parentViewBinder <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
      result<span style="color:#f92672">.</span><span style="color:#a6e22e">superclass</span><span style="color:#f92672">(</span>ParameterizedTypeName<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>ClassName<span style="color:#f92672">.</span><span style="color:#a6e22e">bestGuess</span><span style="color:#f92672">(</span>parentViewBinder<span style="color:#f92672">),</span>
          TypeVariableName<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;T&#34;</span><span style="color:#f92672">)));</span>
    <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
      result<span style="color:#f92672">.</span><span style="color:#a6e22e">addSuperinterface</span><span style="color:#f92672">(</span>ParameterizedTypeName<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>VIEW_BINDER<span style="color:#f92672">,</span> TypeVariableName<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;T&#34;</span><span style="color:#f92672">)));</span>
    <span style="color:#f92672">}</span>

    result<span style="color:#f92672">.</span><span style="color:#a6e22e">addMethod</span><span style="color:#f92672">(</span>createBindMethod<span style="color:#f92672">());</span>

    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>hasUnbinder<span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
      <span style="color:#75715e">// Create unbinding class.
</span><span style="color:#75715e"></span>      result<span style="color:#f92672">.</span><span style="color:#a6e22e">addType</span><span style="color:#f92672">(</span>createUnbinderClass<span style="color:#f92672">());</span>
      <span style="color:#75715e">// Now we need to provide child classes to access and override unbinder implementations.
</span><span style="color:#75715e"></span>      createUnbinderInternalAccessMethods<span style="color:#f92672">(</span>result<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">return</span> JavaFile<span style="color:#f92672">.</span><span style="color:#a6e22e">builder</span><span style="color:#f92672">(</span>classPackage<span style="color:#f92672">,</span> result<span style="color:#f92672">.</span><span style="color:#a6e22e">build</span><span style="color:#f92672">())</span>
        <span style="color:#f92672">.</span><span style="color:#a6e22e">addFileComment</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Generated code from Butter Knife. Do not modify!&#34;</span><span style="color:#f92672">)</span>
        <span style="color:#f92672">.</span><span style="color:#a6e22e">build</span><span style="color:#f92672">();</span>
  <span style="color:#f92672">}</span>

</code></pre></div><h3 id="butterknife的bind方法">ButterKnife的bind方法</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">  <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">bind</span><span style="color:#f92672">(</span><span style="color:#a6e22e">@NonNull</span> Object target<span style="color:#f92672">,</span> <span style="color:#a6e22e">@NonNull</span> Object source<span style="color:#f92672">,</span> <span style="color:#a6e22e">@NonNull</span> Finder finder<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    Class<span style="color:#f92672">&lt;?&gt;</span> targetClass <span style="color:#f92672">=</span> target<span style="color:#f92672">.</span><span style="color:#a6e22e">getClass</span><span style="color:#f92672">();</span>
    <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
      <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>debug<span style="color:#f92672">)</span> Log<span style="color:#f92672">.</span><span style="color:#a6e22e">d</span><span style="color:#f92672">(</span>TAG<span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;Looking up view binder for &#34;</span> <span style="color:#f92672">+</span> targetClass<span style="color:#f92672">.</span><span style="color:#a6e22e">getName</span><span style="color:#f92672">());</span>
      <span style="color:#75715e">//获取生成的辅助类
</span><span style="color:#75715e"></span>      ViewBinder<span style="color:#f92672">&lt;</span>Object<span style="color:#f92672">&gt;</span> viewBinder <span style="color:#f92672">=</span> findViewBinderForClass<span style="color:#f92672">(</span>targetClass<span style="color:#f92672">);</span>
      <span style="color:#75715e">//获取辅助类的bind方法
</span><span style="color:#75715e"></span>      viewBinder<span style="color:#f92672">.</span><span style="color:#a6e22e">bind</span><span style="color:#f92672">(</span>finder<span style="color:#f92672">,</span> target<span style="color:#f92672">,</span> source<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
      <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> RuntimeException<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Unable to bind views for &#34;</span> <span style="color:#f92672">+</span> targetClass<span style="color:#f92672">.</span><span style="color:#a6e22e">getName</span><span style="color:#f92672">(),</span> e<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
  <span style="color:#f92672">}</span>

    <span style="color:#a6e22e">@NonNull</span>
  <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> ViewBinder<span style="color:#f92672">&lt;</span>Object<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">findViewBinderForClass</span><span style="color:#f92672">(</span>Class<span style="color:#f92672">&lt;?&gt;</span> cls<span style="color:#f92672">)</span>
      <span style="color:#66d9ef">throws</span> IllegalAccessException<span style="color:#f92672">,</span> InstantiationException <span style="color:#f92672">{</span>
    ViewBinder<span style="color:#f92672">&lt;</span>Object<span style="color:#f92672">&gt;</span> viewBinder <span style="color:#f92672">=</span> BINDERS<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>cls<span style="color:#f92672">);</span>
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>viewBinder <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
      <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>debug<span style="color:#f92672">)</span> Log<span style="color:#f92672">.</span><span style="color:#a6e22e">d</span><span style="color:#f92672">(</span>TAG<span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;HIT: Cached in view binder map.&#34;</span><span style="color:#f92672">);</span>
      <span style="color:#66d9ef">return</span> viewBinder<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
    String clsName <span style="color:#f92672">=</span> cls<span style="color:#f92672">.</span><span style="color:#a6e22e">getName</span><span style="color:#f92672">();</span>
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>clsName<span style="color:#f92672">.</span><span style="color:#a6e22e">startsWith</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;android.&#34;</span><span style="color:#f92672">)</span> <span style="color:#f92672">||</span> clsName<span style="color:#f92672">.</span><span style="color:#a6e22e">startsWith</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;java.&#34;</span><span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
      <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>debug<span style="color:#f92672">)</span> Log<span style="color:#f92672">.</span><span style="color:#a6e22e">d</span><span style="color:#f92672">(</span>TAG<span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;MISS: Reached framework class. Abandoning search.&#34;</span><span style="color:#f92672">);</span>
      <span style="color:#66d9ef">return</span> NOP_VIEW_BINDER<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
    <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
      Class<span style="color:#f92672">&lt;?&gt;</span> viewBindingClass <span style="color:#f92672">=</span> Class<span style="color:#f92672">.</span><span style="color:#a6e22e">forName</span><span style="color:#f92672">(</span>clsName <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;$$ViewBinder&#34;</span><span style="color:#f92672">);</span>
      <span style="color:#75715e">//noinspection unchecked
</span><span style="color:#75715e"></span>      viewBinder <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>ViewBinder<span style="color:#f92672">&lt;</span>Object<span style="color:#f92672">&gt;)</span> viewBindingClass<span style="color:#f92672">.</span><span style="color:#a6e22e">newInstance</span><span style="color:#f92672">();</span>
      <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>debug<span style="color:#f92672">)</span> Log<span style="color:#f92672">.</span><span style="color:#a6e22e">d</span><span style="color:#f92672">(</span>TAG<span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;HIT: Loaded view binder class.&#34;</span><span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>ClassNotFoundException e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
      <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>debug<span style="color:#f92672">)</span> Log<span style="color:#f92672">.</span><span style="color:#a6e22e">d</span><span style="color:#f92672">(</span>TAG<span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;Not found. Trying superclass &#34;</span> <span style="color:#f92672">+</span> cls<span style="color:#f92672">.</span><span style="color:#a6e22e">getSuperclass</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getName</span><span style="color:#f92672">());</span>
      viewBinder <span style="color:#f92672">=</span> findViewBinderForClass<span style="color:#f92672">(</span>cls<span style="color:#f92672">.</span><span style="color:#a6e22e">getSuperclass</span><span style="color:#f92672">());</span>
    <span style="color:#f92672">}</span>
    BINDERS<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span>cls<span style="color:#f92672">,</span> viewBinder<span style="color:#f92672">);</span>
    <span style="color:#66d9ef">return</span> viewBinder<span style="color:#f92672">;</span>
  <span style="color:#f92672">}</span>


</code></pre></div>
                    
                    <HR width="100%" id="EOF">
                    <p style="color:#777;">Last modified on 2015-04-19</p>
                    
                </div>
            </div>
            
            
            <nav class="post-pagination">

                
                <a class="newer-posts" href="https://malinkang.cn/posts/android-decompile/">
                    Next<br>android反编译
                </a>
                
                
                
                <a class="older-posts" href="https://malinkang.cn/posts/android-studio-plugins/">
                    Previous<br>Android Studio常用插件
                </a>
                
            </nav>
            <div class="post-comment-wrapper">
                


<div id="gitalk-container"></div>





            </div>
        </div>
    </div>
</div>

            </div><div id="single-column-footer">
Hugo Theme <a href="https://github.com/amazingrise/hugo-theme-diary">Diary</a> by <a href="https://amazingrise.net">Rise</a>
<br>
Ported from <a href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a>'s <a href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> <br>
<br>

&copy;
	
	This is a customized copyright.
	</div>
    	</div>
    <script src="https://malinkang.cn//js/journal.js"></script>
    </body>
</html>

<!DOCTYPE html><html lang="zh-CN" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="《Java编程思想》第15章泛型" /><meta property="og:locale" content="zh_CN" /><meta name="description" content="一般的类和方法，只能使用具体的类型：要么是基本类型，要么是自定义的类。如果要编写可以应用于多种类型的代码，这种刻板的限制对代码的束缚就会很大。" /><meta property="og:description" content="一般的类和方法，只能使用具体的类型：要么是基本类型，要么是自定义的类。如果要编写可以应用于多种类型的代码，这种刻板的限制对代码的束缚就会很大。" /><link rel="canonical" href="https://malinkang.cn/posts/thinking-in-java-generics/" /><meta property="og:url" content="https://malinkang.cn/posts/thinking-in-java-generics/" /><meta property="og:site_name" content="malinkang" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2013-06-18T21:39:36+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="《Java编程思想》第15章泛型" /><meta name="twitter:site" content="@malinkang" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"description":"一般的类和方法，只能使用具体的类型：要么是基本类型，要么是自定义的类。如果要编写可以应用于多种类型的代码，这种刻板的限制对代码的束缚就会很大。","headline":"《Java编程思想》第15章泛型","dateModified":"2013-06-18T21:39:36+08:00","url":"https://malinkang.cn/posts/thinking-in-java-generics/","datePublished":"2013-06-18T21:39:36+08:00","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://malinkang.cn/posts/thinking-in-java-generics/"},"@context":"https://schema.org"}</script><title>《Java编程思想》第15章泛型 | malinkang</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="malinkang"><meta name="application-name" content="malinkang"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://malinkang-1253444926.cos.ap-beijing.myqcloud.com/images/avatar.jpeg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">malinkang</a></div><div class="site-subtitle font-italic">人生最可悲的事情，莫过于胸怀大志，却又虚度光阴。</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>分类</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>标签</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>归档</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>关于</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/malinkang" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/malinkang" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['linkang.ma','gmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>《Java编程思想》第15章泛型</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>《Java编程思想》第15章泛型</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> malinkang </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Tue, Jun 18, 2013, 9:39 PM +0800" prep="on" > Jun 18, 2013 <i class="unloaded">2013-06-18T21:39:36+08:00</i> </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="15081 words">83 min</span></div></div><div class="post-content"><p><strong>一般的类和方法，只能使用具体的类型：要么是基本类型，要么是自定义的类。如果要编写可以应用于多种类型的代码，这种刻板的限制对代码的束缚就会很大。</strong></p><p>在面向对象编程语言中，多态算是一种泛化机制。例如，你可以将方法的参数类型设为基类，那么该方法就可以接受从这个基类中导出的任何类作为参数。这样的方法更加通用一些，可应用的地方也多一些。在类的内部也是如此，凡是需要说明类型的地方，如果都使用基类，确实能够具备更好的灵活性。但是，考虑到除了final类不能扩展，其他任何类都可以被扩展，所以这种灵活性大多数时候也会有一些性能损耗。</p><p>有时候，拘泥于单继承体系，也会使程序受限太多。如果方法的参数是一个接口，而不是一个类，这种限制就放松了许多。因为任何实现了该接口的类都能够满足该方法，这也包括暂时还不存在的类。这就给予客户端程序员的一种选择，他可以通过实现一个接口来满足类或方法。因此，接口允许我们快捷地实现类及成果，也使我们有机会创建一个新类来做到这一点。</p><p>可是有的时候，即便使用了接口，对程序的约束也还是太强了。因为一旦指明了接口，它就要求你的代码必须使用特定的接口。而我们希望达到的目的是编写更通用的代码，要使代码能够应用于“某种不具体的类型”，而不是一个个具体的接口或类。</p><p>这就是Java SE5的重大变化之一：泛型的概念。泛型实现了<code class="language-plaintext highlighter-rouge">参数化类型</code>的概念，使代码可以应用于多种类型。“泛型”这个术语的意思是：“使用于许多许多的类型”。泛型在编程语言中出现时，其最初的目的是希望类或方法具备最广泛的表达能力。如何做到这一点呢，正是通过<strong>解耦类或方法所使用的类型之间的约束</strong>。</p><h2 id="151-与c的比较">15.1 与C++的比较</h2><h2 id="152-简单泛型">15.2 简单泛型</h2><p>一个只能持有单个对象的类。</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="c1">//: generics/Holder1.java</span>

<span class="kd">class</span> <span class="nc">Automobile</span> <span class="o">{}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Holder1</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="nc">Automobile</span> <span class="n">a</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">Holder1</span><span class="o">(</span><span class="nc">Automobile</span> <span class="n">a</span><span class="o">)</span> <span class="o">{</span> <span class="k">this</span><span class="o">.</span><span class="na">a</span> <span class="o">=</span> <span class="n">a</span><span class="o">;</span> <span class="o">}</span>
  <span class="nc">Automobile</span> <span class="nf">get</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">a</span><span class="o">;</span> <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~</span>
</pre></table></code></div></div><p>在<code class="language-plaintext highlighter-rouge">Java SE5</code>之前，可以让这个类直接持有<code class="language-plaintext highlighter-rouge">Object</code>类型的对象。</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="c1">//: generics/Holder2.java</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Holder2</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="nc">Object</span> <span class="n">a</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">Holder2</span><span class="o">(</span><span class="nc">Object</span> <span class="n">a</span><span class="o">)</span> <span class="o">{</span> <span class="k">this</span><span class="o">.</span><span class="na">a</span> <span class="o">=</span> <span class="n">a</span><span class="o">;</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">set</span><span class="o">(</span><span class="nc">Object</span> <span class="n">a</span><span class="o">)</span> <span class="o">{</span> <span class="k">this</span><span class="o">.</span><span class="na">a</span> <span class="o">=</span> <span class="n">a</span><span class="o">;</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="nc">Object</span> <span class="nf">get</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">a</span><span class="o">;</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Holder2</span> <span class="n">h2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Holder2</span><span class="o">(</span><span class="k">new</span> <span class="nc">Automobile</span><span class="o">());</span>
    <span class="nc">Automobile</span> <span class="n">a</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Automobile</span><span class="o">)</span><span class="n">h2</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
    <span class="n">h2</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="s">"Not an Automobile"</span><span class="o">);</span>
    <span class="nc">String</span> <span class="n">s</span> <span class="o">=</span> <span class="o">(</span><span class="nc">String</span><span class="o">)</span><span class="n">h2</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
    <span class="n">h2</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span> <span class="c1">// Autoboxes to Integer</span>
    <span class="nc">Integer</span> <span class="n">x</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Integer</span><span class="o">)</span><span class="n">h2</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~</span>
</pre></table></code></div></div><p>泛型的主要目的之一就是用来指定容器要持有什么类型的对象，而且由编译器来保证类型的正确性。因此，与其使用<code class="language-plaintext highlighter-rouge">Object</code>，我们更喜欢暂时不指定类型，而是稍后再决定具体使用说明类型。要达到这个目的，需要使用类型参数，用尖括号括住，放在类名后面。然后在使用这个类的时候，再用实际的类型替换此类型参数。</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="c1">//: generics/Holder3.java</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Holder3</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="no">T</span> <span class="n">a</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">Holder3</span><span class="o">(</span><span class="no">T</span> <span class="n">a</span><span class="o">)</span> <span class="o">{</span> <span class="k">this</span><span class="o">.</span><span class="na">a</span> <span class="o">=</span> <span class="n">a</span><span class="o">;</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">set</span><span class="o">(</span><span class="no">T</span> <span class="n">a</span><span class="o">)</span> <span class="o">{</span> <span class="k">this</span><span class="o">.</span><span class="na">a</span> <span class="o">=</span> <span class="n">a</span><span class="o">;</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="no">T</span> <span class="nf">get</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">a</span><span class="o">;</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Holder3</span><span class="o">&lt;</span><span class="nc">Automobile</span><span class="o">&gt;</span> <span class="n">h3</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Holder3</span><span class="o">&lt;</span><span class="nc">Automobile</span><span class="o">&gt;(</span><span class="k">new</span> <span class="nc">Automobile</span><span class="o">());</span>
    <span class="nc">Automobile</span> <span class="n">a</span> <span class="o">=</span> <span class="n">h3</span><span class="o">.</span><span class="na">get</span><span class="o">();</span> <span class="c1">// No cast needed</span>
    <span class="c1">// h3.set("Not an Automobile"); // Error</span>
    <span class="c1">// h3.set(1); // Error</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:</span>
</pre></table></code></div></div><h3 id="1521-一个元组类库">15.2.1 一个元组类库</h3><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="c1">//: net/mindview/util/TwoTuple.java</span>
<span class="kn">package</span> <span class="nn">net.mindview.util</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TwoTuple</span><span class="o">&lt;</span><span class="no">A</span><span class="o">,</span><span class="no">B</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">final</span> <span class="no">A</span> <span class="n">first</span><span class="o">;</span>
  <span class="kd">public</span> <span class="kd">final</span> <span class="no">B</span> <span class="n">second</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">TwoTuple</span><span class="o">(</span><span class="no">A</span> <span class="n">a</span><span class="o">,</span> <span class="no">B</span> <span class="n">b</span><span class="o">)</span> <span class="o">{</span> <span class="n">first</span> <span class="o">=</span> <span class="n">a</span><span class="o">;</span> <span class="n">second</span> <span class="o">=</span> <span class="n">b</span><span class="o">;</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="nc">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="s">"("</span> <span class="o">+</span> <span class="n">first</span> <span class="o">+</span> <span class="s">", "</span> <span class="o">+</span> <span class="n">second</span> <span class="o">+</span> <span class="s">")"</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~</span>
</pre></table></code></div></div><p>利用继承机制实现长度更长的元组。</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre><td class="rouge-code"><pre><span class="c1">//: net/mindview/util/ThreeTuple.java</span>
<span class="kn">package</span> <span class="nn">net.mindview.util</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ThreeTuple</span><span class="o">&lt;</span><span class="no">A</span><span class="o">,</span><span class="no">B</span><span class="o">,</span><span class="no">C</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="nc">TwoTuple</span><span class="o">&lt;</span><span class="no">A</span><span class="o">,</span><span class="no">B</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">final</span> <span class="no">C</span> <span class="n">third</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">ThreeTuple</span><span class="o">(</span><span class="no">A</span> <span class="n">a</span><span class="o">,</span> <span class="no">B</span> <span class="n">b</span><span class="o">,</span> <span class="no">C</span> <span class="n">c</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">);</span>
    <span class="n">third</span> <span class="o">=</span> <span class="n">c</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="nc">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="s">"("</span> <span class="o">+</span> <span class="n">first</span> <span class="o">+</span> <span class="s">", "</span> <span class="o">+</span> <span class="n">second</span> <span class="o">+</span> <span class="s">", "</span> <span class="o">+</span> <span class="n">third</span> <span class="o">+</span><span class="s">")"</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~</span>


<span class="c1">//: net/mindview/util/FourTuple.java</span>
<span class="kn">package</span> <span class="nn">net.mindview.util</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FourTuple</span><span class="o">&lt;</span><span class="no">A</span><span class="o">,</span><span class="no">B</span><span class="o">,</span><span class="no">C</span><span class="o">,</span><span class="no">D</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="nc">ThreeTuple</span><span class="o">&lt;</span><span class="no">A</span><span class="o">,</span><span class="no">B</span><span class="o">,</span><span class="no">C</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">final</span> <span class="no">D</span> <span class="n">fourth</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">FourTuple</span><span class="o">(</span><span class="no">A</span> <span class="n">a</span><span class="o">,</span> <span class="no">B</span> <span class="n">b</span><span class="o">,</span> <span class="no">C</span> <span class="n">c</span><span class="o">,</span> <span class="no">D</span> <span class="n">d</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">,</span> <span class="n">c</span><span class="o">);</span>
    <span class="n">fourth</span> <span class="o">=</span> <span class="n">d</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="nc">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="s">"("</span> <span class="o">+</span> <span class="n">first</span> <span class="o">+</span> <span class="s">", "</span> <span class="o">+</span> <span class="n">second</span> <span class="o">+</span> <span class="s">", "</span> <span class="o">+</span>
      <span class="n">third</span> <span class="o">+</span> <span class="s">", "</span> <span class="o">+</span> <span class="n">fourth</span> <span class="o">+</span> <span class="s">")"</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~</span>
</pre></table></code></div></div><p>为了使用元组，你只需定义一个长度适合的元组，将其作为方法的返回值，然后在<code class="language-plaintext highlighter-rouge">return</code>语句中创建该元组，并返回即可。</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
</pre><td class="rouge-code"><pre><span class="c1">//: generics/TupleTest.java</span>
<span class="kn">import</span> <span class="nn">net.mindview.util.*</span><span class="o">;</span>

<span class="kd">class</span> <span class="nc">Amphibian</span> <span class="o">{}</span>
<span class="kd">class</span> <span class="nc">Vehicle</span> <span class="o">{}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TupleTest</span> <span class="o">{</span>
  <span class="kd">static</span> <span class="nc">TwoTuple</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="nf">f</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// Autoboxing converts the int to Integer:</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nc">TwoTuple</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">Integer</span><span class="o">&gt;(</span><span class="s">"hi"</span><span class="o">,</span> <span class="mi">47</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">static</span> <span class="nc">ThreeTuple</span><span class="o">&lt;</span><span class="nc">Amphibian</span><span class="o">,</span><span class="nc">String</span><span class="o">,</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="nf">g</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nc">ThreeTuple</span><span class="o">&lt;</span><span class="nc">Amphibian</span><span class="o">,</span> <span class="nc">String</span><span class="o">,</span> <span class="nc">Integer</span><span class="o">&gt;(</span>
      <span class="k">new</span> <span class="nf">Amphibian</span><span class="o">(),</span> <span class="s">"hi"</span><span class="o">,</span> <span class="mi">47</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">static</span> <span class="nc">FourTuple</span><span class="o">&lt;</span><span class="nc">Vehicle</span><span class="o">,</span><span class="nc">Amphibian</span><span class="o">,</span><span class="nc">String</span><span class="o">,</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="nf">h</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nc">FourTuple</span><span class="o">&lt;</span><span class="nc">Vehicle</span><span class="o">,</span><span class="nc">Amphibian</span><span class="o">,</span><span class="nc">String</span><span class="o">,</span><span class="nc">Integer</span><span class="o">&gt;(</span>
        <span class="k">new</span> <span class="nf">Vehicle</span><span class="o">(),</span> <span class="k">new</span> <span class="nc">Amphibian</span><span class="o">(),</span> <span class="s">"hi"</span><span class="o">,</span> <span class="mi">47</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">static</span> <span class="nc">FiveTuple</span><span class="o">&lt;</span><span class="nc">Vehicle</span><span class="o">,</span><span class="nc">Amphibian</span><span class="o">,</span><span class="nc">String</span><span class="o">,</span><span class="nc">Integer</span><span class="o">,</span><span class="nc">Double</span><span class="o">&gt;</span> <span class="nf">k</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span>
      <span class="nc">FiveTuple</span><span class="o">&lt;</span><span class="nc">Vehicle</span><span class="o">,</span><span class="nc">Amphibian</span><span class="o">,</span><span class="nc">String</span><span class="o">,</span><span class="nc">Integer</span><span class="o">,</span><span class="nc">Double</span><span class="o">&gt;(</span>
        <span class="k">new</span> <span class="nf">Vehicle</span><span class="o">(),</span> <span class="k">new</span> <span class="nc">Amphibian</span><span class="o">(),</span> <span class="s">"hi"</span><span class="o">,</span> <span class="mi">47</span><span class="o">,</span> <span class="mf">11.1</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">TwoTuple</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">ttsi</span> <span class="o">=</span> <span class="n">f</span><span class="o">();</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">ttsi</span><span class="o">);</span>
    <span class="c1">// ttsi.first = "there"; // Compile error: final</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">g</span><span class="o">());</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">h</span><span class="o">());</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">k</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output: (80% match)
(hi, 47)
(Amphibian@1f6a7b9, hi, 47)
(Vehicle@35ce36, Amphibian@757aef, hi, 47)
(Vehicle@9cab16, Amphibian@1a46e30, hi, 47, 11.1)
*/</span><span class="c1">//:~</span>
</pre></table></code></div></div><h3 id="1522-一个堆栈类">15.2.2 一个堆栈类</h3><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
</pre><td class="rouge-code"><pre><span class="c1">//: generics/LinkedStack.java</span>
<span class="c1">// A stack implemented with an internal linked structure.</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">LinkedStack</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="c1">//Node类</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Node</span><span class="o">&lt;</span><span class="no">U</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="no">U</span> <span class="n">item</span><span class="o">;</span>
    <span class="nc">Node</span><span class="o">&lt;</span><span class="no">U</span><span class="o">&gt;</span> <span class="n">next</span><span class="o">;</span>
    <span class="nc">Node</span><span class="o">()</span> <span class="o">{</span> <span class="n">item</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span> <span class="n">next</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span> <span class="o">}</span>
    <span class="nc">Node</span><span class="o">(</span><span class="no">U</span> <span class="n">item</span><span class="o">,</span> <span class="nc">Node</span><span class="o">&lt;</span><span class="no">U</span><span class="o">&gt;</span> <span class="n">next</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">this</span><span class="o">.</span><span class="na">item</span> <span class="o">=</span> <span class="n">item</span><span class="o">;</span>
      <span class="k">this</span><span class="o">.</span><span class="na">next</span> <span class="o">=</span> <span class="n">next</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kt">boolean</span> <span class="nf">end</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">item</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">next</span> <span class="o">==</span> <span class="kc">null</span><span class="o">;</span> <span class="o">}</span>
  <span class="o">}</span>
  <span class="kd">private</span> <span class="nc">Node</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">top</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Node</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;();</span> <span class="c1">// End sentinel</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">push</span><span class="o">(</span><span class="no">T</span> <span class="n">item</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">top</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Node</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;(</span><span class="n">item</span><span class="o">,</span> <span class="n">top</span><span class="o">);</span>
  <span class="o">}</span>    
  <span class="kd">public</span> <span class="no">T</span> <span class="nf">pop</span><span class="o">()</span> <span class="o">{</span>
    <span class="no">T</span> <span class="n">result</span> <span class="o">=</span> <span class="n">top</span><span class="o">.</span><span class="na">item</span><span class="o">;</span>
    <span class="k">if</span><span class="o">(!</span><span class="n">top</span><span class="o">.</span><span class="na">end</span><span class="o">())</span>
      <span class="n">top</span> <span class="o">=</span> <span class="n">top</span><span class="o">.</span><span class="na">next</span><span class="o">;</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">LinkedStack</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">lss</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">LinkedStack</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;();</span>
    <span class="k">for</span><span class="o">(</span><span class="nc">String</span> <span class="n">s</span> <span class="o">:</span> <span class="s">"Phasers on stun!"</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">" "</span><span class="o">))</span>
      <span class="n">lss</span><span class="o">.</span><span class="na">push</span><span class="o">(</span><span class="n">s</span><span class="o">);</span>
    <span class="nc">String</span> <span class="n">s</span><span class="o">;</span>
    <span class="k">while</span><span class="o">((</span><span class="n">s</span> <span class="o">=</span> <span class="n">lss</span><span class="o">.</span><span class="na">pop</span><span class="o">())</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">s</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output:
stun!
on
Phasers
*/</span><span class="c1">//:~</span>
</pre></table></code></div></div><h3 id="1523-randomlist">15.2.3 RandomList</h3><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="c1">//: generics/RandomList.java</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">RandomList</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">storage</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;();</span>
  <span class="kd">private</span> <span class="nc">Random</span> <span class="n">rand</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Random</span><span class="o">(</span><span class="mi">47</span><span class="o">);</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="no">T</span> <span class="n">item</span><span class="o">)</span> <span class="o">{</span> <span class="n">storage</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">item</span><span class="o">);</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="no">T</span> <span class="nf">select</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">storage</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">rand</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="n">storage</span><span class="o">.</span><span class="na">size</span><span class="o">()));</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">RandomList</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">rs</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">RandomList</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;();</span>
    <span class="k">for</span><span class="o">(</span><span class="nc">String</span> <span class="nl">s:</span> <span class="o">(</span><span class="s">"The quick brown fox jumped over "</span> <span class="o">+</span>
        <span class="s">"the lazy brown dog"</span><span class="o">).</span><span class="na">split</span><span class="o">(</span><span class="s">" "</span><span class="o">))</span>
      <span class="n">rs</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">s</span><span class="o">);</span>
    <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">11</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">rs</span><span class="o">.</span><span class="na">select</span><span class="o">()</span> <span class="o">+</span> <span class="s">" "</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output:
brown over fox quick quick dog brown The brown lazy brown
*/</span><span class="c1">//:~</span>
</pre></table></code></div></div><h2 id="153-泛型接口">15.3 泛型接口</h2><p>泛型也可以应用于接口。</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="c1">//: net/mindview/util/Generator.java</span>
<span class="c1">// A generic interface.</span>
<span class="kn">package</span> <span class="nn">net.mindview.util</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Generator</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="o">{</span> <span class="no">T</span> <span class="nf">next</span><span class="o">();</span> <span class="o">}</span> <span class="c1">///:~</span>
</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre><td class="rouge-code"><pre><span class="c1">//: generics/coffee/Coffee.java</span>
<span class="kn">package</span> <span class="nn">generics.coffee</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Coffee</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="kt">long</span> <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">id</span> <span class="o">=</span> <span class="n">counter</span><span class="o">++;</span>
  <span class="kd">public</span> <span class="nc">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="nf">getClass</span><span class="o">().</span><span class="na">getSimpleName</span><span class="o">()</span> <span class="o">+</span> <span class="s">" "</span> <span class="o">+</span> <span class="n">id</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~</span>


<span class="c1">//: generics/coffee/Latte.java</span>
<span class="kn">package</span> <span class="nn">generics.coffee</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Latte</span> <span class="kd">extends</span> <span class="nc">Coffee</span> <span class="o">{}</span> <span class="c1">///:~</span>

<span class="c1">//: generics/coffee/Mocha.java</span>
<span class="kn">package</span> <span class="nn">generics.coffee</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Mocha</span> <span class="kd">extends</span> <span class="nc">Coffee</span> <span class="o">{}</span> <span class="c1">///:~</span>

<span class="c1">//: generics/coffee/Cappuccino.java</span>
<span class="kn">package</span> <span class="nn">generics.coffee</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Cappuccino</span> <span class="kd">extends</span> <span class="nc">Coffee</span> <span class="o">{}</span> <span class="c1">///:~</span>

<span class="c1">//: generics/coffee/Americano.java</span>
<span class="kn">package</span> <span class="nn">generics.coffee</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Americano</span> <span class="kd">extends</span> <span class="nc">Coffee</span> <span class="o">{}</span> <span class="c1">///:~</span>


<span class="c1">//: generics/coffee/Breve.java</span>
<span class="kn">package</span> <span class="nn">generics.coffee</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Breve</span> <span class="kd">extends</span> <span class="nc">Coffee</span> <span class="o">{}</span> <span class="c1">///:~</span>
</pre></table></code></div></div><p>编写一个类，实现<code class="language-plaintext highlighter-rouge">Generator&lt;Coffee&gt;</code>接口。</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
</pre><td class="rouge-code"><pre><span class="c1">//: generics/coffee/CoffeeGenerator.java</span>
<span class="c1">// Generate different types of Coffee:</span>
<span class="kn">package</span> <span class="nn">generics.coffee</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">net.mindview.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CoffeeGenerator</span> <span class="kd">implements</span> <span class="nc">Generator</span><span class="o">&lt;</span><span class="nc">Coffee</span><span class="o">&gt;,</span> <span class="nc">Iterable</span><span class="o">&lt;</span><span class="nc">Coffee</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="nc">Class</span><span class="o">[]</span> <span class="n">types</span> <span class="o">=</span> <span class="o">{</span> <span class="nc">Latte</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="nc">Mocha</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
    <span class="nc">Cappuccino</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="nc">Americano</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="nc">Breve</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="o">};</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="nc">Random</span> <span class="n">rand</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Random</span><span class="o">(</span><span class="mi">47</span><span class="o">);</span>
  <span class="kd">public</span> <span class="nf">CoffeeGenerator</span><span class="o">()</span> <span class="o">{}</span>
  <span class="c1">// For iteration:</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">CoffeeGenerator</span><span class="o">(</span><span class="kt">int</span> <span class="n">sz</span><span class="o">)</span> <span class="o">{</span> <span class="n">size</span> <span class="o">=</span> <span class="n">sz</span><span class="o">;</span> <span class="o">}</span>    
  <span class="kd">public</span> <span class="nc">Coffee</span> <span class="nf">next</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">{</span> <span class="c1">//随机生成一种类型</span>
      <span class="k">return</span> <span class="o">(</span><span class="nc">Coffee</span><span class="o">)</span><span class="n">types</span><span class="o">[</span><span class="n">rand</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="n">types</span><span class="o">.</span><span class="na">length</span><span class="o">)].</span><span class="na">newInstance</span><span class="o">();</span>
      <span class="c1">// Report programmer errors at run time:</span>
    <span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
  <span class="c1">//迭代器</span>
  <span class="kd">class</span> <span class="nc">CoffeeIterator</span> <span class="kd">implements</span> <span class="nc">Iterator</span><span class="o">&lt;</span><span class="nc">Coffee</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="n">size</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">hasNext</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">;</span> <span class="o">}</span>
    <span class="kd">public</span> <span class="nc">Coffee</span> <span class="nf">next</span><span class="o">()</span> <span class="o">{</span>
      <span class="n">count</span><span class="o">--;</span>
      <span class="k">return</span> <span class="nc">CoffeeGenerator</span><span class="o">.</span><span class="na">this</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">remove</span><span class="o">()</span> <span class="o">{</span> <span class="c1">// Not implemented</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nf">UnsupportedOperationException</span><span class="o">();</span>
    <span class="o">}</span>
  <span class="o">};</span>    
  <span class="kd">public</span> <span class="nc">Iterator</span><span class="o">&lt;</span><span class="nc">Coffee</span><span class="o">&gt;</span> <span class="nf">iterator</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">CoffeeIterator</span><span class="o">();</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">CoffeeGenerator</span> <span class="n">gen</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">CoffeeGenerator</span><span class="o">();</span>
    <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">gen</span><span class="o">.</span><span class="na">next</span><span class="o">());</span>
    <span class="k">for</span><span class="o">(</span><span class="nc">Coffee</span> <span class="n">c</span> <span class="o">:</span> <span class="k">new</span> <span class="nc">CoffeeGenerator</span><span class="o">(</span><span class="mi">5</span><span class="o">))</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output:
Americano 0
Latte 1
Americano 2
Mocha 3
Mocha 4
Breve 5
Americano 6
Latte 7
Cappuccino 8
Cappuccino 9
*/</span><span class="c1">//:~</span>
</pre></table></code></div></div><p>下面的类是<code class="language-plaintext highlighter-rouge">Generator&lt;T&gt;</code>接口的另一个实现，它负责生成<code class="language-plaintext highlighter-rouge">Fibonacci</code>数列：</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="c1">//: generics/Fibonacci.java</span>
<span class="c1">// Generate a Fibonacci sequence.</span>
<span class="kn">import</span> <span class="nn">net.mindview.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Fibonacci</span> <span class="kd">implements</span> <span class="nc">Generator</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nc">Integer</span> <span class="nf">next</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">fib</span><span class="o">(</span><span class="n">count</span><span class="o">++);</span> <span class="o">}</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="nf">fib</span><span class="o">(</span><span class="kt">int</span> <span class="n">n</span><span class="o">)</span> <span class="o">{</span> <span class="c1">//递归</span>
    <span class="k">if</span><span class="o">(</span><span class="n">n</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="o">)</span> <span class="k">return</span> <span class="mi">1</span><span class="o">;</span>
    <span class="k">return</span> <span class="nf">fib</span><span class="o">(</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="o">)</span> <span class="o">+</span> <span class="n">fib</span><span class="o">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Fibonacci</span> <span class="n">gen</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Fibonacci</span><span class="o">();</span>
    <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">18</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">gen</span><span class="o">.</span><span class="na">next</span><span class="o">()</span> <span class="o">+</span> <span class="s">" "</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output:
1 1 2 3 5 8 13 21 34 55 89 144 233 377 610 987 1597 2584
*/</span><span class="c1">//:~</span>
</pre></table></code></div></div><p>虽然我们在<code class="language-plaintext highlighter-rouge">Fibonacci</code>类使用的都是<code class="language-plaintext highlighter-rouge">int</code>类型，但是其类型参数却是<code class="language-plaintext highlighter-rouge">Integer</code>。这个例子引出了<code class="language-plaintext highlighter-rouge">Java</code>泛型的一个局限性：基本类型无法作为类型参数。不过，<code class="language-plaintext highlighter-rouge">Java SE5</code>具备了自动打包和自动拆包的功能，可以很方便地在基本类型和相应的包装类型之间进行转换。</p><p>通过继承来创建适配器类：</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre><td class="rouge-code"><pre><span class="c1">//: generics/IterableFibonacci.java</span>
<span class="c1">// Adapt the Fibonacci class to make it Iterable.</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">IterableFibonacci</span>
<span class="kd">extends</span> <span class="nc">Fibonacci</span> <span class="kd">implements</span> <span class="nc">Iterable</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">n</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">IterableFibonacci</span><span class="o">(</span><span class="kt">int</span> <span class="n">count</span><span class="o">)</span> <span class="o">{</span> <span class="n">n</span> <span class="o">=</span> <span class="n">count</span><span class="o">;</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="nc">Iterator</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="nf">iterator</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nc">Iterator</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;()</span> <span class="o">{</span>
      <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">hasNext</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">;</span> <span class="o">}</span>
      <span class="kd">public</span> <span class="nc">Integer</span> <span class="nf">next</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">n</span><span class="o">--;</span>
        <span class="k">return</span> <span class="nc">IterableFibonacci</span><span class="o">.</span><span class="na">this</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
      <span class="o">}</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">remove</span><span class="o">()</span> <span class="o">{</span> <span class="c1">// Not implemented</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">UnsupportedOperationException</span><span class="o">();</span>
      <span class="o">}</span>
    <span class="o">};</span>
  <span class="o">}</span>    
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">:</span> <span class="k">new</span> <span class="nc">IterableFibonacci</span><span class="o">(</span><span class="mi">18</span><span class="o">))</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">i</span> <span class="o">+</span> <span class="s">" "</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output:
1 1 2 3 5 8 13 21 34 55 89 144 233 377 610 987 1597 2584
*/</span><span class="c1">//:~</span>
</pre></table></code></div></div><h2 id="154-泛型方法">15.4 泛型方法</h2><p>到目前为止，我们看到的泛型，都是应用于整个类上。但同样可以在类中包含参数化方法，而这个方法所在的类可以是泛型类，也可以不是泛型类。</p><p>如果使用泛型方法可以取代将整个类泛型化，那么就应该只使用泛型方法，因为它可以使事情更清楚明白。</p><p>要定义泛型方法，只需将泛型参数列表置于返回值之前，就像下面这样：</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre><span class="c1">//: generics/GenericMethods.java</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">GenericMethods</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="kt">void</span> <span class="nf">f</span><span class="o">(</span><span class="no">T</span> <span class="n">x</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">x</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getName</span><span class="o">());</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">GenericMethods</span> <span class="n">gm</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">GenericMethods</span><span class="o">();</span>
    <span class="n">gm</span><span class="o">.</span><span class="na">f</span><span class="o">(</span><span class="s">""</span><span class="o">);</span>
    <span class="n">gm</span><span class="o">.</span><span class="na">f</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span><span class="c1">//传入基本类型，自动打包机制就会介入其中，将基本类型的值包装为对应的对象。</span>
    <span class="n">gm</span><span class="o">.</span><span class="na">f</span><span class="o">(</span><span class="mf">1.0</span><span class="o">);</span>
    <span class="n">gm</span><span class="o">.</span><span class="na">f</span><span class="o">(</span><span class="mf">1.0</span><span class="no">F</span><span class="o">);</span>
    <span class="n">gm</span><span class="o">.</span><span class="na">f</span><span class="o">(</span><span class="sc">'c'</span><span class="o">);</span>
    <span class="n">gm</span><span class="o">.</span><span class="na">f</span><span class="o">(</span><span class="n">gm</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output:
java.lang.String
java.lang.Integer
java.lang.Double
java.lang.Float
java.lang.Character
GenericMethods
*/</span><span class="c1">//:~</span>
</pre></table></code></div></div><h3 id="1541-杠杆利用类型参数推断">15.4.1 杠杆利用类型参数推断</h3><p>创建一个持有<code class="language-plaintext highlighter-rouge">List</code>的<code class="language-plaintext highlighter-rouge">Map</code></p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nc">Map</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">,</span><span class="nc">List</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="nc">Pet</span><span class="o">&gt;&gt;</span> <span class="n">petPeople</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">,</span><span class="nc">List</span><span class="o">&lt;?</span> <span class="n">extendsPet</span><span class="o">&gt;&gt;();</span>
</pre></table></code></div></div><p>编译器本来应该能够从泛型参数列表中的参数推断出另一个参数，编译器暂时还做不到（Java7能做到了）。</p><p>编写一个工具类，它包含各种各样的<code class="language-plaintext highlighter-rouge">static</code>方法，专门用来创建各种常用的容器对象：</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre><td class="rouge-code"><pre><span class="c1">//: net/mindview/util/New.java</span>
<span class="c1">// Utilities to simplify generic container creation</span>
<span class="c1">// by using type argument inference.</span>
<span class="kn">package</span> <span class="nn">net.mindview.util</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">New</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;</span> <span class="nf">map</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;();</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="nc">List</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="nf">list</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;();</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="nc">LinkedList</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="nf">lList</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nc">LinkedList</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;();</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="nc">Set</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="nf">set</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nc">HashSet</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;();</span>
  <span class="o">}</span>    
  <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="nc">Queue</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="nf">queue</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nc">LinkedList</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;();</span>
  <span class="o">}</span>
  <span class="c1">// Examples:</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;&gt;</span> <span class="n">sls</span> <span class="o">=</span> <span class="nc">New</span><span class="o">.</span><span class="na">map</span><span class="o">();</span>
    <span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">ls</span> <span class="o">=</span> <span class="nc">New</span><span class="o">.</span><span class="na">list</span><span class="o">();</span>
    <span class="nc">LinkedList</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">lls</span> <span class="o">=</span> <span class="nc">New</span><span class="o">.</span><span class="na">lList</span><span class="o">();</span>
    <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">ss</span> <span class="o">=</span> <span class="nc">New</span><span class="o">.</span><span class="na">set</span><span class="o">();</span>
    <span class="nc">Queue</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">qs</span> <span class="o">=</span> <span class="nc">New</span><span class="o">.</span><span class="na">queue</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~</span>
</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="c1">//: generics/SimplerPets.java</span>
<span class="kn">import</span> <span class="nn">typeinfo.pets.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">net.mindview.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SimplerPets</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">,</span> <span class="nc">List</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="nc">Pet</span><span class="o">&gt;&gt;</span> <span class="n">petPeople</span> <span class="o">=</span> <span class="nc">New</span><span class="o">.</span><span class="na">map</span><span class="o">();</span>
    <span class="c1">// Rest of the code is the same...</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~</span>
</pre></table></code></div></div><p>类型推断只对赋值操作有效，其他时候并不起作用。</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="c1">//: generics/LimitsOfInference.java</span>
<span class="kn">import</span> <span class="nn">typeinfo.pets.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">LimitsOfInference</span> <span class="o">{</span>
  <span class="kd">static</span> <span class="kt">void</span>
  <span class="nf">f</span><span class="o">(</span><span class="nc">Map</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">,</span> <span class="nc">List</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="nc">Pet</span><span class="o">&gt;&gt;</span> <span class="n">petPeople</span><span class="o">)</span> <span class="o">{}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// f(New.map()); // Does not compile</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~</span>
</pre></table></code></div></div><h4 id="显式的类型说明">显式的类型说明</h4><p>在泛型方法中，可以显式地指明类型。</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="c1">//: generics/ExplicitTypeSpecification.java</span>
<span class="kn">import</span> <span class="nn">typeinfo.pets.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">net.mindview.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ExplicitTypeSpecification</span> <span class="o">{</span>
  <span class="kd">static</span> <span class="kt">void</span> <span class="nf">f</span><span class="o">(</span><span class="nc">Map</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">,</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Pet</span><span class="o">&gt;&gt;</span> <span class="n">petPeople</span><span class="o">)</span> <span class="o">{}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">f</span><span class="o">(</span><span class="nc">New</span><span class="o">.&lt;</span><span class="nc">Person</span><span class="o">,</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Pet</span><span class="o">&gt;&gt;</span><span class="n">map</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~</span>
</pre></table></code></div></div><h3 id="1542-可变参数与泛型方法">15.4.2 可变参数与泛型方法</h3><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre><span class="c1">//: generics/GenericVarargs.java</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">GenericVarargs</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="nc">List</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="nf">makeList</span><span class="o">(</span><span class="no">T</span><span class="o">...</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">List</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;();</span>
    <span class="k">for</span><span class="o">(</span><span class="no">T</span> <span class="n">item</span> <span class="o">:</span> <span class="n">args</span><span class="o">)</span>
      <span class="n">result</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">item</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">ls</span> <span class="o">=</span> <span class="n">makeList</span><span class="o">(</span><span class="s">"A"</span><span class="o">);</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">ls</span><span class="o">);</span>
    <span class="n">ls</span> <span class="o">=</span> <span class="n">makeList</span><span class="o">(</span><span class="s">"A"</span><span class="o">,</span> <span class="s">"B"</span><span class="o">,</span> <span class="s">"C"</span><span class="o">);</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">ls</span><span class="o">);</span>
    <span class="n">ls</span> <span class="o">=</span> <span class="n">makeList</span><span class="o">(</span><span class="s">"ABCDEFFHIJKLMNOPQRSTUVWXYZ"</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">""</span><span class="o">));</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">ls</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output:
[A]
[A, B, C]
[, A, B, C, D, E, F, F, H, I, J, K, L, M, N, O, P, Q, R, S, T, U, V, W, X, Y, Z]
*/</span><span class="c1">//:~</span>
</pre></table></code></div></div><h3 id="1543-用于generator的泛型方法">15.4.3 用于Generator的泛型方法</h3><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre><td class="rouge-code"><pre><span class="c1">//: generics/Generators.java</span>
<span class="c1">// A utility to use with Generators.</span>
<span class="kn">import</span> <span class="nn">generics.coffee.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">net.mindview.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Generators</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="nc">Collection</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="nf">fill</span><span class="o">(</span><span class="nc">Collection</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">coll</span><span class="o">,</span> <span class="nc">Generator</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">gen</span><span class="o">,</span> <span class="kt">int</span> <span class="n">n</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span>
      <span class="n">coll</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">gen</span><span class="o">.</span><span class="na">next</span><span class="o">());</span>
    <span class="k">return</span> <span class="n">coll</span><span class="o">;</span>
  <span class="o">}</span>    
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Collection</span><span class="o">&lt;</span><span class="nc">Coffee</span><span class="o">&gt;</span> <span class="n">coffee</span> <span class="o">=</span> <span class="n">fill</span><span class="o">(</span><span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">Coffee</span><span class="o">&gt;(),</span> <span class="k">new</span> <span class="nc">CoffeeGenerator</span><span class="o">(),</span> <span class="mi">4</span><span class="o">);</span>
    <span class="k">for</span><span class="o">(</span><span class="nc">Coffee</span> <span class="n">c</span> <span class="o">:</span> <span class="n">coffee</span><span class="o">)</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
    <span class="nc">Collection</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">fnumbers</span> <span class="o">=</span> <span class="n">fill</span><span class="o">(</span>
      <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;(),</span> <span class="k">new</span> <span class="nc">Fibonacci</span><span class="o">(),</span> <span class="mi">12</span><span class="o">);</span>
    <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">:</span> <span class="n">fnumbers</span><span class="o">)</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">i</span> <span class="o">+</span> <span class="s">", "</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output:
Americano 0
Latte 1
Americano 2
Mocha 3
1, 1, 2, 3, 5, 8, 13, 21, 34, 55, 89, 144,
*/</span><span class="c1">//:~</span>
</pre></table></code></div></div><h3 id="1544-一个通用的generator">15.4.4 一个通用的Generator</h3><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="c1">//: net/mindview/util/BasicGenerator.java</span>
<span class="c1">// Automatically create a Generator, given a class</span>
<span class="c1">// with a default (no-arg) constructor.</span>
<span class="kn">package</span> <span class="nn">net.mindview.util</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">BasicGenerator</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="kd">implements</span> <span class="nc">Generator</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="nc">Class</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">type</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">BasicGenerator</span><span class="o">(</span><span class="nc">Class</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">type</span><span class="o">){</span> <span class="k">this</span><span class="o">.</span><span class="na">type</span> <span class="o">=</span> <span class="n">type</span><span class="o">;</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="no">T</span> <span class="nf">next</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="c1">// Assumes type is a public class:</span>
      <span class="k">return</span> <span class="n">type</span><span class="o">.</span><span class="na">newInstance</span><span class="o">();</span> <span class="c1">//采用默认构造函数</span>
    <span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
  <span class="c1">// Produce a Default generator given a type token:</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="nc">Generator</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="nf">create</span><span class="o">(</span><span class="nc">Class</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">type</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nc">BasicGenerator</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;(</span><span class="n">type</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~</span>
</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="c1">//: generics/CountedObject.java</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CountedObject</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="kt">long</span> <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">id</span> <span class="o">=</span> <span class="n">counter</span><span class="o">++;</span>
  <span class="kd">public</span> <span class="kt">long</span> <span class="nf">id</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">id</span><span class="o">;</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="nc">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="s">"CountedObject "</span> <span class="o">+</span> <span class="n">id</span><span class="o">;}</span>
<span class="o">}</span> <span class="c1">///:~</span>
</pre></table></code></div></div><p>使用<code class="language-plaintext highlighter-rouge">BasicGenerator</code>，可以很容易地位<code class="language-plaintext highlighter-rouge">CountedObject</code>创建一个<code class="language-plaintext highlighter-rouge">Generator</code>：</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="c1">//: generics/BasicGeneratorDemo.java</span>
<span class="kn">import</span> <span class="nn">net.mindview.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">BasicGeneratorDemo</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Generator</span><span class="o">&lt;</span><span class="nc">CountedObject</span><span class="o">&gt;</span> <span class="n">gen</span> <span class="o">=</span>
      <span class="nc">BasicGenerator</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="nc">CountedObject</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">gen</span><span class="o">.</span><span class="na">next</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output:
CountedObject 0
CountedObject 1
CountedObject 2
CountedObject 3
CountedObject 4
*/</span><span class="c1">//:~</span>
</pre></table></code></div></div><h3 id="1545-简化元组的使用">15.4.5 简化元组的使用</h3><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="c1">//: net/mindview/util/Tuple.java</span>
<span class="c1">// Tuple library using type argument inference.</span>
<span class="kn">package</span> <span class="nn">net.mindview.util</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Tuple</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="no">A</span><span class="o">,</span><span class="no">B</span><span class="o">&gt;</span> <span class="nc">TwoTuple</span><span class="o">&lt;</span><span class="no">A</span><span class="o">,</span><span class="no">B</span><span class="o">&gt;</span> <span class="nf">tuple</span><span class="o">(</span><span class="no">A</span> <span class="n">a</span><span class="o">,</span> <span class="no">B</span> <span class="n">b</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nc">TwoTuple</span><span class="o">&lt;</span><span class="no">A</span><span class="o">,</span><span class="no">B</span><span class="o">&gt;(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="no">A</span><span class="o">,</span><span class="no">B</span><span class="o">,</span><span class="no">C</span><span class="o">&gt;</span> <span class="nc">ThreeTuple</span><span class="o">&lt;</span><span class="no">A</span><span class="o">,</span><span class="no">B</span><span class="o">,</span><span class="no">C</span><span class="o">&gt;</span> <span class="nf">tuple</span><span class="o">(</span><span class="no">A</span> <span class="n">a</span><span class="o">,</span> <span class="no">B</span> <span class="n">b</span><span class="o">,</span> <span class="no">C</span> <span class="n">c</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nc">ThreeTuple</span><span class="o">&lt;</span><span class="no">A</span><span class="o">,</span><span class="no">B</span><span class="o">,</span><span class="no">C</span><span class="o">&gt;(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">,</span> <span class="n">c</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="no">A</span><span class="o">,</span><span class="no">B</span><span class="o">,</span><span class="no">C</span><span class="o">,</span><span class="no">D</span><span class="o">&gt;</span> <span class="nc">FourTuple</span><span class="o">&lt;</span><span class="no">A</span><span class="o">,</span><span class="no">B</span><span class="o">,</span><span class="no">C</span><span class="o">,</span><span class="no">D</span><span class="o">&gt;</span> <span class="nf">tuple</span><span class="o">(</span><span class="no">A</span> <span class="n">a</span><span class="o">,</span> <span class="no">B</span> <span class="n">b</span><span class="o">,</span> <span class="no">C</span> <span class="n">c</span><span class="o">,</span> <span class="no">D</span> <span class="n">d</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nc">FourTuple</span><span class="o">&lt;</span><span class="no">A</span><span class="o">,</span><span class="no">B</span><span class="o">,</span><span class="no">C</span><span class="o">,</span><span class="no">D</span><span class="o">&gt;(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">,</span> <span class="n">c</span><span class="o">,</span> <span class="n">d</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="no">A</span><span class="o">,</span><span class="no">B</span><span class="o">,</span><span class="no">C</span><span class="o">,</span><span class="no">D</span><span class="o">,</span><span class="no">E</span><span class="o">&gt;</span> <span class="nc">FiveTuple</span><span class="o">&lt;</span><span class="no">A</span><span class="o">,</span><span class="no">B</span><span class="o">,</span><span class="no">C</span><span class="o">,</span><span class="no">D</span><span class="o">,</span><span class="no">E</span><span class="o">&gt;</span> <span class="nf">tuple</span><span class="o">(</span><span class="no">A</span> <span class="n">a</span><span class="o">,</span> <span class="no">B</span> <span class="n">b</span><span class="o">,</span> <span class="no">C</span> <span class="n">c</span><span class="o">,</span> <span class="no">D</span> <span class="n">d</span><span class="o">,</span> <span class="no">E</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nc">FiveTuple</span><span class="o">&lt;</span><span class="no">A</span><span class="o">,</span><span class="no">B</span><span class="o">,</span><span class="no">C</span><span class="o">,</span><span class="no">D</span><span class="o">,</span><span class="no">E</span><span class="o">&gt;(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">,</span> <span class="n">c</span><span class="o">,</span> <span class="n">d</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~</span>
</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre><td class="rouge-code"><pre><span class="c1">//: generics/TupleTest2.java</span>
<span class="kn">import</span> <span class="nn">net.mindview.util.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">net</span><span class="o">.</span><span class="na">mindview</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">Tuple</span><span class="o">.*;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TupleTest2</span> <span class="o">{</span>
  <span class="kd">static</span> <span class="nc">TwoTuple</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="nf">f</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="nf">tuple</span><span class="o">(</span><span class="s">"hi"</span><span class="o">,</span> <span class="mi">47</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">static</span> <span class="nc">TwoTuple</span> <span class="nf">f2</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">tuple</span><span class="o">(</span><span class="s">"hi"</span><span class="o">,</span> <span class="mi">47</span><span class="o">);</span> <span class="o">}</span>
  <span class="kd">static</span> <span class="nc">ThreeTuple</span><span class="o">&lt;</span><span class="nc">Amphibian</span><span class="o">,</span><span class="nc">String</span><span class="o">,</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="nf">g</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="nf">tuple</span><span class="o">(</span><span class="k">new</span> <span class="nc">Amphibian</span><span class="o">(),</span> <span class="s">"hi"</span><span class="o">,</span> <span class="mi">47</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">static</span> <span class="nc">FourTuple</span><span class="o">&lt;</span><span class="nc">Vehicle</span><span class="o">,</span><span class="nc">Amphibian</span><span class="o">,</span><span class="nc">String</span><span class="o">,</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="nf">h</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="nf">tuple</span><span class="o">(</span><span class="k">new</span> <span class="nc">Vehicle</span><span class="o">(),</span> <span class="k">new</span> <span class="nc">Amphibian</span><span class="o">(),</span> <span class="s">"hi"</span><span class="o">,</span> <span class="mi">47</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">static</span> <span class="nc">FiveTuple</span><span class="o">&lt;</span><span class="nc">Vehicle</span><span class="o">,</span><span class="nc">Amphibian</span><span class="o">,</span><span class="nc">String</span><span class="o">,</span><span class="nc">Integer</span><span class="o">,</span><span class="nc">Double</span><span class="o">&gt;</span> <span class="nf">k</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="nf">tuple</span><span class="o">(</span><span class="k">new</span> <span class="nc">Vehicle</span><span class="o">(),</span> <span class="k">new</span> <span class="nc">Amphibian</span><span class="o">(),</span>
      <span class="s">"hi"</span><span class="o">,</span> <span class="mi">47</span><span class="o">,</span> <span class="mf">11.1</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">TwoTuple</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">ttsi</span> <span class="o">=</span> <span class="n">f</span><span class="o">();</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">ttsi</span><span class="o">);</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">f2</span><span class="o">());</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">g</span><span class="o">());</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">h</span><span class="o">());</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">k</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output: (80% match)
(hi, 47)
(hi, 47)
(Amphibian@7d772e, hi, 47)
(Vehicle@757aef, Amphibian@d9f9c3, hi, 47)
(Vehicle@1a46e30, Amphibian@3e25a5, hi, 47, 11.1)
*/</span><span class="c1">//:~</span>
</pre></table></code></div></div><h3 id="1546-一个set实用工具">15.4.6 一个Set实用工具</h3><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre><td class="rouge-code"><pre><span class="c1">//: net/mindview/util/Sets.java</span>
<span class="kn">package</span> <span class="nn">net.mindview.util</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Sets</span> <span class="o">{</span>
    <span class="c1">//两个集合合并</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="nc">Set</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="nf">union</span><span class="o">(</span><span class="nc">Set</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">a</span><span class="o">,</span> <span class="nc">Set</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">b</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Set</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashSet</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;(</span><span class="n">a</span><span class="o">);</span>
    <span class="n">result</span><span class="o">.</span><span class="na">addAll</span><span class="o">(</span><span class="n">b</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
  <span class="o">}</span><span class="c1">//共有部分</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="nc">Set</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="nf">intersection</span><span class="o">(</span><span class="nc">Set</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">a</span><span class="o">,</span> <span class="nc">Set</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">b</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Set</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashSet</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;(</span><span class="n">a</span><span class="o">);</span>
    <span class="n">result</span><span class="o">.</span><span class="na">retainAll</span><span class="o">(</span><span class="n">b</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
  <span class="o">}</span>    
  <span class="c1">//移除subset中的元素</span>
  <span class="c1">// Subtract subset from superset:</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="nc">Set</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="nf">difference</span><span class="o">(</span><span class="nc">Set</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">superset</span><span class="o">,</span> <span class="nc">Set</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">subset</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Set</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashSet</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;(</span><span class="n">superset</span><span class="o">);</span>
    <span class="n">result</span><span class="o">.</span><span class="na">removeAll</span><span class="o">(</span><span class="n">subset</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="c1">// Reflexive--everything not in the intersection:</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="nc">Set</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="nf">complement</span><span class="o">(</span><span class="nc">Set</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">a</span><span class="o">,</span> <span class="nc">Set</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">b</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="nf">difference</span><span class="o">(</span><span class="n">union</span><span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">),</span> <span class="n">intersection</span><span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">));</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~</span>
</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="c1">//: generics/watercolors/Watercolors.java</span>
<span class="kn">package</span> <span class="nn">generics.watercolors</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">enum</span> <span class="nc">Watercolors</span> <span class="o">{</span>
  <span class="no">ZINC</span><span class="o">,</span> <span class="no">LEMON_YELLOW</span><span class="o">,</span> <span class="no">MEDIUM_YELLOW</span><span class="o">,</span> <span class="no">DEEP_YELLOW</span><span class="o">,</span> <span class="no">ORANGE</span><span class="o">,</span>
  <span class="no">BRILLIANT_RED</span><span class="o">,</span> <span class="no">CRIMSON</span><span class="o">,</span> <span class="no">MAGENTA</span><span class="o">,</span> <span class="no">ROSE_MADDER</span><span class="o">,</span> <span class="no">VIOLET</span><span class="o">,</span>
  <span class="no">CERULEAN_BLUE_HUE</span><span class="o">,</span> <span class="no">PHTHALO_BLUE</span><span class="o">,</span> <span class="no">ULTRAMARINE</span><span class="o">,</span>
  <span class="no">COBALT_BLUE_HUE</span><span class="o">,</span> <span class="no">PERMANENT_GREEN</span><span class="o">,</span> <span class="no">VIRIDIAN_HUE</span><span class="o">,</span>
  <span class="no">SAP_GREEN</span><span class="o">,</span> <span class="no">YELLOW_OCHRE</span><span class="o">,</span> <span class="no">BURNT_SIENNA</span><span class="o">,</span> <span class="no">RAW_UMBER</span><span class="o">,</span>
  <span class="no">BURNT_UMBER</span><span class="o">,</span> <span class="no">PAYNES_GRAY</span><span class="o">,</span> <span class="no">IVORY_BLACK</span>
<span class="o">}</span> <span class="c1">///:~</span>
</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre><td class="rouge-code"><pre><span class="c1">//: generics/WatercolorSets.java</span>
<span class="kn">import</span> <span class="nn">generics.watercolors.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">net</span><span class="o">.</span><span class="na">mindview</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">Print</span><span class="o">.*;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">net</span><span class="o">.</span><span class="na">mindview</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">Sets</span><span class="o">.*;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">generics</span><span class="o">.</span><span class="na">watercolors</span><span class="o">.</span><span class="na">Watercolors</span><span class="o">.*;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">WatercolorSets</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">Watercolors</span><span class="o">&gt;</span> <span class="n">set1</span> <span class="o">=</span>
      <span class="nc">EnumSet</span><span class="o">.</span><span class="na">range</span><span class="o">(</span><span class="no">BRILLIANT_RED</span><span class="o">,</span> <span class="no">VIRIDIAN_HUE</span><span class="o">);</span>
    <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">Watercolors</span><span class="o">&gt;</span> <span class="n">set2</span> <span class="o">=</span>
      <span class="nc">EnumSet</span><span class="o">.</span><span class="na">range</span><span class="o">(</span><span class="no">CERULEAN_BLUE_HUE</span><span class="o">,</span> <span class="no">BURNT_UMBER</span><span class="o">);</span>
    <span class="n">print</span><span class="o">(</span><span class="s">"set1: "</span> <span class="o">+</span> <span class="n">set1</span><span class="o">);</span>
    <span class="n">print</span><span class="o">(</span><span class="s">"set2: "</span> <span class="o">+</span> <span class="n">set2</span><span class="o">);</span>
    <span class="n">print</span><span class="o">(</span><span class="s">"union(set1, set2): "</span> <span class="o">+</span> <span class="n">union</span><span class="o">(</span><span class="n">set1</span><span class="o">,</span> <span class="n">set2</span><span class="o">));</span>
    <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">Watercolors</span><span class="o">&gt;</span> <span class="n">subset</span> <span class="o">=</span> <span class="n">intersection</span><span class="o">(</span><span class="n">set1</span><span class="o">,</span> <span class="n">set2</span><span class="o">);</span>
    <span class="n">print</span><span class="o">(</span><span class="s">"intersection(set1, set2): "</span> <span class="o">+</span> <span class="n">subset</span><span class="o">);</span>
    <span class="n">print</span><span class="o">(</span><span class="s">"difference(set1, subset): "</span> <span class="o">+</span> <span class="n">difference</span><span class="o">(</span><span class="n">set1</span><span class="o">,</span> <span class="n">subset</span><span class="o">));</span>    
    <span class="n">print</span><span class="o">(</span><span class="s">"difference(set2, subset): "</span> <span class="o">+</span> <span class="n">difference</span><span class="o">(</span><span class="n">set2</span><span class="o">,</span> <span class="n">subset</span><span class="o">));</span>
    <span class="n">print</span><span class="o">(</span><span class="s">"complement(set1, set2): "</span> <span class="o">+</span> <span class="n">complement</span><span class="o">(</span><span class="n">set1</span><span class="o">,</span> <span class="n">set2</span><span class="o">));</span>
  <span class="o">}</span>    
<span class="o">}</span> <span class="cm">/* Output: (Sample)
set1: [BRILLIANT_RED, CRIMSON, MAGENTA, ROSE_MADDER, VIOLET, CERULEAN_BLUE_HUE, PHTHALO_BLUE, ULTRAMARINE, COBALT_BLUE_HUE, PERMANENT_GREEN, VIRIDIAN_HUE]
set2: [CERULEAN_BLUE_HUE, PHTHALO_BLUE, ULTRAMARINE, COBALT_BLUE_HUE, PERMANENT_GREEN, VIRIDIAN_HUE, SAP_GREEN, YELLOW_OCHRE, BURNT_SIENNA, RAW_UMBER, BURNT_UMBER]
union(set1, set2): [SAP_GREEN, ROSE_MADDER, YELLOW_OCHRE, PERMANENT_GREEN, BURNT_UMBER, COBALT_BLUE_HUE, VIOLET, BRILLIANT_RED, RAW_UMBER, ULTRAMARINE, BURNT_SIENNA, CRIMSON, CERULEAN_BLUE_HUE, PHTHALO_BLUE, MAGENTA, VIRIDIAN_HUE]
intersection(set1, set2): [ULTRAMARINE, PERMANENT_GREEN, COBALT_BLUE_HUE, PHTHALO_BLUE, CERULEAN_BLUE_HUE, VIRIDIAN_HUE]
difference(set1, subset): [ROSE_MADDER, CRIMSON, VIOLET, MAGENTA, BRILLIANT_RED]
difference(set2, subset): [RAW_UMBER, SAP_GREEN, YELLOW_OCHRE, BURNT_SIENNA, BURNT_UMBER]
complement(set1, set2): [SAP_GREEN, ROSE_MADDER, YELLOW_OCHRE, BURNT_UMBER, VIOLET, BRILLIANT_RED, RAW_UMBER, BURNT_SIENNA, CRIMSON, MAGENTA]
*/</span><span class="c1">//:~</span>
</pre></table></code></div></div><h2 id="155-匿名内部类">15.5 匿名内部类</h2><p>泛型还可以应用于内部类以及匿名内部类。</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
</pre><td class="rouge-code"><pre><span class="c1">//: generics/BankTeller.java</span>
<span class="c1">// A very simple bank teller simulation.</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">net.mindview.util.*</span><span class="o">;</span>

<span class="kd">class</span> <span class="nc">Customer</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="kt">long</span> <span class="n">counter</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">id</span> <span class="o">=</span> <span class="n">counter</span><span class="o">++;</span>
  <span class="kd">private</span> <span class="nf">Customer</span><span class="o">()</span> <span class="o">{}</span>
  <span class="kd">public</span> <span class="nc">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="s">"Customer "</span> <span class="o">+</span> <span class="n">id</span><span class="o">;</span> <span class="o">}</span>
  <span class="c1">// A method to produce Generator objects:</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="nc">Generator</span><span class="o">&lt;</span><span class="nc">Customer</span><span class="o">&gt;</span> <span class="nf">generator</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nc">Generator</span><span class="o">&lt;</span><span class="nc">Customer</span><span class="o">&gt;()</span> <span class="o">{</span> <span class="c1">//匿名内部类</span>
      <span class="kd">public</span> <span class="nc">Customer</span> <span class="nf">next</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="k">new</span> <span class="nc">Customer</span><span class="o">();</span> <span class="o">}</span>
    <span class="o">};</span>
  <span class="o">}</span>
<span class="o">}</span>    

<span class="kd">class</span> <span class="nc">Teller</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="kt">long</span> <span class="n">counter</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">id</span> <span class="o">=</span> <span class="n">counter</span><span class="o">++;</span>
  <span class="kd">private</span> <span class="nf">Teller</span><span class="o">()</span> <span class="o">{}</span>
  <span class="kd">public</span> <span class="nc">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="s">"Teller "</span> <span class="o">+</span> <span class="n">id</span><span class="o">;</span> <span class="o">}</span>
  <span class="c1">// A single Generator object:</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="nc">Generator</span><span class="o">&lt;</span><span class="nc">Teller</span><span class="o">&gt;</span> <span class="n">generator</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Generator</span><span class="o">&lt;</span><span class="nc">Teller</span><span class="o">&gt;()</span> <span class="o">{</span>
      <span class="kd">public</span> <span class="nc">Teller</span> <span class="nf">next</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="k">new</span> <span class="nc">Teller</span><span class="o">();</span> <span class="o">}</span>
    <span class="o">};</span>
<span class="o">}</span>    

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">BankTeller</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">serve</span><span class="o">(</span><span class="nc">Teller</span> <span class="n">t</span><span class="o">,</span> <span class="nc">Customer</span> <span class="n">c</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">t</span> <span class="o">+</span> <span class="s">" serves "</span> <span class="o">+</span> <span class="n">c</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Random</span> <span class="n">rand</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Random</span><span class="o">(</span><span class="mi">47</span><span class="o">);</span>
    <span class="nc">Queue</span><span class="o">&lt;</span><span class="nc">Customer</span><span class="o">&gt;</span> <span class="n">line</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">LinkedList</span><span class="o">&lt;</span><span class="nc">Customer</span><span class="o">&gt;();</span>
    <span class="nc">Generators</span><span class="o">.</span><span class="na">fill</span><span class="o">(</span><span class="n">line</span><span class="o">,</span> <span class="nc">Customer</span><span class="o">.</span><span class="na">generator</span><span class="o">(),</span> <span class="mi">15</span><span class="o">);</span>
    <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Teller</span><span class="o">&gt;</span> <span class="n">tellers</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">Teller</span><span class="o">&gt;();</span>
    <span class="nc">Generators</span><span class="o">.</span><span class="na">fill</span><span class="o">(</span><span class="n">tellers</span><span class="o">,</span> <span class="nc">Teller</span><span class="o">.</span><span class="na">generator</span><span class="o">,</span> <span class="mi">4</span><span class="o">);</span>
    <span class="k">for</span><span class="o">(</span><span class="nc">Customer</span> <span class="n">c</span> <span class="o">:</span> <span class="n">line</span><span class="o">)</span>
      <span class="n">serve</span><span class="o">(</span><span class="n">tellers</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">rand</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="n">tellers</span><span class="o">.</span><span class="na">size</span><span class="o">())),</span> <span class="n">c</span><span class="o">);</span>
  <span class="o">}</span>    
<span class="o">}</span> <span class="cm">/* Output:
Teller 3 serves Customer 1
Teller 2 serves Customer 2
Teller 3 serves Customer 3
Teller 1 serves Customer 4
Teller 1 serves Customer 5
Teller 3 serves Customer 6
Teller 1 serves Customer 7
Teller 2 serves Customer 8
Teller 3 serves Customer 9
Teller 3 serves Customer 10
Teller 2 serves Customer 11
Teller 4 serves Customer 12
Teller 2 serves Customer 13
Teller 1 serves Customer 14
Teller 1 serves Customer 15
*/</span><span class="c1">//:~</span>
</pre></table></code></div></div><h2 id="156-构建复杂模型">15.6 构建复杂模型</h2><p>泛型的一个重要好处是能够简单而安全地创建复杂的模型。例如，我们可以很容易地创建<code class="language-plaintext highlighter-rouge">List</code>元组。</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="c1">//: generics/TupleList.java</span>
<span class="c1">// Combining generic types to make complex generic types.</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">net.mindview.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TupleList</span><span class="o">&lt;</span><span class="no">A</span><span class="o">,</span><span class="no">B</span><span class="o">,</span><span class="no">C</span><span class="o">,</span><span class="no">D</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">FourTuple</span><span class="o">&lt;</span><span class="no">A</span><span class="o">,</span><span class="no">B</span><span class="o">,</span><span class="no">C</span><span class="o">,</span><span class="no">D</span><span class="o">&gt;&gt;</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">TupleList</span><span class="o">&lt;</span><span class="nc">Vehicle</span><span class="o">,</span> <span class="nc">Amphibian</span><span class="o">,</span> <span class="nc">String</span><span class="o">,</span> <span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">tl</span> <span class="o">=</span>
      <span class="k">new</span> <span class="nc">TupleList</span><span class="o">&lt;</span><span class="nc">Vehicle</span><span class="o">,</span> <span class="nc">Amphibian</span><span class="o">,</span> <span class="nc">String</span><span class="o">,</span> <span class="nc">Integer</span><span class="o">&gt;();</span>
    <span class="n">tl</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="nc">TupleTest</span><span class="o">.</span><span class="na">h</span><span class="o">());</span>
    <span class="n">tl</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="nc">TupleTest</span><span class="o">.</span><span class="na">h</span><span class="o">());</span>
    <span class="k">for</span><span class="o">(</span><span class="nc">FourTuple</span><span class="o">&lt;</span><span class="nc">Vehicle</span><span class="o">,</span><span class="nc">Amphibian</span><span class="o">,</span><span class="nc">String</span><span class="o">,</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="nl">i:</span> <span class="n">tl</span><span class="o">)</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output: (75% match)
(Vehicle@11b86e7, Amphibian@35ce36, hi, 47)
(Vehicle@757aef, Amphibian@d9f9c3, hi, 47)
*/</span><span class="c1">//:~</span>
</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
</pre><td class="rouge-code"><pre><span class="c1">//: generics/Store.java</span>
<span class="c1">// Building up a complex model using generic containers.</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">net.mindview.util.*</span><span class="o">;</span>
<span class="c1">//商品</span>
<span class="kd">class</span> <span class="nc">Product</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">id</span><span class="o">;</span>
  <span class="kd">private</span> <span class="nc">String</span> <span class="n">description</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kt">double</span> <span class="n">price</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">Product</span><span class="o">(</span><span class="kt">int</span> <span class="nc">IDnumber</span><span class="o">,</span> <span class="nc">String</span> <span class="n">descr</span><span class="o">,</span> <span class="kt">double</span> <span class="n">price</span><span class="o">){</span>
    <span class="n">id</span> <span class="o">=</span> <span class="nc">IDnumber</span><span class="o">;</span>
    <span class="n">description</span> <span class="o">=</span> <span class="n">descr</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">price</span> <span class="o">=</span> <span class="n">price</span><span class="o">;</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">toString</span><span class="o">());</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="nc">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">id</span> <span class="o">+</span> <span class="s">": "</span> <span class="o">+</span> <span class="n">description</span> <span class="o">+</span> <span class="s">", price: $"</span> <span class="o">+</span> <span class="n">price</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">priceChange</span><span class="o">(</span><span class="kt">double</span> <span class="n">change</span><span class="o">)</span> <span class="o">{</span><span class="c1">//更改价格</span>
    <span class="n">price</span> <span class="o">+=</span> <span class="n">change</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="nc">Generator</span><span class="o">&lt;</span><span class="nc">Product</span><span class="o">&gt;</span> <span class="n">generator</span> <span class="o">=</span>
    <span class="k">new</span> <span class="nc">Generator</span><span class="o">&lt;</span><span class="nc">Product</span><span class="o">&gt;()</span> <span class="o">{</span>
      <span class="kd">private</span> <span class="nc">Random</span> <span class="n">rand</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Random</span><span class="o">(</span><span class="mi">47</span><span class="o">);</span>
      <span class="kd">public</span> <span class="nc">Product</span> <span class="nf">next</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">Product</span><span class="o">(</span><span class="n">rand</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="mi">1000</span><span class="o">),</span> <span class="s">"Test"</span><span class="o">,</span>
          <span class="nc">Math</span><span class="o">.</span><span class="na">round</span><span class="o">(</span><span class="n">rand</span><span class="o">.</span><span class="na">nextDouble</span><span class="o">()</span> <span class="o">*</span> <span class="mf">1000.0</span><span class="o">)</span> <span class="o">+</span> <span class="mf">0.99</span><span class="o">);</span> <span class="c1">//商品生成器</span>
      <span class="o">}</span>
    <span class="o">};</span>
<span class="o">}</span>
<span class="c1">//货架</span>
<span class="kd">class</span> <span class="nc">Shelf</span> <span class="kd">extends</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">Product</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="nf">Shelf</span><span class="o">(</span><span class="kt">int</span> <span class="n">nProducts</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Generators</span><span class="o">.</span><span class="na">fill</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="nc">Product</span><span class="o">.</span><span class="na">generator</span><span class="o">,</span> <span class="n">nProducts</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>    
<span class="c1">//走廊 </span>
<span class="kd">class</span> <span class="nc">Aisle</span> <span class="kd">extends</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">Shelf</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="nf">Aisle</span><span class="o">(</span><span class="kt">int</span> <span class="n">nShelves</span><span class="o">,</span> <span class="kt">int</span> <span class="n">nProducts</span><span class="o">)</span> <span class="o">{</span><span class="c1">//走廊摆放货架</span>
    <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">nShelves</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span>
      <span class="n">add</span><span class="o">(</span><span class="k">new</span> <span class="nc">Shelf</span><span class="o">(</span><span class="n">nProducts</span><span class="o">));</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">CheckoutStand</span> <span class="o">{}</span>
<span class="kd">class</span> <span class="nc">Office</span> <span class="o">{}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Store</span> <span class="kd">extends</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">Aisle</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">CheckoutStand</span><span class="o">&gt;</span> <span class="n">checkouts</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">CheckoutStand</span><span class="o">&gt;();</span>
  <span class="kd">private</span> <span class="nc">Office</span> <span class="n">office</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Office</span><span class="o">();</span>
  <span class="kd">public</span> <span class="nf">Store</span><span class="o">(</span><span class="kt">int</span> <span class="n">nAisles</span><span class="o">,</span> <span class="kt">int</span> <span class="n">nShelves</span><span class="o">,</span> <span class="kt">int</span> <span class="n">nProducts</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">nAisles</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span>
      <span class="n">add</span><span class="o">(</span><span class="k">new</span> <span class="nc">Aisle</span><span class="o">(</span><span class="n">nShelves</span><span class="o">,</span> <span class="n">nProducts</span><span class="o">));</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="nc">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
    <span class="nc">StringBuilder</span> <span class="n">result</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StringBuilder</span><span class="o">();</span>
    <span class="k">for</span><span class="o">(</span><span class="nc">Aisle</span> <span class="n">a</span> <span class="o">:</span> <span class="k">this</span><span class="o">)</span>
      <span class="k">for</span><span class="o">(</span><span class="nc">Shelf</span> <span class="n">s</span> <span class="o">:</span> <span class="n">a</span><span class="o">)</span>
        <span class="k">for</span><span class="o">(</span><span class="nc">Product</span> <span class="n">p</span> <span class="o">:</span> <span class="n">s</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">result</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">p</span><span class="o">);</span>
          <span class="n">result</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">"\n"</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="k">new</span> <span class="nc">Store</span><span class="o">(</span><span class="mi">14</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">10</span><span class="o">));</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output:
258: Test, price: $400.99
861: Test, price: $160.99
868: Test, price: $417.99
207: Test, price: $268.99
551: Test, price: $114.99
278: Test, price: $804.99
520: Test, price: $554.99
140: Test, price: $530.99
...
*/</span><span class="c1">//:~</span>
</pre></table></code></div></div><h2 id="157-擦除的神秘之处">15.7 擦除的神秘之处</h2><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="c1">//: generics/ErasedTypeEquivalence.java</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ErasedTypeEquivalence</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Class</span> <span class="n">c1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;().</span><span class="na">getClass</span><span class="o">();</span>
    <span class="nc">Class</span> <span class="n">c2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;().</span><span class="na">getClass</span><span class="o">();</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">c1</span> <span class="o">==</span> <span class="n">c2</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output:
true
*/</span><span class="c1">//:~</span>
</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre><td class="rouge-code"><pre><span class="c1">//: generics/LostInformation.java</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">class</span> <span class="nc">Frob</span> <span class="o">{}</span>
<span class="kd">class</span> <span class="nc">Fnorkle</span> <span class="o">{}</span>
<span class="kd">class</span> <span class="nc">Quark</span><span class="o">&lt;</span><span class="no">Q</span><span class="o">&gt;</span> <span class="o">{}</span>
<span class="kd">class</span> <span class="nc">Particle</span><span class="o">&lt;</span><span class="no">POSITION</span><span class="o">,</span><span class="no">MOMENTUM</span><span class="o">&gt;</span> <span class="o">{}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">LostInformation</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Frob</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">Frob</span><span class="o">&gt;();</span>
    <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">Frob</span><span class="o">,</span><span class="nc">Fnorkle</span><span class="o">&gt;</span> <span class="n">map</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;</span><span class="nc">Frob</span><span class="o">,</span><span class="nc">Fnorkle</span><span class="o">&gt;();</span>
    <span class="nc">Quark</span><span class="o">&lt;</span><span class="nc">Fnorkle</span><span class="o">&gt;</span> <span class="n">quark</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Quark</span><span class="o">&lt;</span><span class="nc">Fnorkle</span><span class="o">&gt;();</span>
    <span class="nc">Particle</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">,</span><span class="nc">Double</span><span class="o">&gt;</span> <span class="n">p</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Particle</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">,</span><span class="nc">Double</span><span class="o">&gt;();</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="nc">Arrays</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span>
      <span class="n">list</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getTypeParameters</span><span class="o">()));</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="nc">Arrays</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span>
      <span class="n">map</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getTypeParameters</span><span class="o">()));</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="nc">Arrays</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span>
      <span class="n">quark</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getTypeParameters</span><span class="o">()));</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="nc">Arrays</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span>
      <span class="n">p</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getTypeParameters</span><span class="o">()));</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output:
[E]
[K, V]
[Q]
[POSITION, MOMENTUM]
*/</span><span class="c1">//:~</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">Class.getTypeParameters()</code>将返回一个<code class="language-plaintext highlighter-rouge">TypeVariable</code>对象数组，表示有泛型声明所声明的类型参数。但是，正如你从输出中看到的，你能够发现的只是用作参数占位符的标识符，这并非有用的信息。</p><p><strong>在泛型代码内部，无法获得任何有关反省参数类型的信息。</strong></p><h3 id="1571-c的方式">15.7.1 C++的方式</h3><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="c1">//: generics/Templates.cpp</span>
<span class="cp">#include &lt;iostream&gt;
</span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">T</span><span class="p">&gt;</span> <span class="k">class</span> <span class="nc">Manipulator</span> <span class="p">{</span>
  <span class="n">T</span> <span class="n">obj</span><span class="p">;</span>
<span class="nl">public:</span>
  <span class="n">Manipulator</span><span class="p">(</span><span class="n">T</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span> <span class="p">}</span>
  <span class="kt">void</span> <span class="n">manipulate</span><span class="p">()</span> <span class="p">{</span> <span class="n">obj</span><span class="p">.</span><span class="n">f</span><span class="p">();</span> <span class="p">}</span>
<span class="p">};</span>

<span class="k">class</span> <span class="nc">HasF</span> <span class="p">{</span>
<span class="nl">public:</span>
  <span class="kt">void</span> <span class="n">f</span><span class="p">()</span> <span class="p">{</span> <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"HasF::f()"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span> <span class="p">}</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">HasF</span> <span class="n">hf</span><span class="p">;</span>
  <span class="n">Manipulator</span><span class="o">&lt;</span><span class="n">HasF</span><span class="o">&gt;</span> <span class="n">manipulator</span><span class="p">(</span><span class="n">hf</span><span class="p">);</span>
  <span class="n">manipulator</span><span class="p">.</span><span class="n">manipulate</span><span class="p">();</span>
<span class="p">}</span>
</pre></table></code></div></div><p>当实例化这个模版时，C++编译器将进行检查，因此在<code class="language-plaintext highlighter-rouge">Manipulator&lt;HasF&gt;</code>被实例化的这一刻，它看到<code class="language-plaintext highlighter-rouge">HasF</code>拥有一个方法<code class="language-plaintext highlighter-rouge">f()</code>。如果情况并非如此，就会得到一个编译期错误，这样类型安全就得到了保障。</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">HasF</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">f</span><span class="o">()</span> <span class="o">{</span> <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"HasF.f()"</span><span class="o">);</span> <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="c1">//: generics/Manipulation.java</span>
<span class="c1">// {CompileTimeError} (Won't compile)</span>

<span class="kd">class</span> <span class="nc">Manipulator</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="no">T</span> <span class="n">obj</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">Manipulator</span><span class="o">(</span><span class="no">T</span> <span class="n">x</span><span class="o">)</span> <span class="o">{</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">x</span><span class="o">;</span> <span class="o">}</span>
  <span class="c1">// Error: cannot find symbol: method f():</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">manipulate</span><span class="o">()</span> <span class="o">{</span> <span class="n">obj</span><span class="o">.</span><span class="na">f</span><span class="o">();</span> <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Manipulation</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">HasF</span> <span class="n">hf</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HasF</span><span class="o">();</span>
    <span class="nc">Manipulator</span><span class="o">&lt;</span><span class="nc">HasF</span><span class="o">&gt;</span> <span class="n">manipulator</span> <span class="o">=</span>
      <span class="k">new</span> <span class="nc">Manipulator</span><span class="o">&lt;</span><span class="nc">HasF</span><span class="o">&gt;(</span><span class="n">hf</span><span class="o">);</span>
    <span class="n">manipulator</span><span class="o">.</span><span class="na">manipulate</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~</span>
</pre></table></code></div></div><p>由于有了擦除，<code class="language-plaintext highlighter-rouge">Java</code>编译器无法将<code class="language-plaintext highlighter-rouge">manipulate()</code>必须能够在<code class="language-plaintext highlighter-rouge">obj</code>上调用<code class="language-plaintext highlighter-rouge">f()</code>这一需求映射到<code class="language-plaintext highlighter-rouge">HasF</code>拥有<code class="language-plaintext highlighter-rouge">f()</code>这一事实上。为了调用<code class="language-plaintext highlighter-rouge">f()</code>，我们必须协助泛型类，给定泛型类的边界，以此告知编译器只能接受遵循这个边界的类型。这里重用了<code class="language-plaintext highlighter-rouge">extends</code>关键字。由于有了边界，便面的代码就可以编译了：</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="c1">//: generics/Manipulator2.java</span>

<span class="kd">class</span> <span class="nc">Manipulator2</span><span class="o">&lt;</span><span class="no">T</span> <span class="kd">extends</span> <span class="nc">HasF</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="no">T</span> <span class="n">obj</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">Manipulator2</span><span class="o">(</span><span class="no">T</span> <span class="n">x</span><span class="o">)</span> <span class="o">{</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">x</span><span class="o">;</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">manipulate</span><span class="o">()</span> <span class="o">{</span> <span class="n">obj</span><span class="o">.</span><span class="na">f</span><span class="o">();</span> <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~</span>
</pre></table></code></div></div><p>我们说泛型类型参数将<code class="language-plaintext highlighter-rouge">擦除到它的第一个边界</code>，我们还提到了<code class="language-plaintext highlighter-rouge">类型参数的擦除</code>。编译器实际上会把类型参数替换为它的擦除，就像上面的示例一样。<code class="language-plaintext highlighter-rouge">T</code>擦除到了<code class="language-plaintext highlighter-rouge">HasF</code>，就好像在类的声明中用<code class="language-plaintext highlighter-rouge">HasF</code>替换了<code class="language-plaintext highlighter-rouge">T</code>一样。</p><p>自己执行擦除，创建出没有泛型的类：</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="c1">//: generics/Manipulator3.java</span>

<span class="kd">class</span> <span class="nc">Manipulator3</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="nc">HasF</span> <span class="n">obj</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">Manipulator3</span><span class="o">(</span><span class="nc">HasF</span> <span class="n">x</span><span class="o">)</span> <span class="o">{</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">x</span><span class="o">;</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">manipulate</span><span class="o">()</span> <span class="o">{</span> <span class="n">obj</span><span class="o">.</span><span class="na">f</span><span class="o">();</span> <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~</span>
</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="c1">//: generics/ReturnGenericType.java</span>

<span class="kd">class</span> <span class="nc">ReturnGenericType</span><span class="o">&lt;</span><span class="no">T</span> <span class="kd">extends</span> <span class="nc">HasF</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="no">T</span> <span class="n">obj</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">ReturnGenericType</span><span class="o">(</span><span class="no">T</span> <span class="n">x</span><span class="o">)</span> <span class="o">{</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">x</span><span class="o">;</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="no">T</span> <span class="nf">get</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">obj</span><span class="o">;</span> <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~</span>
</pre></table></code></div></div><h3 id="1572-迁移兼容性">15.7.2 迁移兼容性</h3><p>擦除不是一个语言特性。它是<code class="language-plaintext highlighter-rouge">Java</code>泛型实现中的一种折中，因为泛型不是<code class="language-plaintext highlighter-rouge">Java</code>语言出现时就有的组成部分，所以这种折中是必须的。</p><p>如果泛型在Java 1.0中就已经是其一部分了，那么这个特性将不会使用擦除来实现。它将使用具体化，使类型参数保持为第一类实体，因此你就能够在类型参数上执行基于类型的语言操作和反射操作。擦除减少了泛型的泛化性。泛型在Java中仍旧是有用的，只是不如它们本来设想的那么有用，而原因就是擦除。</p><p>在基于擦除的实现中，泛型类型被当做第二类型处理，即不能在某些重要的上下文环境中使用类型。泛型类型只有在静态类型检查期间才出现，在此之后，程序中的所有泛型类型都将被擦除，替换为它们的非泛型上界。例如，诸如<code class="language-plaintext highlighter-rouge">List&lt;T&gt;</code>这样的类型注解将被擦除为<code class="language-plaintext highlighter-rouge">List</code>，而普通的类型变量在未指定边界的情况下将被擦除为<code class="language-plaintext highlighter-rouge">Object</code>。</p><p>擦除的核心动机是它使得泛化的客户端可以用非泛化的类库来使用，反之亦然，这经常被称为“迁移兼容性”。在理想情况下，当所有事物都可以同时被泛化时，我们就可以专注于此。在现实中，即使程序员只编写泛型代码，他们也必须处理在Java SE5之前编写的非泛型类库。那些类库的作者可能从没有想过要泛化他们的代码，或者可能刚刚开始接触泛型。</p><p>因此Java泛型不仅必须支持向后兼容性，即现有的代码和类文件仍旧合法，并且继续保持之前的含义；而且还要支持迁移兼容性，使得类库按照它们自己的步调变成泛型的，并且当某个类库变为泛型时，不会破坏依赖于他的代码和应用程序。在决定这就是目标之后，Java设计者们和从事此问题相关工作的各个团队决策认为擦除是唯一可行的解决方法。通过允许非泛型代码与泛型代码啊共存，擦除使得这种向着泛型的迁移成为可能。</p><h3 id="1573-擦除的问题">15.7.3 擦除的问题</h3><p>擦除的代价是显著的。泛型不能用于显式地引用运行时类型的操作之中，例如<code class="language-plaintext highlighter-rouge">转型</code>、<code class="language-plaintext highlighter-rouge">instanceof</code>和<code class="language-plaintext highlighter-rouge">new表达式</code>。</p><p>另外，擦除和迁移兼容性意味着，使用泛型并不是强制的。</p><h3 id="1574-边界处的动作">15.7.4 边界处的动作</h3><p>正是因为有了擦除，我发现泛型最令人困惑的方面源自这样一个事实，即可以表示没有任何意义的事物。</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="c1">//: generics/ArrayMaker.java</span>
<span class="kn">import</span> <span class="nn">java.lang.reflect.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ArrayMaker</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="nc">Class</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">kind</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">ArrayMaker</span><span class="o">(</span><span class="nc">Class</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">kind</span><span class="o">)</span> <span class="o">{</span> <span class="k">this</span><span class="o">.</span><span class="na">kind</span> <span class="o">=</span> <span class="n">kind</span><span class="o">;</span> <span class="o">}</span>
  <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"unchecked"</span><span class="o">)</span>
  <span class="no">T</span><span class="o">[]</span> <span class="nf">create</span><span class="o">(</span><span class="kt">int</span> <span class="n">size</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="o">(</span><span class="no">T</span><span class="o">[])</span><span class="nc">Array</span><span class="o">.</span><span class="na">newInstance</span><span class="o">(</span><span class="n">kind</span><span class="o">,</span> <span class="n">size</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">ArrayMaker</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">stringMaker</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayMaker</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;(</span><span class="nc">String</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="nc">String</span><span class="o">[]</span> <span class="n">stringArray</span> <span class="o">=</span> <span class="n">stringMaker</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">9</span><span class="o">);</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="nc">Arrays</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">stringArray</span><span class="o">));</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output:
[null, null, null, null, null, null, null, null, null]
*/</span><span class="c1">//:~</span>
</pre></table></code></div></div><p>即使<code class="language-plaintext highlighter-rouge">kind</code>被存储为<code class="language-plaintext highlighter-rouge">Class&lt;T&gt;</code>，擦除也意味着它实际将被存储为<code class="language-plaintext highlighter-rouge">Class</code>，没有任何参数。因此，当你在使用它时，例如在创建数组时，<code class="language-plaintext highlighter-rouge">Array.newInstance()</code>实际上并未拥有<code class="language-plaintext highlighter-rouge">kind</code>所蕴含的类型信息，因此这不会产生具体的结果，所以必须转型，这将产生一条令你无法满意的警告。</p><p>注意，对于在泛型中创建数组，使用<code class="language-plaintext highlighter-rouge">Array.newInstance()</code>是推荐的方式。</p><p>如果我们要创建一个容器而不是数组，情况就有些不同了：</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="c1">//: generics/ListMaker.java</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ListMaker</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="nc">List</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="nf">create</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;();</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">ListMaker</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">stringMaker</span><span class="o">=</span> <span class="k">new</span> <span class="nc">ListMaker</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;();</span>
    <span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">stringList</span> <span class="o">=</span> <span class="n">stringMaker</span><span class="o">.</span><span class="na">create</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~</span>
</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="c1">//: generics/FilledListMaker.java</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FilledListMaker</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="nc">List</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="nf">create</span><span class="o">(</span><span class="no">T</span> <span class="n">t</span><span class="o">,</span> <span class="kt">int</span> <span class="n">n</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">List</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;();</span>
    <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span>
      <span class="n">result</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">t</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">FilledListMaker</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">stringMaker</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">FilledListMaker</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;();</span>
    <span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="n">stringMaker</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"Hello"</span><span class="o">,</span> <span class="mi">4</span><span class="o">);</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">list</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output:
[Hello, Hello, Hello, Hello]
*/</span><span class="c1">//:~</span>
</pre></table></code></div></div><p>即使编译器无法知道有关<code class="language-plaintext highlighter-rouge">create()</code>中的<code class="language-plaintext highlighter-rouge">T</code>的任何信息，但是它仍旧可以在编译期确保你放置到<code class="language-plaintext highlighter-rouge">result</code>中的对象具有<code class="language-plaintext highlighter-rouge">T</code>类型，使其适合<code class="language-plaintext highlighter-rouge">ArrayList&lt;T&gt;</code>。因此，即使擦除在方法或类内部移除了有关实际类型的信息，编译器仍旧可以确保在方法或类中使用的类型的内部一致性。</p><p><strong>因为擦除在方法体中移除了类型信息，所以在运行时的问题就是</strong><code class="language-plaintext highlighter-rouge">边界</code><strong>：即对象进入和离开方法的地点。这些正是编译器在编译期执行类型检查并插入转型代码的地点。</strong></p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="c1">//: generics/SimpleHolder.java</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SimpleHolder</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="nc">Object</span> <span class="n">obj</span><span class="o">;</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">set</span><span class="o">(</span><span class="nc">Object</span> <span class="n">obj</span><span class="o">)</span> <span class="o">{</span> <span class="k">this</span><span class="o">.</span><span class="na">obj</span> <span class="o">=</span> <span class="n">obj</span><span class="o">;</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="nc">Object</span> <span class="nf">get</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">obj</span><span class="o">;</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">SimpleHolder</span> <span class="n">holder</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SimpleHolder</span><span class="o">();</span>
    <span class="n">holder</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="s">"Item"</span><span class="o">);</span>
    <span class="nc">String</span> <span class="n">s</span> <span class="o">=</span> <span class="o">(</span><span class="nc">String</span><span class="o">)</span><span class="n">holder</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~</span>
</pre></table></code></div></div><p>用<code class="language-plaintext highlighter-rouge">javap -c SimpleHolder</code>反编译这个类：</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">typeinfo</span><span class="o">.</span><span class="na">SimpleHolder</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="n">typeinfo</span><span class="o">.</span><span class="na">SimpleHolder</span><span class="o">();</span>
    <span class="nl">Code:</span>
       <span class="mi">0</span><span class="o">:</span> <span class="n">aload_0</span>
       <span class="mi">1</span><span class="o">:</span> <span class="n">invokespecial</span> <span class="err">#</span><span class="mi">1</span>                  <span class="c1">// Method java/lang/Object."&lt;init&gt;":()V</span>
       <span class="mi">4</span><span class="o">:</span> <span class="k">return</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">set</span><span class="o">(</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Object</span><span class="o">);</span>
    <span class="nl">Code:</span>
       <span class="mi">0</span><span class="o">:</span> <span class="n">aload_0</span>
       <span class="mi">1</span><span class="o">:</span> <span class="n">aload_1</span>
       <span class="mi">2</span><span class="o">:</span> <span class="n">putfield</span>      <span class="err">#</span><span class="mi">2</span>                  <span class="c1">// Field obj:Ljava/lang/Object;</span>
       <span class="mi">5</span><span class="o">:</span> <span class="k">return</span>

  <span class="kd">public</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Object</span> <span class="nf">get</span><span class="o">();</span>
    <span class="nl">Code:</span>
       <span class="mi">0</span><span class="o">:</span> <span class="n">aload_0</span>
       <span class="mi">1</span><span class="o">:</span> <span class="n">getfield</span>      <span class="err">#</span><span class="mi">2</span>                  <span class="c1">// Field obj:Ljava/lang/Object;</span>
       <span class="mi">4</span><span class="o">:</span> <span class="n">areturn</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span><span class="o">[]);</span>
    <span class="nl">Code:</span>
       <span class="mi">0</span><span class="o">:</span> <span class="k">new</span>           <span class="err">#</span><span class="mi">3</span>                  <span class="c1">// class typeinfo/SimpleHolder</span>
       <span class="mi">3</span><span class="o">:</span> <span class="n">dup</span>
       <span class="mi">4</span><span class="o">:</span> <span class="n">invokespecial</span> <span class="err">#</span><span class="mi">4</span>                  <span class="c1">// Method "&lt;init&gt;":()V</span>
       <span class="mi">7</span><span class="o">:</span> <span class="n">astore_1</span>
       <span class="mi">8</span><span class="o">:</span> <span class="n">aload_1</span>
       <span class="mi">9</span><span class="o">:</span> <span class="n">ldc</span>           <span class="err">#</span><span class="mi">5</span>                  <span class="c1">// String Item</span>
      <span class="mi">11</span><span class="o">:</span> <span class="n">invokevirtual</span> <span class="err">#</span><span class="mi">6</span>                  <span class="c1">// Method set:(Ljava/lang/Object;)V</span>
      <span class="mi">14</span><span class="o">:</span> <span class="n">aload_1</span>
      <span class="mi">15</span><span class="o">:</span> <span class="n">invokevirtual</span> <span class="err">#</span><span class="mi">7</span>                  <span class="c1">// Method get:()Ljava/lang/Object;</span>
      <span class="mi">18</span><span class="o">:</span> <span class="n">checkcast</span>     <span class="err">#</span><span class="mi">8</span>                  <span class="c1">// class java/lang/String</span>
      <span class="mi">21</span><span class="o">:</span> <span class="n">astore_2</span>
      <span class="mi">22</span><span class="o">:</span> <span class="k">return</span>
<span class="o">}</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">set()</code>和<code class="language-plaintext highlighter-rouge">get()</code>方法将直接存储和产生值，而转型是在调用<code class="language-plaintext highlighter-rouge">get()</code>的时候接受检查的。</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="c1">//: generics/GenericHolder.java</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">GenericHolder</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="no">T</span> <span class="n">obj</span><span class="o">;</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">set</span><span class="o">(</span><span class="no">T</span> <span class="n">obj</span><span class="o">)</span> <span class="o">{</span> <span class="k">this</span><span class="o">.</span><span class="na">obj</span> <span class="o">=</span> <span class="n">obj</span><span class="o">;</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="no">T</span> <span class="nf">get</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">obj</span><span class="o">;</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">GenericHolder</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">holder</span> <span class="o">=</span>
      <span class="k">new</span> <span class="nc">GenericHolder</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;();</span>
    <span class="n">holder</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="s">"Item"</span><span class="o">);</span>
    <span class="nc">String</span> <span class="n">s</span> <span class="o">=</span> <span class="n">holder</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~</span>
</pre></table></code></div></div><p>反编译：</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">typeinfo</span><span class="o">.</span><span class="na">GenericHolder</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="n">typeinfo</span><span class="o">.</span><span class="na">GenericHolder</span><span class="o">();</span>
    <span class="nl">Code:</span>
       <span class="mi">0</span><span class="o">:</span> <span class="n">aload_0</span>
       <span class="mi">1</span><span class="o">:</span> <span class="n">invokespecial</span> <span class="err">#</span><span class="mi">1</span>                  <span class="c1">// Method java/lang/Object."&lt;init&gt;":()V</span>
       <span class="mi">4</span><span class="o">:</span> <span class="k">return</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">set</span><span class="o">(</span><span class="no">T</span><span class="o">);</span>
    <span class="nl">Code:</span>
       <span class="mi">0</span><span class="o">:</span> <span class="n">aload_0</span>
       <span class="mi">1</span><span class="o">:</span> <span class="n">aload_1</span>
       <span class="mi">2</span><span class="o">:</span> <span class="n">putfield</span>      <span class="err">#</span><span class="mi">2</span>                  <span class="c1">// Field obj:Ljava/lang/Object;</span>
       <span class="mi">5</span><span class="o">:</span> <span class="k">return</span>

  <span class="kd">public</span> <span class="no">T</span> <span class="nf">get</span><span class="o">();</span>
    <span class="nl">Code:</span>
       <span class="mi">0</span><span class="o">:</span> <span class="n">aload_0</span>
       <span class="mi">1</span><span class="o">:</span> <span class="n">getfield</span>      <span class="err">#</span><span class="mi">2</span>                  <span class="c1">// Field obj:Ljava/lang/Object;</span>
       <span class="mi">4</span><span class="o">:</span> <span class="n">areturn</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span><span class="o">[]);</span>
    <span class="nl">Code:</span>
       <span class="mi">0</span><span class="o">:</span> <span class="k">new</span>           <span class="err">#</span><span class="mi">3</span>                  <span class="c1">// class typeinfo/GenericHolder</span>
       <span class="mi">3</span><span class="o">:</span> <span class="n">dup</span>
       <span class="mi">4</span><span class="o">:</span> <span class="n">invokespecial</span> <span class="err">#</span><span class="mi">4</span>                  <span class="c1">// Method "&lt;init&gt;":()V</span>
       <span class="mi">7</span><span class="o">:</span> <span class="n">astore_1</span>
       <span class="mi">8</span><span class="o">:</span> <span class="n">aload_1</span>
       <span class="mi">9</span><span class="o">:</span> <span class="n">ldc</span>           <span class="err">#</span><span class="mi">5</span>                  <span class="c1">// String Item</span>
      <span class="mi">11</span><span class="o">:</span> <span class="n">invokevirtual</span> <span class="err">#</span><span class="mi">6</span>                  <span class="c1">// Method set:(Ljava/lang/Object;)V</span>
      <span class="mi">14</span><span class="o">:</span> <span class="n">aload_1</span>
      <span class="mi">15</span><span class="o">:</span> <span class="n">invokevirtual</span> <span class="err">#</span><span class="mi">7</span>                  <span class="c1">// Method get:()Ljava/lang/Object;</span>
      <span class="mi">18</span><span class="o">:</span> <span class="n">checkcast</span>     <span class="err">#</span><span class="mi">8</span>                  <span class="c1">// class java/lang/String</span>
      <span class="mi">21</span><span class="o">:</span> <span class="n">astore_2</span>
      <span class="mi">22</span><span class="o">:</span> <span class="k">return</span>
<span class="o">}</span>
</pre></table></code></div></div><p>所产生的字节码是相同的。对进入<code class="language-plaintext highlighter-rouge">set()</code>的类型进行检查是不需要的，因为这将由编译器执行。而对从<code class="language-plaintext highlighter-rouge">get()</code>返回的值进行转型仍旧是需要的，但这与你自己必须执行的操作是一样的，此处它将由编译器自动插入。</p><p>由于所产生的<code class="language-plaintext highlighter-rouge">get()</code>和<code class="language-plaintext highlighter-rouge">set()</code>的字节码相同，所以在泛型中的所有动作都发生在边界处：对传递进来的值进行额外的编译器检查，并插入对传递出去的值的转型。</p><h2 id="158-擦除的补偿">15.8 擦除的补偿</h2><p>擦除丢失了在泛型代码中执行某些操作的能力。任何在运行时需要知道确切类型信息的操作都将无法工作：</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="c1">//: generics/Erased.java</span>
<span class="c1">// {CompileTimeError} (Won't compile)</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Erased</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="no">SIZE</span> <span class="o">=</span> <span class="mi">100</span><span class="o">;</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">f</span><span class="o">(</span><span class="nc">Object</span> <span class="n">arg</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span><span class="o">(</span><span class="n">arg</span> <span class="k">instanceof</span> <span class="no">T</span><span class="o">)</span> <span class="o">{}</span>          <span class="c1">// Error</span>
    <span class="no">T</span> <span class="kt">var</span> <span class="o">=</span> <span class="k">new</span> <span class="no">T</span><span class="o">();</span>                 <span class="c1">// Error</span>
    <span class="no">T</span><span class="o">[]</span> <span class="n">array</span> <span class="o">=</span> <span class="k">new</span> <span class="no">T</span><span class="o">[</span><span class="no">SIZE</span><span class="o">];</span>         <span class="c1">// Error</span>
    <span class="no">T</span><span class="o">[]</span> <span class="n">array</span> <span class="o">=</span> <span class="o">(</span><span class="no">T</span><span class="o">)</span><span class="k">new</span> <span class="nc">Object</span><span class="o">[</span><span class="no">SIZE</span><span class="o">];</span> <span class="c1">// Unchecked warning</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~</span>
</pre></table></code></div></div><p>偶尔可以绕过这些问题来编程，但是有时必须通过引入类型标签来对擦除进行补偿。这意味着你需要显式地传递你的类型的<code class="language-plaintext highlighter-rouge">Class</code>对象，以便你可以在类型表达式中使用它。</p><p>例如，在前面示例中对使用<code class="language-plaintext highlighter-rouge">instanceof</code>的尝试最终失败了，因为其类型信息已经被擦除了。如果引入类型标签，就可以转而使用动态的<code class="language-plaintext highlighter-rouge">isInstance()</code>：</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre><td class="rouge-code"><pre><span class="c1">//: generics/ClassTypeCapture.java</span>

<span class="kd">class</span> <span class="nc">Building</span> <span class="o">{}</span>
<span class="kd">class</span> <span class="nc">House</span> <span class="kd">extends</span> <span class="nc">Building</span> <span class="o">{}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ClassTypeCapture</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="nc">Class</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">kind</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">ClassTypeCapture</span><span class="o">(</span><span class="nc">Class</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">kind</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">kind</span> <span class="o">=</span> <span class="n">kind</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">f</span><span class="o">(</span><span class="nc">Object</span> <span class="n">arg</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">kind</span><span class="o">.</span><span class="na">isInstance</span><span class="o">(</span><span class="n">arg</span><span class="o">);</span>
  <span class="o">}</span>    
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">ClassTypeCapture</span><span class="o">&lt;</span><span class="nc">Building</span><span class="o">&gt;</span> <span class="n">ctt1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ClassTypeCapture</span><span class="o">&lt;</span><span class="nc">Building</span><span class="o">&gt;(</span><span class="nc">Building</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">ctt1</span><span class="o">.</span><span class="na">f</span><span class="o">(</span><span class="k">new</span> <span class="nc">Building</span><span class="o">()));</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">ctt1</span><span class="o">.</span><span class="na">f</span><span class="o">(</span><span class="k">new</span> <span class="nc">House</span><span class="o">()));</span>
    <span class="nc">ClassTypeCapture</span><span class="o">&lt;</span><span class="nc">House</span><span class="o">&gt;</span> <span class="n">ctt2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ClassTypeCapture</span><span class="o">&lt;</span><span class="nc">House</span><span class="o">&gt;(</span><span class="nc">House</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">ctt2</span><span class="o">.</span><span class="na">f</span><span class="o">(</span><span class="k">new</span> <span class="nc">Building</span><span class="o">()));</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">ctt2</span><span class="o">.</span><span class="na">f</span><span class="o">(</span><span class="k">new</span> <span class="nc">House</span><span class="o">()));</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output:
true
true
false
true
*/</span><span class="c1">//:~</span>
</pre></table></code></div></div><h3 id="1581-创建类型实例">15.8.1 创建类型实例</h3><p>在<code class="language-plaintext highlighter-rouge">Erased.java</code>中对创建一个<code class="language-plaintext highlighter-rouge">new T()</code>的尝试将无法实现，部分原因是因为擦除，而另一部分原因是因为编译器不能验证<code class="language-plaintext highlighter-rouge">T</code>具有默认构造器。但是在<code class="language-plaintext highlighter-rouge">C++</code>中，这种操作很自然，很直观，并且很安全：</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="c1">//: generics/InstantiateGenericType.cpp</span>
<span class="c1">// C++, not Java!</span>

<span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">T</span><span class="p">&gt;</span> <span class="k">class</span> <span class="nc">Foo</span> <span class="p">{</span>
  <span class="n">T</span> <span class="n">x</span><span class="p">;</span> <span class="c1">// Create a field of type T</span>
  <span class="n">T</span><span class="o">*</span> <span class="n">y</span><span class="p">;</span> <span class="c1">// Pointer to T</span>
<span class="nl">public:</span>
  <span class="c1">// Initialize the pointer:</span>
  <span class="n">Foo</span><span class="p">()</span> <span class="p">{</span> <span class="n">y</span> <span class="o">=</span> <span class="k">new</span> <span class="n">T</span><span class="p">();</span> <span class="p">}</span>
<span class="p">};</span>

<span class="k">class</span> <span class="nc">Bar</span> <span class="p">{};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">Foo</span><span class="o">&lt;</span><span class="n">Bar</span><span class="o">&gt;</span> <span class="n">fb</span><span class="p">;</span>
  <span class="n">Foo</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">fi</span><span class="p">;</span> <span class="c1">// ... and it works with primitives</span>
<span class="p">}</span> <span class="c1">///:~</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">Java</code>中的解决方案是传递一个工厂对象，并使用它来创建新的实例。最便利的工厂对象就是<code class="language-plaintext highlighter-rouge">Class</code>对象，因此如果使用类型标签，那么你就可以使用<code class="language-plaintext highlighter-rouge">newInstance()</code>来创建这个类型的新对象。</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre><td class="rouge-code"><pre><span class="c1">//: generics/InstantiateGenericType.java</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">net</span><span class="o">.</span><span class="na">mindview</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">Print</span><span class="o">.*;</span>

<span class="kd">class</span> <span class="nc">ClassAsFactory</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="no">T</span> <span class="n">x</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">ClassAsFactory</span><span class="o">(</span><span class="nc">Class</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">kind</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">x</span> <span class="o">=</span> <span class="n">kind</span><span class="o">.</span><span class="na">newInstance</span><span class="o">();</span>
    <span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Employee</span> <span class="o">{}</span>    

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">InstantiateGenericType</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">ClassAsFactory</span><span class="o">&lt;</span><span class="nc">Employee</span><span class="o">&gt;</span> <span class="n">fe</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ClassAsFactory</span><span class="o">&lt;</span><span class="nc">Employee</span><span class="o">&gt;(</span><span class="nc">Employee</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="n">print</span><span class="o">(</span><span class="s">"ClassAsFactory&lt;Employee&gt; succeeded"</span><span class="o">);</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="nc">ClassAsFactory</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">fi</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ClassAsFactory</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;(</span><span class="nc">Integer</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">print</span><span class="o">(</span><span class="s">"ClassAsFactory&lt;Integer&gt; failed"</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output:
ClassAsFactory&lt;Employee&gt; succeeded
ClassAsFactory&lt;Integer&gt; failed
*/</span><span class="c1">//:~</span>
</pre></table></code></div></div><p>这可以编译，但是会因<code class="language-plaintext highlighter-rouge">ClassAsFactory&lt;Integer&gt;</code>而失败，因为<code class="language-plaintext highlighter-rouge">Integer</code>没有任何默认的构造器。因为这个错误不是在编译期捕获的，所以<code class="language-plaintext highlighter-rouge">Sun</code>的伙计们对这种方式并不赞成，他们建议使用显式的工厂，并将限制其类型，使得只能接受实现了这个工厂的类：</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre><td class="rouge-code"><pre><span class="c1">//: generics/FactoryConstraint.java</span>

<span class="kd">interface</span> <span class="nc">FactoryI</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="no">T</span> <span class="nf">create</span><span class="o">();</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Foo2</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="no">T</span> <span class="n">x</span><span class="o">;</span>
  <span class="kd">public</span> <span class="o">&lt;</span><span class="no">F</span> <span class="kd">extends</span> <span class="nc">FactoryI</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;&gt;</span> <span class="nf">Foo2</span><span class="o">(</span><span class="no">F</span> <span class="n">factory</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="na">create</span><span class="o">();</span>
  <span class="o">}</span>
  <span class="c1">// ...</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">IntegerFactory</span> <span class="kd">implements</span> <span class="nc">FactoryI</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="nc">Integer</span> <span class="nf">create</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">Integer</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>    

<span class="kd">class</span> <span class="nc">Widget</span> <span class="o">{</span><span class="c1">//内部类</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Factory</span> <span class="kd">implements</span> <span class="nc">FactoryI</span><span class="o">&lt;</span><span class="nc">Widget</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="nc">Widget</span> <span class="nf">create</span><span class="o">()</span> <span class="o">{</span>
      <span class="k">return</span> <span class="k">new</span> <span class="nf">Widget</span><span class="o">();</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FactoryConstraint</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">new</span> <span class="nc">Foo2</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;(</span><span class="k">new</span> <span class="nc">IntegerFactory</span><span class="o">());</span>
    <span class="k">new</span> <span class="nc">Foo2</span><span class="o">&lt;</span><span class="nc">Widget</span><span class="o">&gt;(</span><span class="k">new</span> <span class="nc">Widget</span><span class="o">.</span><span class="na">Factory</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~</span>
</pre></table></code></div></div><p>另一种方式是<code class="language-plaintext highlighter-rouge">模版方法</code>设计模式。</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre><span class="c1">//: generics/CreatorGeneric.java</span>

<span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">GenericWithCreate</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kd">final</span> <span class="no">T</span> <span class="n">element</span><span class="o">;</span>
  <span class="nc">GenericWithCreate</span><span class="o">()</span> <span class="o">{</span> <span class="n">element</span> <span class="o">=</span> <span class="n">create</span><span class="o">();</span> <span class="o">}</span>
  <span class="kd">abstract</span> <span class="no">T</span> <span class="nf">create</span><span class="o">();</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">X</span> <span class="o">{}</span>

<span class="kd">class</span> <span class="nc">Creator</span> <span class="kd">extends</span> <span class="nc">GenericWithCreate</span><span class="o">&lt;</span><span class="no">X</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="no">X</span> <span class="nf">create</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="k">new</span> <span class="no">X</span><span class="o">();</span> <span class="o">}</span>
  <span class="kt">void</span> <span class="nf">f</span><span class="o">()</span> <span class="o">{</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">element</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getSimpleName</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span>    

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CreatorGeneric</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Creator</span> <span class="n">c</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Creator</span><span class="o">();</span>
    <span class="n">c</span><span class="o">.</span><span class="na">f</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output:
X
*/</span><span class="c1">//:~</span>
</pre></table></code></div></div><h3 id="1582-泛型数组">15.8.2 泛型数组</h3><p>正如你在<code class="language-plaintext highlighter-rouge">Erased.java</code>中所见，不能创建泛型数组。一般的解决方案是在任何想要创建泛型数组的地方都使用<code class="language-plaintext highlighter-rouge">ArrayList</code>：</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="c1">//: generics/ListOfGenerics.java</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ListOfGenerics</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">array</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;();</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="no">T</span> <span class="n">item</span><span class="o">)</span> <span class="o">{</span> <span class="n">array</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">item</span><span class="o">);</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="no">T</span> <span class="nf">get</span><span class="o">(</span><span class="kt">int</span> <span class="n">index</span><span class="o">)</span> <span class="o">{</span> <span class="k">return</span> <span class="n">array</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">index</span><span class="o">);</span> <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~</span>
</pre></table></code></div></div><p>有趣的是，可以按照编译器喜欢的方式来定义一个引用：</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="c1">//: generics/ArrayOfGenericReference.java</span>

<span class="kd">class</span> <span class="nc">Generic</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="o">{}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ArrayOfGenericReference</span> <span class="o">{</span>
  <span class="kd">static</span> <span class="nc">Generic</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;[]</span> <span class="n">gia</span><span class="o">;</span>
<span class="o">}</span> <span class="c1">///:~</span>
</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="c1">//: generics/ArrayOfGeneric.java</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ArrayOfGeneric</span> <span class="o">{</span>
  <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="no">SIZE</span> <span class="o">=</span> <span class="mi">100</span><span class="o">;</span>
  <span class="kd">static</span> <span class="nc">Generic</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;[]</span> <span class="n">gia</span><span class="o">;</span>
  <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"unchecked"</span><span class="o">)</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">// 可以将子类转换为父类，但不能讲父类转换为子类 所以这里创建Object数组也是不可以的</span>
    <span class="c1">// Compiles; produces ClassCastException:</span>
    <span class="c1">//! gia = (Generic&lt;Integer&gt;[])new Object[SIZE];</span>
    <span class="c1">// Runtime type is the raw (erased) type:</span>
    <span class="n">gia</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Generic</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;[])</span><span class="k">new</span> <span class="nc">Generic</span><span class="o">[</span><span class="no">SIZE</span><span class="o">];</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">gia</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getSimpleName</span><span class="o">());</span>
    <span class="n">gia</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Generic</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;();</span>
    <span class="c1">//! gia[1] = new Object(); // Compile-time error</span>
    <span class="c1">// Discovers type mismatch at compile time:</span>
    <span class="c1">//! gia[2] = new Generic&lt;Double&gt;();</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output:
Generic[]
*/</span><span class="c1">//:~</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">gia</code>已经被转型为<code class="language-plaintext highlighter-rouge">Generic&lt;Integer&gt;[]</code>，但是这个信息只存在于编译期（并且如果没有@Suppress Warnings注解，你将得到有关这个转型的警告）。在运行时，它仍旧是<code class="language-plaintext highlighter-rouge">Object</code>数组，而这将引发问题。<strong>成功创建泛型数组的唯一方式就是创建一个被擦除类型的新数组，然后对其转型。</strong></p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre><span class="c1">//: generics/GenericArray.java</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">GenericArray</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="no">T</span><span class="o">[]</span> <span class="n">array</span><span class="o">;</span>
  <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"unchecked"</span><span class="o">)</span>
  <span class="kd">public</span> <span class="nf">GenericArray</span><span class="o">(</span><span class="kt">int</span> <span class="n">sz</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">array</span> <span class="o">=</span> <span class="o">(</span><span class="no">T</span><span class="o">[])</span><span class="k">new</span> <span class="nc">Object</span><span class="o">[</span><span class="n">sz</span><span class="o">];</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">put</span><span class="o">(</span><span class="kt">int</span> <span class="n">index</span><span class="o">,</span> <span class="no">T</span> <span class="n">item</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">array</span><span class="o">[</span><span class="n">index</span><span class="o">]</span> <span class="o">=</span> <span class="n">item</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="no">T</span> <span class="nf">get</span><span class="o">(</span><span class="kt">int</span> <span class="n">index</span><span class="o">)</span> <span class="o">{</span> <span class="k">return</span> <span class="n">array</span><span class="o">[</span><span class="n">index</span><span class="o">];</span> <span class="o">}</span>
  <span class="c1">// Method that exposes the underlying representation:</span>
  <span class="kd">public</span> <span class="no">T</span><span class="o">[]</span> <span class="nf">rep</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">array</span><span class="o">;</span> <span class="o">}</span>    
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">GenericArray</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">gai</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">GenericArray</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;(</span><span class="mi">10</span><span class="o">);</span>
    <span class="c1">// This causes a ClassCastException:</span>
    <span class="c1">//! Integer[] ia = gai.rep();</span>
    <span class="c1">// This is OK:</span>
    <span class="nc">Object</span><span class="o">[]</span> <span class="n">oa</span> <span class="o">=</span> <span class="n">gai</span><span class="o">.</span><span class="na">rep</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~</span>
</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre><td class="rouge-code"><pre><span class="c1">//: generics/GenericArray2.java</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">GenericArray2</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="nc">Object</span><span class="o">[]</span> <span class="n">array</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">GenericArray2</span><span class="o">(</span><span class="kt">int</span> <span class="n">sz</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">array</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Object</span><span class="o">[</span><span class="n">sz</span><span class="o">];</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">put</span><span class="o">(</span><span class="kt">int</span> <span class="n">index</span><span class="o">,</span> <span class="no">T</span> <span class="n">item</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">array</span><span class="o">[</span><span class="n">index</span><span class="o">]</span> <span class="o">=</span> <span class="n">item</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"unchecked"</span><span class="o">)</span>
  <span class="kd">public</span> <span class="no">T</span> <span class="nf">get</span><span class="o">(</span><span class="kt">int</span> <span class="n">index</span><span class="o">)</span> <span class="o">{</span> <span class="k">return</span> <span class="o">(</span><span class="no">T</span><span class="o">)</span><span class="n">array</span><span class="o">[</span><span class="n">index</span><span class="o">];</span> <span class="o">}</span>
  <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"unchecked"</span><span class="o">)</span>
  <span class="kd">public</span> <span class="no">T</span><span class="o">[]</span> <span class="nf">rep</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="o">(</span><span class="no">T</span><span class="o">[])</span><span class="n">array</span><span class="o">;</span> <span class="c1">// Warning: unchecked cast</span>
  <span class="o">}</span>    
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">GenericArray2</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">gai</span> <span class="o">=</span>  <span class="k">new</span> <span class="nc">GenericArray2</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;(</span><span class="mi">10</span><span class="o">);</span>
    <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="o">;</span> <span class="n">i</span> <span class="o">++)</span>
      <span class="n">gai</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">i</span><span class="o">,</span> <span class="n">i</span><span class="o">);</span>
    <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="o">;</span> <span class="n">i</span> <span class="o">++)</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">gai</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">)</span> <span class="o">+</span> <span class="s">" "</span><span class="o">);</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">();</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="nc">Integer</span><span class="o">[]</span> <span class="n">ia</span> <span class="o">=</span> <span class="n">gai</span><span class="o">.</span><span class="na">rep</span><span class="o">();</span>
    <span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span> <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">e</span><span class="o">);</span> <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output: (Sample)
0 1 2 3 4 5 6 7 8 9
java.lang.ClassCastException: [Ljava.lang.Object; cannot be cast to [Ljava.lang.Integer;
*/</span><span class="c1">//:~</span>
</pre></table></code></div></div><p>不能声明<code class="language-plaintext highlighter-rouge">T[] array = new T[sz]</code>，因此我们创建了一个对象数组，然后将其转型。</p><p><code class="language-plaintext highlighter-rouge">rep()</code>方法将返回<code class="language-plaintext highlighter-rouge">T[]</code>，它在<code class="language-plaintext highlighter-rouge">main()</code>中将用于<code class="language-plaintext highlighter-rouge">gai</code>，因此应该是<code class="language-plaintext highlighter-rouge">Integer[]</code>，但是如果调用它，并尝试着将结果作为<code class="language-plaintext highlighter-rouge">Integer[]</code>引用来捕获，就会得到<code class="language-plaintext highlighter-rouge">ClassCastException</code>。</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="c1">//: generics/GenericArrayWithTypeToken.java</span>
<span class="kn">import</span> <span class="nn">java.lang.reflect.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">GenericArrayWithTypeToken</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="no">T</span><span class="o">[]</span> <span class="n">array</span><span class="o">;</span>
  <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"unchecked"</span><span class="o">)</span>
  <span class="kd">public</span> <span class="nf">GenericArrayWithTypeToken</span><span class="o">(</span><span class="nc">Class</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">type</span><span class="o">,</span> <span class="kt">int</span> <span class="n">sz</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">array</span> <span class="o">=</span> <span class="o">(</span><span class="no">T</span><span class="o">[])</span><span class="nc">Array</span><span class="o">.</span><span class="na">newInstance</span><span class="o">(</span><span class="n">type</span><span class="o">,</span> <span class="n">sz</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">put</span><span class="o">(</span><span class="kt">int</span> <span class="n">index</span><span class="o">,</span> <span class="no">T</span> <span class="n">item</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">array</span><span class="o">[</span><span class="n">index</span><span class="o">]</span> <span class="o">=</span> <span class="n">item</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="no">T</span> <span class="nf">get</span><span class="o">(</span><span class="kt">int</span> <span class="n">index</span><span class="o">)</span> <span class="o">{</span> <span class="k">return</span> <span class="n">array</span><span class="o">[</span><span class="n">index</span><span class="o">];</span> <span class="o">}</span>
  <span class="c1">// Expose the underlying representation:</span>
  <span class="kd">public</span> <span class="no">T</span><span class="o">[]</span> <span class="nf">rep</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">array</span><span class="o">;</span> <span class="o">}</span>    
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">GenericArrayWithTypeToken</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">gai</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">GenericArrayWithTypeToken</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;(</span><span class="nc">Integer</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">10</span><span class="o">);</span>
    <span class="c1">// This now works:</span>
    <span class="nc">Integer</span><span class="o">[]</span> <span class="n">ia</span> <span class="o">=</span> <span class="n">gai</span><span class="o">.</span><span class="na">rep</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~</span>
</pre></table></code></div></div><h2 id="159-边界">15.9 边界</h2><p>因为擦除移除了类型信息，所以，无界泛型参数调用的方法只是那些可以用<code class="language-plaintext highlighter-rouge">Object</code>调用的方法。但是，如果能够将这个参数限制为某个类型自己，那么就可以用这些类型子集来调用方法。为了执行这种限制，<code class="language-plaintext highlighter-rouge">Java</code>泛型重用了<code class="language-plaintext highlighter-rouge">extends</code>关键字。</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
</pre><td class="rouge-code"><pre><span class="c1">//: generics/BasicBounds.java</span>

<span class="kd">interface</span> <span class="nc">HasColor</span> <span class="o">{</span> <span class="n">java</span><span class="o">.</span><span class="na">awt</span><span class="o">.</span><span class="na">Color</span> <span class="nf">getColor</span><span class="o">();</span> <span class="o">}</span>

<span class="kd">class</span> <span class="nc">Colored</span><span class="o">&lt;</span><span class="no">T</span> <span class="kd">extends</span> <span class="nc">HasColor</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="no">T</span> <span class="n">item</span><span class="o">;</span>
  <span class="nc">Colored</span><span class="o">(</span><span class="no">T</span> <span class="n">item</span><span class="o">)</span> <span class="o">{</span> <span class="k">this</span><span class="o">.</span><span class="na">item</span> <span class="o">=</span> <span class="n">item</span><span class="o">;</span> <span class="o">}</span>
  <span class="no">T</span> <span class="nf">getItem</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">item</span><span class="o">;</span> <span class="o">}</span>
  <span class="c1">// The bound allows you to call a method:</span>
  <span class="n">java</span><span class="o">.</span><span class="na">awt</span><span class="o">.</span><span class="na">Color</span> <span class="nf">color</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">item</span><span class="o">.</span><span class="na">getColor</span><span class="o">();</span> <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Dimension</span> <span class="o">{</span> <span class="kd">public</span> <span class="kt">int</span> <span class="n">x</span><span class="o">,</span> <span class="n">y</span><span class="o">,</span> <span class="n">z</span><span class="o">;</span> <span class="o">}</span>

<span class="c1">//类必须在前</span>
<span class="c1">// This won't work -- class must be first, then interfaces:</span>
<span class="c1">// class ColoredDimension&lt;T extends HasColor &amp; Dimension&gt; {</span>

<span class="c1">// Multiple bounds:</span>
<span class="kd">class</span> <span class="nc">ColoredDimension</span><span class="o">&lt;</span><span class="no">T</span> <span class="kd">extends</span> <span class="nc">Dimension</span> <span class="o">&amp;</span> <span class="nc">HasColor</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="no">T</span> <span class="n">item</span><span class="o">;</span>
  <span class="nc">ColoredDimension</span><span class="o">(</span><span class="no">T</span> <span class="n">item</span><span class="o">)</span> <span class="o">{</span> <span class="k">this</span><span class="o">.</span><span class="na">item</span> <span class="o">=</span> <span class="n">item</span><span class="o">;</span> <span class="o">}</span>
  <span class="no">T</span> <span class="nf">getItem</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">item</span><span class="o">;</span> <span class="o">}</span>
  <span class="n">java</span><span class="o">.</span><span class="na">awt</span><span class="o">.</span><span class="na">Color</span> <span class="nf">color</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">item</span><span class="o">.</span><span class="na">getColor</span><span class="o">();</span> <span class="o">}</span>
  <span class="kt">int</span> <span class="nf">getX</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">item</span><span class="o">.</span><span class="na">x</span><span class="o">;</span> <span class="o">}</span>
  <span class="kt">int</span> <span class="nf">getY</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">item</span><span class="o">.</span><span class="na">y</span><span class="o">;</span> <span class="o">}</span>
  <span class="kt">int</span> <span class="nf">getZ</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">item</span><span class="o">.</span><span class="na">z</span><span class="o">;</span> <span class="o">}</span>
<span class="o">}</span>

<span class="kd">interface</span> <span class="nc">Weight</span> <span class="o">{</span> <span class="kt">int</span> <span class="nf">weight</span><span class="o">();</span> <span class="o">}</span>    

<span class="c1">// As with inheritance, you can have only one</span>
<span class="c1">// concrete class but multiple interfaces:</span>
<span class="kd">class</span> <span class="nc">Solid</span><span class="o">&lt;</span><span class="no">T</span> <span class="kd">extends</span> <span class="nc">Dimension</span> <span class="o">&amp;</span> <span class="nc">HasColor</span> <span class="o">&amp;</span> <span class="nc">Weight</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="no">T</span> <span class="n">item</span><span class="o">;</span>
  <span class="nc">Solid</span><span class="o">(</span><span class="no">T</span> <span class="n">item</span><span class="o">)</span> <span class="o">{</span> <span class="k">this</span><span class="o">.</span><span class="na">item</span> <span class="o">=</span> <span class="n">item</span><span class="o">;</span> <span class="o">}</span>
  <span class="no">T</span> <span class="nf">getItem</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">item</span><span class="o">;</span> <span class="o">}</span>
  <span class="n">java</span><span class="o">.</span><span class="na">awt</span><span class="o">.</span><span class="na">Color</span> <span class="nf">color</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">item</span><span class="o">.</span><span class="na">getColor</span><span class="o">();</span> <span class="o">}</span>
  <span class="kt">int</span> <span class="nf">getX</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">item</span><span class="o">.</span><span class="na">x</span><span class="o">;</span> <span class="o">}</span>
  <span class="kt">int</span> <span class="nf">getY</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">item</span><span class="o">.</span><span class="na">y</span><span class="o">;</span> <span class="o">}</span>
  <span class="kt">int</span> <span class="nf">getZ</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">item</span><span class="o">.</span><span class="na">z</span><span class="o">;</span> <span class="o">}</span>
  <span class="kt">int</span> <span class="nf">weight</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">item</span><span class="o">.</span><span class="na">weight</span><span class="o">();</span> <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Bounded</span> <span class="kd">extends</span> <span class="nc">Dimension</span> <span class="kd">implements</span> <span class="nc">HasColor</span><span class="o">,</span> <span class="nc">Weight</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="n">java</span><span class="o">.</span><span class="na">awt</span><span class="o">.</span><span class="na">Color</span> <span class="nf">getColor</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="kc">null</span><span class="o">;</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">weight</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="mi">0</span><span class="o">;</span> <span class="o">}</span>
<span class="o">}</span>    

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">BasicBounds</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Solid</span><span class="o">&lt;</span><span class="nc">Bounded</span><span class="o">&gt;</span> <span class="n">solid</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Solid</span><span class="o">&lt;</span><span class="nc">Bounded</span><span class="o">&gt;(</span><span class="k">new</span> <span class="nc">Bounded</span><span class="o">());</span>
    <span class="n">solid</span><span class="o">.</span><span class="na">color</span><span class="o">();</span>
    <span class="n">solid</span><span class="o">.</span><span class="na">getY</span><span class="o">();</span>
    <span class="n">solid</span><span class="o">.</span><span class="na">weight</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~</span>
</pre></table></code></div></div><p>继承的每个层次上添加边界限制：</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre><td class="rouge-code"><pre><span class="c1">//: generics/InheritBounds.java</span>

<span class="kd">class</span> <span class="nc">HoldItem</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="no">T</span> <span class="n">item</span><span class="o">;</span>
  <span class="nc">HoldItem</span><span class="o">(</span><span class="no">T</span> <span class="n">item</span><span class="o">)</span> <span class="o">{</span> <span class="k">this</span><span class="o">.</span><span class="na">item</span> <span class="o">=</span> <span class="n">item</span><span class="o">;</span> <span class="o">}</span>
  <span class="no">T</span> <span class="nf">getItem</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">item</span><span class="o">;</span> <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Colored2</span><span class="o">&lt;</span><span class="no">T</span> <span class="kd">extends</span> <span class="nc">HasColor</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="nc">HoldItem</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="nc">Colored2</span><span class="o">(</span><span class="no">T</span> <span class="n">item</span><span class="o">)</span> <span class="o">{</span> <span class="kd">super</span><span class="o">(</span><span class="n">item</span><span class="o">);</span> <span class="o">}</span>
  <span class="n">java</span><span class="o">.</span><span class="na">awt</span><span class="o">.</span><span class="na">Color</span> <span class="nf">color</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">item</span><span class="o">.</span><span class="na">getColor</span><span class="o">();</span> <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">ColoredDimension2</span><span class="o">&lt;</span><span class="no">T</span> <span class="kd">extends</span> <span class="nc">Dimension</span> <span class="o">&amp;</span> <span class="nc">HasColor</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="nc">Colored2</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="nc">ColoredDimension2</span><span class="o">(</span><span class="no">T</span> <span class="n">item</span><span class="o">)</span> <span class="o">{</span>  <span class="kd">super</span><span class="o">(</span><span class="n">item</span><span class="o">);</span> <span class="o">}</span>
  <span class="kt">int</span> <span class="nf">getX</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">item</span><span class="o">.</span><span class="na">x</span><span class="o">;</span> <span class="o">}</span>
  <span class="kt">int</span> <span class="nf">getY</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">item</span><span class="o">.</span><span class="na">y</span><span class="o">;</span> <span class="o">}</span>
  <span class="kt">int</span> <span class="nf">getZ</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">item</span><span class="o">.</span><span class="na">z</span><span class="o">;</span> <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Solid2</span><span class="o">&lt;</span><span class="no">T</span> <span class="kd">extends</span> <span class="nc">Dimension</span> <span class="o">&amp;</span> <span class="nc">HasColor</span> <span class="o">&amp;</span> <span class="nc">Weight</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="nc">ColoredDimension2</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="nc">Solid2</span><span class="o">(</span><span class="no">T</span> <span class="n">item</span><span class="o">)</span> <span class="o">{</span>  <span class="kd">super</span><span class="o">(</span><span class="n">item</span><span class="o">);</span> <span class="o">}</span>
  <span class="kt">int</span> <span class="nf">weight</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">item</span><span class="o">.</span><span class="na">weight</span><span class="o">();</span> <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">InheritBounds</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Solid2</span><span class="o">&lt;</span><span class="nc">Bounded</span><span class="o">&gt;</span> <span class="n">solid2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Solid2</span><span class="o">&lt;</span><span class="nc">Bounded</span><span class="o">&gt;(</span><span class="k">new</span> <span class="nc">Bounded</span><span class="o">());</span>
    <span class="n">solid2</span><span class="o">.</span><span class="na">color</span><span class="o">();</span>
    <span class="n">solid2</span><span class="o">.</span><span class="na">getY</span><span class="o">();</span>
    <span class="n">solid2</span><span class="o">.</span><span class="na">weight</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~</span>
</pre></table></code></div></div><p>具有更多层次的示例：</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
</pre><td class="rouge-code"><pre><span class="c1">//: generics/EpicBattle.java</span>
<span class="c1">// Demonstrating bounds in Java generics.</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">interface</span> <span class="nc">SuperPower</span> <span class="o">{}</span>
<span class="kd">interface</span> <span class="nc">XRayVision</span> <span class="kd">extends</span> <span class="nc">SuperPower</span> <span class="o">{</span>
  <span class="kt">void</span> <span class="nf">seeThroughWalls</span><span class="o">();</span>
<span class="o">}</span>
<span class="kd">interface</span> <span class="nc">SuperHearing</span> <span class="kd">extends</span> <span class="nc">SuperPower</span> <span class="o">{</span>
  <span class="kt">void</span> <span class="nf">hearSubtleNoises</span><span class="o">();</span>
<span class="o">}</span>
<span class="kd">interface</span> <span class="nc">SuperSmell</span> <span class="kd">extends</span> <span class="nc">SuperPower</span> <span class="o">{</span>
  <span class="kt">void</span> <span class="nf">trackBySmell</span><span class="o">();</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">SuperHero</span><span class="o">&lt;</span><span class="no">POWER</span> <span class="kd">extends</span> <span class="nc">SuperPower</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="no">POWER</span> <span class="n">power</span><span class="o">;</span>
  <span class="nc">SuperHero</span><span class="o">(</span><span class="no">POWER</span> <span class="n">power</span><span class="o">)</span> <span class="o">{</span> <span class="k">this</span><span class="o">.</span><span class="na">power</span> <span class="o">=</span> <span class="n">power</span><span class="o">;</span> <span class="o">}</span>
  <span class="no">POWER</span> <span class="nf">getPower</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">power</span><span class="o">;</span> <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">SuperSleuth</span><span class="o">&lt;</span><span class="no">POWER</span> <span class="kd">extends</span> <span class="nc">XRayVision</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="nc">SuperHero</span><span class="o">&lt;</span><span class="no">POWER</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="nc">SuperSleuth</span><span class="o">(</span><span class="no">POWER</span> <span class="n">power</span><span class="o">)</span> <span class="o">{</span> <span class="kd">super</span><span class="o">(</span><span class="n">power</span><span class="o">);</span> <span class="o">}</span>
  <span class="kt">void</span> <span class="nf">see</span><span class="o">()</span> <span class="o">{</span> <span class="n">power</span><span class="o">.</span><span class="na">seeThroughWalls</span><span class="o">();</span> <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">CanineHero</span><span class="o">&lt;</span><span class="no">POWER</span> <span class="kd">extends</span> <span class="nc">SuperHearing</span> <span class="o">&amp;</span> <span class="nc">SuperSmell</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="nc">SuperHero</span><span class="o">&lt;</span><span class="no">POWER</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="nc">CanineHero</span><span class="o">(</span><span class="no">POWER</span> <span class="n">power</span><span class="o">)</span> <span class="o">{</span> <span class="kd">super</span><span class="o">(</span><span class="n">power</span><span class="o">);</span> <span class="o">}</span>
  <span class="kt">void</span> <span class="nf">hear</span><span class="o">()</span> <span class="o">{</span> <span class="n">power</span><span class="o">.</span><span class="na">hearSubtleNoises</span><span class="o">();</span> <span class="o">}</span>
  <span class="kt">void</span> <span class="nf">smell</span><span class="o">()</span> <span class="o">{</span> <span class="n">power</span><span class="o">.</span><span class="na">trackBySmell</span><span class="o">();</span> <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">SuperHearSmell</span> <span class="kd">implements</span> <span class="nc">SuperHearing</span><span class="o">,</span> <span class="nc">SuperSmell</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">hearSubtleNoises</span><span class="o">()</span> <span class="o">{}</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">trackBySmell</span><span class="o">()</span> <span class="o">{}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">DogBoy</span> <span class="kd">extends</span> <span class="nc">CanineHero</span><span class="o">&lt;</span><span class="nc">SuperHearSmell</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="nc">DogBoy</span><span class="o">()</span> <span class="o">{</span> <span class="kd">super</span><span class="o">(</span><span class="k">new</span> <span class="nc">SuperHearSmell</span><span class="o">());</span> <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">EpicBattle</span> <span class="o">{</span>
  <span class="c1">// Bounds in generic methods:</span>
  <span class="kd">static</span> <span class="o">&lt;</span><span class="no">POWER</span> <span class="kd">extends</span> <span class="nc">SuperHearing</span><span class="o">&gt;</span> <span class="kt">void</span> <span class="nf">useSuperHearing</span><span class="o">(</span><span class="nc">SuperHero</span><span class="o">&lt;</span><span class="no">POWER</span><span class="o">&gt;</span> <span class="n">hero</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">hero</span><span class="o">.</span><span class="na">getPower</span><span class="o">().</span><span class="na">hearSubtleNoises</span><span class="o">();</span>
  <span class="o">}</span>
  <span class="kd">static</span> <span class="o">&lt;</span><span class="no">POWER</span> <span class="kd">extends</span> <span class="nc">SuperHearing</span> <span class="o">&amp;</span> <span class="nc">SuperSmell</span><span class="o">&gt;</span> <span class="kt">void</span> <span class="nf">superFind</span><span class="o">(</span><span class="nc">SuperHero</span><span class="o">&lt;</span><span class="no">POWER</span><span class="o">&gt;</span> <span class="n">hero</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">hero</span><span class="o">.</span><span class="na">getPower</span><span class="o">().</span><span class="na">hearSubtleNoises</span><span class="o">();</span>
    <span class="n">hero</span><span class="o">.</span><span class="na">getPower</span><span class="o">().</span><span class="na">trackBySmell</span><span class="o">();</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">DogBoy</span> <span class="n">dogBoy</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DogBoy</span><span class="o">();</span>
    <span class="n">useSuperHearing</span><span class="o">(</span><span class="n">dogBoy</span><span class="o">);</span>
    <span class="n">superFind</span><span class="o">(</span><span class="n">dogBoy</span><span class="o">);</span>
    <span class="c1">// You can do this:</span>
    <span class="nc">List</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="nc">SuperHearing</span><span class="o">&gt;</span> <span class="n">audioBoys</span><span class="o">;</span>
    <span class="c1">// But you can't do this:</span>
    <span class="c1">// List&lt;? extends SuperHearing &amp; SuperSmell&gt; dogBoys;</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~</span>
</pre></table></code></div></div><h2 id="1510-通配符">15.10 通配符</h2><p>可以向导出类型的数组赋予基类型的数组引用：</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre><td class="rouge-code"><pre><span class="c1">//: generics/CovariantArrays.java</span>

<span class="kd">class</span> <span class="nc">Fruit</span> <span class="o">{}</span>
<span class="kd">class</span> <span class="nc">Apple</span> <span class="kd">extends</span> <span class="nc">Fruit</span> <span class="o">{}</span>
<span class="kd">class</span> <span class="nc">Jonathan</span> <span class="kd">extends</span> <span class="nc">Apple</span> <span class="o">{}</span>
<span class="kd">class</span> <span class="nc">Orange</span> <span class="kd">extends</span> <span class="nc">Fruit</span> <span class="o">{}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CovariantArrays</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Fruit</span><span class="o">[]</span> <span class="n">fruit</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Apple</span><span class="o">[</span><span class="mi">10</span><span class="o">];</span>
    <span class="n">fruit</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Apple</span><span class="o">();</span> <span class="c1">// OK</span>
    <span class="n">fruit</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Jonathan</span><span class="o">();</span> <span class="c1">// OK</span>
    <span class="c1">// Runtime type is Apple[], not Fruit[] or Orange[]:</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="c1">// Compiler allows you to add Fruit:</span>
      <span class="n">fruit</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Fruit</span><span class="o">();</span> <span class="c1">// ArrayStoreException</span>
    <span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span> <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">e</span><span class="o">);</span> <span class="o">}</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="c1">// Compiler allows you to add Oranges:</span>
      <span class="n">fruit</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Orange</span><span class="o">();</span> <span class="c1">// ArrayStoreException</span>
    <span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span> <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">e</span><span class="o">);</span> <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output:
java.lang.ArrayStoreException: Fruit
java.lang.ArrayStoreException: Orange
*/</span><span class="c1">//:~</span>
</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="c1">//: generics/NonCovariantGenerics.java</span>
<span class="c1">// {CompileTimeError} (Won't compile)</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">NonCovariantGenerics</span> <span class="o">{</span>
  <span class="c1">// Compile Error: incompatible types:</span>
  <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Fruit</span><span class="o">&gt;</span> <span class="n">flist</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">Apple</span><span class="o">&gt;();</span>
<span class="o">}</span> <span class="c1">///:~</span>
</pre></table></code></div></div><p>有时你想要在两个类之间建立某种类型的向上转型关系，这正是通配符所允许的：</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="c1">//: generics/GenericsAndCovariance.java</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">GenericsAndCovariance</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// Wildcards allow covariance:</span>
    <span class="nc">List</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="nc">Fruit</span><span class="o">&gt;</span> <span class="n">flist</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">Apple</span><span class="o">&gt;();</span>
    <span class="c1">// Compile Error: can't add any type of object:</span>
    <span class="c1">// flist.add(new Apple());</span>
    <span class="c1">// flist.add(new Fruit());</span>
    <span class="c1">// flist.add(new Object());</span>
    <span class="n">flist</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span> <span class="c1">// Legal but uninteresting</span>
    <span class="c1">// We know that it returns at least Fruit:</span>
    <span class="nc">Fruit</span> <span class="n">f</span> <span class="o">=</span> <span class="n">flist</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~</span>
</pre></table></code></div></div><h3 id="15101-编译器有多聪明">15.10.1 编译器有多聪明</h3><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="c1">//: generics/CompilerIntelligence.java</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CompilerIntelligence</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">List</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="nc">Fruit</span><span class="o">&gt;</span> <span class="n">flist</span> <span class="o">=</span>
      <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="k">new</span> <span class="nc">Apple</span><span class="o">());</span>
    <span class="nc">Apple</span> <span class="n">a</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Apple</span><span class="o">)</span><span class="n">flist</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span> <span class="c1">// No warning</span>
    <span class="n">flist</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="k">new</span> <span class="nc">Apple</span><span class="o">());</span> <span class="c1">// Argument is 'Object'</span>
    <span class="n">flist</span><span class="o">.</span><span class="na">indexOf</span><span class="o">(</span><span class="k">new</span> <span class="nc">Apple</span><span class="o">());</span> <span class="c1">// Argument is 'Object'</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~</span>
</pre></table></code></div></div><p>当你指定一个<code class="language-plaintext highlighter-rouge">ArrayList&lt;? extends Fruit&gt;</code>时，<code class="language-plaintext highlighter-rouge">add()</code>的参数就变成了“? extends Fruit”。从这个描述中，编译器并不能了解这里需要<code class="language-plaintext highlighter-rouge">Fruit</code>的哪个具体子类型，因此它不会接受任何类型的<code class="language-plaintext highlighter-rouge">Fruit</code>。</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre><td class="rouge-code"><pre><span class="c1">//: generics/Holder.java</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Holder</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="no">T</span> <span class="n">value</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">Holder</span><span class="o">()</span> <span class="o">{}</span>
  <span class="kd">public</span> <span class="nf">Holder</span><span class="o">(</span><span class="no">T</span> <span class="n">val</span><span class="o">)</span> <span class="o">{</span> <span class="n">value</span> <span class="o">=</span> <span class="n">val</span><span class="o">;</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">set</span><span class="o">(</span><span class="no">T</span> <span class="n">val</span><span class="o">)</span> <span class="o">{</span> <span class="n">value</span> <span class="o">=</span> <span class="n">val</span><span class="o">;</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="no">T</span> <span class="nf">get</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">value</span><span class="o">;</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="nc">Object</span> <span class="n">obj</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">obj</span><span class="o">);</span>
  <span class="o">}</span>    
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Holder</span><span class="o">&lt;</span><span class="nc">Apple</span><span class="o">&gt;</span> <span class="nc">Apple</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Holder</span><span class="o">&lt;</span><span class="nc">Apple</span><span class="o">&gt;(</span><span class="k">new</span> <span class="nc">Apple</span><span class="o">());</span>
    <span class="nc">Apple</span> <span class="n">d</span> <span class="o">=</span> <span class="nc">Apple</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
    <span class="nc">Apple</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">d</span><span class="o">);</span>
    <span class="c1">// Holder&lt;Fruit&gt; Fruit = Apple; // Cannot upcast</span>
    <span class="nc">Holder</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="nc">Fruit</span><span class="o">&gt;</span> <span class="n">fruit</span> <span class="o">=</span> <span class="nc">Apple</span><span class="o">;</span> <span class="c1">// OK</span>
    <span class="nc">Fruit</span> <span class="n">p</span> <span class="o">=</span> <span class="n">fruit</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
    <span class="n">d</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Apple</span><span class="o">)</span><span class="n">fruit</span><span class="o">.</span><span class="na">get</span><span class="o">();</span> <span class="c1">// Returns 'Object'</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="nc">Orange</span> <span class="n">c</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Orange</span><span class="o">)</span><span class="n">fruit</span><span class="o">.</span><span class="na">get</span><span class="o">();</span> <span class="c1">// No warning</span>
    <span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span> <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">e</span><span class="o">);</span> <span class="o">}</span>
    <span class="c1">// fruit.set(new Apple()); // Cannot call set()</span>
    <span class="c1">// fruit.set(new Fruit()); // Cannot call set()</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">fruit</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">d</span><span class="o">));</span> <span class="c1">// OK</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output: (Sample)
java.lang.ClassCastException: Apple cannot be cast to Orange
true
*/</span><span class="c1">//:~</span>
</pre></table></code></div></div><h3 id="15102-逆变">15.10.2 逆变</h3><p>还可以走另外一条路，即使用<code class="language-plaintext highlighter-rouge">超类型通配符</code>。</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="c1">//: generics/SuperTypeWildcards.java</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SuperTypeWildcards</span> <span class="o">{</span>
  <span class="kd">static</span> <span class="kt">void</span> <span class="nf">writeTo</span><span class="o">(</span><span class="nc">List</span><span class="o">&lt;?</span> <span class="kd">super</span> <span class="nc">Apple</span><span class="o">&gt;</span> <span class="n">apples</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">apples</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nc">Apple</span><span class="o">());</span>
    <span class="n">apples</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nc">Jonathan</span><span class="o">());</span>
    <span class="c1">// apples.add(new Fruit()); // Error</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~</span>
</pre></table></code></div></div><p>List&lt;? super Apple&gt;是Apple的某种基类型的List，这样你就知道向其中添加Apple或Apple的子类型是安全的。</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre><span class="c1">//: generics/GenericWriting.java</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">GenericWriting</span> <span class="o">{</span>
  <span class="kd">static</span> <span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="kt">void</span> <span class="nf">writeExact</span><span class="o">(</span><span class="nc">List</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">,</span> <span class="no">T</span> <span class="n">item</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">item</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">static</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Apple</span><span class="o">&gt;</span> <span class="n">apples</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">Apple</span><span class="o">&gt;();</span>
  <span class="kd">static</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Fruit</span><span class="o">&gt;</span> <span class="n">fruit</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">Fruit</span><span class="o">&gt;();</span>
  <span class="kd">static</span> <span class="kt">void</span> <span class="nf">f1</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">writeExact</span><span class="o">(</span><span class="n">apples</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Apple</span><span class="o">());</span>
    <span class="c1">// writeExact(fruit, new Apple()); // Error:</span>
    <span class="c1">// Incompatible types: found Fruit, required Apple</span>
  <span class="o">}</span>
  <span class="kd">static</span> <span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="kt">void</span> <span class="nf">writeWithWildcard</span><span class="o">(</span><span class="nc">List</span><span class="o">&lt;?</span> <span class="kd">super</span> <span class="no">T</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">,</span> <span class="no">T</span> <span class="n">item</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">item</span><span class="o">);</span>
  <span class="o">}</span>    
  <span class="kd">static</span> <span class="kt">void</span> <span class="nf">f2</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">writeWithWildcard</span><span class="o">(</span><span class="n">apples</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Apple</span><span class="o">());</span>
    <span class="n">writeWithWildcard</span><span class="o">(</span><span class="n">fruit</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Apple</span><span class="o">());</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span> <span class="n">f1</span><span class="o">();</span> <span class="n">f2</span><span class="o">();</span> <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~</span>
</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
</pre><td class="rouge-code"><pre><span class="c1">//: generics/GenericReading.java</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">GenericReading</span> <span class="o">{</span>
  <span class="kd">static</span> <span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="no">T</span> <span class="nf">readExact</span><span class="o">(</span><span class="nc">List</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">list</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">static</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Apple</span><span class="o">&gt;</span> <span class="n">apples</span> <span class="o">=</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="k">new</span> <span class="nc">Apple</span><span class="o">());</span>
  <span class="kd">static</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Fruit</span><span class="o">&gt;</span> <span class="n">fruit</span> <span class="o">=</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="k">new</span> <span class="nc">Fruit</span><span class="o">());</span>
  <span class="c1">// A static method adapts to each call:</span>
  <span class="kd">static</span> <span class="kt">void</span> <span class="nf">f1</span><span class="o">()</span> <span class="o">{</span>
    <span class="nc">Apple</span> <span class="n">a</span> <span class="o">=</span> <span class="n">readExact</span><span class="o">(</span><span class="n">apples</span><span class="o">);</span>
    <span class="nc">Fruit</span> <span class="n">f</span> <span class="o">=</span> <span class="n">readExact</span><span class="o">(</span><span class="n">fruit</span><span class="o">);</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">readExact</span><span class="o">(</span><span class="n">apples</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="c1">// If, however, you have a class, then its type is</span>
  <span class="c1">// established when the class is instantiated:</span>
  <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Reader</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="no">T</span> <span class="nf">readExact</span><span class="o">(</span><span class="nc">List</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">)</span> <span class="o">{</span> <span class="k">return</span> <span class="n">list</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span> <span class="o">}</span>
  <span class="o">}</span>    
  <span class="kd">static</span> <span class="kt">void</span> <span class="nf">f2</span><span class="o">()</span> <span class="o">{</span>
    <span class="nc">Reader</span><span class="o">&lt;</span><span class="nc">Fruit</span><span class="o">&gt;</span> <span class="n">fruitReader</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Reader</span><span class="o">&lt;</span><span class="nc">Fruit</span><span class="o">&gt;();</span>
    <span class="nc">Fruit</span> <span class="n">f</span> <span class="o">=</span> <span class="n">fruitReader</span><span class="o">.</span><span class="na">readExact</span><span class="o">(</span><span class="n">fruit</span><span class="o">);</span>
    <span class="c1">// Fruit a = fruitReader.readExact(apples); // Error:</span>
    <span class="c1">// readExact(List&lt;Fruit&gt;) cannot be</span>
    <span class="c1">// applied to (List&lt;Apple&gt;).</span>
  <span class="o">}</span>
  <span class="kd">static</span> <span class="kd">class</span> <span class="nc">CovariantReader</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="no">T</span> <span class="nf">readCovariant</span><span class="o">(</span><span class="nc">List</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="no">T</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">return</span> <span class="n">list</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
  <span class="kd">static</span> <span class="kt">void</span> <span class="nf">f3</span><span class="o">()</span> <span class="o">{</span>
    <span class="nc">CovariantReader</span><span class="o">&lt;</span><span class="nc">Fruit</span><span class="o">&gt;</span> <span class="n">fruitReader</span> <span class="o">=</span>
      <span class="k">new</span> <span class="nc">CovariantReader</span><span class="o">&lt;</span><span class="nc">Fruit</span><span class="o">&gt;();</span>
    <span class="nc">Fruit</span> <span class="n">f</span> <span class="o">=</span> <span class="n">fruitReader</span><span class="o">.</span><span class="na">readCovariant</span><span class="o">(</span><span class="n">fruit</span><span class="o">);</span>
    <span class="nc">Fruit</span> <span class="n">a</span> <span class="o">=</span> <span class="n">fruitReader</span><span class="o">.</span><span class="na">readCovariant</span><span class="o">(</span><span class="n">apples</span><span class="o">);</span>
  <span class="o">}</span>    
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">f1</span><span class="o">();</span> <span class="n">f2</span><span class="o">();</span> <span class="n">f3</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~</span>
</pre></table></code></div></div><h3 id="15103-无界通配符">15.10.3 无界通配符</h3><p><code class="language-plaintext highlighter-rouge">无界通配符&lt;?&gt;</code>看起来意味着“任何事物”，因此使用无界通配符好像等价于使用原生类型。</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
</pre><td class="rouge-code"><pre><span class="c1">//: generics/UnboundedWildcards1.java</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UnboundedWildcards1</span> <span class="o">{</span>
  <span class="kd">static</span> <span class="nc">List</span> <span class="n">list1</span><span class="o">;</span>
  <span class="kd">static</span> <span class="nc">List</span><span class="o">&lt;?&gt;</span> <span class="n">list2</span><span class="o">;</span>
  <span class="kd">static</span> <span class="nc">List</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="nc">Object</span><span class="o">&gt;</span> <span class="n">list3</span><span class="o">;</span>
  <span class="kd">static</span> <span class="kt">void</span> <span class="nf">assign1</span><span class="o">(</span><span class="nc">List</span> <span class="n">list</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">list1</span> <span class="o">=</span> <span class="n">list</span><span class="o">;</span>
    <span class="n">list2</span> <span class="o">=</span> <span class="n">list</span><span class="o">;</span>
    <span class="c1">// list3 = list; // Warning: unchecked conversion</span>
    <span class="c1">// Found: List, Required: List&lt;? extends Object&gt;</span>
  <span class="o">}</span>
  <span class="kd">static</span> <span class="kt">void</span> <span class="nf">assign2</span><span class="o">(</span><span class="nc">List</span><span class="o">&lt;?&gt;</span> <span class="n">list</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">list1</span> <span class="o">=</span> <span class="n">list</span><span class="o">;</span>
    <span class="n">list2</span> <span class="o">=</span> <span class="n">list</span><span class="o">;</span>
    <span class="n">list3</span> <span class="o">=</span> <span class="n">list</span><span class="o">;</span>
  <span class="o">}</span>    
  <span class="kd">static</span> <span class="kt">void</span> <span class="nf">assign3</span><span class="o">(</span><span class="nc">List</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="nc">Object</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">list1</span> <span class="o">=</span> <span class="n">list</span><span class="o">;</span>
    <span class="n">list2</span> <span class="o">=</span> <span class="n">list</span><span class="o">;</span>
    <span class="n">list3</span> <span class="o">=</span> <span class="n">list</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">assign1</span><span class="o">(</span><span class="k">new</span> <span class="nc">ArrayList</span><span class="o">());</span>
    <span class="n">assign2</span><span class="o">(</span><span class="k">new</span> <span class="nc">ArrayList</span><span class="o">());</span>
    <span class="c1">// assign3(new ArrayList()); // Warning:</span>
    <span class="c1">// Unchecked conversion. Found: ArrayList</span>
    <span class="c1">// Required: List&lt;? extends Object&gt;</span>
    <span class="n">assign1</span><span class="o">(</span><span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;());</span>
    <span class="n">assign2</span><span class="o">(</span><span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;());</span>
    <span class="n">assign3</span><span class="o">(</span><span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;());</span>
    <span class="c1">// Both forms are acceptable as List&lt;?&gt;:</span>
    <span class="nc">List</span><span class="o">&lt;?&gt;</span> <span class="n">wildList</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">();</span>
    <span class="n">wildList</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;();</span>
    <span class="n">assign1</span><span class="o">(</span><span class="n">wildList</span><span class="o">);</span>
    <span class="n">assign2</span><span class="o">(</span><span class="n">wildList</span><span class="o">);</span>
    <span class="n">assign3</span><span class="o">(</span><span class="n">wildList</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~</span>
</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="c1">//: generics/UnboundedWildcards2.java</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UnboundedWildcards2</span> <span class="o">{</span>
  <span class="kd">static</span> <span class="nc">Map</span> <span class="n">map1</span><span class="o">;</span>
  <span class="kd">static</span> <span class="nc">Map</span><span class="o">&lt;?,?&gt;</span> <span class="n">map2</span><span class="o">;</span>
  <span class="kd">static</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,?&gt;</span> <span class="n">map3</span><span class="o">;</span>
  <span class="kd">static</span> <span class="kt">void</span> <span class="nf">assign1</span><span class="o">(</span><span class="nc">Map</span> <span class="n">map</span><span class="o">)</span> <span class="o">{</span> <span class="n">map1</span> <span class="o">=</span> <span class="n">map</span><span class="o">;</span> <span class="o">}</span>
  <span class="kd">static</span> <span class="kt">void</span> <span class="nf">assign2</span><span class="o">(</span><span class="nc">Map</span><span class="o">&lt;?,?&gt;</span> <span class="n">map</span><span class="o">)</span> <span class="o">{</span> <span class="n">map2</span> <span class="o">=</span> <span class="n">map</span><span class="o">;</span> <span class="o">}</span>
  <span class="kd">static</span> <span class="kt">void</span> <span class="nf">assign3</span><span class="o">(</span><span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,?&gt;</span> <span class="n">map</span><span class="o">)</span> <span class="o">{</span> <span class="n">map3</span> <span class="o">=</span> <span class="n">map</span><span class="o">;</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">assign1</span><span class="o">(</span><span class="k">new</span> <span class="nc">HashMap</span><span class="o">());</span>
    <span class="n">assign2</span><span class="o">(</span><span class="k">new</span> <span class="nc">HashMap</span><span class="o">());</span>
    <span class="c1">// assign3(new HashMap()); // Warning:</span>
    <span class="c1">// Unchecked conversion. Found: HashMap</span>
    <span class="c1">// Required: Map&lt;String,?&gt;</span>
    <span class="n">assign1</span><span class="o">(</span><span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">Integer</span><span class="o">&gt;());</span>
    <span class="n">assign2</span><span class="o">(</span><span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">Integer</span><span class="o">&gt;());</span>
    <span class="n">assign3</span><span class="o">(</span><span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">Integer</span><span class="o">&gt;());</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~</span>
</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
</pre><td class="rouge-code"><pre><span class="c1">//: generics/Wildcards.java</span>
<span class="c1">// Exploring the meaning of wildcards.</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Wildcards</span> <span class="o">{</span>
   <span class="c1">// Raw argument:</span>
  <span class="kd">static</span> <span class="kt">void</span> <span class="nf">rawArgs</span><span class="o">(</span><span class="nc">Holder</span> <span class="n">holder</span><span class="o">,</span> <span class="nc">Object</span> <span class="n">arg</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// holder.set(arg); // Warning:</span>
    <span class="c1">//   Unchecked call to set(T) as a</span>
    <span class="c1">//   member of the raw type Holder</span>
    <span class="c1">// holder.set(new Wildcards()); // Same warning</span>

    <span class="c1">// Can't do this; don't have any 'T':</span>
    <span class="c1">// T t = holder.get();</span>

    <span class="c1">// OK, but type information has been lost:</span>
    <span class="nc">Object</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">holder</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
  <span class="o">}</span>    
  <span class="c1">// Similar to rawArgs(), but errors instead of warnings:</span>
  <span class="kd">static</span> <span class="kt">void</span> <span class="nf">unboundedArg</span><span class="o">(</span><span class="nc">Holder</span><span class="o">&lt;?&gt;</span> <span class="n">holder</span><span class="o">,</span> <span class="nc">Object</span> <span class="n">arg</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// holder.set(arg); // Error:</span>
    <span class="c1">//   set(capture of ?) in Holder&lt;capture of ?&gt;</span>
    <span class="c1">//   cannot be applied to (Object)</span>
    <span class="c1">// holder.set(new Wildcards()); // Same error</span>

    <span class="c1">// Can't do this; don't have any 'T':</span>
    <span class="c1">// T t = holder.get();</span>

    <span class="c1">// OK, but type information has been lost:</span>
    <span class="nc">Object</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">holder</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
  <span class="o">}</span>    
  <span class="kd">static</span> <span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="no">T</span> <span class="nf">exact1</span><span class="o">(</span><span class="nc">Holder</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">holder</span><span class="o">)</span> <span class="o">{</span>
    <span class="no">T</span> <span class="n">t</span> <span class="o">=</span> <span class="n">holder</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
    <span class="k">return</span> <span class="n">t</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">static</span> <span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="no">T</span> <span class="nf">exact2</span><span class="o">(</span><span class="nc">Holder</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">holder</span><span class="o">,</span> <span class="no">T</span> <span class="n">arg</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">holder</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">arg</span><span class="o">);</span>
    <span class="no">T</span> <span class="n">t</span> <span class="o">=</span> <span class="n">holder</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
    <span class="k">return</span> <span class="n">t</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">static</span> <span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="no">T</span> <span class="nf">wildSubtype</span><span class="o">(</span><span class="nc">Holder</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="no">T</span><span class="o">&gt;</span> <span class="n">holder</span><span class="o">,</span> <span class="no">T</span> <span class="n">arg</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// holder.set(arg); // Error:</span>
    <span class="c1">//   set(capture of ? extends T) in</span>
    <span class="c1">//   Holder&lt;capture of ? extends T&gt;</span>
    <span class="c1">//   cannot be applied to (T)</span>
    <span class="no">T</span> <span class="n">t</span> <span class="o">=</span> <span class="n">holder</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
    <span class="k">return</span> <span class="n">t</span><span class="o">;</span>
  <span class="o">}</span>    
  <span class="kd">static</span> <span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="kt">void</span> <span class="nf">wildSupertype</span><span class="o">(</span><span class="nc">Holder</span><span class="o">&lt;?</span> <span class="kd">super</span> <span class="no">T</span><span class="o">&gt;</span> <span class="n">holder</span><span class="o">,</span> <span class="no">T</span> <span class="n">arg</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">holder</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">arg</span><span class="o">);</span>
    <span class="c1">// T t = holder.get();  // Error:</span>
    <span class="c1">//   Incompatible types: found Object, required T</span>

    <span class="c1">// OK, but type information has been lost:</span>
    <span class="nc">Object</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">holder</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Holder</span> <span class="n">raw</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Holder</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">&gt;();</span>
    <span class="c1">// Or:</span>
    <span class="n">raw</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Holder</span><span class="o">();</span>
    <span class="nc">Holder</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">&gt;</span> <span class="n">qualified</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Holder</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">&gt;();</span>
    <span class="nc">Holder</span><span class="o">&lt;?&gt;</span> <span class="n">unbounded</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Holder</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">&gt;();</span>
    <span class="nc">Holder</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="nc">Long</span><span class="o">&gt;</span> <span class="n">bounded</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Holder</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">&gt;();</span>
    <span class="nc">Long</span> <span class="n">lng</span> <span class="o">=</span> <span class="mi">1L</span><span class="o">;</span>

    <span class="n">rawArgs</span><span class="o">(</span><span class="n">raw</span><span class="o">,</span> <span class="n">lng</span><span class="o">);</span>
    <span class="n">rawArgs</span><span class="o">(</span><span class="n">qualified</span><span class="o">,</span> <span class="n">lng</span><span class="o">);</span>
    <span class="n">rawArgs</span><span class="o">(</span><span class="n">unbounded</span><span class="o">,</span> <span class="n">lng</span><span class="o">);</span>
    <span class="n">rawArgs</span><span class="o">(</span><span class="n">bounded</span><span class="o">,</span> <span class="n">lng</span><span class="o">);</span>

    <span class="n">unboundedArg</span><span class="o">(</span><span class="n">raw</span><span class="o">,</span> <span class="n">lng</span><span class="o">);</span>
    <span class="n">unboundedArg</span><span class="o">(</span><span class="n">qualified</span><span class="o">,</span> <span class="n">lng</span><span class="o">);</span>
    <span class="n">unboundedArg</span><span class="o">(</span><span class="n">unbounded</span><span class="o">,</span> <span class="n">lng</span><span class="o">);</span>
    <span class="n">unboundedArg</span><span class="o">(</span><span class="n">bounded</span><span class="o">,</span> <span class="n">lng</span><span class="o">);</span>

    <span class="c1">// Object r1 = exact1(raw); // Warnings:</span>
    <span class="c1">//   Unchecked conversion from Holder to Holder&lt;T&gt;</span>
    <span class="c1">//   Unchecked method invocation: exact1(Holder&lt;T&gt;)</span>
    <span class="c1">//   is applied to (Holder)</span>
    <span class="nc">Long</span> <span class="n">r2</span> <span class="o">=</span> <span class="n">exact1</span><span class="o">(</span><span class="n">qualified</span><span class="o">);</span>
    <span class="nc">Object</span> <span class="n">r3</span> <span class="o">=</span> <span class="n">exact1</span><span class="o">(</span><span class="n">unbounded</span><span class="o">);</span> <span class="c1">// Must return Object</span>
    <span class="nc">Long</span> <span class="n">r4</span> <span class="o">=</span> <span class="n">exact1</span><span class="o">(</span><span class="n">bounded</span><span class="o">);</span>

    <span class="c1">// Long r5 = exact2(raw, lng); // Warnings:</span>
    <span class="c1">//   Unchecked conversion from Holder to Holder&lt;Long&gt;</span>
    <span class="c1">//   Unchecked method invocation: exact2(Holder&lt;T&gt;,T)</span>
    <span class="c1">//   is applied to (Holder,Long)</span>
    <span class="nc">Long</span> <span class="n">r6</span> <span class="o">=</span> <span class="n">exact2</span><span class="o">(</span><span class="n">qualified</span><span class="o">,</span> <span class="n">lng</span><span class="o">);</span>
    <span class="c1">// Long r7 = exact2(unbounded, lng); // Error:</span>
    <span class="c1">//   exact2(Holder&lt;T&gt;,T) cannot be applied to</span>
    <span class="c1">//   (Holder&lt;capture of ?&gt;,Long)</span>
    <span class="c1">// Long r8 = exact2(bounded, lng); // Error:</span>
    <span class="c1">//   exact2(Holder&lt;T&gt;,T) cannot be applied</span>
    <span class="c1">//   to (Holder&lt;capture of ? extends Long&gt;,Long)</span>

    <span class="c1">// Long r9 = wildSubtype(raw, lng); // Warnings:</span>
    <span class="c1">//   Unchecked conversion from Holder</span>
    <span class="c1">//   to Holder&lt;? extends Long&gt;</span>
    <span class="c1">//   Unchecked method invocation:</span>
    <span class="c1">//   wildSubtype(Holder&lt;? extends T&gt;,T) is</span>
    <span class="c1">//   applied to (Holder,Long)</span>
    <span class="nc">Long</span> <span class="n">r10</span> <span class="o">=</span> <span class="n">wildSubtype</span><span class="o">(</span><span class="n">qualified</span><span class="o">,</span> <span class="n">lng</span><span class="o">);</span>
    <span class="c1">// OK, but can only return Object:</span>
    <span class="nc">Object</span> <span class="n">r11</span> <span class="o">=</span> <span class="n">wildSubtype</span><span class="o">(</span><span class="n">unbounded</span><span class="o">,</span> <span class="n">lng</span><span class="o">);</span>
    <span class="nc">Long</span> <span class="n">r12</span> <span class="o">=</span> <span class="n">wildSubtype</span><span class="o">(</span><span class="n">bounded</span><span class="o">,</span> <span class="n">lng</span><span class="o">);</span>

    <span class="c1">// wildSupertype(raw, lng); // Warnings:</span>
    <span class="c1">//   Unchecked conversion from Holder</span>
    <span class="c1">//   to Holder&lt;? super Long&gt;</span>
    <span class="c1">//   Unchecked method invocation:</span>
    <span class="c1">//   wildSupertype(Holder&lt;? super T&gt;,T)</span>
    <span class="c1">//   is applied to (Holder,Long)</span>
    <span class="n">wildSupertype</span><span class="o">(</span><span class="n">qualified</span><span class="o">,</span> <span class="n">lng</span><span class="o">);</span>
    <span class="c1">// wildSupertype(unbounded, lng); // Error:</span>
    <span class="c1">//   wildSupertype(Holder&lt;? super T&gt;,T) cannot be</span>
    <span class="c1">//   applied to (Holder&lt;capture of ?&gt;,Long)</span>
    <span class="c1">// wildSupertype(bounded, lng); // Error:</span>
    <span class="c1">//   wildSupertype(Holder&lt;? super T&gt;,T) cannot be</span>
    <span class="c1">//  applied to (Holder&lt;capture of ? extends Long&gt;,Long)</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~</span>
</pre></table></code></div></div><p>在<code class="language-plaintext highlighter-rouge">rawArgs()</code>中，编译器知道Holder是一个泛型雷兴国，因此即使它在这里被表示成功一个原生类型，编译器仍旧知道向<code class="language-plaintext highlighter-rouge">set()</code>传递一个Object是不安全的。由于它是原生类型，你可以将任何类型的对象传递给<code class="language-plaintext highlighter-rouge">set()</code>，而这个对象将被向上转型为Object。因此，无论何时，只要使用了原生类型，都会放弃编译期检查。对get()的调用说明了相同的问题：没有任何T类型的对象，因此结果只能是一个Object。</p><p>人们很自然地会开始考虑原生Holder与Holder&lt;?&gt;是大致相同的事物。但是unboundedArg()强调tamen</p><h3 id="15104-捕获转换">15.10.4 捕获转换</h3><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre><td class="rouge-code"><pre><span class="c1">//: generics/CaptureConversion.java</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CaptureConversion</span> <span class="o">{</span>
  <span class="kd">static</span> <span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="kt">void</span> <span class="nf">f1</span><span class="o">(</span><span class="nc">Holder</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">holder</span><span class="o">)</span> <span class="o">{</span>
    <span class="no">T</span> <span class="n">t</span> <span class="o">=</span> <span class="n">holder</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">t</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getSimpleName</span><span class="o">());</span>
  <span class="o">}</span>
  <span class="kd">static</span> <span class="kt">void</span> <span class="nf">f2</span><span class="o">(</span><span class="nc">Holder</span><span class="o">&lt;?&gt;</span> <span class="n">holder</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">f1</span><span class="o">(</span><span class="n">holder</span><span class="o">);</span> <span class="c1">// Call with captured type</span>
  <span class="o">}</span>    
  <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"unchecked"</span><span class="o">)</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Holder</span> <span class="n">raw</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Holder</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;(</span><span class="mi">1</span><span class="o">);</span>
    <span class="c1">// f1(raw); // Produces warnings</span>
    <span class="n">f2</span><span class="o">(</span><span class="n">raw</span><span class="o">);</span> <span class="c1">// No warnings</span>
    <span class="nc">Holder</span> <span class="n">rawBasic</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Holder</span><span class="o">();</span>
    <span class="n">rawBasic</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="k">new</span> <span class="nc">Object</span><span class="o">());</span> <span class="c1">// Warning</span>
    <span class="n">f2</span><span class="o">(</span><span class="n">rawBasic</span><span class="o">);</span> <span class="c1">// No warnings</span>
    <span class="c1">// Upcast to Holder&lt;?&gt;, still figures it out:</span>
    <span class="nc">Holder</span><span class="o">&lt;?&gt;</span> <span class="n">wildcarded</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Holder</span><span class="o">&lt;</span><span class="nc">Double</span><span class="o">&gt;(</span><span class="mf">1.0</span><span class="o">);</span>
    <span class="n">f2</span><span class="o">(</span><span class="n">wildcarded</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output:
Integer
Object
Double
*/</span><span class="c1">//:~</span>
</pre></table></code></div></div><h2 id="1511-问题">15.11 问题</h2><h3 id="15111任何基本类型都不能作为类型参数">15.11.1.任何基本类型都不能作为类型参数</h3><h3 id="15112实现参数化接口">15.11.2.实现参数化接口</h3><h3 id="15113-转型和警告">15.11.3 转型和警告</h3><h3 id="15114-重载">15.11.4 重载</h3><h3 id="15115-基类劫持了接口">15.11.5 基类劫持了接口</h3><h2 id="1512-自限定的类型">15.12 自限定的类型</h2><h3 id="15121-古怪的循环泛型">15.12.1 古怪的循环泛型</h3><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="c1">//: generics/CuriouslyRecurringGeneric.java</span>

<span class="kd">class</span> <span class="nc">GenericType</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="o">{}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CuriouslyRecurringGeneric</span>
  <span class="kd">extends</span> <span class="nc">GenericType</span><span class="o">&lt;</span><span class="nc">CuriouslyRecurringGeneric</span><span class="o">&gt;</span> <span class="o">{}</span> <span class="c1">///:~</span>
</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="c1">//: generics/BasicHolder.java</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">BasicHolder</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="no">T</span> <span class="n">element</span><span class="o">;</span>
  <span class="kt">void</span> <span class="nf">set</span><span class="o">(</span><span class="no">T</span> <span class="n">arg</span><span class="o">)</span> <span class="o">{</span> <span class="n">element</span> <span class="o">=</span> <span class="n">arg</span><span class="o">;</span> <span class="o">}</span>
  <span class="no">T</span> <span class="nf">get</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">element</span><span class="o">;</span> <span class="o">}</span>
  <span class="kt">void</span> <span class="nf">f</span><span class="o">()</span> <span class="o">{</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">element</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getSimpleName</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~</span>
</pre></table></code></div></div><p>我们可以在一个古怪的循环泛型中使用<code class="language-plaintext highlighter-rouge">BasicHolder</code>。</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="c1">//: generics/CRGWithBasicHolder.java</span>

<span class="kd">class</span> <span class="nc">Subtype</span> <span class="kd">extends</span> <span class="nc">BasicHolder</span><span class="o">&lt;</span><span class="nc">Subtype</span><span class="o">&gt;</span> <span class="o">{}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CRGWithBasicHolder</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Subtype</span> <span class="n">st1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Subtype</span><span class="o">(),</span> <span class="n">st2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Subtype</span><span class="o">();</span>
    <span class="n">st1</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">st2</span><span class="o">);</span>
    <span class="nc">Subtype</span> <span class="n">st3</span> <span class="o">=</span> <span class="n">st1</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
    <span class="n">st1</span><span class="o">.</span><span class="na">f</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output:
Subtype
*/</span><span class="c1">//:~</span>
</pre></table></code></div></div><p>新类<code class="language-plaintext highlighter-rouge">Subtype</code>接受的参数和返回的值具有<code class="language-plaintext highlighter-rouge">Subtype</code>类型而不仅仅是基类<code class="language-plaintext highlighter-rouge">BasicHolder</code>类型。这就是<code class="language-plaintext highlighter-rouge">CRG</code>的本质：基类用到处类替代其参数。这意味着泛型基类变成了一种其所有到处类的公共功能的模版，但是这些功能对于其所有参数和返回值，将使用导出类型。也就是说，在所产生的类中将使用确切类型而不是基类型。因此，在<code class="language-plaintext highlighter-rouge">Subtype</code>中，传递给<code class="language-plaintext highlighter-rouge">set()</code>的参数和<code class="language-plaintext highlighter-rouge">get()</code>返回的类型都是确切的<code class="language-plaintext highlighter-rouge">Subtype</code>。</p><h3 id="15122-自限定">15.12.2 自限定</h3><p><code class="language-plaintext highlighter-rouge">BasicHolder</code>可以使用任何类型作为其泛型参数，就像下面看到的那样：</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="c1">//: generics/Unconstrained.java</span>

<span class="kd">class</span> <span class="nc">Other</span> <span class="o">{}</span>
<span class="kd">class</span> <span class="nc">BasicOther</span> <span class="kd">extends</span> <span class="nc">BasicHolder</span><span class="o">&lt;</span><span class="nc">Other</span><span class="o">&gt;</span> <span class="o">{}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Unconstrained</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">BasicOther</span> <span class="n">b</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BasicOther</span><span class="o">(),</span> <span class="n">b2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BasicOther</span><span class="o">();</span>
    <span class="n">b</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="k">new</span> <span class="nc">Other</span><span class="o">());</span>
    <span class="nc">Other</span> <span class="n">other</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
    <span class="n">b</span><span class="o">.</span><span class="na">f</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output:
Other
*/</span><span class="c1">//:~</span>
</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre><td class="rouge-code"><pre><span class="c1">//: generics/SelfBounding.java</span>

<span class="kd">class</span> <span class="nc">SelfBounded</span><span class="o">&lt;</span><span class="no">T</span> <span class="kd">extends</span> <span class="nc">SelfBounded</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;&gt;</span> <span class="o">{</span>
  <span class="no">T</span> <span class="n">element</span><span class="o">;</span>
  <span class="nc">SelfBounded</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="nf">set</span><span class="o">(</span><span class="no">T</span> <span class="n">arg</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">element</span> <span class="o">=</span> <span class="n">arg</span><span class="o">;</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="no">T</span> <span class="nf">get</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">element</span><span class="o">;</span> <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">A</span> <span class="kd">extends</span> <span class="nc">SelfBounded</span><span class="o">&lt;</span><span class="no">A</span><span class="o">&gt;</span> <span class="o">{}</span>
<span class="kd">class</span> <span class="nc">B</span> <span class="kd">extends</span> <span class="nc">SelfBounded</span><span class="o">&lt;</span><span class="no">A</span><span class="o">&gt;</span> <span class="o">{}</span> <span class="c1">// Also OK</span>

<span class="kd">class</span> <span class="nc">C</span> <span class="kd">extends</span> <span class="nc">SelfBounded</span><span class="o">&lt;</span><span class="no">C</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="no">C</span> <span class="nf">setAndGet</span><span class="o">(</span><span class="no">C</span> <span class="n">arg</span><span class="o">)</span> <span class="o">{</span> <span class="n">set</span><span class="o">(</span><span class="n">arg</span><span class="o">);</span> <span class="k">return</span> <span class="n">get</span><span class="o">();</span> <span class="o">}</span>
<span class="o">}</span>    

<span class="kd">class</span> <span class="nc">D</span> <span class="o">{}</span>
<span class="c1">// Can't do this:</span>
<span class="c1">// class E extends SelfBounded&lt;D&gt; {}</span>
<span class="c1">// Compile error: Type parameter D is not within its bound</span>

<span class="c1">// Alas, you can do this, so you can't force the idiom:</span>
<span class="kd">class</span> <span class="nc">F</span> <span class="kd">extends</span> <span class="nc">SelfBounded</span> <span class="o">{}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SelfBounding</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="no">A</span> <span class="n">a</span> <span class="o">=</span> <span class="k">new</span> <span class="no">A</span><span class="o">();</span>
    <span class="n">a</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="k">new</span> <span class="no">A</span><span class="o">());</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="k">new</span> <span class="no">A</span><span class="o">()).</span><span class="na">get</span><span class="o">();</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
    <span class="no">C</span> <span class="n">c</span> <span class="o">=</span> <span class="k">new</span> <span class="no">C</span><span class="o">();</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="na">setAndGet</span><span class="o">(</span><span class="k">new</span> <span class="no">C</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~</span>
</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="c1">//: generics/NotSelfBounded.java</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">NotSelfBounded</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="no">T</span> <span class="n">element</span><span class="o">;</span>
  <span class="nc">NotSelfBounded</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="nf">set</span><span class="o">(</span><span class="no">T</span> <span class="n">arg</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">element</span> <span class="o">=</span> <span class="n">arg</span><span class="o">;</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="no">T</span> <span class="nf">get</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">element</span><span class="o">;</span> <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">A2</span> <span class="kd">extends</span> <span class="nc">NotSelfBounded</span><span class="o">&lt;</span><span class="no">A2</span><span class="o">&gt;</span> <span class="o">{}</span>
<span class="kd">class</span> <span class="nc">B2</span> <span class="kd">extends</span> <span class="nc">NotSelfBounded</span><span class="o">&lt;</span><span class="no">A2</span><span class="o">&gt;</span> <span class="o">{}</span>

<span class="kd">class</span> <span class="nc">C2</span> <span class="kd">extends</span> <span class="nc">NotSelfBounded</span><span class="o">&lt;</span><span class="no">C2</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="no">C2</span> <span class="nf">setAndGet</span><span class="o">(</span><span class="no">C2</span> <span class="n">arg</span><span class="o">)</span> <span class="o">{</span> <span class="n">set</span><span class="o">(</span><span class="n">arg</span><span class="o">);</span> <span class="k">return</span> <span class="n">get</span><span class="o">();</span> <span class="o">}</span>
<span class="o">}</span>    

<span class="kd">class</span> <span class="nc">D2</span> <span class="o">{}</span>
<span class="c1">// Now this is OK:</span>
<span class="kd">class</span> <span class="nc">E2</span> <span class="kd">extends</span> <span class="nc">NotSelfBounded</span><span class="o">&lt;</span><span class="no">D2</span><span class="o">&gt;</span> <span class="o">{}</span> <span class="c1">///:~</span>
</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="c1">//: generics/SelfBoundingMethods.java</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SelfBoundingMethods</span> <span class="o">{</span>
  <span class="kd">static</span> <span class="o">&lt;</span><span class="no">T</span> <span class="kd">extends</span> <span class="nc">SelfBounded</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;&gt;</span> <span class="no">T</span> <span class="nf">f</span><span class="o">(</span><span class="no">T</span> <span class="n">arg</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">arg</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">arg</span><span class="o">).</span><span class="na">get</span><span class="o">();</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="no">A</span> <span class="n">a</span> <span class="o">=</span> <span class="n">f</span><span class="o">(</span><span class="k">new</span> <span class="no">A</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~</span>
</pre></table></code></div></div><h3 id="15123-参数协变">15.12.3 参数协变</h3><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="c1">//: generics/CovariantReturnTypes.java</span>

<span class="kd">class</span> <span class="nc">Base</span> <span class="o">{}</span>
<span class="kd">class</span> <span class="nc">Derived</span> <span class="kd">extends</span> <span class="nc">Base</span> <span class="o">{}</span>

<span class="kd">interface</span> <span class="nc">OrdinaryGetter</span> <span class="o">{</span>
  <span class="nc">Base</span> <span class="nf">get</span><span class="o">();</span>
<span class="o">}</span>

<span class="kd">interface</span> <span class="nc">DerivedGetter</span> <span class="kd">extends</span> <span class="nc">OrdinaryGetter</span> <span class="o">{</span>
  <span class="c1">// Return type of overridden method is allowed to vary:</span>
  <span class="nc">Derived</span> <span class="nf">get</span><span class="o">();</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CovariantReturnTypes</span> <span class="o">{</span>
  <span class="kt">void</span> <span class="nf">test</span><span class="o">(</span><span class="nc">DerivedGetter</span> <span class="n">d</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Derived</span> <span class="n">d2</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~</span>
</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="c1">//: generics/GenericsAndReturnTypes.java</span>

<span class="kd">interface</span> <span class="nc">GenericGetter</span><span class="o">&lt;</span><span class="no">T</span> <span class="kd">extends</span> <span class="nc">GenericGetter</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;&gt;</span> <span class="o">{</span>
  <span class="no">T</span> <span class="nf">get</span><span class="o">();</span>
<span class="o">}</span>

<span class="kd">interface</span> <span class="nc">Getter</span> <span class="kd">extends</span> <span class="nc">GenericGetter</span><span class="o">&lt;</span><span class="nc">Getter</span><span class="o">&gt;</span> <span class="o">{}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">GenericsAndReturnTypes</span> <span class="o">{</span>
  <span class="kt">void</span> <span class="nf">test</span><span class="o">(</span><span class="nc">Getter</span> <span class="n">g</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Getter</span> <span class="n">result</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
    <span class="nc">GenericGetter</span> <span class="n">gg</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="na">get</span><span class="o">();</span> <span class="c1">// Also the base type</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~</span>
</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre><td class="rouge-code"><pre><span class="c1">//: generics/OrdinaryArguments.java</span>

<span class="kd">class</span> <span class="nc">OrdinarySetter</span> <span class="o">{</span>
  <span class="kt">void</span> <span class="nf">set</span><span class="o">(</span><span class="nc">Base</span> <span class="n">base</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"OrdinarySetter.set(Base)"</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">DerivedSetter</span> <span class="kd">extends</span> <span class="nc">OrdinarySetter</span> <span class="o">{</span>
  <span class="kt">void</span> <span class="nf">set</span><span class="o">(</span><span class="nc">Derived</span> <span class="n">derived</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"DerivedSetter.set(Derived)"</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>    

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">OrdinaryArguments</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Base</span> <span class="n">base</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Base</span><span class="o">();</span>
    <span class="nc">Derived</span> <span class="n">derived</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Derived</span><span class="o">();</span>
    <span class="nc">DerivedSetter</span> <span class="n">ds</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DerivedSetter</span><span class="o">();</span>
    <span class="n">ds</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">derived</span><span class="o">);</span>
    <span class="n">ds</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">base</span><span class="o">);</span> <span class="c1">// Compiles: overloaded, not overridden!</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output:
DerivedSetter.set(Derived)
OrdinarySetter.set(Base)
*/</span><span class="c1">//:~</span>
</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="c1">//: generics/SelfBoundingAndCovariantArguments.java</span>

<span class="kd">interface</span> <span class="nc">SelfBoundSetter</span><span class="o">&lt;</span><span class="no">T</span> <span class="kd">extends</span> <span class="nc">SelfBoundSetter</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;&gt;</span> <span class="o">{</span>
  <span class="kt">void</span> <span class="nf">set</span><span class="o">(</span><span class="no">T</span> <span class="n">arg</span><span class="o">);</span>
<span class="o">}</span>

<span class="kd">interface</span> <span class="nc">Setter</span> <span class="kd">extends</span> <span class="nc">SelfBoundSetter</span><span class="o">&lt;</span><span class="nc">Setter</span><span class="o">&gt;</span> <span class="o">{}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SelfBoundingAndCovariantArguments</span> <span class="o">{</span>
  <span class="kt">void</span> <span class="nf">testA</span><span class="o">(</span><span class="nc">Setter</span> <span class="n">s1</span><span class="o">,</span> <span class="nc">Setter</span> <span class="n">s2</span><span class="o">,</span> <span class="nc">SelfBoundSetter</span> <span class="n">sbs</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">s1</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">s2</span><span class="o">);</span>
    <span class="c1">// s1.set(sbs); // Error:</span>
    <span class="c1">// set(Setter) in SelfBoundSetter&lt;Setter&gt;</span>
    <span class="c1">// cannot be applied to (SelfBoundSetter)</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~</span>
</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre><td class="rouge-code"><pre><span class="c1">//: generics/PlainGenericInheritance.java</span>

<span class="kd">class</span> <span class="nc">GenericSetter</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="o">{</span> <span class="c1">// Not self-bounded</span>
  <span class="kt">void</span> <span class="nf">set</span><span class="o">(</span><span class="no">T</span> <span class="n">arg</span><span class="o">){</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"GenericSetter.set(Base)"</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">DerivedGS</span> <span class="kd">extends</span> <span class="nc">GenericSetter</span><span class="o">&lt;</span><span class="nc">Base</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kt">void</span> <span class="nf">set</span><span class="o">(</span><span class="nc">Derived</span> <span class="n">derived</span><span class="o">){</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"DerivedGS.set(Derived)"</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>    

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PlainGenericInheritance</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Base</span> <span class="n">base</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Base</span><span class="o">();</span>
    <span class="nc">Derived</span> <span class="n">derived</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Derived</span><span class="o">();</span>
    <span class="nc">DerivedGS</span> <span class="n">dgs</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DerivedGS</span><span class="o">();</span>
    <span class="n">dgs</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">derived</span><span class="o">);</span>
    <span class="n">dgs</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">base</span><span class="o">);</span> <span class="c1">// Compiles: overloaded, not overridden!</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output:
DerivedGS.set(Derived)
GenericSetter.set(Base)
*/</span><span class="c1">//:~</span>
</pre></table></code></div></div><h2 id="1513-动态类型安全">15.13 动态类型安全</h2><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre><td class="rouge-code"><pre><span class="c1">//: generics/CheckedList.java</span>
<span class="c1">// Using Collection.checkedList().</span>
<span class="kn">import</span> <span class="nn">typeinfo.pets.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CheckedList</span> <span class="o">{</span>
  <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"unchecked"</span><span class="o">)</span>
  <span class="kd">static</span> <span class="kt">void</span> <span class="nf">oldStyleMethod</span><span class="o">(</span><span class="nc">List</span> <span class="n">probablyDogs</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">probablyDogs</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nc">Cat</span><span class="o">());</span>
  <span class="o">}</span>    
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Dog</span><span class="o">&gt;</span> <span class="n">dogs1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">Dog</span><span class="o">&gt;();</span>
    <span class="n">oldStyleMethod</span><span class="o">(</span><span class="n">dogs1</span><span class="o">);</span> <span class="c1">// Quietly accepts a Cat</span>
    <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Dog</span><span class="o">&gt;</span> <span class="n">dogs2</span> <span class="o">=</span> <span class="nc">Collections</span><span class="o">.</span><span class="na">checkedList</span><span class="o">(</span>
      <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">Dog</span><span class="o">&gt;(),</span> <span class="nc">Dog</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">oldStyleMethod</span><span class="o">(</span><span class="n">dogs2</span><span class="o">);</span> <span class="c1">// Throws an exception</span>
    <span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="c1">// Derived types work fine:</span>
    <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Pet</span><span class="o">&gt;</span> <span class="n">pets</span> <span class="o">=</span> <span class="nc">Collections</span><span class="o">.</span><span class="na">checkedList</span><span class="o">(</span>
      <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">Pet</span><span class="o">&gt;(),</span> <span class="nc">Pet</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="n">pets</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nc">Dog</span><span class="o">());</span>
    <span class="n">pets</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nc">Cat</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output:
java.lang.ClassCastException: Attempt to insert class typeinfo.pets.Cat element into collection with element type class typeinfo.pets.Dog
*/</span><span class="c1">//:~</span>
</pre></table></code></div></div><h2 id="1514异常">15.14异常</h2><h2 id="1515-混型">15.15 混型</h2><h3 id="15151-c中的混型">15.15.1 C++中的混型</h3><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
</pre><td class="rouge-code"><pre><span class="c1">//: generics/Mixins.cpp</span>
<span class="cp">#include &lt;string&gt;
#include &lt;ctime&gt;
#include &lt;iostream&gt;
</span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">T</span><span class="p">&gt;</span> <span class="k">class</span> <span class="nc">TimeStamped</span> <span class="o">:</span> <span class="k">public</span> <span class="n">T</span> <span class="p">{</span>
  <span class="kt">long</span> <span class="n">timeStamp</span><span class="p">;</span>
<span class="nl">public:</span>
  <span class="n">TimeStamped</span><span class="p">()</span> <span class="p">{</span> <span class="n">timeStamp</span> <span class="o">=</span> <span class="n">time</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span> <span class="p">}</span>
  <span class="kt">long</span> <span class="n">getStamp</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="n">timeStamp</span><span class="p">;</span> <span class="p">}</span>
<span class="p">};</span>

<span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">T</span><span class="p">&gt;</span> <span class="k">class</span> <span class="nc">SerialNumbered</span> <span class="o">:</span> <span class="k">public</span> <span class="n">T</span> <span class="p">{</span>
  <span class="kt">long</span> <span class="n">serialNumber</span><span class="p">;</span>
  <span class="k">static</span> <span class="kt">long</span> <span class="n">counter</span><span class="p">;</span>
<span class="nl">public:</span>
  <span class="n">SerialNumbered</span><span class="p">()</span> <span class="p">{</span> <span class="n">serialNumber</span> <span class="o">=</span> <span class="n">counter</span><span class="o">++</span><span class="p">;</span> <span class="p">}</span>
  <span class="kt">long</span> <span class="n">getSerialNumber</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="n">serialNumber</span><span class="p">;</span> <span class="p">}</span>
<span class="p">};</span>

<span class="c1">// Define and initialize the static storage:</span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">T</span><span class="p">&gt;</span> <span class="kt">long</span> <span class="n">SerialNumbered</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">counter</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Basic</span> <span class="p">{</span>
  <span class="n">string</span> <span class="n">value</span><span class="p">;</span>
<span class="nl">public:</span>
  <span class="kt">void</span> <span class="n">set</span><span class="p">(</span><span class="n">string</span> <span class="n">val</span><span class="p">)</span> <span class="p">{</span> <span class="n">value</span> <span class="o">=</span> <span class="n">val</span><span class="p">;</span> <span class="p">}</span>
  <span class="n">string</span> <span class="n">get</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="n">value</span><span class="p">;</span> <span class="p">}</span>
<span class="p">};</span>    

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">TimeStamped</span><span class="o">&lt;</span><span class="n">SerialNumbered</span><span class="o">&lt;</span><span class="n">Basic</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">mixin1</span><span class="p">,</span> <span class="n">mixin2</span><span class="p">;</span>
  <span class="n">mixin1</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="s">"test string 1"</span><span class="p">);</span>
  <span class="n">mixin2</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="s">"test string 2"</span><span class="p">);</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">mixin1</span><span class="p">.</span><span class="n">get</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">" "</span> <span class="o">&lt;&lt;</span> <span class="n">mixin1</span><span class="p">.</span><span class="n">getStamp</span><span class="p">()</span> <span class="o">&lt;&lt;</span>
    <span class="s">" "</span> <span class="o">&lt;&lt;</span> <span class="n">mixin1</span><span class="p">.</span><span class="n">getSerialNumber</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">mixin2</span><span class="p">.</span><span class="n">get</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">" "</span> <span class="o">&lt;&lt;</span> <span class="n">mixin2</span><span class="p">.</span><span class="n">getStamp</span><span class="p">()</span> <span class="o">&lt;&lt;</span>
    <span class="s">" "</span> <span class="o">&lt;&lt;</span> <span class="n">mixin2</span><span class="p">.</span><span class="n">getSerialNumber</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="p">}</span> <span class="cm">/* Output: (Sample)
test string 1 1129840250 1
test string 2 1129840250 2
*/</span><span class="c1">//:~</span>
</pre></table></code></div></div><h3 id="152-与接口混合">15.2 与接口混合</h3><p>一种更常见的推荐解决方案是使用接口来产生混型效果，就像下面这样：</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
</pre><td class="rouge-code"><pre><span class="c1">//: generics/Mixins.java</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">interface</span> <span class="nc">TimeStamped</span> <span class="o">{</span> <span class="kt">long</span> <span class="nf">getStamp</span><span class="o">();</span> <span class="o">}</span>

<span class="kd">class</span> <span class="nc">TimeStampedImp</span> <span class="kd">implements</span> <span class="nc">TimeStamped</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">timeStamp</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">TimeStampedImp</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">timeStamp</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Date</span><span class="o">().</span><span class="na">getTime</span><span class="o">();</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">long</span> <span class="nf">getStamp</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">timeStamp</span><span class="o">;</span> <span class="o">}</span>
<span class="o">}</span>

<span class="kd">interface</span> <span class="nc">SerialNumbered</span> <span class="o">{</span> <span class="kt">long</span> <span class="nf">getSerialNumber</span><span class="o">();</span> <span class="o">}</span>

<span class="kd">class</span> <span class="nc">SerialNumberedImp</span> <span class="kd">implements</span> <span class="nc">SerialNumbered</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="kt">long</span> <span class="n">counter</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialNumber</span> <span class="o">=</span> <span class="n">counter</span><span class="o">++;</span>
  <span class="kd">public</span> <span class="kt">long</span> <span class="nf">getSerialNumber</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">serialNumber</span><span class="o">;</span> <span class="o">}</span>
<span class="o">}</span>

<span class="kd">interface</span> <span class="nc">Basic</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">set</span><span class="o">(</span><span class="nc">String</span> <span class="n">val</span><span class="o">);</span>
  <span class="kd">public</span> <span class="nc">String</span> <span class="nf">get</span><span class="o">();</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">BasicImp</span> <span class="kd">implements</span> <span class="nc">Basic</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="nc">String</span> <span class="n">value</span><span class="o">;</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">set</span><span class="o">(</span><span class="nc">String</span> <span class="n">val</span><span class="o">)</span> <span class="o">{</span> <span class="n">value</span> <span class="o">=</span> <span class="n">val</span><span class="o">;</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="nc">String</span> <span class="nf">get</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">value</span><span class="o">;</span> <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Mixin</span> <span class="kd">extends</span> <span class="nc">BasicImp</span> <span class="kd">implements</span> <span class="nc">TimeStamped</span><span class="o">,</span> <span class="nc">SerialNumbered</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="nc">TimeStamped</span> <span class="n">timeStamp</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">TimeStampedImp</span><span class="o">();</span>
  <span class="kd">private</span> <span class="nc">SerialNumbered</span> <span class="n">serialNumber</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SerialNumberedImp</span><span class="o">();</span>
  <span class="kd">public</span> <span class="kt">long</span> <span class="nf">getStamp</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">timeStamp</span><span class="o">.</span><span class="na">getStamp</span><span class="o">();</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">long</span> <span class="nf">getSerialNumber</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">serialNumber</span><span class="o">.</span><span class="na">getSerialNumber</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Mixins</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Mixin</span> <span class="n">mixin1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Mixin</span><span class="o">(),</span> <span class="n">mixin2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Mixin</span><span class="o">();</span>
    <span class="n">mixin1</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="s">"test string 1"</span><span class="o">);</span>
    <span class="n">mixin2</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="s">"test string 2"</span><span class="o">);</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">mixin1</span><span class="o">.</span><span class="na">get</span><span class="o">()</span> <span class="o">+</span> <span class="s">" "</span> <span class="o">+</span>
      <span class="n">mixin1</span><span class="o">.</span><span class="na">getStamp</span><span class="o">()</span> <span class="o">+</span>  <span class="s">" "</span> <span class="o">+</span> <span class="n">mixin1</span><span class="o">.</span><span class="na">getSerialNumber</span><span class="o">());</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">mixin2</span><span class="o">.</span><span class="na">get</span><span class="o">()</span> <span class="o">+</span> <span class="s">" "</span> <span class="o">+</span>
      <span class="n">mixin2</span><span class="o">.</span><span class="na">getStamp</span><span class="o">()</span> <span class="o">+</span>  <span class="s">" "</span> <span class="o">+</span> <span class="n">mixin2</span><span class="o">.</span><span class="na">getSerialNumber</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output: (Sample)
test string 1 1132437151359 1
test string 2 1132437151359 2
*/</span><span class="c1">//:~</span>
</pre></table></code></div></div><h3 id="153-使用装饰器模式">15.3 使用装饰器模式</h3><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
</pre><td class="rouge-code"><pre><span class="c1">//: generics/decorator/Decoration.java</span>
<span class="kn">package</span> <span class="nn">generics.decorator</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">class</span> <span class="nc">Basic</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="nc">String</span> <span class="n">value</span><span class="o">;</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">set</span><span class="o">(</span><span class="nc">String</span> <span class="n">val</span><span class="o">)</span> <span class="o">{</span> <span class="n">value</span> <span class="o">=</span> <span class="n">val</span><span class="o">;</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="nc">String</span> <span class="nf">get</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">value</span><span class="o">;</span> <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Decorator</span> <span class="kd">extends</span> <span class="nc">Basic</span> <span class="o">{</span>
  <span class="kd">protected</span> <span class="nc">Basic</span> <span class="n">basic</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">Decorator</span><span class="o">(</span><span class="nc">Basic</span> <span class="n">basic</span><span class="o">)</span> <span class="o">{</span> <span class="k">this</span><span class="o">.</span><span class="na">basic</span> <span class="o">=</span> <span class="n">basic</span><span class="o">;</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">set</span><span class="o">(</span><span class="nc">String</span> <span class="n">val</span><span class="o">)</span> <span class="o">{</span> <span class="n">basic</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">val</span><span class="o">);</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="nc">String</span> <span class="nf">get</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">basic</span><span class="o">.</span><span class="na">get</span><span class="o">();</span> <span class="o">}</span>
<span class="o">}</span>    

<span class="kd">class</span> <span class="nc">TimeStamped</span> <span class="kd">extends</span> <span class="nc">Decorator</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">timeStamp</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">TimeStamped</span><span class="o">(</span><span class="nc">Basic</span> <span class="n">basic</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">(</span><span class="n">basic</span><span class="o">);</span>
    <span class="n">timeStamp</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Date</span><span class="o">().</span><span class="na">getTime</span><span class="o">();</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">long</span> <span class="nf">getStamp</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">timeStamp</span><span class="o">;</span> <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">SerialNumbered</span> <span class="kd">extends</span> <span class="nc">Decorator</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="kt">long</span> <span class="n">counter</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialNumber</span> <span class="o">=</span> <span class="n">counter</span><span class="o">++;</span>
  <span class="kd">public</span> <span class="nf">SerialNumbered</span><span class="o">(</span><span class="nc">Basic</span> <span class="n">basic</span><span class="o">)</span> <span class="o">{</span> <span class="kd">super</span><span class="o">(</span><span class="n">basic</span><span class="o">);</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">long</span> <span class="nf">getSerialNumber</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">serialNumber</span><span class="o">;</span> <span class="o">}</span>
<span class="o">}</span>    

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Decoration</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">TimeStamped</span> <span class="n">t</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">TimeStamped</span><span class="o">(</span><span class="k">new</span> <span class="nc">Basic</span><span class="o">());</span>
    <span class="nc">TimeStamped</span> <span class="n">t2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">TimeStamped</span><span class="o">(</span>
      <span class="k">new</span> <span class="nf">SerialNumbered</span><span class="o">(</span><span class="k">new</span> <span class="nc">Basic</span><span class="o">()));</span>
    <span class="c1">//! t2.getSerialNumber(); // Not available</span>
    <span class="nc">SerialNumbered</span> <span class="n">s</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SerialNumbered</span><span class="o">(</span><span class="k">new</span> <span class="nc">Basic</span><span class="o">());</span>
    <span class="nc">SerialNumbered</span> <span class="n">s2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SerialNumbered</span><span class="o">(</span>
      <span class="k">new</span> <span class="nf">TimeStamped</span><span class="o">(</span><span class="k">new</span> <span class="nc">Basic</span><span class="o">()));</span>
    <span class="c1">//! s2.getStamp(); // Not available</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="c1">///:~</span>
</pre></table></code></div></div><h3 id="154-与动态代理混合">15.4 与动态代理混合</h3><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
</pre><td class="rouge-code"><pre><span class="c1">//: generics/DynamicProxyMixin.java</span>
<span class="kn">import</span> <span class="nn">java.lang.reflect.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">net.mindview.util.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">net</span><span class="o">.</span><span class="na">mindview</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">Tuple</span><span class="o">.*;</span>

<span class="kd">class</span> <span class="nc">MixinProxy</span> <span class="kd">implements</span> <span class="nc">InvocationHandler</span> <span class="o">{</span>
  <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">Object</span><span class="o">&gt;</span> <span class="n">delegatesByMethod</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">MixinProxy</span><span class="o">(</span><span class="nc">TwoTuple</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">,</span><span class="nc">Class</span><span class="o">&lt;?&gt;&gt;...</span> <span class="n">pairs</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">delegatesByMethod</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">Object</span><span class="o">&gt;();</span>
    <span class="k">for</span><span class="o">(</span><span class="nc">TwoTuple</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">,</span><span class="nc">Class</span><span class="o">&lt;?&gt;&gt;</span> <span class="n">pair</span> <span class="o">:</span> <span class="n">pairs</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">for</span><span class="o">(</span><span class="nc">Method</span> <span class="n">method</span> <span class="o">:</span> <span class="n">pair</span><span class="o">.</span><span class="na">second</span><span class="o">.</span><span class="na">getMethods</span><span class="o">())</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">methodName</span> <span class="o">=</span> <span class="n">method</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>
        <span class="c1">// The first interface in the map</span>
        <span class="c1">// implements the method.</span>
        <span class="k">if</span> <span class="o">(!</span><span class="n">delegatesByMethod</span><span class="o">.</span><span class="na">containsKey</span><span class="o">(</span><span class="n">methodName</span><span class="o">))</span>
          <span class="n">delegatesByMethod</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">methodName</span><span class="o">,</span> <span class="n">pair</span><span class="o">.</span><span class="na">first</span><span class="o">);</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>    
  <span class="kd">public</span> <span class="nc">Object</span> <span class="nf">invoke</span><span class="o">(</span><span class="nc">Object</span> <span class="n">proxy</span><span class="o">,</span> <span class="nc">Method</span> <span class="n">method</span><span class="o">,</span>
    <span class="nc">Object</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Throwable</span> <span class="o">{</span>
    <span class="nc">String</span> <span class="n">methodName</span> <span class="o">=</span> <span class="n">method</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>
    <span class="nc">Object</span> <span class="n">delegate</span> <span class="o">=</span> <span class="n">delegatesByMethod</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">methodName</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">method</span><span class="o">.</span><span class="na">invoke</span><span class="o">(</span><span class="n">delegate</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"unchecked"</span><span class="o">)</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="nc">Object</span> <span class="nf">newInstance</span><span class="o">(</span><span class="nc">TwoTuple</span><span class="o">...</span> <span class="n">pairs</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Class</span><span class="o">[]</span> <span class="n">interfaces</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Class</span><span class="o">[</span><span class="n">pairs</span><span class="o">.</span><span class="na">length</span><span class="o">];</span>
    <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">pairs</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
      <span class="n">interfaces</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Class</span><span class="o">)</span><span class="n">pairs</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">second</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nc">ClassLoader</span> <span class="n">cl</span> <span class="o">=</span> <span class="n">pairs</span><span class="o">[</span><span class="mi">0</span><span class="o">].</span><span class="na">first</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getClassLoader</span><span class="o">();</span>
    <span class="k">return</span> <span class="nc">Proxy</span><span class="o">.</span><span class="na">newProxyInstance</span><span class="o">(</span>
      <span class="n">cl</span><span class="o">,</span> <span class="n">interfaces</span><span class="o">,</span> <span class="k">new</span> <span class="nc">MixinProxy</span><span class="o">(</span><span class="n">pairs</span><span class="o">));</span>
  <span class="o">}</span>
<span class="o">}</span>    

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DynamicProxyMixin</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Object</span> <span class="n">mixin</span> <span class="o">=</span> <span class="nc">MixinProxy</span><span class="o">.</span><span class="na">newInstance</span><span class="o">(</span>
      <span class="n">tuple</span><span class="o">(</span><span class="k">new</span> <span class="nc">BasicImp</span><span class="o">(),</span> <span class="nc">Basic</span><span class="o">.</span><span class="na">class</span><span class="o">),</span>
      <span class="n">tuple</span><span class="o">(</span><span class="k">new</span> <span class="nc">TimeStampedImp</span><span class="o">(),</span> <span class="nc">TimeStamped</span><span class="o">.</span><span class="na">class</span><span class="o">),</span>
      <span class="n">tuple</span><span class="o">(</span><span class="k">new</span> <span class="nc">SerialNumberedImp</span><span class="o">(),</span><span class="nc">SerialNumbered</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>
    <span class="nc">Basic</span> <span class="n">b</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Basic</span><span class="o">)</span><span class="n">mixin</span><span class="o">;</span>
    <span class="nc">TimeStamped</span> <span class="n">t</span> <span class="o">=</span> <span class="o">(</span><span class="nc">TimeStamped</span><span class="o">)</span><span class="n">mixin</span><span class="o">;</span>
    <span class="nc">SerialNumbered</span> <span class="n">s</span> <span class="o">=</span> <span class="o">(</span><span class="nc">SerialNumbered</span><span class="o">)</span><span class="n">mixin</span><span class="o">;</span>
    <span class="n">b</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="s">"Hello"</span><span class="o">);</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">b</span><span class="o">.</span><span class="na">get</span><span class="o">());</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">t</span><span class="o">.</span><span class="na">getStamp</span><span class="o">());</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">s</span><span class="o">.</span><span class="na">getSerialNumber</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="cm">/* Output: (Sample)
Hello
1132519137015
1
*/</span><span class="c1">//:~</span>
</pre></table></code></div></div><h2 id="1516-潜在类型机制">15.16 潜在类型机制</h2><h2 id="1517-对缺乏潜在类型机制的补偿">15.17 对缺乏潜在类型机制的补偿</h2><h2 id="1518-将函数对象用作策略">15.18 将函数对象用作策略</h2><h2 id="1519-总结转型真的如此之糟吗">15.19 总结：转型真的如此之糟吗？</h2><h2 id="相关资料">相关资料</h2><ul><li><a href="http://java.sun.com/j2se/1.5/pdf/generics-tutorial.pdf">Java Generics Tutorial</a><li><a href="https://book.douban.com/subject/2303830/">Java Generics and Collections</a><li><a href="http://www.angelikalanger.com/GenericsFAQ/JavaGenericsFAQ.html">Java Generics FAQs</a><li><a href="https://www.zhihu.com/question/20400700">Java 泛型 &lt;? super T&gt; 中 super 怎么 理解？与 extends 有何不同？</a></ul></div><div class="post-tail-wrapper text-muted"><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/thinking-in-java/" class="post-tag no-text-decoration" >Thinking in Java</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=《Java编程思想》第15章泛型 - malinkang&url=https://malinkang.cn/posts/thinking-in-java-generics/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=《Java编程思想》第15章泛型 - malinkang&u=https://malinkang.cn/posts/thinking-in-java-generics/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=《Java编程思想》第15章泛型 - malinkang&url=https://malinkang.cn/posts/thinking-in-java-generics/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/dagger-guide/">Dagger使用指南</a><li><a href="/posts/understanding-the-jvm-runtime-data-areas/">《深入理解JVM》第2章Java内存区域与内存溢出异常</a><li><a href="/posts/understanding-the-jvm-garbage-collection/">《深入理解JVM》第3章垃圾收集器</a><li><a href="/posts/understanding-the-jvm-class-file-structure/">《深入理解JVM》第6章类文件结构</a><li><a href="/posts/understanding-the-jvm-class-loader/">《深入理解JVM》第7章虚拟机类加载机制</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/">源码分析</a> <a class="post-tag" href="/tags/thinking-in-java/">Thinking in Java</a> <a class="post-tag" href="/tags/android/">Android</a> <a class="post-tag" href="/tags/effective-java/">Effective Java</a> <a class="post-tag" href="/tags/kotlin/">Kotlin</a> <a class="post-tag" href="/tags/java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98/">Java并发编程实战</a> <a class="post-tag" href="/tags/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3jvm/">深入理解JVM</a> <a class="post-tag" href="/tags/android/">android</a> <a class="post-tag" href="/tags/databinding/">databinding</a> <a class="post-tag" href="/tags/recyclerview/">RecyclerView</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/thinking-in-java-everything-is-an-object/"><div class="card-body"> <span class="timeago small" > Mar 20, 2013 <i class="unloaded">2013-03-20T00:26:34+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>《Java编程思想》第2章一切都是对象</h3><div class="text-muted small"><p> 2.2 必须由你创建所有对象 2.2.1 存储到什么地方 2.2.2 特例：基本类型 在程序设计中经常用到一系列类型，它们需要特殊对待。可以把它们想象成“基本”类型。之所以特殊对待，是因为new将对象存储在“堆”里，故用new创建一个对象，特别是小的、简单的变量，往往不是很有效。因此，对于这些类型，Java采取与C和C++相同的方法。也就是说，不用new来创建变量，而是创建一个并非是引...</p></div></div></a></div><div class="card"> <a href="/posts/thinking-in-java-operators/"><div class="card-body"> <span class="timeago small" > Mar 26, 2013 <i class="unloaded">2013-03-26T21:39:36+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>《Java编程思想》第3章操作符</h3><div class="text-muted small"><p></p></div></div></a></div><div class="card"> <a href="/posts/thinking-in-java-controlling-execution/"><div class="card-body"> <span class="timeago small" > Apr 2, 2013 <i class="unloaded">2013-04-02T21:39:36+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>《Java编程思想》第4章控制流程</h3><div class="text-muted small"><p></p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/thinking-in-java-type-information/" class="btn btn-outline-primary" prompt="Older"><p>《Java编程思想》第14章类型信息</p></a> <a href="/posts/thinking-in-java-arrays/" class="btn btn-outline-primary" prompt="Newer"><p>《Java编程思想》第16章数组</p></a></div><div id="disqus" class="pt-2 pb-2"><p class="text-center text-muted small pb-5"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script src="/assets/js/lib/jquery.disqusloader.min.js"></script> <script> const options = { scriptUrl: '//malinkang-cn.disqus.com/embed.js', disqusConfig: function() { this.page.title = '《Java编程思想》第15章泛型'; this.page.url = 'https://malinkang.cn/posts/thinking-in-java-generics/'; this.page.identifier = '/posts/thinking-in-java-generics/'; } }; $.disqusLoader('#disqus', options); </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://twitter.com/malinkang">malinkang</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/">源码分析</a> <a class="post-tag" href="/tags/thinking-in-java/">Thinking in Java</a> <a class="post-tag" href="/tags/android/">Android</a> <a class="post-tag" href="/tags/effective-java/">Effective Java</a> <a class="post-tag" href="/tags/kotlin/">Kotlin</a> <a class="post-tag" href="/tags/java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98/">Java并发编程实战</a> <a class="post-tag" href="/tags/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3jvm/">深入理解JVM</a> <a class="post-tag" href="/tags/android/">android</a> <a class="post-tag" href="/tags/databinding/">databinding</a> <a class="post-tag" href="/tags/recyclerview/">RecyclerView</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://malinkang.cn{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
